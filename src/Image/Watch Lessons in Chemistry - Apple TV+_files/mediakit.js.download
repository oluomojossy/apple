/**
 * IMPORTANT NOTE:
 *
 * This file is licensed only for the use of Apple developers in providing MusicKit Web Services,
 * and is subject to the Apple Media Services Terms and Conditions and the Apple Developer Program
 * License Agreement. You may not copy, modify, re-host, or create derivative works of this file or the
 * accompanying Documentation, or any part thereof, including any updates, without Apple's written consent.
 *
 * ACKNOWLEDGEMENTS:
 * https://js-cdn.music.apple.com/musickit/v1/acknowledgements.txt
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MusicKit={})}(this,(function(e){"use strict";var t=void 0!==typeof self?self:this,r="undefined"!=typeof FastBoot?FastBoot.require("buffer").Buffer:"undefined"!=typeof process&&null!==process.versions&&null!==process.versions.node?Buffer:window.Buffer;function memoize(e){return function(...t){let r="",n=t.length;for(e._memoized=e._memoized||{};n--;){const e=t[n];r+=e===Object(e)?JSON.stringify(e):e}return r in e._memoized?e._memoized[r]:e._memoized[r]=e(...t)}}function isObject$1(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function generateUUID(){let e=strRandomizer()+strRandomizer();for(;e.length<16;)e+=strRandomizer();return e.slice(0,16)}function strRandomizer(){return Math.random().toString(16).substring(2)}const n=memoize(e=>/^[a|i|l|p]{1}\.[a-zA-Z0-9]+$/.test(e)),i=memoize(e=>/^(a\.)?[a-zA-Z0-9]+$/.test(e));function detectNodeEnvironment(){var e,t,r,n;return void 0!==(null===(r=globalThis)||void 0===r||null===(t=r.process)||void 0===t||null===(e=t.versions)||void 0===e?void 0:e.node)||void 0!==(null===(n=globalThis)||void 0===n?void 0:n.FastBoot)}function isNodeEnvironment$1(){return detectNodeEnvironment()}const o=memoize(detectNodeEnvironment()?e=>r.from(e,"base64").toString("binary"):e=>window.atob(e));memoize(detectNodeEnvironment()?e=>r.from(e).toString("base64"):e=>window.btoa(e));const debounce=(e,t=250,r={isImmediate:!1})=>{let n;return function(...i){const o=this,a=r.isImmediate&&void 0===n;void 0!==n&&clearTimeout(n),n=setTimeout((function(){n=void 0,r.isImmediate||e.apply(o,i)}),t),a&&e.apply(o,i)}},arrayEquals=(e,t)=>!!e&&!!t&&[].every.call(e,(e,r)=>e===t[r]),a=memoize(e=>{const t=new Uint16Array(e),r=t.length;let n="";for(let i=0;i<r;i++)n+=String.fromCharCode(t[i]);return n}),s=memoize(e=>{const t=o(e);return c(t)});function ensureArray(e=[]){return Array.isArray(e)?e:[e]}const c=memoize(e=>{const t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n}),l=memoize(e=>{const t=e.length,r=new ArrayBuffer(2*t),n=new Uint16Array(r);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n}),d=memoize(e=>{let t,r,n,i,o,a,s,c=0;const l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let d="";for(;c<e.length;)t=e[c++],r=c<e.length?e[c++]:Number.NaN,n=c<e.length?e[c++]:Number.NaN,i=t>>2,o=(3&t)<<4|r>>4,a=(15&r)<<2|n>>6,s=63&n,isNaN(r)?a=s=64:isNaN(n)&&(s=64),d+=l.charAt(i)+l.charAt(o)+l.charAt(a)+l.charAt(s);return d});function hasOwn(e,t){return Object.prototype.hasOwnProperty.call(Object(e),t)}function transform$9(e,t,r=!1){return r&&(e=Object.keys(e).reduce((t,r)=>(t[e[r]]=r,t),{})),Object.keys(e).reduce((r,n)=>{const i=e[n],o="function"==typeof i?i():function(e,t){return t.split(".").reduce((e,t)=>{if(void 0!==e)return e[t]},e)}(t,i);return o&&function(e,t,r){t.split(".").reduce((t,n,i,o)=>{const a=i===o.length-1,s=hasOwn(t,n),c=t[n]instanceof Object,l=null===t[n];if(!a&&s&&(!c||l))throw new TypeError(`Value at ${o.slice(0,i+1).join(".")} in keypath is not an Object.`);return a?(t[n]=r,e):s?t[n]:t[n]={}},e)}(r,n,o),r},{})}function transformKeys(e,t){return Object.keys(e).reduce((r,n)=>(r[t(n)]=e[n],r),{})}class GenericStorage{get data(){return this._data}set data(e){this._data=e}get length(){return this.keys.length}get keys(){return Object.keys(this.data)}getItem(e){return this.data[e]||null}setItem(e,t){this.data[e]=t}removeItem(e){delete this.data[e]}clear(){this.keys.forEach(e=>this.removeItem(e))}key(e){return this.keys[e]||null}constructor(e={}){var t,r,n;n=void 0,(r="_data")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.data=e}}function getCookie(e="",t=document.cookie){const r=t.match(new RegExp(`(?:^|;\\s*)${e}=([^;]*)`));if(r)return r[1]}function setCookie(e,t,r="",n=14,i,o){const a=new Date;i=null!=i?i:window;const s=(o=null!=o?o:/\./.test(i.location.hostname)?i.location.hostname:"").length>0?`domain=${o}; `:"";a.setTime(a.getTime()+24*n*60*60*1e3);let c="";"https:"===i.location.protocol&&(c="; secure"),i.document.cookie=`${e}=${t}; expires=${a.toUTCString()}; ${s}path=${r}${c}`}function removeCookie(e,t,r){setCookie(e,"","/",0,t,r)}function hasSessionStorage(){let e=!1;try{e="undefined"!=typeof sessionStorage}catch(t){}return e}function getSessionStorage(){let e;return hasSessionStorage()&&(e=sessionStorage),e}function hasLocalStorage(){let e=!1;try{e="undefined"!=typeof localStorage}catch(t){}return e}function getLocalStorage(){let e;return hasLocalStorage()&&(e=localStorage),e}function _define_property$21(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Notifications{get shouldStorageDispatch(){return"undefined"!=typeof window&&hasSessionStorage()&&this.dispatchNamespace}addEventListener(e,t){Array.isArray(this._eventRegistry[e])&&this._eventRegistry[e].push(t)}dispatchEvent(e,t){Array.isArray(this._eventRegistry[e])&&this._eventRegistry[e].forEach(e=>e(t))}dispatchDistributedEvent(e,t){if(this.dispatchEvent(e,t),this.shouldStorageDispatch){var r;const n=`${this.dispatchNamespace}:${e}`;null===(r=getSessionStorage())||void 0===r||r.setItem(n,JSON.stringify(t))}}removeEventListener(e,t){if(Array.isArray(this._eventRegistry[e])){const r=this._eventRegistry[e].indexOf(t);this._eventRegistry[e].splice(r,1)}}_handleGlobalStorageEvent(e){var t;if(this.dispatchNamespace&&(null===(t=e.key)||void 0===t?void 0:t.startsWith(this.dispatchNamespace+":"))){const t=e.key.substring(this.dispatchNamespace.length+1);this.dispatchEvent(t,JSON.parse(e.newValue))}}constructor(e=[],t){_define_property$21(this,"dispatchNamespace",void 0),_define_property$21(this,"_eventRegistry",{}),e.forEach(e=>{this._eventRegistry[e]=[]}),t&&t.namespace&&(this.dispatchNamespace="com.apple."+t.namespace),this.shouldStorageDispatch&&(this._handleGlobalStorageEvent=this._handleGlobalStorageEvent.bind(this),window.addEventListener("storage",this._handleGlobalStorageEvent))}}let isMergeableObject=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){let t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===u}(e)}(e)};let u="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function cloneUnlessOtherwiseSpecified(e,t){return!1!==t.clone&&t.isMergeableObject(e)?deepmerge((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function defaultArrayMerge(e,t,r){return e.concat(t).map((function(e){return cloneUnlessOtherwiseSpecified(e,r)}))}function getKeys(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function mergeObject(e,t,r){let n={};return r.isMergeableObject(e)&&getKeys(e).forEach((function(t){n[t]=cloneUnlessOtherwiseSpecified(e[t],r)})),getKeys(t).forEach((function(i){r.isMergeableObject(t[i])&&e[i]?n[i]=function(e,t){if(!t.customMerge)return deepmerge;let r=t.customMerge(e);return"function"==typeof r?r:deepmerge}(i,r)(e[i],t[i],r):n[i]=cloneUnlessOtherwiseSpecified(t[i],r)})),n}function deepmerge(e,t,r){(r=r||{}).arrayMerge=r.arrayMerge||defaultArrayMerge,r.isMergeableObject=r.isMergeableObject||isMergeableObject;let n=Array.isArray(t);return n===Array.isArray(e)?n?r.arrayMerge(e,t,r):mergeObject(e,t,r):cloneUnlessOtherwiseSpecified(t,r)}function _define_property$20(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$20(e,t,r[t])}))}return e}function _object_spread_props$t(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _object_without_properties$2(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var p;deepmerge.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,r){return deepmerge(e,r,t)}),{})},function(e){e.dataRecordDidDelete="dataRecordDidDelete",e.dataRecordWillDelete="dataRecordWillDelete",e.dataRecordDidMaterialize="dataRecordDidMaterialize",e.dataRecordDidPopulate="dataRecordDidPopulate",e.dataRecordWillPopulate="dataRecordWillPopulate"}(p||(p={}));const isDataRecord=e=>!(!e||"function"!=typeof e.hasAttributes||"function"!=typeof e.hasRelationships||"function"!=typeof e.hasViews||"function"!=typeof e.serialize);class DataRecord{hasProperties(e){return!e||(e.attributes||e.relationships||e.views?!(e.attributes&&!this.hasAttributes(e.attributes))&&(!(e.relationships&&!this.hasRelationships(e.relationships))&&!(e.views&&!this.hasViews(e.views))):this.hasAttributes()||this.hasRelationships()||this.hasViews())}hasAttributes(e){return this._hasProperties(this._mjs.attributes,e)}hasRelationships(e){return this._hasProperties(this._mjs.relationships,e)}hasViews(e){return this._hasProperties(this._mjs.views,e)}meta(e){return e?this._meta[e]:this._meta}serialize(e=!0,t={},r={}){const n={id:this.id,type:this.type};return t[`${this.type}-${this.id}`]&&!r.allowFullDuplicateSerializations?n:(t[`${this.type}-${this.id}`]=!0,this.hasAttributes()&&(n.attributes=this._mjs.attributes.reduce((e,t)=>(e[t]=this[t],e),{})),this._mjs.relationships.length>0&&(n.relationships=this._serializeRelatedData(this._mjs.relationships,t,r)),this._mjs.views.length>0&&(n.views=this._serializeRelatedData(this._mjs.views,t,r)),e?{data:n}:n)}setProperty(e,t,r="attributes",n={}){function isMergeableObject(e){return!(!e||"object"!=typeof e||e instanceof DataRecord)}hasOwn(this,e)||(this._mjs[r]||(this._mjs[r]=[]),this._mjs[r].push(e));const setDescriptor=e=>({value:e,writable:!0,configurable:!0,enumerable:!0});this[e]&&t&&"object"==typeof this[e]&&"object"==typeof t?"attributes"===r?Object.defineProperty(this,e,setDescriptor(deepmerge(this[e],t,{arrayMerge:function(e,t,r){return t},isMergeableObject:isMergeableObject}))):"relationships"===r&&Array.isArray(this[e])&&n.extendRelationships?Object.defineProperty(this,e,setDescriptor(deepmerge(this[e],t,{isMergeableObject:isMergeableObject}))):Object.defineProperty(this,e,setDescriptor(t)):Object.defineProperty(this,e,setDescriptor(t))}removeRelative(e,t){this[e]&&(Array.isArray(this[e])?this[e]=this[e].filter(e=>e.id!==t):delete this[e])}setParent(e){const t=this._mjs.parents,r=t&&t.length>0;this._mjs.parents=r?t.concat(e):e}_hasProperties(e,t){return!!e&&(t?ensureArray(t).every(t=>e.includes(t)):e.length>0)}_serializeRelatedData(e,t={},r={}){return e.reduce((e,n)=>{if(r.excludeRelationships&&r.excludeRelationships.has(n))return e;if(r.includeRelationships&&!r.includeRelationships.has(n))return e;const i=this[n];return Array.isArray(i)?e[n]={data:i.map(e=>"function"==typeof e.serialize?e.serialize(!1,t,r):e)}:e[n]=i&&"function"==typeof i.serialize?i.serialize(!1,t,r):i,e},{})}constructor(e,t,r={}){_define_property$20(this,"type",void 0),_define_property$20(this,"id",void 0),_define_property$20(this,"_mjs",void 0),_define_property$20(this,"_meta",void 0),this.type=e,this.id=t,this._mjs={attributes:[],relationships:[],views:[]},this._meta={},this._mjs=_object_spread$N({},this._mjs,r)}}class DataStore extends Notifications{get mapping(){return this._mapping}set mapping(e){this._mapping=e}clear(){this._records={},this._expiryRecords=new Set}peek(e,t,r){if(this._checkForExpiredRecords(),!this._records[e])return t?null:[];if(!t)return Object.values(this._records[e]);if(Array.isArray(t))return t.map(t=>{const n=this._records[e][t];if(n&&n.hasProperties(r))return n});const n=this._records[e][t];return n&&n.hasProperties(r)?n:null}populateDataRecords(e,t={},r={}){if(!e.data)return[];if(!Array.isArray(e.data))return this.populateDataRecord(e.data,t,r);const n=[];return e.data.forEach((e,i)=>{const o=_object_spread_props$t(_object_spread$N({},r),{parents:r.parents?[_object_spread_props$t(_object_spread$N({},r.parents[0]),{position:i})]:[]});r.parents&&(r.parents[0].position=i);const a=this.populateDataRecord(e,t,o);n.push(a)}),n}populateDataRecord(e,t={},r){const n=r.filter||this.filter,i=r.mapping||this.mapping;if(n&&!n(e))return;if(i){let t="function"==typeof i?i(e):transform$9(i,e);Object.assign(e,t)}this._shouldDisableRecordReuse&&(t={});const o=this._materializeRecord(t,_object_spread$N({id:e.id,type:e.type},r));return e.meta&&(o._meta=e.meta),e.attributes&&e.attributes.cachingPolicy&&e.attributes.cachingPolicy.maxAge&&(o._mjs.expiration=Date.now()+1e3*e.attributes.cachingPolicy.maxAge,this._removeOnExpiration&&this._expiryRecords.add(o)),this._populateDataAttributes(e,o),"object"==typeof e.relationships&&Object.keys(e.relationships).forEach(n=>{let a=e.relationships[n];a&&"data"in a&&(a=this.populateDataRecords(a,t,{mapping:i,parents:[{relationshipName:n,parentType:o.type,parentId:o.id}]}),o.setProperty(n,a,"relationships",r))}),"object"==typeof e.views&&Object.keys(e.views).forEach(r=>{const n=e.views[r];if(n.attributes||n.data){const e=new DataRecord("view",r);if(this._populateDataAttributes(n,e),n.data){const r=this.populateDataRecords(n,t,i);e.setProperty("data",r,"relationships")}o.setProperty(r,e,"views")}}),o}query(e,t){this._checkForExpiredRecords();let includeRecord=e=>!1;return"string"==typeof e&&t?includeRecord=r=>{var n;return(null===(n=r)||void 0===n?void 0:n[e])===t}:"function"==typeof e?includeRecord=t=>{try{return e(t)}catch(r){return!1}}:"object"==typeof e&&(includeRecord=t=>{const r=Object.keys(e);let n=0;return r.forEach(r=>{var i;(null===(i=t)||void 0===i?void 0:i[r])===e[r]&&n++}),r.length===n}),Object.values(this._records).reduce((e,t)=>(Object.values(t).forEach(t=>{includeRecord(t)&&e.push(t)}),e),[])}remove(e,t){setTimeout(this._checkForExpiredRecords.bind(this),0);if(!hasOwn(this._records,e))return;const r=this.peek(e,t);r&&(this.dispatchEvent(p.dataRecordWillDelete,[e,t]),r._mjs.parents&&r._mjs.parents.length>0&&r._mjs.parents.forEach(({relationshipName:e,parentType:t,parentId:n})=>{this.peek(t,n).removeRelative(e,r.id)}),delete this._records[e][t],this.dispatchEvent(p.dataRecordDidDelete,[e,t]))}save(e,t={}){return setTimeout(this._checkForExpiredRecords.bind(this),0),this.populateDataRecords(e,this._records,t)}_populateDataAttributes(e,t){"object"==typeof e.attributes&&(this.dispatchEvent(p.dataRecordWillPopulate,[t.type,t.id]),Object.keys(e.attributes).forEach(r=>{t.setProperty(r,e.attributes[r],"attributes")}),this.dispatchEvent(p.dataRecordDidPopulate,[t.type,t.id]))}_materializeRecord(e,t){const{type:r,id:n}=t,i=_object_without_properties$2(t,["type","id"]);return e[r]=e[r]||{},e[r][n]?e[r][n].setParent(i.parents||[]):e[r][n]=new DataRecord(r,n,i),this.dispatchEvent(p.dataRecordDidMaterialize,[r,n]),e[r][n]}_checkForExpiredRecords(){const e=[];this._expiryRecords.forEach(t=>{Date.now()>t._mjs.expiration&&(e.push([t.type,t.id]),this._expiryRecords.delete(t))}),e.forEach(e=>{this.remove(...e)})}constructor(e={}){super([p.dataRecordDidDelete,p.dataRecordWillDelete,p.dataRecordDidMaterialize,p.dataRecordWillPopulate,p.dataRecordDidPopulate]),_define_property$20(this,"_records",void 0),_define_property$20(this,"_expiryRecords",void 0),_define_property$20(this,"_mapping",void 0),_define_property$20(this,"_removeOnExpiration",!1),_define_property$20(this,"_shouldDisableRecordReuse",!0),_define_property$20(this,"filter",void 0),this._records={},this._expiryRecords=new Set,this._removeOnExpiration=!!e.removeOnExpiration,this._mapping=e.mapping,this._shouldDisableRecordReuse=!!e.shouldDisableRecordReuse,this.filter=e.filter}}function _define_property$1$(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class DeveloperToken{get isExpired(){return this.expiration<Date.now()}_decode(e){return JSON.parse(o(e))}constructor(e){if(_define_property$1$(this,"token",void 0),_define_property$1$(this,"expiration",void 0),_define_property$1$(this,"keyId",void 0),_define_property$1$(this,"teamId",void 0),this.token=e,!e||!/^[a-z0-9\-\_]{16,}\.[a-z0-9\-\_]{16,}\.[a-z0-9\-\_]{16,}/i.test(e))throw new Error("Invalid token.");const[t,r]=e.split("."),{exp:n,iss:i}=this._decode(r);if(this.expiration=1e3*n,this.isExpired)throw new Error("Initialized with an expired token.");this.teamId=i;const{kid:o}=this._decode(t);this.keyId=o}}function _define_property$1_(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const h={400:"REQUEST_ERROR",401:"UNAUTHORIZED_ERROR",403:"ACCESS_DENIED",404:"NOT_FOUND",405:"NOT_FOUND",413:"REQUEST_ERROR",414:"REQUEST_ERROR",429:"QUOTA_EXCEEDED",500:"SERVER_ERROR",501:"NOT_FOUND",503:"SERVICE_UNAVAILABLE"},y={"-1004":"DEVICE_LIMIT","-1017":"GEO_BLOCK",1010:h[404],2002:"AUTHORIZATION_ERROR",2034:"TOKEN_EXPIRED",3059:"DEVICE_LIMIT",3063:"SUBSCRIPTION_ERROR",3076:"CONTENT_UNAVAILABLE",3082:"CONTENT_RESTRICTED",3084:"STREAM_UPSELL",5002:h[500],180202:"PLAYREADY_CBC_ENCRYPTION_ERROR",190121:"WIDEVINE_CDM_EXPIRED"},_=new Set(["CONTENT_EQUIVALENT","CONTENT_UNAVAILABLE","CONTENT_UNSUPPORTED","SERVER_ERROR","SUBSCRIPTION_ERROR","UNSUPPORTED_ERROR","USER_INTERACTION_REQUIRED"]);class MKError extends Error{static playActivityError(e){return new this("PLAY_ACTIVITY",e)}static parseError(e){return new this("PARSE_ERROR",e)}static responseError(e){const{status:t,statusText:r}=e,n=new this(h[t]||"NETWORK_ERROR",r||""+t);return n.data=e,n}static serverError(e,t="UNKNOWN_ERROR"){let{status:r,dialog:n,failureType:i,customerMessage:o,errorMessage:a,message:s}=e;n&&(s=n.message||n.customerMessage||n.errorMessage,n.message=s);const c=y[i]||y[r]||t,l=new this(c,s||o||a);return"STREAM_UPSELL"===c&&n&&n.okButtonAction&&n.okButtonAction.url&&(n.okButtonAction.url=n.okButtonAction.url.replace(/\&(?:challenge|key-system|uri|user-initiated)=[^\&]+/gim,"")),l.dialog=n,l}static internalError(e){return new this(MKError.INTERNAL_ERROR,e)}constructor(e,t){super(),_define_property$1_(this,"errorCode","UNKNOWN_ERROR"),_define_property$1_(this,"description",void 0),_define_property$1_(this,"dialog",void 0),_define_property$1_(this,"data",void 0),e&&_.has(e)?(this.name=this.errorCode=e,this.message=this.description=t||e):t||"string"!=typeof e?(this.name=this.errorCode=e||"UNKNOWN_ERROR",t&&(this.message=this.description=t)):(this.name=this.errorCode="UNKNOWN_ERROR",this.message=this.description=e),Error.captureStackTrace&&Error.captureStackTrace(this,MKError)}}_define_property$1_(MKError,"ACCESS_DENIED",h[403]),_define_property$1_(MKError,"AGE_VERIFICATION","AGE_VERIFICATION"),_define_property$1_(MKError,"AUTHORIZATION_ERROR",y[2002]),_define_property$1_(MKError,"BUFFER_STALLED_ERROR","BUFFER_STALLED_ERROR"),_define_property$1_(MKError,"CONFIGURATION_ERROR","CONFIGURATION_ERROR"),_define_property$1_(MKError,"CONTENT_EQUIVALENT","CONTENT_EQUIVALENT"),_define_property$1_(MKError,"CONTENT_RESTRICTED",y[3082]),_define_property$1_(MKError,"CONTENT_UNAVAILABLE",y[3076]),_define_property$1_(MKError,"CONTENT_UNSUPPORTED","CONTENT_UNSUPPORTED"),_define_property$1_(MKError,"DEVICE_LIMIT",y[3059]),_define_property$1_(MKError,"GEO_BLOCK",y[-1017]),_define_property$1_(MKError,"INVALID_ARGUMENTS","INVALID_ARGUMENTS"),_define_property$1_(MKError,"PLAYREADY_CBC_ENCRYPTION_ERROR","PLAYREADY_CBC_ENCRYPTION_ERROR"),_define_property$1_(MKError,"MEDIA_CERTIFICATE","MEDIA_CERTIFICATE"),_define_property$1_(MKError,"MEDIA_DESCRIPTOR","MEDIA_DESCRIPTOR"),_define_property$1_(MKError,"MEDIA_LICENSE","MEDIA_LICENSE"),_define_property$1_(MKError,"MEDIA_KEY","MEDIA_KEY"),_define_property$1_(MKError,"MEDIA_PLAYBACK","MEDIA_PLAYBACK"),_define_property$1_(MKError,"MEDIA_SESSION","MEDIA_SESSION"),_define_property$1_(MKError,"NETWORK_ERROR","NETWORK_ERROR"),_define_property$1_(MKError,"NOT_FOUND",y[1010]),_define_property$1_(MKError,"PARSE_ERROR","PARSE_ERROR"),_define_property$1_(MKError,"PLAY_ACTIVITY","PLAY_ACTIVITY"),_define_property$1_(MKError,"QUOTA_EXCEEDED",h[429]),_define_property$1_(MKError,"REQUEST_ERROR",h[400]),_define_property$1_(MKError,"SERVER_ERROR",y[5002]),_define_property$1_(MKError,"SERVICE_UNAVAILABLE",h[503]),_define_property$1_(MKError,"STREAM_UPSELL",y[3084]),_define_property$1_(MKError,"SUBSCRIPTION_ERROR",y[3063]),_define_property$1_(MKError,"TOKEN_EXPIRED",y[2034]),_define_property$1_(MKError,"UNAUTHORIZED_ERROR",h[401]),_define_property$1_(MKError,"UNKNOWN_ERROR","UNKNOWN_ERROR"),_define_property$1_(MKError,"UNSUPPORTED_ERROR","UNSUPPORTED_ERROR"),_define_property$1_(MKError,"USER_INTERACTION_REQUIRED","USER_INTERACTION_REQUIRED"),_define_property$1_(MKError,"INTERNAL_ERROR","INTERNAL_ERROR"),_define_property$1_(MKError,"OUTPUT_RESTRICTED","OUTPUT_RESTRICTED"),_define_property$1_(MKError,"WIDEVINE_CDM_EXPIRED","WIDEVINE_CDM_EXPIRED");function invoke(e){return void 0===e||(e=>"function"!=typeof e)(e)?e:e()}function _define_property$1Z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const DEFAULT_CACHE_KEY_FUNCTION=(e,t)=>`${t}${e}`;class NetworkCache{getItem(e){const t=this.cacheKeyForPath(e),r=this.storage.getItem(t);if(null!==r){const{x:e,d:n}=JSON.parse(r);if(e>Date.now())return n;this.storage.removeItem(t)}}setItem(e,t,r=this.ttl){const n=this.cacheKeyForPath(e);this.storage.setItem(n,JSON.stringify({x:Date.now()+r,d:t}))}removeItem(e){const t=this.cacheKeyForPath(e);this.storage.removeItem(t)}removeItemsMatching(e,t=!0){const r=this.cacheKeyForPath(e);this.removeItemsMatchingCacheKey(r,t)}clear(){this.removeItemsMatchingCacheKey(this.prefix,!1)}removeItemsMatchingCacheKey(e,t){const r=new RegExp(`^${e}${t?"$":""}`);(this.storage instanceof GenericStorage?this.storage.keys:Object.keys(this.storage)).forEach(e=>{e&&r.test(e)&&this.storage.removeItem(e)})}cacheKeyForPath(e){return this.cacheKeyFunction(e,this.prefix)}constructor(e={}){_define_property$1Z(this,"storage",void 0),_define_property$1Z(this,"prefix",void 0),_define_property$1Z(this,"ttl",void 0),_define_property$1Z(this,"cacheKeyFunction",void 0),this.storage=e.storage||new GenericStorage,this.prefix=e.prefix||"",this.ttl=e.ttl||3e5,this.cacheKeyFunction=e.cacheKeyFunction||DEFAULT_CACHE_KEY_FUNCTION}}function _define_property$1Y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1Y(e,t,r[t])}))}return e}function _object_spread_props$s(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const addPathToURL=(e,t)=>void 0===e||""===e?t||"":void 0===t?e:(e.endsWith("/")&&(e=e.slice(0,-1)),t.startsWith("/")&&(t=t.slice(1)),`${e}/${t}`),addQueryParamsToURL=(e,t)=>{const r=urlEncodeParameters(t);return""===r?e:e.endsWith("&")||e.endsWith("?")?`${e}${r}`:e.includes("?")?`${e}&${r}`:`${e}?${r}`},f="undefined"!=typeof Headers,headersToDict=e=>{let t={};var r;return r=e,f&&r instanceof Headers?e.forEach((e,r)=>t[r]=e):Array.isArray(e)?e.forEach(([e,r])=>t[e]=r):t=e,t},mergeFetchHeaders=(e={},t={})=>_object_spread$M({},headersToDict(e),headersToDict(t)),mergeFetchOptions=(e,t)=>{var r,n;if(e||t)return(null===(r=e)||void 0===r?void 0:r.headers)&&(null===(n=t)||void 0===n?void 0:n.headers)?_object_spread_props$s(_object_spread$M({},e,t),{headers:mergeFetchHeaders(e.headers,t.headers)}):_object_spread$M({},e,t)};function parseQueryParams(e){if(!e||e.startsWith("http")&&!e.includes("?"))return{};try{var t;return parseParams(null!==(t=e.split("?")[1])&&void 0!==t?t:e,"&",decodeURIComponent)}catch(r){return{}}}function parseParams(e,t="&",r=(e=>e)){return"string"!=typeof e?{}:e.split(t).map(e=>e.trim().split("=",2)).reduce((e,t)=>{const[n,i]=t;return""===n&&void 0===i||(e[r(n)]=r(i),void 0===i&&(e[r(n)]=void 0)),e},{})}function getMaxAgeFromHeaders(e){const t=function(e,t){if(void 0!==t)return f&&t instanceof Headers?t.get(e):t[e]}("cache-control",e);if(t){return(e=>{const t=Number(e);if(Number.isFinite(t))return t})(parseParams(t,",")["max-age"])}}function rewriteLastUrlPath(e,t){const r=e.split("/");return r.pop(),r.push(t),r.join("/")}const recursiveEncodeParameters=(e,t)=>Object.keys(e).reduce((r,n)=>{const i=e[n],o=t?`${t}[${encodeURIComponent(n)}]`:encodeURIComponent(n);return`${r}${r?"&":""}${isObject$1(i)?recursiveEncodeParameters(i,o):`${o}=${encodeURIComponent(""+i)}`}`},"");function urlEncodeParameters(e){return e?recursiveEncodeParameters(e):""}function asyncGeneratorStep$1p(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$1X(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1X(e,t,r[t])}))}return e}var v;!function(e){e.JSON="application/json",e.FORM="application/x-www-form-urlencoded"}(v||(v={}));class TokenSession extends class{clearCacheForRequest(e,t){"object"==typeof e&&(t=e,e=void 0);const r=this.constructURL(e,t);this.networkCache.removeItemsMatching(r)}request(e,t,r){var n,i=this;return(n=function*(){r||"object"!=typeof e||(r=t||{},t=e,e=void 0);let n={};"object"==typeof(r=_object_spread$L({method:i.method,headers:i.headers,reload:!1},i._fetchOptions,r)).queryParameters?(n=r.queryParameters,delete r.queryParameters):"GET"!==r.method&&"DELETE"!==r.method||(n=t);const o=i.constructURL(e,n),{method:a,reload:s=!1,useRawResponse:c}=r;if(r.headers=i.buildHeaders(r),delete r.reload,delete r.useRawResponse,"GET"===a&&!s){const e=i.getCacheItem(o);if(e)return Promise.resolve(e)}t&&Object.keys(t).length&&("POST"===a||"PUT"===a)&&(r.body=r.body||t,r.contentType===v.FORM?(r.body=urlEncodeParameters(r.body),r.headers.set("Content-Type",v.FORM)):(r.body=JSON.stringify(r.body),r.headers.set("Content-Type",v.JSON)));const l=yield i._fetchFunction(o,r);if(!l.ok)return Promise.reject(l);let d;try{d=yield l.json()}catch(h){d={}}if(d.errors)return Promise.reject(d.errors);const u=c?d:d.results||d.data||d;if("GET"===a){var p;const e=null!==(p=getMaxAgeFromHeaders(l.headers))&&void 0!==p?p:i.ttl;i.setCacheItem(o,u,e)}return u},function(){var e=this,t=arguments;return new Promise((function(r,i){var o=n.apply(e,t);function _next(e){asyncGeneratorStep$1p(o,r,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1p(o,r,i,_next,_throw,"throw",e)}_next(void 0)}))})()}buildHeaders({headers:e,reload:t=!1}={}){void 0===e&&(e=this.headers);const r=(e=>new e.constructor(e))(e);return t&&r.set("Cache-Control","no-cache"),r}constructURL(e,t){return((e,t,r)=>addQueryParamsToURL(addPathToURL(e,t),r))(this.url,e,t)}getCacheItem(e){const t=this.networkCache.storage,r=`${this.prefix}${this.prefix}cache-mut`,n=t.getItem(r)||null,i=this.headers.get("Music-User-Token")||this.headers.get("Media-User-Token")||null;return i!==n&&(this.networkCache.clear(),null===i?t.removeItem(r):t.setItem(r,i)),this.networkCache.getItem(e)}setCacheItem(e,t,r=this.ttl){this.networkCache.setItem(e,t,r)}clearNetworkCache(){this.networkCache.clear()}_key(e,t){const r=function(e){try{const[t,r]=e.split("?",2);if(void 0===r)return t;const n=r.split("&").map(e=>e.split("=",2)),i=[...Array(n.length).keys()];i.sort((e,t)=>{const r=n[e],i=n[t];return r<i?-1:r>i?1:e-t});const o=i.map(e=>n[e]);return`${t}?${o.map(([e,t])=>void 0!==t?`${e}=${t}`:e).join("&")}`}catch(t){return e}}(e).toLowerCase().replace(this.url,"");return`${this.prefix}${r.replace(/[^-_0-9a-z]{1,}/g,".")}`}constructor(e,t){if(_define_property$1X(this,"url",void 0),_define_property$1X(this,"headers",void 0),_define_property$1X(this,"prefix",""),_define_property$1X(this,"storage",void 0),_define_property$1X(this,"networkCache",void 0),_define_property$1X(this,"ttl",void 0),_define_property$1X(this,"method","GET"),_define_property$1X(this,"_fetchOptions",void 0),_define_property$1X(this,"_fetchFunction",void 0),this.url=e,(t=t||{}).storage&&t.underlyingStorage)throw new Error("only pass storage OR underlyingStorage in sessionOptions to URLSession");const r=t.underlyingStorage||{};if(this.storage=t.storage||new GenericStorage(r),this.networkCache=new NetworkCache({storage:this.storage,prefix:this.prefix,cacheKeyFunction:this._key.bind(this)}),this.ttl=t.ttl||3e5,this._fetchOptions=_object_spread$L({},t.fetchOptions),"function"!=typeof t.fetch&&"function"!=typeof fetch)throw new Error("window.fetch is not defined");var n;this._fetchFunction=null!==(n=t.fetch)&&void 0!==n?n:fetch.bind(window),this.headers=this._fetchOptions.headers||new Headers,delete this._fetchOptions.headers}}{get developerToken(){return this._developerToken.token}constructor(e,t,r){super(e,r),_define_property$1X(this,"userToken",void 0),_define_property$1X(this,"_developerToken",void 0),this._developerToken=new DeveloperToken(t),this.headers.set("Authorization","Bearer "+this.developerToken),r=r||{},this.userToken=r.userToken,this.userToken&&this.headers.set("Media-User-Token",this.userToken)}}Date.now();isNodeEnvironment$1();const g=/\/(?:([a-z]{2})\/)?(album|artist|episode|movie|music-video|playlist|podcast|post|season|show|song|station)\/(?:[^/]*\/)?(?:id)?(\d+|[a-z]{2}\.[a-z0-9-]+|umc.cmc.[a-zA-Z0-9]+)(?:.*(?:[?|&]i=(\d+)).*)?.*$/i;function formatArtworkURL(e,t,r){return t=t||e.height||100,r=r||e.width||100,window.devicePixelRatio>=1.5&&(r*=2,t*=2),e.url.replace("{h}",""+t).replace("{w}",""+r).replace("{f}","jpeg")}function formattedMediaURL(e){const t=function(e){const t=e.match(g)||[];let[,r,n,i,o]=t;return"music-video"===n&&(n="musicVideo"),-1!==["album","playlist"].indexOf(n)&&o?(n="song",i=o):"podcast"===n&&o&&(n="episode",i=o),{storefrontId:r,kind:n,contentId:i,itemId:o}}(e),{storefrontId:r,kind:n,contentId:i}=t;if([r,n,i].some(e=>void 0===e))throw new TypeError("Invalid Media URL: "+e);return{storefrontId:r,kind:n,contentId:i,isUTS:!!i&&i.startsWith("umc.")}}const m=/^http(?:s)?\:\/\/(?:itunes|(embed\.)?(music|podcasts|tv))\.apple\.com/i,b=["allow-forms","allow-popups","allow-same-origin","allow-scripts","allow-storage-access-by-user-activation","allow-top-navigation-by-user-activation"],S=["autoplay *","encrypted-media *","fullscreen *","clipboard-write"];var P,E;e.PlaybackType=void 0,(P=e.PlaybackType||(e.PlaybackType={}))[P.none=0]="none",P[P.preview=1]="preview",P[P.unencryptedFull=2]="unencryptedFull",P[P.encryptedFull=3]="encryptedFull",function(e){e[e.none=0]="none",e[e.loading=1]="loading",e[e.ready=2]="ready",e[e.playing=3]="playing",e[e.ended=4]="ended",e[e.unavailable=5]="unavailable",e[e.restricted=6]="restricted",e[e.error=7]="error",e[e.unsupported=8]="unsupported"}(E||(E={}));const T={AFG:"143610",AGO:"143564",AIA:"143538",ALB:"143575",AND:"143611",ARE:"143481",ARG:"143505",ARM:"143524",ATG:"143540",AUS:"143460",AUT:"143445",AZE:"143568",BEL:"143446",BEN:"143576",BFA:"143578",BGD:"143490",BGR:"143526",BHR:"143559",BHS:"143539",BIH:"143612",BLR:"143565",BLZ:"143555",BMU:"143542",BOL:"143556",BRA:"143503",BRB:"143541",BRN:"143560",BTN:"143577",BWA:"143525",CAF:"143623",CAN:"143455",CHE:"143459",CHL:"143483",CHN:"143465",CIV:"143527",CMR:"143574",COD:"143613",COG:"143582",COL:"143501",CPV:"143580",CRI:"143495",CYM:"143544",CYP:"143557",CZE:"143489",DEU:"143443",DMA:"143545",DNK:"143458",DOM:"143508",DZA:"143563",ECU:"143509",EGY:"143516",ESP:"143454",EST:"143518",ETH:"143569",FIN:"143447",FJI:"143583",FRA:"143442",FSM:"143591",GAB:"143614",GBR:"143444",GEO:"143615",GHA:"143573",GIN:"143616",GMB:"143584",GNB:"143585",GRC:"143448",GRD:"143546",GTM:"143504",GUY:"143553",HKG:"143463",HND:"143510",HRV:"143494",HUN:"143482",IDN:"143476",IND:"143467",IRL:"143449",IRQ:"143617",ISL:"143558",ISR:"143491",ITA:"143450",JAM:"143511",JOR:"143528",JPN:"143462",KAZ:"143517",KEN:"143529",KGZ:"143586",KHM:"143579",KNA:"143548",KOR:"143466",KWT:"143493",LAO:"143587",LBN:"143497",LBR:"143588",LBY:"143567",LCA:"143549",LIE:"143522",LKA:"143486",LTU:"143520",LUX:"143451",LVA:"143519",MAC:"143515",MAR:"143620",MCO:"143618",MDA:"143523",MDG:"143531",MDV:"143488",MEX:"143468",MKD:"143530",MLI:"143532",MLT:"143521",MMR:"143570",MNE:"143619",MNG:"143592",MOZ:"143593",MRT:"143590",MSR:"143547",MUS:"143533",MWI:"143589",MYS:"143473",NAM:"143594",NER:"143534",NGA:"143561",NIC:"143512",NLD:"143452",NOR:"143457",NPL:"143484",NRU:"143606",NZL:"143461",OMN:"143562",PAK:"143477",PAN:"143485",PER:"143507",PHL:"143474",PLW:"143595",PNG:"143597",POL:"143478",PRT:"143453",PRY:"143513",PSE:"143596",QAT:"143498",ROU:"143487",RUS:"143469",RWA:"143621",SAU:"143479",SEN:"143535",SGP:"143464",SLB:"143601",SLE:"143600",SLV:"143506",SRB:"143500",STP:"143598",SUR:"143554",SVK:"143496",SVN:"143499",SWE:"143456",SWZ:"143602",SYC:"143599",TCA:"143552",TCD:"143581",THA:"143475",TJK:"143603",TKM:"143604",TON:"143608",TTO:"143551",TUN:"143536",TUR:"143480",TWN:"143470",TZA:"143572",UGA:"143537",UKR:"143492",URY:"143514",USA:"143441",UZB:"143566",VCT:"143550",VEN:"143502",VGB:"143543",VNM:"143471",VUT:"143609",WSM:"143607",XKX:"143624",YEM:"143571",ZAF:"143472",ZMB:"143622",ZWE:"143605"};function asyncGeneratorStep$1o(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1o(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1o(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1o(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const k={AW:"ABW",AF:"AFG",AO:"AGO",AI:"AIA",AX:"ALA",AL:"ALB",AD:"AND",AE:"ARE",AR:"ARG",AM:"ARM",AS:"ASM",AQ:"ATA",TF:"ATF",AG:"ATG",AU:"AUS",AT:"AUT",AZ:"AZE",BI:"BDI",BE:"BEL",BJ:"BEN",BQ:"BES",BF:"BFA",BD:"BGD",BG:"BGR",BH:"BHR",BS:"BHS",BA:"BIH",BL:"BLM",BY:"BLR",BZ:"BLZ",BM:"BMU",BO:"BOL",BR:"BRA",BB:"BRB",BN:"BRN",BT:"BTN",BV:"BVT",BW:"BWA",CF:"CAF",CA:"CAN",CC:"CCK",CH:"CHE",CL:"CHL",CN:"CHN",CI:"CIV",CM:"CMR",CD:"COD",CG:"COG",CK:"COK",CO:"COL",KM:"COM",CV:"CPV",CR:"CRI",CU:"CUB",CW:"CUW",CX:"CXR",KY:"CYM",CY:"CYP",CZ:"CZE",DE:"DEU",DJ:"DJI",DM:"DMA",DK:"DNK",DO:"DOM",DZ:"DZA",EC:"ECU",EG:"EGY",ER:"ERI",EH:"ESH",ES:"ESP",EE:"EST",ET:"ETH",FI:"FIN",FJ:"FJI",FK:"FLK",FR:"FRA",FO:"FRO",FM:"FSM",GA:"GAB",GB:"GBR",GE:"GEO",GG:"GGY",GH:"GHA",GI:"GIB",GN:"GIN",GP:"GLP",GM:"GMB",GW:"GNB",GQ:"GNQ",GR:"GRC",GD:"GRD",GL:"GRL",GT:"GTM",GF:"GUF",GU:"GUM",GY:"GUY",HK:"HKG",HM:"HMD",HN:"HND",HR:"HRV",HT:"HTI",HU:"HUN",ID:"IDN",IM:"IMN",IN:"IND",IO:"IOT",IE:"IRL",IR:"IRN",IQ:"IRQ",IS:"ISL",IL:"ISR",IT:"ITA",JM:"JAM",JE:"JEY",JO:"JOR",JP:"JPN",KZ:"KAZ",KE:"KEN",KG:"KGZ",KH:"KHM",KI:"KIR",KN:"KNA",KR:"KOR",KW:"KWT",LA:"LAO",LB:"LBN",LR:"LBR",LY:"LBY",LC:"LCA",LI:"LIE",LK:"LKA",LS:"LSO",LT:"LTU",LU:"LUX",LV:"LVA",MO:"MAC",MF:"MAF",MA:"MAR",MC:"MCO",MD:"MDA",MG:"MDG",MV:"MDV",MX:"MEX",MH:"MHL",MK:"MKD",ML:"MLI",MT:"MLT",MM:"MMR",ME:"MNE",MN:"MNG",MP:"MNP",MZ:"MOZ",MR:"MRT",MS:"MSR",MQ:"MTQ",MU:"MUS",MW:"MWI",MY:"MYS",YT:"MYT",NA:"NAM",NC:"NCL",NE:"NER",NF:"NFK",NG:"NGA",NI:"NIC",NU:"NIU",NL:"NLD",NO:"NOR",NP:"NPL",NR:"NRU",NZ:"NZL",OM:"OMN",PK:"PAK",PA:"PAN",PN:"PCN",PE:"PER",PH:"PHL",PW:"PLW",PG:"PNG",PL:"POL",PR:"PRI",KP:"PRK",PT:"PRT",PY:"PRY",PS:"PSE",PF:"PYF",QA:"QAT",RE:"REU",RO:"ROU",RU:"RUS",RW:"RWA",SA:"SAU",SD:"SDN",SN:"SEN",SG:"SGP",GS:"SGS",SH:"SHN",SJ:"SJM",SB:"SLB",SL:"SLE",SV:"SLV",SM:"SMR",SO:"SOM",PM:"SPM",RS:"SRB",SS:"SSD",ST:"STP",SR:"SUR",SK:"SVK",SI:"SVN",SE:"SWE",SZ:"SWZ",SX:"SXM",SC:"SYC",SY:"SYR",TC:"TCA",TD:"TCD",TG:"TGO",TH:"THA",TJ:"TJK",TK:"TKL",TM:"TKM",TL:"TLS",TO:"TON",TT:"TTO",TN:"TUN",TR:"TUR",TV:"TUV",TW:"TWN",TZ:"TZA",UG:"UGA",UA:"UKR",UM:"UMI",UY:"URY",US:"USA",UZ:"UZB",VA:"VAT",VC:"VCT",VE:"VEN",VG:"VGB",VI:"VIR",VN:"VNM",VU:"VUT",WF:"WLF",WS:"WSM",XK:"XKX",YE:"YEM",ZA:"ZAF",ZM:"ZMB",ZW:"ZWE"};const w={af:48,sq:1,ar:34,eu:1,bg:49,be:1,ca:42,zh:19,"zh-tw":18,"zh-cn":19,"zh-hk":45,"zh-sg":19,hr:41,cs:22,da:11,nl:10,"nl-be":65,en:1,"en-us":1,"en-eg":26,"en-au":27,"en-gb":2,"en-ca":6,"en-nz":27,"en-ie":26,"en-za":26,"en-jm":26,"en-bz":26,"en-tt":26,"en-001":26,et:30,fo:1,fa:59,fi:12,fr:3,"fr-ca":5,gd:2,de:4,"de-ch":57,el:23,he:36,hi:50,hu:21,is:31,id:37,it:7,ja:9,ko:13,lv:33,lt:32,mk:1,mt:1,no:14,nb:14,nn:14,pl:20,"pt-br":15,pt:24,rm:1,ro:39,ru:16,sr:1,sk:40,sl:52,es:8,"es-mx":28,"es-419":44,sv:17,th:35,ts:1,tn:1,tr:25,uk:29,ur:55,ve:1,vi:43,xh:1,yi:1,zu:56,ms:38,iw:36,lo:46,tl:47,kk:51,ta:53,te:54,bn:58,ga:60,ht:61,la:62,pa:63,sa:64};let O="Music-User-Token";function getLanguages(){if("undefined"==typeof navigator)return[];if(navigator.languages)return navigator.languages;const e=navigator.language||navigator.userLanguage;return e?[e]:[]}O="Media-User-Token";const I={};function findOrCreate(e,t){const r=e.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase());if(hasOwn(I,r)){const n=I[r];if(t!==n.constructor)throw new Error(`DevFlag ${e} was already registered with a different type (${n.constructor.name})`);return n}const n=new t(e);return Object.defineProperty(I,r,{configurable:!0,enumerable:!0,get:function(){return n},set(e){n.set(e)}}),n}class LocalStorageDevFlag{get value(){return this.get()}get configured(){return void 0!==this.value}read(){var e,t;const r=null!==(t=null===(e=getLocalStorage())||void 0===e?void 0:e.getItem(this.key))&&void 0!==t?t:null;return null!==r?r:void 0}write(e){var t;null===(t=getLocalStorage())||void 0===t||t.setItem(this.key,e)}clear(){var e;null===(e=getLocalStorage())||void 0===e||e.removeItem(this.key)}constructor(e){if(function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"key",void 0),"string"!=typeof e||""===e.trim())throw new Error("DevFlag requires a non-empty string key");this.key=e}}class StringDevFlag extends LocalStorageDevFlag{static register(e){return findOrCreate(e,this)}static get(e){return this.register(e).get()}static set(e,t){this.register(e).set(t)}get(){return this.read()}set(e){"string"!=typeof e&&console.warn("Value for StringDevFlag should be a string"),this.write(e)}}class BooleanDevFlag extends LocalStorageDevFlag{static register(e){return findOrCreate(e,this)}static get(e){return this.register(e).get()}static set(e,t){this.register(e).set(t)}get(){const e=this.read();if(void 0!==e)return"1"===e||"true"===e.toLowerCase()}set(e){"boolean"==typeof e?this.write(!0===e?"1":"0"):console.warn("Value for BooleanDevFlag should be a boolean")}get enabled(){return!0===this.get()}enable(){this.set(!0)}disable(){this.set(!1)}toggle(){this.set(!this.get())}}class JsonDevFlag extends LocalStorageDevFlag{static register(e){return findOrCreate(e,this)}static get(e){return this.register(e).get()}static set(e,t){this.register(e).set(t)}get(){const e=this.read();if(void 0!==e)try{return JSON.parse(e)}catch(Ae){return}}set(e){this.write(JSON.stringify(e))}prop(e){if(void 0!==this.value)return this.value[e]}}const A=JsonDevFlag.register("mk-hlsjs-automation-config"),$=new RegExp("^https://([a-z0-9]+-)?"+("js-cdn.music.apple.com"+"/musickit/v3/".replace(/v3/,"(v2|v3)")).replace(/[\.\/]/g,"\\$&"),"i"),R=/^https:\/\/(.*\/includes\/js-cdn)\//i,C=/^([a-z]+:)?\/\//;function findScript(e){return isNodeEnvironment$1()||!e?null:document.querySelector(`script[src*="${e}"]`)}function getScriptSrcElements(){if("undefined"==typeof document||!document.querySelectorAll)return[];return Array.from(document.querySelectorAll("script[src]"))}function determineCdnBasePrefix(){for(const e of getScriptSrcElements()){const t=$.exec(e.src);if(t)return t[1]||""}return""}function determineCdnPathPrefix(){for(const e of getScriptSrcElements()){const t=R.exec(e.src);if(t)return t[1]||""}return""}function determineCdnBaseHost(){if(isNodeEnvironment$1())return"";return`//${determineCdnBasePrefix()}js-cdn.music.apple.com`}function determineCdnPathHost(){const e=determineCdnPathPrefix();return e?"//"+e:e}const M=StringDevFlag.register("mk-hlsjs-log-level"),D=StringDevFlag.register("mk-hlsjs-version");function getHlsJsCdnConfig(){const e={hls:"",rtc:""};if(isNodeEnvironment$1())return e;const t=determineCdnPathHost()||determineCdnBaseHost(),r=D.get()||"2.510.3",n=function(){const e=M.value;switch(e){case"info":case"error":case"warn":return"hls.production.verbose.min.js";case"trace":case"debug":return console.warn(`HLS log level ${e} is not supported, loading production build.`),"hls.js";default:return"hls.js"}}();return e.hls=`https:${t}/hls.js/${r}/hls.js/${n}`,e.rtc=`https:${t}/hls.js/${r}/rtc.js/rtc.min.js`,function(e){var t;const r=A.get();if(!(null===(t=r)||void 0===t?void 0:t.url))return;const{url:n}=r;isAppleHostname(n)&&"carry-"===determineCdnBasePrefix()&&(e.hls=n)}(e),e}function isAppleHostname(e){try{return new URL(e).hostname.endsWith(".apple.com")}catch(t){}return!1}function cdnBaseURL(e,t=window){var r;if(isNodeEnvironment$1())return"";const n=null===(r=getLocalStorage())||void 0===r?void 0:r.getItem("mkCDNBaseURLOverride");if(n)return n;const i=findScript(e);return i?i.getAttribute("src").replace(new RegExp(e+"$"),""):(determineCdnPathHost()||determineCdnBaseHost())+"/musickit/v3/"}const x=new Map;function loadScript(e,t){const r=x.get(e);if(r)return r;const n=new Promise((r,n)=>{isNodeEnvironment$1()&&n("Dynamic script loading is unsupported in Node environments.");if(findScript(e))return r();const i=document.createElement("script");let o;if(t&&Object.keys(t).forEach(e=>{i.setAttribute(e,t[e])}),i.onload=()=>{r()},i.onerror=e=>{n(e)},C.test(e))o=e;else{o=`${cdnBaseURL(e)}${e}`}i.src=o,document.head.appendChild(i)});return x.set(e,n),n}const L={CRITICAL:50,ERROR:40,WARNING:30,NOTICE:20,INFO:10,DEBUG:2,TRACE:1,NONE:0};const N={OFF:"NONE",0:"NONE","+":"INFO","++":"DEBUG",V:"DEBUG",D:"DEBUG",VERBOSE:"DEBUG",VV:"TRACE",SILLY:"TRACE","*":"TRACE"};function getLoggingLevel(e,t={}){if("number"==typeof e)return function(e){return"number"==typeof e&&Object.values(L).includes(e)}(e)?e:void 0;let r=e.toUpperCase();return t.allowShorthands&&void 0!==N[r]&&(r=N[r]),function(e){return"string"==typeof e&&void 0!==L[e.toUpperCase()]}(r)?L[r]:void 0}function getLoggingLevelName(e){for(const[t,r]of Object.entries(L))if(e===r)return t}function walk(e,t){const r=[e];for(;r.length>0;){const e=r.shift();void 0!==e&&(r.push(...e.children),t(e))}}function _define_property$1V(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1V(e,t,r[t])}))}return e}function _object_spread_props$r(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _define_property1(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const j=L.ERROR,DEFAULT_POLICY=(e,t)=>e!==L.NONE&&t>=e;class Logger$1{get parent(){return this._parent}get children(){return Array.from(this._children.values())}get namespace(){return void 0===this._parent?this.name:this._parent.namespace+"/"+this.name}get enabled(){return this.level!==L.NONE}get level(){var e,t,r;return null!==(r=null!==(t=this._level)&&void 0!==t?t:null===(e=this.parent)||void 0===e?void 0:e.level)&&void 0!==r?r:j}get levelName(){var e;return null!==(e=getLoggingLevelName(this.level))&&void 0!==e?e:"UNKNOWN"}get levelPolicy(){var e,t,r;return null!==(r=null!==(t=this._levelPolicy)&&void 0!==t?t:null===(e=this.parent)||void 0===e?void 0:e.levelPolicy)&&void 0!==r?r:DEFAULT_POLICY}get handlers(){var e,t,r;return null!==(r=null!==(t=this._handlers)&&void 0!==t?t:null===(e=this.parent)||void 0===e?void 0:e.handlers)&&void 0!==r?r:{}}isEnabledFor(e){return this.levelPolicy(this.level,e)}setLevel(e){const t=getLoggingLevel(e);void 0!==t&&(this._level=t)}clearLevel(){this._level=void 0}setLevelPolicy(e){this._levelPolicy=e}clearLevelPolicy(){this._levelPolicy=void 0}addHandler(e,t){this._handlers||(this._handlers={}),this._handlers[e]=t}hasHandler(e){var t;return void 0!==(null===(t=this._handlers)||void 0===t?void 0:t[e])}removeHandler(e){void 0!==this._handlers&&(delete this._handlers[e],0===Object.keys(this._handlers).length&&this.clearHandlers())}clearHandlers(){this._handlers=void 0}createChild(e,t){const r=this._children.get(e);return void 0!==r?r:new Logger$1(e,_object_spread_props$r(_object_spread$K({},t),{parent:this}))}linkChild(e){if(void 0!==e.parent&&e.parent!==this)throw new Error(`Logger '${e.name}' is already a child of a different parent ('${e.parent.name}')`);const t=this._children.get(e.name);if(void 0!==t&&t!==e)throw new Error(`A child with name '${e.name}' is already registered`);return void 0===t&&(this._children.set(e.name,e),e.linkParent(this)),e}unlinkChild(e){const t=this._children.get(e.name);return t===e&&(this._children.delete(e.name),t.unlinkParent()),e}getByName(e){return this._children.get(e)}getByNamespace(e){return function(e,t,r="/"){if(""===(t=t.trim())||"*"===t)return e;const n=t.split(r);n[0].trim()===e.name&&n.shift();if(0===n.length)return e;let i=e;for(;void 0!==i&&n.length>0;){const e=n.shift();i=i.getByName(e.trim())}return i}(this,e)}linkParent(e){return this.parent!==e&&(this.unlinkParent(),this._parent=e,e.linkChild(this)),this}unlinkParent(){return void 0!==this._parent&&(this._parent.unlinkChild(this),this._parent=void 0),this}log(e,t,...r){const n=getLoggingLevel(e);void 0!==n&&this.logRecord({time:Date.now(),namespace:this.namespace,level:n,message:t,args:r})}logRecord(e){if(!this.levelPolicy(this.level,e.level))return;const t=_object_spread$K({namespace:this.namespace},e);for(const r of Object.values(this.handlers))r.process(t)}error(e,...t){this.log(L.ERROR,e,...t)}warning(e,...t){this.log(L.WARNING,e,...t)}warn(e,...t){this.warning(e,...t)}info(e,...t){this.log(L.INFO,e,...t)}debug(e,...t){this.log(L.DEBUG,e,...t)}trace(e,...t){this.log(L.TRACE,e,...t)}constructor(e,t){var r,n,i,o;_define_property1(this,"name",void 0),_define_property1(this,"_parent",void 0),_define_property1(this,"_children",new Map),_define_property1(this,"_level",void 0),_define_property1(this,"_levelPolicy",void 0),_define_property1(this,"_handlers",void 0),this.name=e,this._levelPolicy=null===(r=t)||void 0===r?void 0:r.levelPolicy,this._handlers=null===(n=t)||void 0===n?void 0:n.handlers,void 0!==(null===(i=t)||void 0===i?void 0:i.parent)&&this.linkParent(t.parent),void 0!==(null===(o=t)||void 0===o?void 0:o.level)&&this.setLevel(t.level)}}function _define_property$1U(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class CallbackHandler{process(e){this.enabled&&void 0!==this.callback&&this.callback(e)}constructor(e,t={}){var r;_define_property$1U(this,"enabled",void 0),_define_property$1U(this,"callback",void 0),this.callback=e,this.enabled=null===(r=t.enabled)||void 0===r||r}}const U=/%{([^}]+)}/gi;var F;const B={timestamp:e=>String(e.time),time:e=>String(e.time),datetime:e=>new Date(e.time).toISOString(),date:e=>new Date(e.time).toISOString(),level:e=>String(e.level),levelname:e=>null!==(F=getLoggingLevelName(e.level))&&void 0!==F?F:"UNKNOWN",message:e=>e.message,name:e=>e.namespace.split("/").pop(),namespace:e=>e.namespace};function _define_property$1T(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const V=new Map([[L.CRITICAL,"error"],[L.ERROR,"error"],[L.WARNING,"warn"],[L.NOTICE,"warn"],[L.INFO,"log"],[L.DEBUG,"debug"]]),G=(H="%{datetime} %{levelname} - [%{namespace}] %{message}",function(e){return H.replace(U,(function(t,r){return r=r.toLowerCase(),void 0!==B[r]?B[r](e):t}))});var H;const W=new Logger$1("storekit");function _define_property$1S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const q=["apps.apple.com","books.apple.com","fitness.apple.com","mediaauth.apple.com","multidev.apple.com","music.apple.com","one.apple.com","podcasts.apple.com","tv.apple.com","itunes.apple.com"];function _define_property$1R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class AuthBridgeApp extends class{init(e,t){var r;this._receiveWindow=e,this._sendWindow=t,this.handleMessage=this.handleMessage.bind(this),null===(r=this._receiveWindow)||void 0===r||r.addEventListener("message",this.handleMessage)}sendMessage(e,t){const r={action:"mediakit:"+e,data:t};this._sendWindow&&this._sendWindow.postMessage(JSON.stringify(r),this._targetOrigin)}handleMessage(e){if(!this._isOriginAllowed(e.origin))return;let t;try{t=JSON.parse(e.data)}catch(n){}if(!t||!this._isNamespacedData(t))return;"*"===this._targetOrigin&&(this._targetOrigin=e.origin),W.debug("auth-bridge: handleMessage",t);const r=t.action.replace("mediakit:","");this[r]?this[r](t.data):W.debug("auth-bridge: unsupported method",r)}_isOriginAllowed(e){if(!e)return!1;const[t,r]=e.split("://");let n="";return r&&(n=r.split(":")[0],n&&(n=n.toLocaleLowerCase())),"https"===t&&!!n&&q.some(e=>n===e||n.endsWith("."+e))}_isNamespacedData(e){return e.action&&-1!==e.action.indexOf("mediakit:")}constructor(){_define_property$1S(this,"_receiveWindow",void 0),_define_property$1S(this,"_sendWindow",void 0),_define_property$1S(this,"_targetOrigin","*")}}{requestAuthUpdate(){this.whenFrameInited.then(()=>this.sendMessage("requestAuthUpdate"))}setCookieItem(e,t){this.whenFrameInited.then(()=>this.sendMessage("setCookieItem",{name:e,value:t}))}clearAuth(){this.whenFrameInited.then(()=>this.sendMessage("clearAuth"))}frameInit(){var e;null===(e=this._frameInitResolve)||void 0===e||e.call(this),this.requestAuthUpdate()}updateAuth(e){var t,r;if((null===(t=e)||void 0===t?void 0:t.enabled)&&(null===(r=e)||void 0===r?void 0:r.cookies)){const t=e.cookies;Object.keys(t).forEach(e=>{var r;const n=null!==(r=t[e])&&void 0!==r?r:"";n?setCookie(e,n,"/",30):removeCookie(e)})}this._authUpdateResolve&&(this._authUpdateResolve(),this._authUpdateResolve=void 0)}authClearedFromOtherFrame(){W.warn("Override auth-bridge/app's authClearedFromOtherFrame to trigger app-specific sign out behavior")}_getIframeSrc(){let e="",t=determineCdnPathPrefix();if(t)t+="/musickit/v3/",e="?inc="+encodeURIComponent(t);else{const t=determineCdnBasePrefix();t&&(e="?env="+t.substring(0,t.length-1))}return"https://mediaauth.apple.com/auth-bridge/"+e}constructor(){super(),_define_property$1R(this,"whenAuthCompleted",void 0),_define_property$1R(this,"frame",void 0),_define_property$1R(this,"whenFrameInited",void 0),_define_property$1R(this,"_frameInitResolve",void 0),_define_property$1R(this,"_authUpdateResolve",void 0),this.whenFrameInited=new Promise(e=>this._frameInitResolve=e),this.whenAuthCompleted=new Promise(e=>this._authUpdateResolve=e),this.frame=document.createElement("iframe"),this.frame.src=this._getIframeSrc(),this.frame.style.display="none",document.body.appendChild(this.frame),this.init(window,this.frame.contentWindow)}}const z=new Set(["apps","books","music","podcasts","tv"]),Y=/\.apple\.com$/;function getCommerceHostname(e,t){!t&&"undefined"!=typeof location&&location.hostname&&(t=location);let r=e+".itunes.apple.com";if(!t)return r;const n=function(e){if(!e||!Y.test(e))return;const t=e.split(".");let r=t[t.length-3];const n=r;if(r&&r.includes("-")){const e=r.split("-");r=e[e.length-1]}return z.has(r)?n:void 0}(t.hostname);return n&&(r=`${e}.${n}.apple.com`),r}var Q,J,X;function buildQueryParams(e={app:Q.APP,p:Q.P}){return void 0===e.app&&(e.app=Q.APP),void 0===e.p&&(e.p=Q.P),Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}!function(e){e.APP="music",e.P="subscribe"}(Q||(Q={})),function(e){e.DEFAULT_CID="pldfltcid",e.TV_CID="pltvcid",e.RESTRICTIONS_ENABLED="itre",e.STOREFRONT_COUNTRY_CODE="itua",e.USER_TOKEN="media-user-token"}(J||(J={})),e.SKRealm=void 0,(X=e.SKRealm||(e.SKRealm={}))[X.MUSIC=0]="MUSIC",X[X.PODCAST=1]="PODCAST",X[X.TV=2]="TV";const Z={[e.SKRealm.TV]:"com.apple.onboarding.tvapp",[e.SKRealm.MUSIC]:"com.apple.onboarding.applemusic"},ee={[e.SKRealm.TV]:"pltvcid",[e.SKRealm.MUSIC]:"pldfltcid"},te={"com.apple.onboarding.tvapp":5,"com.apple.onboarding.applemusic":3};function asyncGeneratorStep$1n(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$1Q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var re;!function(e){e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"}(re||(re={}));class Dispatch{get source(){return this._source}set source(e){if(!e&&this._source)return this._source.removeEventListener("message",this.handle),void(this._source=void 0);e.addEventListener("message",this.handle),this._source=e}apply(e,t){if(!this.destination)throw new Error("No destination");const r=this._sequence++,n=new Promise((e,t)=>{this._registry[r]={resolve:e,reject:t}});return this.send(this.destination,{jsonrpc:"2.0",id:r,method:e,params:t}),n}call(e,...t){return this.apply(e,t)}handleRequest(e){var t,r=this;return(t=function*(){const t={jsonrpc:"2.0",id:e.id},n=r.methods[e.method];if(!n)return Object.assign(t,{error:{code:re.MethodNotFound,message:"Method not found"}});try{const r=yield n.apply(void 0,ensureArray(e.params));return Object.assign(t,{result:r})}catch(Ae){return Object.assign(t,{error:{code:Ae.code||re.InternalError,message:Ae.message}})}},function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function _next(e){asyncGeneratorStep$1n(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1n(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}handleResponse(e){const t=this._registry[e.id];delete this._registry[e.id],t&&(e.error?t.reject(Object.assign(Error(),e.error)):t.resolve(e.result))}send(e,t){e.postMessage(t,e.window===e?this.origin:void 0)}constructor(e={}){_define_property$1Q(this,"destination",void 0),_define_property$1Q(this,"origin",void 0),_define_property$1Q(this,"methods",void 0),_define_property$1Q(this,"_registry",{}),_define_property$1Q(this,"_sequence",0),_define_property$1Q(this,"_source",void 0),_define_property$1Q(this,"handle",e=>{e.data&&"2.0"===e.data.jsonrpc&&("*"!==this.origin&&this.origin!==e.origin||(e.data.method&&this.destination?this.handleRequest(e.data).then(e=>{this.send(this.destination,e)}):(hasOwn(e.data,"result")||e.data.error)&&this.handleResponse(e.data)))}),this.destination=e.destination,this.methods=e.methods||{},this.origin=e.origin||"*",e.source&&(this.source=e.source)}}function asyncGeneratorStep$1m(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1m(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1m(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1m(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1P(e,t,r[t])}))}return e}function _object_spread_props$q(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var ne;function validateToken(e){if("string"!=typeof e)return!1;const t=e.match(/[a-zA-Z0-9=\/+]{32,}==$/);var r;return null!==(r=t&&t.length>0)&&void 0!==r&&r}!function(e){e[e.UNAVAILABLE=-1]="UNAVAILABLE",e[e.NOT_DETERMINED=0]="NOT_DETERMINED",e[e.DENIED=1]="DENIED",e[e.RESTRICTED=2]="RESTRICTED",e[e.AUTHORIZED=3]="AUTHORIZED"}(ne||(ne={}));const ie=`https://${getCommerceHostname("buy")}/commerce/account/authenticateMusicKitRequest`,oe="https://authorize.music.apple.com",ae=/^https?:\/\/(.+\.)*(apple\.com|apps\.mzstatic\.com)(\/[\w\d]+)*$/;var se,ce,le;!function(e){e[e.AUTHORIZE=0]="AUTHORIZE",e[e.SUBSCRIBE=1]="SUBSCRIBE"}(se||(se={}));class ServiceSetupView{get isServiceView(){return/(authorize\.(.+\.)*apple\.com)/i.test(window.location.hostname)||window&&window.name===this.target||!1}focus(){this._window&&window.focus&&this._window.focus()}load(e={action:se.AUTHORIZE}){var t=this;return _async_to_generator$1m((function*(){return e.action===se.SUBSCRIBE?t._subscribeAction(e.parameters):t._authorizeAction(e.parameters)}))()}present(e="",t){const{height:r,left:n,top:i,width:o}=this._calculateClientDimensions(),a={height:650,menubar:"no",resizable:"no",scrollbars:"no",status:"no",toolbar:"no",width:650},s=_object_spread$J(_object_spread_props$q(_object_spread$J({},a),{left:o/2-a.width/2+n,top:r/2-a.height/2+i}),t),c=Object.keys(s).map(e=>`${e}=${s[e]}`).join(",");return/trident|msie/i.test(navigator.userAgent)?(this._window=window.open(window.location.href,this.target,c)||void 0,this._window.location.href=e):this._window=window.open(e,this.target,c)||void 0,/\bedge\b/i.test(navigator.userAgent)&&(this._window.opener=self),this.focus(),this._window}_startPollingForWindowClosed(e){this._window&&void 0===this._windowClosedInterval&&(this._windowClosedInterval=setInterval(()=>{var t;(null===(t=this._window)||void 0===t?void 0:t.closed)&&(this._stopPollingForWindowClosed(),e())},500))}_stopPollingForWindowClosed(){void 0!==this._windowClosedInterval&&(clearInterval(this._windowClosedInterval),this._windowClosedInterval=void 0)}_authorizeAction(e={}){var t=this;return _async_to_generator$1m((function*(){var r;let n,i;const o=(null===(r=window.location)||void 0===r?void 0:r.href)||"";return"GET"===t.authenticateMethod?i=`${oe}/woa?${buildQueryParams(_object_spread_props$q(_object_spread$J({},t.deeplinkParameters),{a:btoa(t._thirdPartyInfo()),referrer:o}))}`:(n=t._buildFormElement(ie),document.body.appendChild(n)),new Promise((r,o)=>{const a=t.present(i);t._startPollingForWindowClosed(()=>{o(ne.NOT_DETERMINED)}),t.dispatch=new Dispatch({methods:{authorize(e,t,n){validateToken(e)?r({restricted:t&&"1"===t,userToken:e,cid:n}):o(ne.NOT_DETERMINED)},close(){},decline(){o(ne.DENIED)},switchUserId(){o(ne.NOT_DETERMINED)},thirdPartyInfo:()=>t._thirdPartyInfo(t.developerToken,_object_spread$J({},t.deeplinkParameters,e)),unavailable(){o(ne.UNAVAILABLE)}},origin:oe,source:window,destination:a}),n&&n.submit()})}))()}_buildFormElement(e,t=this.target,r=this.developerToken){const n=document.createElement("form");n.setAttribute("method","post"),n.setAttribute("action",e),n.setAttribute("target",t),n.style.display="none";const i=document.createElement("input");i.setAttribute("name","jwtToken"),i.setAttribute("value",r),n.appendChild(i);const o=document.createElement("input");o.setAttribute("name","isWebPlayer"),o.setAttribute("value","true"),n.appendChild(o);const a=document.createElement("input");return a.setAttribute("name","LogoURL"),a.setAttribute("value",""),n.appendChild(a),n}_calculateClientDimensions(e=window){return{height:e.innerHeight?e.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,left:e.screenLeft?e.screenLeft:screen.availLeft||screen.left,top:e.screenTop?e.screenTop:screen.availTop||screen.top,width:e.innerWidth?e.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width}}_subscribeAction(e={}){var t=this;return _async_to_generator$1m((function*(){return Object.assign(e,t.deeplinkParameters),new Promise((r,n)=>{const i="https://authorize.music.apple.com/upsell?"+buildQueryParams(e);t.present(i),window.addEventListener("message",({data:e,origin:t,source:i})=>{const{closeWindow:o,launchClient:a}="string"==typeof e?JSON.parse(e):e;t&&!ae.test(t)||(a?0===a.supported?n("Unable to subscribe on this platform."):r(a):n("Subscribe action error."))})})}))()}_thirdPartyInfo(e=this.developerToken,t){let r=this.iconURL;const n=window.location.host||document.referrer,i=[...[].slice.call(document.querySelectorAll('link[rel="apple-music-app-icon"]')),...[].slice.call(document.querySelectorAll('link[rel="apple-touch-icon-precomposed"]')),...[].slice.call(document.querySelectorAll('link[rel="apple-touch-icon"]'))];if(i&&i[0]&&i[0].href){var o;var a;r=null!==(a=null===(o=i.find(e=>!!e.sizes&&"120x120"===e.sizes.value))||void 0===o?void 0:o.href)&&void 0!==a?a:i[0].href}return JSON.stringify({thirdPartyIconURL:r,thirdPartyName:n,thirdPartyParameters:t,thirdPartyToken:e})}constructor(e,t={}){if(_define_property$1P(this,"developerToken",void 0),_define_property$1P(this,"authenticateMethod",void 0),_define_property$1P(this,"deeplinkParameters",void 0),_define_property$1P(this,"iconURL",void 0),_define_property$1P(this,"target",void 0),_define_property$1P(this,"dispatch",void 0),_define_property$1P(this,"_window",void 0),_define_property$1P(this,"_windowClosedInterval",void 0),this.developerToken=e,this.authenticateMethod="GET",this.target="apple-music-service-view",this.deeplinkParameters=t&&t.deeplinkParameters||{},this.iconURL=t&&t.iconURL,this.authenticateMethod=t&&t.authenticateMethod||"GET",this.isServiceView&&window.opener!==window){var r;const e=null===(r=getSessionStorage())||void 0===r?void 0:r.getItem("ac"),t=null!=e?new URL(e).origin:void 0;var n;if(t)this.dispatch=new Dispatch({destination:null!==(n=window.opener)&&void 0!==n?n:void 0,origin:t,source:window})}}}function asyncGeneratorStep$1l(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1l(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1l(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _fetchStorefronts(){return(_fetchStorefronts=_async_to_generator$1l((function*(e,t="https://api.music.apple.com/v1"){const r=new Headers({Authorization:"Bearer "+e}),n=yield fetch(t+"/storefronts",{headers:r}),i=yield n.json();return i.errors?Promise.reject(i.errors):i.data}))).apply(this,arguments)}!function(e){e.ID="us",e.LANGUAGE_TAG="en-gb"}(ce||(ce={}));class Storefront{static inferFromLanguages(e,t=getLanguages()){return _async_to_generator$1l((function*(){const r=yield function(e){return _fetchStorefronts.apply(this,arguments)}(e),n=r.map(e=>e.id),i=t[0]||"en-US",[o,a]=i.toLowerCase().split(/-|_/),s=n.includes(a)?a:"us";return r.find(e=>e.id===s)}))()}constructor(e,t,r){_define_property$1O(this,"id",void 0),_define_property$1O(this,"attributes",void 0),_define_property$1O(this,"href",void 0),_define_property$1O(this,"type",void 0),this.id=e,this.attributes=t,this.type="storefronts",this.href=r||`/v1/${this.type}/${e}`}}function asyncGeneratorStep$1k(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1k(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1k(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1k(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1N(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1N(e,t,r[t])}))}return e}function _ts_metadata$C(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e){e.authorizationStatusDidChange="authorizationStatusDidChange",e.authorizationStatusWillChange="authorizationStatusWillChange",e.eligibleForSubscribeView="eligibleForSubscribeView",e.needsGDPRDidChange="needsGDPRDidChange",e.storefrontCountryCodeDidChange="storefrontCountryCodeDidChange",e.storefrontIdentifierDidChange="storefrontIdentifierDidChange",e.userTokenDidChange="userTokenDidChange"}(le||(le={})),J.DEFAULT_CID;let de=!1;de=!0;const ue="https://"+getCommerceHostname("buy"),pe=`https://${getCommerceHostname("play")}/WebObjects/MZPlay.woa/wa`;class StoreKit extends Notifications{updateUserTokenFromStorage(){const e=this._getStorageItem(J.USER_TOKEN);this.userToken=e||void 0}get authorizationStatus(){return this._authorizationStatus}set authorizationStatus(e){this._authorizationStatus!==e&&(this._getIsActiveSubscription.updateCache(void 0),this.dispatchEvent(le.authorizationStatusWillChange,{authorizationStatus:this._authorizationStatus,newAuthorizationStatus:e}),this._authorizationStatus=e,this.dispatchEvent(le.authorizationStatusDidChange,{authorizationStatus:e}))}get cid(){if(!this._cids[this.cidNamespace]){const e=this._getStorageItem(this.cidNamespace);this._cids[this.cidNamespace]=e||void 0}return this._cids[this.cidNamespace]}set cid(e){e?this._setStorageItem(this.cidNamespace,e):this._removeStorageItem(this.cidNamespace),this._cids[this.cidNamespace]=e}eligibleForSubscribeView(){var e=this;return _async_to_generator$1k((function*(){const t=yield e.hasMusicSubscription();return(!e.hasAuthorized||e.hasAuthorized&&!t)&&!e._dispatchedSubscribeView}))()}get hasAuthorized(){return this.authorizationStatus>ne.DENIED}get logoutURL(){if(!this._disableLogoutURL)return this.iTunesBuyBase+"/account/web/logout"}get parentalControls(){return this._parentalControls}set parentalControls(t){this._parentalControls=t,t&&(this.realm===e.SKRealm.MUSIC?this.restrictedEnabled=t.musicParentalControlsEnabled:this.realm===e.SKRealm.TV&&t.videoContentRestrictions&&(this.authorizationStatus=ne.RESTRICTED))}get _pldfltcid(){return this._cids[J.DEFAULT_CID]}set _pldfltcid(e){this._cids[J.DEFAULT_CID]=e}get privacyAcknowledgements(){return this._privacyAcknowledgements}set privacyAcknowledgements(e){if(this._privacyAcknowledgements=e,!e)return this._gdprVersion=-1,void(this._needsGDPR=void 0);if(this.bundleId){var t;const r=null!==(t=this._needsGDPR)&&void 0!==t&&t;this._gdprVersion=e[this.bundleId]||0,this._needsGDPR=this._gdprVersion<(te[this.bundleId]||0),r!==this._needsGDPR&&this.dispatchEvent(le.needsGDPRDidChange,{GDPRVersion:this._gdprVersion,needsGDPR:this._needsGDPR})}}get restrictedEnabled(){if(this.userToken&&"boolean"!=typeof this._restrictedEnabled){const e=this._getStorageItem(J.RESTRICTIONS_ENABLED);if(e)this._restrictedEnabled="0"!==e;else if(this._storefrontCountryCode){const e=["br","ch","gt","hu","id","in","it","kr","la","lt","my","ru","sg","tr"];this._restrictedEnabled=-1!==e.indexOf(this._storefrontCountryCode)||void 0}}return this._restrictedEnabled}set restrictedEnabled(e){this._restrictedEnabledOverridden||(this.userToken&&void 0!==e&&this._setStorageItem(J.RESTRICTIONS_ENABLED,e?"1":"0"),this._restrictedEnabled=e,e&&(this.authorizationStatus=ne.RESTRICTED))}overrideRestrictEnabled(e){this._restrictedEnabledOverridden=!1,this.restrictedEnabled=e,this._restrictedEnabledOverridden=!0}get storefrontCountryCode(){if(!this._storefrontCountryCode){var e;const t=this._getStorageItem(J.STOREFRONT_COUNTRY_CODE);this._storefrontCountryCode=(null===(e=t)||void 0===e?void 0:e.toLowerCase())||ce.ID}return this._storefrontCountryCode}set storefrontCountryCode(e){e&&this.userToken?this._setStorageItem(J.STOREFRONT_COUNTRY_CODE,e):this._removeStorageItem(J.STOREFRONT_COUNTRY_CODE),e!==this._storefrontCountryCode&&(this._storefrontCountryCode=e,this.dispatchEvent(le.storefrontCountryCodeDidChange,{storefrontCountryCode:e}))}get storefrontIdentifier(){return this._storefrontIdentifier}set storefrontIdentifier(e){this._storefrontIdentifier=e,this.dispatchEvent(le.storefrontIdentifierDidChange,{storefrontIdentifier:e})}runTokenValidations(e,t=!0){e&&validateToken(e)?(t&&this._setStorageItem(J.USER_TOKEN,e),this.authorizationStatus=this.restrictedEnabled?ne.RESTRICTED:ne.AUTHORIZED):(this._removeStorageItem(J.USER_TOKEN),this.authorizationStatus=ne.NOT_DETERMINED)}wrapDynamicUserTokenForChanges(e,t=invoke(e)){if("function"!=typeof e)return e;let r=t;return()=>{const t=invoke(e);return r!==t&&(r=t,this.runTokenValidations(t,!1),this.dispatchEvent(le.userTokenDidChange,{userToken:t})),t||""}}get dynamicUserToken(){return this._dynamicUserToken}set dynamicUserToken(e){const t=invoke(e);this._dynamicUserToken=this.wrapDynamicUserTokenForChanges(e,t),this.runTokenValidations(t,"function"!=typeof e),this.dispatchEvent(le.userTokenDidChange,{userToken:t})}get userToken(){return invoke(this.dynamicUserToken)}set userToken(e){this.dynamicUserToken=e}get userTokenIsValid(){return validateToken(this.userToken)}deeplinkURL(e={}){return"https://finance-app.itunes.apple.com/deeplink?"+buildQueryParams(e=_object_spread$I({},this.deeplinkParameters||{},e))}itunesDeeplinkURL(e={p:"browse"}){return"https://itunes.apple.com/deeplink?"+buildQueryParams(e=_object_spread$I({},this.deeplinkParameters||{},e))}pldfltcid(){var e=this;return _async_to_generator$1k((function*(){if(!e._cids[J.DEFAULT_CID])try{yield e.infoRefresh()}catch(t){return}return e._cids[J.DEFAULT_CID]}))()}renewUserToken(){var e=this;return _async_to_generator$1k((function*(){if(!e.userToken)return e.requestUserToken();const t=new Headers({Authorization:"Bearer "+e.developerToken,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+e.userToken}),r=yield fetch(e.playBase+"/renewMusicToken",{method:"POST",headers:t});if(401===r.status)return yield e.revokeUserToken(),Promise.reject(new Error("Renew token"));const n=yield r.json();return n["music-token"]&&(e.userToken=n["music-token"]),e.userToken}))()}requestStorefrontCountryCode(){var e=this;return _async_to_generator$1k((function*(){if(e.authorizationStatus<=ne.DENIED)return Promise.reject("Not authorized: "+e.authorizationStatus);const t=new Headers({Authorization:"Bearer "+e.developerToken,[O]:e.userToken||""}),r=yield fetch(e.apiBase+"/me/storefront",{headers:t});if(r&&!r.ok)return e._reset(),Promise.reject("Storefront Country Code error.");const n=yield r.json();if(n.errors)return Promise.reject(n.errors);const[i]=n.data;return i&&i.id?(e.storefrontCountryCode=i.id,e.storefrontCountryCode):Promise.reject("Storefront Country Code error.")}))()}requestStorefrontIdentifier(){var e=this;return _async_to_generator$1k((function*(){if(!e.storefrontIdentifier){const t=yield Storefront.inferFromLanguages(e.developerToken);e.storefrontIdentifier=t.id}return e.storefrontIdentifier}))()}requestUserToken(){var e=this;return _async_to_generator$1k((function*(){if(e._serviceSetupView.isServiceView)return e.userToken||"";try{const t=yield e._serviceSetupView.load({action:se.AUTHORIZE});e.cid=t.cid,e.userToken=t.userToken,e.restrictedEnabled=t.restricted}catch(t){return e._reset(),e.authorizationStatus=t,Promise.reject(t)}return e.userToken}))()}revokeUserToken(){var e=this;return _async_to_generator$1k((function*(){var t;try{yield e._webPlayerLogout()}catch(r){}null===(t=e.authBridgeApp)||void 0===t||t.clearAuth(),e.dispatchEvent(le.authorizationStatusWillChange,{authorizationStatus:e.authorizationStatus,newAuthorizationStatus:ne.NOT_DETERMINED}),e._reset(),e.dispatchEvent(le.authorizationStatusDidChange,{authorizationStatus:e.authorizationStatus}),e.dispatchEvent(le.userTokenDidChange,{userToken:e.userToken})}))()}setCids(e){this._cids=_object_spread$I({},this._cids,e),Object.keys(this._cids).forEach(e=>{this._setStorageItem(e,this._cids[e])})}shouldDisplayPrivacyLink(e){var t=this;return _async_to_generator$1k((function*(){return e||(e=t.bundleId),void 0!==t._needsGDPR||(yield t.me()),t._needsGDPR}))()}hasMusicSubscription(){var e=this;return _async_to_generator$1k((function*(){return!!e.hasAuthorized&&e._getIsActiveSubscription()}))()}_getIsActiveSubscription(){var t=this;return _async_to_generator$1k((function*(){var r;if(t.realm===e.SKRealm.PODCAST)return!0;return!!(null===(r=(yield t.me()).subscription)||void 0===r?void 0:r.active)}))()}resetSubscribeViewEligibility(){this._dispatchedSubscribeView=!1}presentSubscribeViewForEligibleUsers(e={},t=!0){var r=this;return _async_to_generator$1k((function*(){const n=yield r.eligibleForSubscribeView();if(!r._serviceSetupView.isServiceView&&n){if(!t)return r.dispatchEvent(le.eligibleForSubscribeView,e),void(r._dispatchedSubscribeView=!0);try{const e=yield r._serviceSetupView.load({action:se.SUBSCRIBE});return r._dispatchedSubscribeView=!0,e}catch(i){return r.revokeUserToken()}}}))()}infoRefresh(){var e=this;return _async_to_generator$1k((function*(){if(e.authorizationStatus<=ne.DENIED)return Promise.reject("Not authorized: "+e.authorizationStatus);const t=new Headers({Authorization:"Bearer "+e.developerToken,[O]:e.userToken||""});try{const r=yield fetch(e.iTunesBuyBase+"/account/web/infoRefresh",{credentials:"include",headers:t}),n=yield r.json();e.setCids(n)}catch(r){}}))()}me(){if(this.authorizationStatus<=ne.DENIED)return Promise.reject("Not authorized: "+this.authorizationStatus);if(!this._me){var t=this;this._me=new Promise(function(){var r=_async_to_generator$1k((function*(r,n){const i=new Headers({Authorization:"Bearer "+t.developerToken,[O]:t.userToken||""}),o=addQueryParamsToURL(t.apiBase+"/me/account",_object_spread$I({meta:"subscription"},t.meParameters));let a;try{a=yield fetch(o,{headers:i})}catch(u){return n(new MKError(MKError.NETWORK_ERROR,"Failed to fetch /me/account"))}if(a&&!a.ok)return t.realm!==e.SKRealm.TV&&t._reset(),n("Account error.");let s=yield a.json();if(s.errors)return n(s.errors);const{data:c,meta:l}=s;if(!l||!l.subscription)return n("Account error.");t.storefrontCountryCode=l.subscription.storefront;const d={meta:l,subscription:l.subscription};c&&c.length&&(d.attributes=c[0].attributes);try{let e=yield fetch(t.iTunesBuyBase+"/account/web/info",{credentials:"include",headers:i});if(s=yield e.json(),t.parentalControls=s.parentalControlsData,t.privacyAcknowledgements=s.privacyAcknowledgement,function(e){if("object"!=typeof e)throw new TypeError("Source is not an Object");for(const t in e)if(hasOwn(e,t))return!1;return!0}(t.privacyAcknowledgements||{})){try{yield t.infoRefresh()}catch(u){r(d)}e=yield fetch(t.iTunesBuyBase+"/account/web/info",{credentials:"include",headers:i}),s=yield e.json(),t.parentalControls=s.parentalControlsData,t.privacyAcknowledgements=s.privacyAcknowledgement}d.info=s}catch(u){console.warn("Failed to fetch privacyAcknowledgements",u)}return r(d)}));return function(e,t){return r.apply(this,arguments)}}()).then(e=>{var t;return this._getIsActiveSubscription.updateCache((null===(t=e.subscription)||void 0===t?void 0:t.active)||!1),this._me=null,e}).catch(e=>(this._me=null,Promise.reject(e)))}return this._me}musicSubscriptionOffers(e,t=getLanguages()){var r=this;return _async_to_generator$1k((function*(){let n;if(r.hasAuthorized){n=(yield r.me()).info.storeFrontISO3A}else{if(!e){var i;const n=yield Storefront.inferFromLanguages(r.developerToken,t);e=null===(i=n)||void 0===i?void 0:i.id}n=e&&k[e.toUpperCase()]||"USA"}const o=function(e="en-US"){const t=w[e.toLowerCase()];if(t)return t;if(e.includes("-")){const t=e.split("-")[0],r=w[t.toLowerCase()];if(r)return r}return w["en-us"]}(t[0]),a=T[n];if(!o||!a)return[];const s=new Headers({"X-Apple-Store-Front":`${a}-${o},8`});r.userToken&&(s.set("Authorization","Bearer "+r.developerToken),s.set("Music-User-Token",r.userToken));const c=yield fetch(r.iTunesBuyBase+"/commerce/web/subscription/offers/music",{headers:s});if(!c.ok)return Promise.reject(c.status);return(yield c.json()).offers}))()}_getStorageItem(e){var t;if(e)return"cookie"===this.persist?getCookie(e):"localstorage"===this.persist?null===(t=this.storage)||void 0===t?void 0:t.getItem(`${this.storagePrefix}.${e}`):void 0}_processLocationHash(e){const t=/^\#([a-zA-Z0-9+\/]{200,}={0,2})$/;if(t.test(e)){const n=e.replace(t,"$1");try{const{itre:e,musicUserToken:t,cid:r}=JSON.parse(atob(n));this.restrictedEnabled=e&&"1"===e,this.userToken=t,this.cid=r}catch(r){}history.replaceState(null,document.title," ")}}_removeStorageItem(e){if("cookie"===this.persist)this._removeCookieFromDomains(e);else if("localstorage"===this.persist){var t;return null===(t=this.storage)||void 0===t?void 0:t.removeItem(`${this.storagePrefix}.${e}`)}}_removeCookieFromDomains(e,t=window){removeCookie(e);const{hostname:r}=t.location,n=r.split(".");if(n.length&&(n.shift(),n.length>2))for(let i=n.length;i>2;i--){const r=n.join(".");n.shift(),removeCookie(e,t,r)}}_reset(e=ne.NOT_DETERMINED){this._authorizationStatus=e,this._cids={},this._dispatchedSubscribeView=!1,this._restrictedEnabled=void 0,this._storefrontCountryCode=void 0,this._getIsActiveSubscription.updateCache(void 0),Object.keys(ee).forEach(e=>{this._removeStorageItem(ee[e])}),this._removeStorageItem(J.RESTRICTIONS_ENABLED),this._removeStorageItem(J.USER_TOKEN),this._removeStorageItem(J.STOREFRONT_COUNTRY_CODE),this._dynamicUserToken=void 0,this._me=null,this.privacyAcknowledgements=void 0}_setStorageItem(e,t){var r,n;return"cookie"===this.persist?(null===(r=this.authBridgeApp)||void 0===r||r.setCookieItem(e,t),setCookie(e,t,"/",180)):"localstorage"===this.persist?null===(n=this.storage)||void 0===n?void 0:n.setItem(`${this.storagePrefix}.${e}`,t):void 0}_webPlayerLogout(){var e=this;return _async_to_generator$1k((function*(){const t=e.logoutURL;if(!t)return;const r=new Headers({Authorization:"Bearer "+e.developerToken,Accept:"application/json","Content-Type":"application/json",["X-Apple-"+O]:""+e.userToken});r.delete("X-Apple-"+O),r.append(O,e.userToken||"");const n=yield fetch(t,{method:"POST",headers:r,credentials:"include"});return n&&!n.ok?Promise.reject(n.status):n.json()}))()}constructor(t,r){var n;(super([le.authorizationStatusDidChange,le.authorizationStatusWillChange,le.eligibleForSubscribeView,le.needsGDPRDidChange,le.storefrontCountryCodeDidChange,le.userTokenDidChange,le.storefrontIdentifierDidChange]),_define_property$1N(this,"developerToken",void 0),_define_property$1N(this,"apiBase",void 0),_define_property$1N(this,"bundleId",void 0),_define_property$1N(this,"cidNamespace",void 0),_define_property$1N(this,"deeplinkParameters",void 0),_define_property$1N(this,"iconURL",void 0),_define_property$1N(this,"iTunesBuyBase",void 0),_define_property$1N(this,"meParameters",void 0),_define_property$1N(this,"persist",void 0),_define_property$1N(this,"playBase",void 0),_define_property$1N(this,"prefix",void 0),_define_property$1N(this,"realm",void 0),_define_property$1N(this,"storage",void 0),_define_property$1N(this,"storagePrefix",void 0),_define_property$1N(this,"whenAuthCompleted",void 0),_define_property$1N(this,"_authorizationStatus",void 0),_define_property$1N(this,"_developerToken",void 0),_define_property$1N(this,"_disableLogoutURL",void 0),_define_property$1N(this,"_dispatchedSubscribeView",void 0),_define_property$1N(this,"_me",void 0),_define_property$1N(this,"_cids",void 0),_define_property$1N(this,"_gdprVersion",void 0),_define_property$1N(this,"_needsGDPR",void 0),_define_property$1N(this,"_parentalControls",void 0),_define_property$1N(this,"_privacyAcknowledgements",void 0),_define_property$1N(this,"_restrictedEnabled",void 0),_define_property$1N(this,"_restrictedEnabledOverridden",void 0),_define_property$1N(this,"_serviceSetupView",void 0),_define_property$1N(this,"authBridgeApp",void 0),_define_property$1N(this,"_storefrontCountryCode",void 0),_define_property$1N(this,"_storefrontIdentifier",void 0),_define_property$1N(this,"_dynamicUserToken",void 0),this.developerToken=t,this.apiBase="https://api.music.apple.com/v1",this.iTunesBuyBase=ue,this.meParameters={},this.persist="localstorage",this.playBase=pe,this.prefix="music",this.realm=e.SKRealm.MUSIC,this.storage=getLocalStorage(),this._authorizationStatus=ne.NOT_DETERMINED,this._disableLogoutURL=!1,this._dispatchedSubscribeView=!1,this._me=null,this._cids={},this._gdprVersion=-1,this._needsGDPR=void 0,this._restrictedEnabledOverridden=!1,this._dynamicUserToken=getCookie(J.USER_TOKEN),W.info("StoreKit initialized"),r&&(r.apiBase&&(this.apiBase=r.apiBase),r.deeplink&&(this.deeplinkParameters=r.deeplink),r.meParameters&&(this.meParameters=r.meParameters),r.persist&&(this.persist=r.persist),r.prefix&&(this.prefix=r.prefix),void 0!==r.realm&&(this.realm=r.realm),void 0!==r.disableLogoutURL&&(this._disableLogoutURL=r.disableLogoutURL),this.bundleId=Z[this.realm]),this.cidNamespace=ee[this.realm],this._developerToken=new DeveloperToken(t),this._serviceSetupView=new ServiceSetupView(t,{authenticateMethod:r&&r.authenticateMethod,iconURL:r&&r.iconURL,deeplinkParameters:this.deeplinkParameters}),this.storagePrefix=`${this.prefix}.${this._developerToken.teamId}`.toLocaleLowerCase(),this.updateUserTokenFromStorage(),this.developerToken&&this.userTokenIsValid&&(this._restrictedEnabled=this.restrictedEnabled,this.shouldDisplayPrivacyLink(this.bundleId).catch(()=>{})),this._storefrontCountryCode=this.storefrontCountryCode,this.whenAuthCompleted=Promise.resolve(),isNodeEnvironment$1())||(this._processLocationHash(window.location.hash),"cookie"!==this.persist||(null===(n=r)||void 0===n?void 0:n.disableAuthBridge)||(this.authBridgeApp=new AuthBridgeApp,this.authBridgeApp.authClearedFromOtherFrame=this.revokeUserToken.bind(this),this.whenAuthCompleted=this.authBridgeApp.whenAuthCompleted.then(()=>{this.updateUserTokenFromStorage()})))}}var he,ye;!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([((e=300)=>(t,r,n)=>{if(void 0===n||"function"!=typeof n.value)throw new TypeError(`Only methods can be decorated with @CachedResult, but ${r} is not a method.`);return{configurable:!0,get(){const t=n.value,i=1e3*e;let o,a=-1;function cachedResultMethod(){return _cachedResultMethod.apply(this,arguments)}function _cachedResultMethod(){return(_cachedResultMethod=_async_to_generator$1o((function*(...e){const r=Date.now();return(void 0===o||-1===a||a>0&&r>a+i)&&(a=r,o=yield t.apply(this,e)),o}))).apply(this,arguments)}return cachedResultMethod.updateCache=function(e){a=Date.now(),o=e},cachedResultMethod.getCachedValue=()=>o,Object.defineProperty(this,r,{value:cachedResultMethod,configurable:!0,writable:!0}),cachedResultMethod}}})(900),_ts_metadata$C("design:type",Function),_ts_metadata$C("design:paramtypes",[])],StoreKit.prototype,"_getIsActiveSubscription",null),e.PlaybackStates=void 0,(he=e.PlaybackStates||(e.PlaybackStates={}))[he.none=0]="none",he[he.loading=1]="loading",he[he.playing=2]="playing",he[he.paused=3]="paused",he[he.stopped=4]="stopped",he[he.ended=5]="ended",he[he.seeking=6]="seeking",he[he.waiting=8]="waiting",he[he.stalled=9]="stalled",he[he.completed=10]="completed",e.PresentationMode=void 0,(ye=e.PresentationMode||(e.PresentationMode={}))[ye.pictureinpicture=0]="pictureinpicture",ye[ye.inline=1]="inline";const _e=["contributors","modalities","movie","musicVideo","musicMovie","trailer","tvEpisode","uploadedVideo","uploaded-videos","music-videos","music-movies","tv-episodes","workouts"];function isVideo(e){var t;return null!=e&&(!0===e.isUTS||_e.includes(e.type)||"video"===(null===(t=e.attributes)||void 0===t?void 0:t.mediaKind))}function isLive(e){var t,r;return!!(null===(r=e)||void 0===r||null===(t=r.attributes)||void 0===t?void 0:t.isLive)}function isStream(e){var t,r,n;return"stream"===(null===(n=e)||void 0===n||null===(r=n.attributes)||void 0===r||null===(t=r.playParams)||void 0===t?void 0:t.format)}function isLiveRadioStation(e){return isLive(e)&&isStream(e)}function isLiveRadioKind(e,t){var r;return isLiveRadioStation(e)&&(null===(r=e.attributes)||void 0===r?void 0:r.mediaKind)===t}function isAOD(e){var t,r;return!isLive(e)&&isStream(e)&&"Episode"===e.attributes.streamingRadioSubType||!!(null===(r=e)||void 0===r||null===(t=r.attributes)||void 0===t?void 0:t.isAOD)}function isBroadcastRadio(e){return isLive(e)&&isStream(e)&&void 0!==e.attributes.stationProviderName&&"Shoutcast"===e.attributes.streamingRadioSubType}function getFilterFromFlags(e){const t=e.includes("radio-live"),r=e.includes("radio-aod"),n=e.includes("radio-broadcast");return function(e){return(!t||t&&!isLiveRadioStation(e))&&(!r||r&&!isAOD(e))&&(!n||n&&!isBroadcastRadio(e))}}const fe={};function normalizeContentType(e){if(void 0!==fe[e])return fe[e];let t=e.replace(/[A-Z]/g,(function(e,t){const r=e.toLowerCase();return 0!==t?"-"+r:r})).replace(/_+/g,"-").replace(/-+/g,"-").replace(/(^-*)|(-*$)/,"");return e.endsWith("y")?t=t.substring(0,t.length-1)+"ies":t.endsWith("s")||(t+="s"),fe[e]=t,t}const ve=["contributors","modalities","musicVideo","podcast-episodes","radioStation","song","uploaded-audios","uploadedAudio","uploaded-videos","uploadedVideo","workouts","workout-programs"],ge={"uploaded-videos":!0,uploadedVideo:!0,"uploaded-audios":!0,uploadedAudio:!0,"podcast-episodes":!0},me=["Vod","LiveService","EbsEvent","Event"],be={mediaItemStateDidChange:"mediaItemStateDidChange",mediaItemStateWillChange:"mediaItemStateWillChange"},Se=new Logger$1("media-item"),{none:Pe,loading:Ee,ready:Te,playing:ke,ended:we,unavailable:Oe,restricted:Ie,error:Ae,unsupported:$e}=E,Re={[Pe]:{allowed:[Ee],unknown:[we,Oe,Ie,Ae,$e]},[Ee]:{allowed:[Te,Ie,Ae,$e],unknown:[]},[Te]:{allowed:[ke],unknown:[Ae]},[ke]:{allowed:[we,Ae],unknown:[Oe,Ie,$e]},[we]:{allowed:[],unknown:[]},[Oe]:{allowed:[],unknown:[]},[Ie]:{allowed:[],unknown:[]},[Ae]:{allowed:[],unknown:[]},[$e]:{allowed:[],unknown:[]}},toName=e=>E[e],createMediaItemStateGuard=(e=Pe)=>{const t={current:e,set(e){const{current:r}=t;if(!((e,t)=>Re[e].allowed.includes(t))(r,e)){const t=((e,t)=>Re[e].unknown.includes(t))(r,e);Se.debug(`MediaItem.state was changed from ${toName(r)} to ${toName(e)}`,t?"but it is unknown whether it should be allowed or not.":"and it should not be happening")}t.current=e}};return t};function isStringNotEmpty(e){return!function(e){return void 0===e||""===e.trim()}(e)}function transform$8(e){return transform$9({"attributes.albumName":"metadata.playlistName","attributes.artistName":"metadata.artistName","attributes.artwork"(){var t;const r=null===(t=e)||void 0===t?void 0:t.artworkURL;if(r)return function(e){const t=e.split("/").pop(),[r,n]=!!t&&t.match(/\d+/g)||["100","100"];return{width:parseInt(r,10),height:parseInt(n,10),url:e.replace(`${r}x${n}`,"{w}x{h}")}}(r)},"attributes.composerName":"metadata.composerName","attributes.contentRating"(){var t,r;if(1===(null===(r=e)||void 0===r||null===(t=r.metadata)||void 0===t?void 0:t.explicit))return"explicit"},"attributes.discNumber"(){var t,r;return(null===(r=e)||void 0===r||null===(t=r.metadata)||void 0===t?void 0:t.discNumber)||1},"attributes.durationInMillis":"metadata.duration","attributes.genreNames"(){var t,r;return[null===(r=e)||void 0===r||null===(t=r.metadata)||void 0===t?void 0:t.genre]},"attributes.isrc"(){var t,r;const n=null===(r=e)||void 0===r||null===(t=r.metadata)||void 0===t?void 0:t.xid;if(n)return n.replace(/^([^:]+):isrc:/,"$1")},"attributes.name":"metadata.itemName","attributes.playParams.id":"metadata.itemId","attributes.playParams.kind":"metadata.kind","attributes.previews"(){var t;return[{url:null===(t=e)||void 0===t?void 0:t.previewURL}]},"attributes.releaseDate":"metadata.releaseDate","attributes.trackNumber":"metadata.trackNumber",assetURL:"URL",cloudId:"metadata.cloud-id",id(){var t,r;return""+(null===(r=e)||void 0===r||null===(t=r.metadata)||void 0===t?void 0:t.itemId)},flavor:"flavor",type:"metadata.kind"},e)}function _define_property$1M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const{mediaItemStateDidChange:Ce,mediaItemStateWillChange:Me}=be,De={isEntitledToPlay:!0};class MediaItem extends Notifications{get ageGatePolicy(){var e;return null===(e=this.defaultPlayable)||void 0===e?void 0:e.ageGatePolicy}get albumInfo(){const{albumName:e,artistName:t}=this,r=[];return t&&r.push(t),e&&r.push(e),r.join(" - ")}get albumName(){return this.attributes.albumName}get artistName(){return this.attributes.genreNames&&this.attributes.genreNames.indexOf("Classical")>-1&&this.attributes.composerName?this.attributes.composerName:this.attributes.artistName}get artwork(){var e,t;return null!==(t=this.attributes.artwork)&&void 0!==t?t:null===(e=this.attributes.images)||void 0===e?void 0:e.coverArt16X9}get artworkURL(){if(this.artwork&&this.artwork.url)return this.artwork.url}get assets(){return this._assets}get canPlay(){return this.isPlayable&&this.isReady}get container(){return this._container}set container(e){this._container=e}get contentRating(){return this.attributes.contentRating}get context(){return this._context}set context(e){this._context=e}get defaultPlayable(){var e;return null===(e=this.playables)||void 0===e?void 0:e[0]}get discNumber(){return this.attributes.discNumber}get hasContainerArtwork(){return this.container&&this.container.attributes&&this.container.attributes.artwork&&this.container.attributes.artwork.url}get hasPlaylistContainer(){return this.container&&"playlists"===this.container.type&&this.container.attributes}get isEntitledToPlay(){var e;const{attributes:t,defaultPlayable:r}=this;var n;return null!==(n=t.isEntitledToPlay||(null===(e=r)||void 0===e?void 0:e.isEntitledToPlay))&&void 0!==n&&n}get supportsLinearScrubbing(){var e,t,r;return this.isLinearStream&&!0===(null===(r=this.defaultPlayable)||void 0===r||null===(t=r.assets)||void 0===t||null===(e=t.streamCapability)||void 0===e?void 0:e.supportsLinearScrubbing)}get isAssetScrubbingDisabled(){return!!this.isLinearStream&&!this.supportsLinearScrubbing}get isLinearStream(){return"LiveService"===(null===(t=e=this)||void 0===t?void 0:t.type)||"Event"===(null===(n=e)||void 0===n||null===(r=n.defaultPlayable)||void 0===r?void 0:r.type)||"EbsEvent"===(null===(o=e)||void 0===o||null===(i=o.defaultPlayable)||void 0===i?void 0:i.type);var e,t,r,n,i,o}get isLiveRadioStation(){return isLiveRadioStation(this)}get isLiveAudioStation(){return isLiveRadioKind(this,"audio")}get isLiveVideoStation(){return isLiveRadioKind(this,"video")}get isAOD(){return isAOD(this)}get isSong(){return"song"===this.type}get info(){return`${this.title} - ${this.albumInfo}`}get isCloudItem(){return this.playParams&&this.playParams.isLibrary||n(this.id)}get isCloudUpload(){return-1===this._songId}get isExplicitItem(){return"explicit"===this.contentRating}get isLoading(){return this.state===E.loading}get isPlayableMediaType(){return this.isUTS||-1!==ve.indexOf(this.type)}get isPlayable(){var e;return!!this.isPlayableMediaType&&(!(!this.isLiveRadioStation&&!this.hasOffersHlsUrl)||(this.needsPlayParams?!!this.playParams:this.isUTS?this.isEntitledToPlay:!!this.attributes.assetUrl||!!(null===(e=this.attributes.previews)||void 0===e?void 0:e.length)))}get isPlaying(){return this.state===E.playing}get isPreparedToPlay(){if("song"===this.type)return!!this._assets&&!!this.keyURLs&&!!this._songId;if(this.isUTS){const e=isStringNotEmpty(this.assetURL),t=!!(this.keyURLs&&isStringNotEmpty(this.keyURLs["hls-key-cert-url"])&&isStringNotEmpty(this.keyURLs["hls-key-server-url"])&&isStringNotEmpty(this.keyURLs["widevine-cert-url"]));return e&&t}return!!isStringNotEmpty(this.assetURL)||this.playRawAssetURL&&!!isStringNotEmpty(this.attributes.assetUrl)}get isrc(){return this.attributes.isrc}get isReady(){return this.state===E.ready}get isRestricted(){return this.state===E.restricted}get isUTS(){var e;return!(!(null===(e=this.defaultPlayable)||void 0===e?void 0:e.type)||!me.includes(this.defaultPlayable.type))}get isUnavailable(){return this.state===E.unavailable}get needsPlayParams(){return["musicVideo","song"].includes(this.type)}get normalizedType(){return normalizeContentType(this.type)}get offers(){return this.attributes.offers}get offersHlsUrl(){var e,t;const{offers:r}=this;return null===(t=null===(e=r)||void 0===e?void 0:e.find(e=>{var t;return!!(null===(t=e.hlsUrl)||void 0===t?void 0:t.length)}))||void 0===t?void 0:t.hlsUrl}get hasOffersHlsUrl(){return isStringNotEmpty(this.offersHlsUrl)}set playbackData(e){if(void 0===e)return;this.previewURL&&(e.previewURL=this.previewURL);const t=transform$8(e);this.artwork&&t.artwork&&delete t.artwork,t.id!==this.id&&delete t.id,this.playParams&&t.attributes.playParams&&(t.attributes.playParams=this.playParams),t.attributes=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1M(e,t,r[t])}))}return e}({},this.attributes,t.attributes),Object.assign(this,t),Se.debug("media-item: item merged with playbackData",this),this.state=E.ready}get playbackDuration(){return this.attributes.durationInMillis||this.attributes.durationInMilliseconds}get playEvent(){var e;return null===(e=this.defaultPlayable)||void 0===e?void 0:e.playEvent}get playlistArtworkURL(){var e,t,r;return this.hasPlaylistContainer&&this.hasContainerArtwork?null===(r=this.container)||void 0===r||null===(t=r.attributes)||void 0===t||null===(e=t.artwork)||void 0===e?void 0:e.url:this.artworkURL}get playlistName(){var e,t;return this.hasPlaylistContainer?null===(t=this.container)||void 0===t||null===(e=t.attributes)||void 0===e?void 0:e.name:this.albumName}get playParams(){return this.attributes.playParams}get playRawAssetURL(){return!(!this.isCloudUpload&&!ge[this.type]||this.hasOffersHlsUrl)}get previewURL(){var e,t,r,n,i,o,a,s,c,l,d,u,p,h,y;return(null===(r=this.attributes)||void 0===r||null===(t=r.previews)||void 0===t||null===(e=t[0])||void 0===e?void 0:e.url)||(null===(o=this.attributes)||void 0===o||null===(i=o.previews)||void 0===i||null===(n=i[0])||void 0===n?void 0:n.hlsUrl)||(null===(l=this.attributes)||void 0===l||null===(c=l.trailers)||void 0===c||null===(s=c[0])||void 0===s||null===(a=s.assets)||void 0===a?void 0:a.hlsUrl)||(null===(p=this.attributes)||void 0===p||null===(u=p.movieClips)||void 0===u||null===(d=u[0])||void 0===d?void 0:d.hlsUrl)||(null===(y=this.attributes)||void 0===y||null===(h=y.video)||void 0===h?void 0:h.hlsUrl)}get rating(){return this.attributes.rating}get releaseDate(){if(this._releaseDate)return this._releaseDate;if(this.attributes&&(this.attributes.releaseDate||this.attributes.releaseDateTime)){const e=this.attributes.releaseDate||this.attributes.releaseDateTime;return this._releaseDate=/^\d{4}-\d{1,2}-\d{1,2}/.test(e)?new Date(e):void 0,this._releaseDate}}set releaseDate(e){this._releaseDate="string"==typeof e?/^\d{4}-\d{1,2}-\d{1,2}/.test(e)?new Date(e):void 0:"number"==typeof e?new Date(e):e}get songId(){return this._songId&&-1!==this._songId?this._songId:this.id}get state(){return this._state.current}set state(e){const t={oldState:this._state.current,state:e};this._stateWillChange&&this._stateWillChange(this),this.dispatchEvent(Me,t),this._state.set(e),this._stateDidChange&&this._stateDidChange(this),this.dispatchEvent(Ce,t)}get title(){return this.attributes.name||this.attributes.title}get trackNumber(){return this.attributes.trackNumber}beginMonitoringStateDidChange(e){this._stateDidChange=e}beginMonitoringStateWillChange(e){this._stateWillChange=e}endMonitoringStateDidChange(){this._stateDidChange=void 0}endMonitoringStateWillChange(){this._stateWillChange=void 0}isEqual(e){return this.id===e.id&&this.type===e.type&&this.attributes===e.attributes}resetState(){this.endMonitoringStateWillChange(),this.endMonitoringStateDidChange(),this.state=E.none}restrict(){this.isExplicitItem&&(this.state=E.restricted,this._removePlayableData())}notSupported(){this.state=E.unsupported,this._removePlayableData()}updateFromLoadError(e){switch(e.errorCode){case MKError.CONTENT_RESTRICTED:this.state=E.restricted;break;case MKError.CONTENT_UNAVAILABLE:this.state=E.unavailable;break;default:this.state=E.error}}updateFromSongList(e){"musicVideo"===this.type?this.updateWithLoadedAssets(void 0,e["hls-playlist-url"]):this.updateWithLoadedAssets(e.assets),this._songId=e.songId,this.updateWithLoadedKeys({"hls-key-cert-url":e["hls-key-cert-url"],"hls-key-server-url":e["hls-key-server-url"],"widevine-cert-url":e["widevine-cert-url"]})}updateWithLoadedKeys(e,t){this.keyURLs=e,t&&(this.keyServerQueryParameters=t)}updateWithLoadedAssets(e,t){e&&(this._assets=e),t&&(this.assetURL=t)}_removePlayableData(){var e,t,r;null===(e=this.attributes)||void 0===e||delete e.playParams,null===(t=this.attributes)||void 0===t||delete t.previews,null===(r=this.attributes)||void 0===r||delete r.trailers}constructor(t={}){super([Ce,Me]),_define_property$1M(this,"id",void 0),_define_property$1M(this,"type",void 0),_define_property$1M(this,"contentType",void 0),_define_property$1M(this,"cloudId",void 0),_define_property$1M(this,"playables",void 0),_define_property$1M(this,"channels",void 0),_define_property$1M(this,"assetURL",void 0),_define_property$1M(this,"hlsMetadata",{}),_define_property$1M(this,"flavor",void 0),_define_property$1M(this,"keyURLs",void 0),_define_property$1M(this,"keyServerQueryParameters",void 0),_define_property$1M(this,"attributes",{}),_define_property$1M(this,"playbackType",e.PlaybackType.none),_define_property$1M(this,"trackInfo",void 0),_define_property$1M(this,"relationships",void 0),_define_property$1M(this,"_assets",[]),_define_property$1M(this,"_container",void 0),_define_property$1M(this,"_context",void 0),_define_property$1M(this,"_releaseDate",void 0),_define_property$1M(this,"_songId",void 0),_define_property$1M(this,"_state",createMediaItemStateGuard()),_define_property$1M(this,"_stateDidChange",void 0),_define_property$1M(this,"_stateWillChange",void 0),Se.debug("media-item: creating Media Item with options:",t);t.id&&t.attributes?(Object.keys(t).forEach(e=>{hasOwn(De,e)||(this[e]=t[e])}),this.type=this.playParams&&this.playParams.kind?this.playParams.kind:this.type||"song"):(this.id=t.id||generateUUID(),this.type=t.type||"song",this.attributes={playParams:{id:this.id,kind:this.type}}),this.contentType=t.contentType,this._context=t.context||{},t.container?this._container=t.container:t.containerId&&t.containerType&&(this._container={id:t.containerId,type:t.containerType})}}const xe=new Logger$1("player"),K=()=>{},asAsync=e=>{e.then(K,K)};var Le;!function(e){e.NONE="none",e.FAIRPLAY="com.apple.fps",e.PLAYREADY="com.microsoft.playready",e.WIDEVINE="com.widevine.alpha"}(Le||(Le={}));const Ne={app:{},features:{},urls:{}},je="mk-player-tsid",Ue='audio/mp4;codecs="mp4a.40.2"';var Fe,Be,Ke;function asyncGeneratorStep$1j(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1j(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1j(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1j(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function findMediaKeySystemAccess(e,t){return _findMediaKeySystemAccess.apply(this,arguments)}function _findMediaKeySystemAccess(){return(_findMediaKeySystemAccess=_async_to_generator$1j((function*(e,t){for(let n=0;n<e.length;n++)try{const r=e[n];return[r,yield navigator.requestMediaKeySystemAccess(r,t)]}catch(r){}return[]}))).apply(this,arguments)}!function(e){e.playbackLicenseError="playbackLicenseError",e.playbackSessionError="playbackSessionError",e.manifestParsed="manifestParsed",e.audioCodecIdentified="audioCodecIdentified",e.audioTracksSwitched="audioTracksSwitched",e.audioTracksUpdated="audioTracksUpdated",e.textTracksSwitched="textTracksSwitched",e.textTracksUpdated="textTracksUpdated",e.inlineStylesParsed="inlineStylesParsed",e.levelUpdated="levelUpdated"}(Fe||(Fe={})),function(e){e.MP4="audio/mp4",e.AVC1="video/mp4"}(Be||(Be={})),function(e){e.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",e.PLAYREADY="com.microsoft.playready",e.FAIRPLAY="com.apple.streamingkeydelivery"}(Ke||(Ke={}));let Ve;const{NONE:Ge,FAIRPLAY:He,WIDEVINE:We,PLAYREADY:qe}=Le;function supportsDrm(){if(!Ve)throw new Error("findKeySystemPreference has not been invoked");return Ve!==Ge}function potentialKeySystemsForAccess(){return function(){const e=getSessionStorage();return!!e&&"true"===e.getItem("mk-playready-cbcs-unsupported")}()?[We]:Ne.features["prefer-playready"]?[qe,We]:[We,qe]}function findKeySystemPreference(e){return _findKeySystemPreference.apply(this,arguments)}function _findKeySystemPreference(){return(_findKeySystemPreference=_async_to_generator$1j((function*(e){var t,r,n,i;if(null===(i=null===(t=e)||void 0===t?void 0:t.isNodeEnvironment)||void 0===i||!i){if(null===(r=window.WebKitMediaKeys)||void 0===r?void 0:r.isTypeSupported(He+".1_0",Be.AVC1))Ve=He;else if(null===(n=window.MSMediaKeys)||void 0===n?void 0:n.isTypeSupported(qe,Be.AVC1))Ve=qe;else{const e=document.createElement("video");if(hasMediaKeySupport()&&e.canPlayType('video/mp4;codecs="avc1.42E01E"')&&e.canPlayType(Ue)){const e=[{initDataTypes:["keyids","cenc"],distinctiveIdentifier:"optional",persistentState:"required",videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"',robustness:"SW_SECURE_CRYPTO"}],audioCapabilities:[{contentType:Ue}]}],t=potentialKeySystemsForAccess(),[r]=yield findMediaKeySystemAccess(t,e);Ve=r}}return Ve=null!=Ve?Ve:Ge,Ve}Ve=Ge}))).apply(this,arguments)}function hasMediaKeySupport(){return!!(navigator&&navigator.requestMediaKeySystemAccess&&window.MediaKeys&&window.MediaKeySystemAccess)}function parseVersion(e){const t={version:e.toLowerCase()},r=e.toLowerCase().split(".").filter(e=>!!e);if(r.length<=1&&!/^\d+$/.test(r[0]))return t;const n=parseInt(r[0],10),i=parseInt(r[1],10),o=parseInt(r[2],10);return Number.isNaN(n)||(t.major=n,Number.isNaN(i)||(t.minor=i),Number.isNaN(o)||(t.patch=o)),t}function applyRules(e,t,r){const{userAgent:n}=null!=t?t:{};if("string"!=typeof n||""===n.trim())return r;for(let i of e){const e=i.slice(0,-1),o=i[i.length-1];let a=null;for(let i of e)if(a=n.match(i),null!==a){Object.assign(r,o(a,t,r));break}if(null!==a)break}return r}function _define_property$1L(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1L(e,t,r[t])}))}return e}function _object_spread_props$p(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var ze,Ye;const Qe={browser:[[/^(itunes|music|tv)\/([\w\.]+)\s/i,e=>_object_spread_props$p(_object_spread$G({name:"webview",variant:e[1].trim().toLowerCase().replace(/(music|tv)/i,"$1.app")},parseVersion(e[2])),{mobile:!1})],[/(?:(?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i,e=>_object_spread$G({name:"webview",variant:"facebook",mobile:!0},parseVersion(e[1]))],[/(instagram|snapchat)[\/ ]([-\w\.]+)/i,e=>_object_spread$G({name:"webview",variant:e[1].trim().toLowerCase(),mobile:!0},parseVersion(e[2]))],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i,e=>_object_spread$G({name:"webview",variant:"tiktok",mobile:!0},parseVersion(e[1]))],[/twitter/i,()=>({name:"webview",variant:"twitter",mobile:!0})],[/ wv\).+?(?:version|chrome)\/([\w\.]+)/i,e=>_object_spread$G({name:"webview",mobile:!0},parseVersion(e[1]))],[/electron\/([\w\.]+) safari/i,e=>_object_spread$G({name:"electron",mobile:!1},parseVersion(e[1]))],[/tesla\/(.*?(20\d\d\.([-\w\.])+))/i,e=>_object_spread_props$p(_object_spread$G({name:"other",variant:"tesla",mobile:!1},parseVersion(e[2])),{version:e[1]})],[/(samsung|huawei)browser\/([-\w\.]+)/i,e=>_object_spread$G({name:"other",variant:e[1].trim().toLowerCase().replace(/browser/i,""),mobile:!0},parseVersion(e[2]))],[/yabrowser\/([-\w\.]+)/i,e=>_object_spread$G({name:"other",variant:"yandex",mobile:!1},parseVersion(e[1]))],[/(brave|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,(e,{userAgent:t})=>_object_spread$G({name:"other",variant:e[1].trim().toLowerCase(),mobile:/mobile/i.test(t)},parseVersion(e[2].replace(/\-/g,".")))],[/edg(e|ios|a)?\/([\w\.]+)/i,e=>_object_spread$G({name:"edge",mobile:/(edgios|edga)/i.test(null!==(ze=e[1])&&void 0!==ze?ze:"")},parseVersion(e[2]))],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i,e=>_object_spread$G({name:"ie",mobile:!1},parseVersion(e[1]))],[/opr\/([\w\.]+)/i,/opera mini\/([-\w\.]+)/i,/opera [mobiletab]{3,6}\b.+version\/([-\w\.]+)/i,/opera(?:.+version\/|[\/ ]+)([\w\.]+)/i,e=>_object_spread$G({name:"opera",mobile:/mobile/i.test(e[0])},parseVersion(e[1]))],[/headlesschrome(?:\/([\w\.]+)| )/i,e=>_object_spread$G({name:"chrome",variant:"headless",mobile:!1},parseVersion(e[1]))],[/\b(?:crmo|crios)\/([\w\.]+)/i,e=>_object_spread$G({name:"chrome",mobile:!0},parseVersion(e[1]))],[/chrome(?: browser)?\/v?([\w\.]+)( mobile)?/i,e=>_object_spread$G({name:"chrome",mobile:/mobile/i.test(null!==(Ye=e[2])&&void 0!==Ye?Ye:"")},parseVersion(e[1]))],[/\bfocus\/([\w\.]+)/i,e=>_object_spread$G({name:"firefox",variant:"focus",mobile:!0},parseVersion(e[1]))],[/fxios\/([\w\.-]+)/i,/(?:mobile|tablet);.*(?:firefox)\/([\w\.-]+)/i,e=>_object_spread$G({name:"firefox",mobile:!0},parseVersion(e[1]))],[/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,e=>_object_spread$G({name:"firefox",variant:e[1].trim().toLowerCase(),mobile:!1},parseVersion(e[2]))],[/(?:firefox)\/([\w\.]+)/i,/(?:mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,e=>_object_spread$G({name:"firefox",mobile:!1},parseVersion(e[1]))],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i,/version\/([\w\.\,]+) .*(safari)/i,/webkit.+?(?:mobile ?safari|safari)(?:\/([\w\.]+))/i,e=>_object_spread$G({name:"safari",mobile:/mobile/i.test(e[0])},parseVersion(e[1]))]],engine:[[/webkit\/(?:537\.36).+chrome\/(?!27)([\w\.]+)/i,e=>_object_spread$G({name:"blink"},parseVersion(e[1]))],[/windows.+ edge\/([\w\.]+)/i,e=>_object_spread$G({name:"blink"},parseVersion(e[1]))],[/presto\/([\w\.]+)/i,e=>_object_spread$G({name:"presto"},parseVersion(e[2]))],[/trident\/([\w\.]+)/i,e=>_object_spread$G({name:"trident"},parseVersion(e[1]))],[/gecko\/([\w\.]+)/i,e=>_object_spread$G({name:"gecko"},parseVersion(e[1]))],[/(khtml|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,e=>_object_spread$G({name:"other"},parseVersion(e[2]))],[/webkit\/([\w\.]+)/i,e=>_object_spread$G({name:"webkit"},parseVersion(e[1]))]],os:[[/microsoft windows (vista|xp)/i,/windows nt 6\.2; (arm)/i,/windows (?:phone(?: os)?|mobile)[\/ ]?([\d\.\w ]*)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i,e=>_object_spread$G({name:"windows"},parseVersion(e[1]))],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,e=>_object_spread$G({name:"ios"},parseVersion(e[1].replace(/_/g,".")))],[/mac(?:intosh;?)? os x ?([\d\._]+)/i,e=>_object_spread$G({name:"macos"},parseVersion(e[1].replace(/_/g,".")))],[/cros [\w]+(?:\)| ([\w\.]+)\b)/i,e=>_object_spread$G({name:"chromeos"},parseVersion(e[1]))],[/(?:android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/droid ([\w\.]+|[\d+])\b.+(android[- ]x86|harmonyos)/i,e=>_object_spread$G({name:"android"},parseVersion(e[1]))],[/linux/i,()=>({name:"linux"})]]};function parseUserAgent(e,t){var r,n,i;var o;return function(e,t){let r=e;for(let n of t)r=n(r);return r}({navigator:e,ua:null!==(i=null===(r=e)||void 0===r?void 0:r.userAgent)&&void 0!==i?i:"",extensions:[],browser:applyRules(Qe.browser,e,{name:"unknown",mobile:!1}),engine:applyRules(Qe.engine,e,{name:"unknown"}),os:applyRules(Qe.os,e,{name:"unknown"})},null!==(o=null===(n=t)||void 0===n?void 0:n.extensions)&&void 0!==o?o:[])}function _define_property$1K(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1K(e,t,r[t])}))}return e}function _object_spread_props$o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function flagsExtension(e){let t=e.os.name;const r="android"===e.os.name;let n="macos"===e.os.name,i="ios"===e.os.name;var o;const a="ipados"===t||i&&/ipad/i.test(e.ua)||n&&(null!==(o=e.navigator.maxTouchPoints)&&void 0!==o?o:0)>=2;a&&(t="ipados",i=!1,n=!1);const s=_object_spread_props$o(_object_spread$F({},e.browser),{isUnknown:"unknown"===e.browser.name,isSafari:"safari"===e.browser.name,isChrome:"chrome"===e.browser.name,isFirefox:"firefox"===e.browser.name,isEdge:"edge"===e.browser.name,isWebView:"webview"===e.browser.name,isOther:"other"===e.browser.name,isMobile:e.browser.mobile||i||a||r||!1}),c=_object_spread_props$o(_object_spread$F({},e.engine),{isUnknown:"unknown"===e.engine.name,isWebKit:"webkit"===e.engine.name,isBlink:"blink"===e.engine.name,isGecko:"gecko"===e.engine.name}),l=_object_spread_props$o(_object_spread$F({},e.os),{name:t,isUnknown:"unknown"===e.os.name,isLinux:"linux"===e.os.name,isWindows:"windows"===e.os.name,isMacOS:n,isAndroid:r,isIOS:i,isIPadOS:a});return _object_spread_props$o(_object_spread$F({},e),{extensions:[...e.extensions,"flags"],browser:s,os:l,engine:c})}function asyncGeneratorStep$1i(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1i(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1i(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1i(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function isBrowserEnvironment(){return _isBrowserEnvironment.apply(this,arguments)}function _isBrowserEnvironment(){return(_isBrowserEnvironment=_async_to_generator$1i((function*(){var e;return void 0!==(null===(e=window)||void 0===e?void 0:e.navigator)}))).apply(this,arguments)}function asyncGeneratorStep$1h(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1h(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1h(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1h(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function isNodeEnvironment(){return _isNodeEnvironment.apply(this,arguments)}function _isNodeEnvironment(){return(_isNodeEnvironment=_async_to_generator$1h((function*(){var e;return void 0!==(null===(e=globalThis)||void 0===e?void 0:e.process)}))).apply(this,arguments)}function asyncGeneratorStep$1g(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1g(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1g(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1g(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const Je={playready:["com.microsoft.playready","com.youtube.playready"],widevine:["com.widevine.alpha"],clearkey:["org.w3.clearkey"],fairplay:["com.apple.fps","com.apple.fairplay"]};function detectEMESupport(){return _detectEMESupport.apply(this,arguments)}function _detectEMESupport(){return(_detectEMESupport=_async_to_generator$1g((function*(){var e,t,r,n;return void 0!==(null===(t=window)||void 0===t||null===(e=t.navigator)||void 0===e?void 0:e.requestMediaKeySystemAccess)&&void 0!==(null===(r=window)||void 0===r?void 0:r.MediaKeys)&&void 0!==(null===(n=window)||void 0===n?void 0:n.MediaKeySystemAccess)}))).apply(this,arguments)}function detectEMEKeySystems(){return _detectEMEKeySystems.apply(this,arguments)}function _detectEMEKeySystems(){return(_detectEMEKeySystems=_async_to_generator$1g((function*(){var e,t;if(yield isNodeEnvironment())return[];const r=[],n=window;if("function"==typeof(null===(e=n.WebKitMediaKeys)||void 0===e?void 0:e.isTypeSupported))for(let s of Je.fairplay){var i,o;if((null===(i=n.WebKitMediaKeys)||void 0===i?void 0:i.isTypeSupported(s,"video/mp4"))||(null===(o=n.WebKitMediaKeys)||void 0===o?void 0:o.isTypeSupported(s+".1_0","video/mp4")))return r.push("fairplay"),r}if("function"==typeof(null===(t=n.MSMediaKeys)||void 0===t?void 0:t.isTypeSupported))for(let s of Je.playready)n.MSMediaKeys.isTypeSupported(s,"video/mp4")&&r.push("playready");if(yield detectEMESupport()){const e=[{initDataTypes:["keyids","cenc"],distinctiveIdentifier:"optional",persistentState:"required",videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"',robustness:"SW_SECURE_CRYPTO"}],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"'}]}];for(let[t,n]of Object.entries(Je))for(let i of n)try{yield navigator.requestMediaKeySystemAccess(i,e),r.push(t);break}catch(a){}}return r}))).apply(this,arguments)}function asyncGeneratorStep$1f(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1f(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1f(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1f(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function detectES2015(){return _detectES2015.apply(this,arguments)}function _detectES2015(){return(_detectES2015=_async_to_generator$1f((function*(){try{new Function('"use strict"; class Test {}; const identity = (x) => x;')()}catch(e){return!1}return"undefined"!=typeof Symbol}))).apply(this,arguments)}function asyncGeneratorStep$1e(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1e(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1e(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1e(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function detectPictureInPictureSupport(){return _detectPictureInPictureSupport.apply(this,arguments)}function _detectPictureInPictureSupport(){return(_detectPictureInPictureSupport=_async_to_generator$1e((function*(){var e,t,r;if(yield isNodeEnvironment())return!1;const n=document.createElement("video");return void 0!==(null===(e=n)||void 0===e?void 0:e.webkitSupportsPresentationMode)&&"function"==typeof(null===(t=n)||void 0===t?void 0:t.webkitSetPresentationMode)||void 0!==(null===(r=document)||void 0===r?void 0:r.pictureInPictureEnabled)}))).apply(this,arguments)}function asyncGeneratorStep$1d(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$1J(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class RuntimeEnvironment{get isConfigured(){return this.configured}get userAgent(){return this.config.userAgent}get ua(){return this.userAgent.ua}get isNodeEnvironment(){return this.config.isNodeEnvironment}get isBrowserEnvironment(){return this.config.isBrowserEnvironment}get isPictureInPictureSupported(){return this.config.isPictureInPictureSupported}get isES2015Supported(){return this.config.isES2015Supported}get availableKeySystems(){return this.config.availableKeySystems}get browser(){return this.userAgent.browser}get engine(){return this.userAgent.engine}get os(){return this.userAgent.os}get isMobile(){return this.browser.isMobile}static detect(){var e,t=this;return(e=function*(){var e,r;const n=null!==(r=null===(e=window)||void 0===e?void 0:e.navigator)&&void 0!==r?r:{userAgent:"",maxTouchPoints:0};return new t({userAgent:yield parseUserAgent(n,{extensions:[flagsExtension]}),isNodeEnvironment:yield isNodeEnvironment(),isBrowserEnvironment:yield isBrowserEnvironment(),isPictureInPictureSupported:yield detectPictureInPictureSupport(),isES2015Supported:yield detectES2015(),availableKeySystems:yield detectEMEKeySystems()})},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1d(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1d(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}configure(e){for(const[t,r]of Object.entries(this.filterConfig(e)))this.config[t]=r;this.configured=!0}filterConfig(e){const t=["userAgent","isNodeEnvironment","isBrowserEnvironment","isES2015Supported","isPictureInPictureSupported","availableKeySystems"],r={};for(const[n,i]of Object.entries(e))void 0!==i&&t.includes(n)&&(r[n]=i);return r}constructor(e){_define_property$1J(this,"configured",!1),_define_property$1J(this,"config",void 0),this.config=this.filterConfig(e),this.configured=!0}}const AsyncDebounce=(e=100,t)=>(r,n,i)=>{const o=i.value,a=asyncDebounce(o,e,t);i.value=a},asyncDebounce=(e,t=250,r={isImmediate:!1})=>{let n,i;function fulfill(e){var t;return null===(t=e)||void 0===t?void 0:t.resolve(r.cancelledValue)}const clearLastPromise=()=>{n&&(n.resolved||(fulfill(n),n.timeoutId&&clearTimeout(n.timeoutId)),n=void 0)},invokeFn=(t,r,i,o)=>{e.apply(t,o).then(e=>{r(e),n&&(n.resolved=!0)}).catch(i)};return r.isImmediate?function(...e){const r=Date.now(),o=this;return i&&r>=i&&clearLastPromise(),i=Date.now()+t,n?fulfill(Promise):new Promise((t,r)=>{n={resolve:t,reject:r},invokeFn(o,t,r,e)})}:function(...e){const r=this;return n&&clearLastPromise(),new Promise((function(i,o){const a=setTimeout(invokeFn.bind(void 0,r,i,o,e),t);n={resolve:i,reject:o,timeoutId:a}}))}};function deprecationWarning(e,t={}){var r;const n=null!==(r=t.message)&&void 0!==r?r:e+" has been deprecated",i=[];t.since&&i.push("since: "+t.since),t.until&&i.push("until: "+t.until),console.warn("Deprecation Warning: "+n+(i.length>0?` (${i.join(", ")})`:""))}class PubSub{publish(e,t){const r=this.getSubscribersForType(e);void 0!==r&&r.forEach(r=>{r(e,t)})}subscribe(e,t){this.getSubscribersForType(e,!0).push(t)}subscribeOnce(e,t){const onceCallback=(e,r)=>{this.unsubscribe(e,onceCallback),t(e,r)};this.subscribe(e,onceCallback)}unsubscribe(e,t){const r=this.getSubscribersForType(e);if(void 0!==r)for(const n in r)if(r[n]===t){delete r[n];break}}clear(e){void 0===e?this.events={}:delete this.events[e]}getSubscribersForType(e,t=!1){return!this.events.hasOwnProperty(e)&&t&&(this.events[e]=[]),this.events[e]}constructor(){var e,t,r;r={},(t="events")in(e=this)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}}function asyncGeneratorStep$1c(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1c(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1c(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1c(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const Xe={},SerialAsync=e=>{let t=Promise.resolve();return(r,n,i)=>{const o=i.value;return i.value=_async_to_generator$1c((function*(...r){return e&&(t=(e=>{let t=Xe[e];return t||(t=Promise.resolve(),Xe[e]=t),t})(e)),t=t.catch(()=>{}).then(()=>o.apply(this,r)),e&&(Xe[e]=t),t})),i}};var Ze,et,tt;e.PlaybackBitrate=void 0,(Ze=e.PlaybackBitrate||(e.PlaybackBitrate={}))[Ze.STANDARD=64]="STANDARD",Ze[Ze.HIGH=256]="HIGH",function(e){e.apiStorefrontChanged="apiStorefrontChanged",e.hlsLevelUpdated="hlsLevelUpdated",e.mediaContentComplete="mediaContentComplete",e.playbackPause="playbackPause",e.playbackPlay="playbackPlay",e.playbackScrub="playbackScrub",e.playbackSeek="playbackSeek",e.playbackSkip="playbackSkip",e.playbackStop="playbackStop",e.lyricsPlay="lyricsPlay",e.lyricsStop="lyricsStop",e.playerActivate="playerActivate",e.playerExit="playerExit",e.queueModified="queueModified",e.userActivityIntent="userActivityIntent",e.applicationActivityIntent="applicationActivityIntent"}(et||(et={})),function(e){e[e.ACCURATE=0]="ACCURATE",e[e.ROUND=1]="ROUND"}(tt||(tt={}));class TimingAccuracy{time(e=0){return this.mode===tt.ROUND?Math.round(e):e}constructor(e=!1){var t,r,n;n=void 0,(r="mode")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.mode=e?tt.ACCURATE:tt.ROUND}}const rt={audioTrackAdded:"audioTrackAdded",audioTrackChanged:"audioTrackChanged",audioTrackRemoved:"audioTrackRemoved",bufferedProgressDidChange:"bufferedProgressDidChange",drmUnsupported:"drmUnsupported",forcedTextTrackChanged:"forcedTextTrackChanged",mediaCanPlay:"mediaCanPlay",mediaElementCreated:"mediaElementCreated",mediaPlaybackError:"mediaPlaybackError",nowPlayingItemDidChange:"nowPlayingItemDidChange",nowPlayingItemWillChange:"nowPlayingItemWillChange",metadataDidChange:"metadataDidChange",playbackBitrateDidChange:"playbackBitrateDidChange",playbackDurationDidChange:"playbackDurationDidChange",playbackProgressDidChange:"playbackProgressDidChange",playbackRateDidChange:"playbackRateDidChange",playbackStateDidChange:"playbackStateDidChange",playbackStateWillChange:"playbackStateWillChange",playbackTargetAvailableDidChange:"playbackTargetAvailableDidChange",playbackTargetIsWirelessDidChange:"playbackTargetIsWirelessDidChange",playbackTimeDidChange:"playbackTimeDidChange",playbackVolumeDidChange:"playbackVolumeDidChange",playerTypeDidChange:"playerTypeDidChange",presentationModeDidChange:"presentationModeDidChange",primaryPlayerDidChange:"primaryPlayerDidChange",textTrackAdded:"textTrackAdded",textTrackChanged:"textTrackChanged",textTrackRemoved:"textTrackRemoved",timedMetadataDidChange:"timedMetadataDidChange"};function _define_property$1G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class BitrateCalculator{get bitrate(){return this._bitrate}set bitrate(e){this._bitrate!==e&&(this._bitrate=e,this._dispatcher.publish(rt.playbackBitrateDidChange,{bitrate:e}))}_calculateAverageDownlink(){return 0===this._downlinkSamples.length?0:this._downlinkSamples.reduce((e,t)=>e+t,0)/this._downlinkSamples.length||0}_recalculateBitrate(t){xe.debug("_recalculateBitrate",t),this._downlinkSamples.push(t);this._calculateAverageDownlink()>e.PlaybackBitrate.STANDARD?(xe.debug("setting bitrate to",e.PlaybackBitrate.HIGH),this.bitrate=e.PlaybackBitrate.HIGH):(xe.debug("setting bitrate to",e.PlaybackBitrate.STANDARD),this.bitrate=e.PlaybackBitrate.STANDARD)}constructor(t,r=e.PlaybackBitrate.STANDARD){var n,i,o;_define_property$1G(this,"_bitrate",void 0),_define_property$1G(this,"_dispatcher",void 0),_define_property$1G(this,"_downlinkSamples",[]),this._bitrate=r,this._dispatcher=t,void 0!==(null===(o=window)||void 0===o||null===(i=o.navigator)||void 0===i||null===(n=i.connection)||void 0===n?void 0:n.downlink)&&this._recalculateBitrate(100*(window.navigator.connection.downlink||0))}}var nt,it,ot,at,st,ct,lt;!function(e){e.MUSICKIT="music_kit-integration",e.OTHER="other",e.MINI="mini",e.SONG="song",e.ALBUM="album",e.ALBUM_CLASSICAL="album-classical",e.ARTIST="artist",e.COMPILATION="compilation",e.COMPILATION_CLASSICAL="compilation-classical",e.PLAYLIST="playlist",e.PLAYLIST_CLASSICAL="playlist-classical",e.RADIO="radio",e.SEARCH="search",e.STATION="station"}(nt||(nt={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.RADIO=1]="RADIO",e[e.PLAYLIST=2]="PLAYLIST",e[e.ALBUM=3]="ALBUM",e[e.ARTIST=4]="ARTIST"}(it||(it={})),function(e){e[e.NOT_APPLICABLE=0]="NOT_APPLICABLE",e[e.OTHER=1]="OTHER",e[e.TRACK_SKIPPED_FORWARDS=2]="TRACK_SKIPPED_FORWARDS",e[e.PLAYBACK_MANUALLY_PAUSED=3]="PLAYBACK_MANUALLY_PAUSED",e[e.PLAYBACK_SUSPENDED=4]="PLAYBACK_SUSPENDED",e[e.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM=5]="MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM",e[e.PLAYBACK_PAUSED_DUE_TO_INACTIVITY=6]="PLAYBACK_PAUSED_DUE_TO_INACTIVITY",e[e.NATURAL_END_OF_TRACK=7]="NATURAL_END_OF_TRACK",e[e.PLAYBACK_STOPPED_DUE_TO_SESSION_TIMEOUT=8]="PLAYBACK_STOPPED_DUE_TO_SESSION_TIMEOUT",e[e.TRACK_BANNED=9]="TRACK_BANNED",e[e.FAILED_TO_LOAD=10]="FAILED_TO_LOAD",e[e.PAUSED_ON_TIMEOUT=11]="PAUSED_ON_TIMEOUT",e[e.SCRUB_BEGIN=12]="SCRUB_BEGIN",e[e.SCRUB_END=13]="SCRUB_END",e[e.TRACK_SKIPPED_BACKWARDS=14]="TRACK_SKIPPED_BACKWARDS",e[e.NOT_SUPPORTED_BY_CLIENT=15]="NOT_SUPPORTED_BY_CLIENT",e[e.QUICK_PLAY=16]="QUICK_PLAY",e[e.EXITED_APPLICATION=17]="EXITED_APPLICATION"}(ot||(ot={})),e.SeekReasonType=void 0,(at=e.SeekReasonType||(e.SeekReasonType={}))[at.Manual=0]="Manual",at[at.Interval=1]="Interval",at[at.SkipIntro=2]="SkipIntro",function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.NO_RIGHTS=1]="NO_RIGHTS",e[e.PURCHASED=2]="PURCHASED",e[e.UPLOADED=3]="UPLOADED",e[e.MATCHED=4]="MATCHED",e[e.ADDED=5]="ADDED",e[e.SUBSCRIBED=6]="SUBSCRIBED",e[e.NOT_SUPPORTED=7]="NOT_SUPPORTED"}(st||(st={})),function(e){e[e.NO_SELECTION_PLAY=0]="NO_SELECTION_PLAY",e[e.RESUME_LAST_PLAYED_SONG=1]="RESUME_LAST_PLAYED_SONG",e[e.RESUME_CURRENT_DEVICE_POSITION=2]="RESUME_CURRENT_DEVICE_POSITION"}(ct||(ct={})),function(e){e[e.NOT_APPLICABLE=0]="NOT_APPLICABLE",e[e.SIMILARITIES=1]="SIMILARITIES",e[e.ESSENTIALS=2]="ESSENTIALS",e[e.USER_LIBRARY=3]="USER_LIBRARY",e[e.ALGO_HEATSEEKER=4]="ALGO_HEATSEEKER",e[e.SEED_TRACK=5]="SEED_TRACK",e[e.GN_1M_TEMPORARY=6]="GN_1M_TEMPORARY",e[e.VECTOR=8]="VECTOR",e[e.ARTIST_SIMILARITIES=9]="ARTIST_SIMILARITIES",e[e.STORY_ALBUM_LISTENERS_ALSO_BOUGHT=10]="STORY_ALBUM_LISTENERS_ALSO_BOUGHT",e[e.STORY_ALBUM_SALES_LEADER=11]="STORY_ALBUM_SALES_LEADER",e[e.STORY_BILLBOARD=12]="STORY_BILLBOARD",e[e.STORY_COMPLETE_MY_ALBUM=13]="STORY_COMPLETE_MY_ALBUM",e[e.STORY_CRITICAL_PICK=14]="STORY_CRITICAL_PICK",e[e.STORY_ITUNES_ESSENTIAL=15]="STORY_ITUNES_ESSENTIAL",e[e.STORY_HEATSEEKER=16]="STORY_HEATSEEKER",e[e.STORY_IDENTITY=17]="STORY_IDENTITY",e[e.STORY_POWER_SONG=18]="STORY_POWER_SONG",e[e.STORY_SONG_SALES_LEADER=20]="STORY_SONG_SALES_LEADER",e[e.GENRE_SIMILARITIES=21]="GENRE_SIMILARITIES",e[e.STORY_IMIX=22]="STORY_IMIX",e[e.STORY_OTHER_MIX=23]="STORY_OTHER_MIX",e[e.EDITORIAL=24]="EDITORIAL",e[e.TOP_SONGS=25]="TOP_SONGS",e[e.SUBFORMAT_SONGS=26]="SUBFORMAT_SONGS",e[e.CRITICAL_PICKS=27]="CRITICAL_PICKS",e[e.US_ARTIST_SIMS=28]="US_ARTIST_SIMS",e[e.HEAVY_ROTATION=29]="HEAVY_ROTATION",e[e.STORY_FORMAT_STATION_HEAVY_ROTATION=30]="STORY_FORMAT_STATION_HEAVY_ROTATION",e[e.ARTIST_BASED_CORE_SIMILAR_ARTISTS=31]="ARTIST_BASED_CORE_SIMILAR_ARTISTS",e[e.ARTIST_BASED_FAMILIAR_SIMILAR_ARTISTS=32]="ARTIST_BASED_FAMILIAR_SIMILAR_ARTISTS",e[e.ARTIST_BASED_DISCOVERIES=33]="ARTIST_BASED_DISCOVERIES",e[e.ARTIST_BASED_HOT_SONGS=34]="ARTIST_BASED_HOT_SONGS",e[e.ARTIST_BASED_SEED_ARTIST=35]="ARTIST_BASED_SEED_ARTIST",e[e.ARTIST_BASED_COMPOSER=36]="ARTIST_BASED_COMPOSER",e[e.EDITORIAL_STATION_INTRO=37]="EDITORIAL_STATION_INTRO",e[e.EDITORIAL_RELATIVE_REPEAT=38]="EDITORIAL_RELATIVE_REPEAT",e[e.EDITORIAL_ABSOLUTE_REPEAT=39]="EDITORIAL_ABSOLUTE_REPEAT",e[e.EDITORIAL_SCHEDULED=40]="EDITORIAL_SCHEDULED",e[e.EDITORIAL_SUGGESTED_ARTIST=41]="EDITORIAL_SUGGESTED_ARTIST",e[e.FOR_YOU_FAMILIAR=42]="FOR_YOU_FAMILIAR",e[e.FOR_YOU_RECOMMENDED=43]="FOR_YOU_RECOMMENDED",e[e.FOR_YOU_FAVORITE_ARTIST=44]="FOR_YOU_FAVORITE_ARTIST",e[e.FOR_YOU_RECOMMENDED_ARTIST=45]="FOR_YOU_RECOMMENDED_ARTIST",e[e.EDITORIAL_POSITIONAL=46]="EDITORIAL_POSITIONAL",e[e.SIMILAR_SONGS=47]="SIMILAR_SONGS",e[e.SONG_ATTRIBUTE_FAVORITE_ARTIST=48]="SONG_ATTRIBUTE_FAVORITE_ARTIST",e[e.SONG_ATTRIBUTE_FAVORITE_ARTIST_DERIVED=49]="SONG_ATTRIBUTE_FAVORITE_ARTIST_DERIVED",e[e.SONG_ATTRIBUTE_FAVORITE_ARTIST_EDITORIAL=50]="SONG_ATTRIBUTE_FAVORITE_ARTIST_EDITORIAL",e[e.SONG_ATTRIBUTE_RECOMMENDED=51]="SONG_ATTRIBUTE_RECOMMENDED",e[e.SONG_ATTRIBUTE_RECOMMENDED_DERIVED=52]="SONG_ATTRIBUTE_RECOMMENDED_DERIVED",e[e.SONG_ATTRIBUTE_RECOMMENDED_EDITORIAL=53]="SONG_ATTRIBUTE_RECOMMENDED_EDITORIAL",e[e.SONG_ATTRIBUTE_NON_PERSONALIZED=54]="SONG_ATTRIBUTE_NON_PERSONALIZED",e[e.SONG_ATTRIBUTE_NON_PERSONALIZED_DERIVED=55]="SONG_ATTRIBUTE_NON_PERSONALIZED_DERIVED",e[e.SONG_ATTRIBUTE_NON_PERSONALIZED_EDITORIAL=56]="SONG_ATTRIBUTE_NON_PERSONALIZED_EDITORIAL",e[e.PERSONAL_STATION=57]="PERSONAL_STATION",e[e.PERSONAL_STATION_FAVORITE_ARTIST=58]="PERSONAL_STATION_FAVORITE_ARTIST",e[e.PERSONAL_STATION_RECOMMENDED=59]="PERSONAL_STATION_RECOMMENDED",e[e.NEW_MUSIC_STATION=60]="NEW_MUSIC_STATION",e[e.NEW_MUSIC_STATION_FAVORITE_ARTIST=61]="NEW_MUSIC_STATION_FAVORITE_ARTIST",e[e.NEW_MUSIC_STATION_RECOMMENDED=62]="NEW_MUSIC_STATION_RECOMMENDED"}(lt||(lt={}));var dt,ut,pt,ht,yt,_t,ft,vt,gt,mt,bt,St,Pt,Et;!function(e){e[e.UNKNOWN_FORMAT=0]="UNKNOWN_FORMAT",e[e.STEREO=1]="STEREO",e[e.SPATIAL=2]="SPATIAL",e[e.PREFERENCE_FORMAT_UNSUPPORTED=3]="PREFERENCE_FORMAT_UNSUPPORTED"}(dt||(dt={})),function(e){e[e.UNKNOWN_QUALITY=0]="UNKNOWN_QUALITY",e[e.HIGH_EFFICIENCY=1]="HIGH_EFFICIENCY",e[e.HIGH_QUALITY=2]="HIGH_QUALITY",e[e.LOSSLESS=3]="LOSSLESS",e[e.HIGH_RESOLUTION_LOSSLESS=4]="HIGH_RESOLUTION_LOSSLESS",e[e.PREFERENCE_QUALITY_UNSUPPORTED=5]="PREFERENCE_QUALITY_UNSUPPORTED"}(ut||(ut={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.STATIC=1]="STATIC",e[e.LINE_BY_LINE=2]="LINE_BY_LINE",e[e.WORD_BY_WORD=3]="WORD_BY_WORD"}(pt||(pt={})),function(e){e[e.REPEAT_UNKNOWN=0]="REPEAT_UNKNOWN",e[e.REPEAT_OFF=1]="REPEAT_OFF",e[e.REPEAT_ONE=2]="REPEAT_ONE",e[e.REPEAT_ALL=3]="REPEAT_ALL"}(ht||(ht={})),function(e){e[e.SHUFFLE_UNKNOWN=0]="SHUFFLE_UNKNOWN",e[e.SHUFFLE_OFF=1]="SHUFFLE_OFF",e[e.SHUFFLE_ON=2]="SHUFFLE_ON"}(yt||(yt={})),function(e){e[e.AUTO_UNKNOWN=0]="AUTO_UNKNOWN",e[e.AUTO_OFF=1]="AUTO_OFF",e[e.AUTO_ON=2]="AUTO_ON",e[e.AUTO_ON_CONTENT_UNSUPPORTED=3]="AUTO_ON_CONTENT_UNSUPPORTED"}(_t||(_t={})),function(e){e[e.NOT_SPECIFIED=0]="NOT_SPECIFIED",e[e.CONTAINER_CHANGED=1]="CONTAINER_CHANGED"}(ft||(ft={})),function(e){e[e.PLAY_END=0]="PLAY_END",e[e.PLAY_START=1]="PLAY_START",e[e.LYRIC_DISPLAY=2]="LYRIC_DISPLAY"}(vt||(vt={})),function(e){e[e.INVALID=0]="INVALID",e[e.ITUNES_STORE_CONTENT=1]="ITUNES_STORE_CONTENT",e[e.NON_SONG_CLIP=2]="NON_SONG_CLIP",e[e.AD=3]="AD",e[e.STREAM=4]="STREAM",e[e.AUDIO_AD=5]="AUDIO_AD",e[e.VIDEO_AD=6]="VIDEO_AD",e[e.TIMED_METADATA_PING=7]="TIMED_METADATA_PING",e[e.ARTIST_UPLOADED_CONTENT=8]="ARTIST_UPLOADED_CONTENT",e[e.AGGREGATE_NON_CATALOG_PLAY_TIME=9]="AGGREGATE_NON_CATALOG_PLAY_TIME",e[e.ORIGINAL_CONTENT_MOVIES=10]="ORIGINAL_CONTENT_MOVIES",e[e.ORIGINAL_CONTENT_SHOWS=11]="ORIGINAL_CONTENT_SHOWS"}(gt||(gt={})),function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO"}(mt||(mt={})),function(e){e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL"}(bt||(bt={})),function(e){e[e.ORIGINATING_DEVICE=0]="ORIGINATING_DEVICE",e[e.PAIRED_WATCH=1]="PAIRED_WATCH",e[e.SONOS=2]="SONOS",e[e.CAR_PLAY=3]="CAR_PLAY",e[e.WEB_AUC=4]="WEB_AUC",e[e.TWITTER_AUC=5]="TWITTER_AUC",e[e.MUSIC_SDK=6]="MUSIC_SDK",e[e.ATV_REMOTE=7]="ATV_REMOTE",e[e.WEBPLAYER=8]="WEBPLAYER",e[e.WHOLE_HOUSE_AUDIO=9]="WHOLE_HOUSE_AUDIO",e[e.MUSICKIT=10]="MUSICKIT",e[e.VW=11]="VW",e[e.UNKNOWN_SOURCE_TYPE=12]="UNKNOWN_SOURCE_TYPE",e[e.AMAZON=13]="AMAZON",e[e.PORSCHE=14]="PORSCHE",e[e.CHROMECAST=15]="CHROMECAST",e[e.WEB_APP=16]="WEB_APP",e[e.MERCEDES_BENZ=17]="MERCEDES_BENZ",e[e.THIRD_PARTY_TV=18]="THIRD_PARTY_TV",e[e.SEAT=19]="SEAT",e[e.CUPRA=20]="CUPRA"}(St||(St={})),function(e){e[e.EPISODE=1]="EPISODE",e[e.SHOUTCAST=2]="SHOUTCAST"}(Pt||(Pt={})),new Map([["play",vt.PLAY_START],["playbackstarted",vt.PLAY_START],["stop",vt.PLAY_END],["playbackstopped",vt.PLAY_END]]),new Map([["exit",ot.EXITED_APPLICATION],["next",ot.TRACK_SKIPPED_FORWARDS],["pause",ot.PLAYBACK_MANUALLY_PAUSED],["playbackfinished",ot.NATURAL_END_OF_TRACK],["playbackstopped",ot.PLAYBACK_MANUALLY_PAUSED],["previous",ot.TRACK_SKIPPED_BACKWARDS],["scrub_begin",ot.SCRUB_BEGIN],["scrub_end",ot.SCRUB_END],["stop",ot.NATURAL_END_OF_TRACK]]),new Logger$1("paf"),function(e){e[e.ALEXA=13]="ALEXA"}(Et||(Et={}));const Bind=()=>(e,t,r)=>{if(void 0===r||"function"!=typeof r.value)throw new TypeError(`Only methods can be decorated with @Bind, but ${t} is not a method.`);return{configurable:!0,get(){const e=r.value.bind(this);return Object.defineProperty(this,t,{value:e,configurable:!0,writable:!0}),e}}},Tt=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],kt=["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"],wt=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],noop=()=>Promise.resolve(),Ot=(e=>{if(void 0===e)return noop;const t=Tt.find(t=>"function"==typeof e.prototype[t]);return"string"!=typeof t?noop:(e=self.document)=>{var r,n;return null===(n=e)||void 0===n||null===(r=n[t])||void 0===r?void 0:r.call(n)}})(HTMLDocument),It=(e=>{if(void 0===e)return()=>!1;const t=kt.find(t=>t in e.prototype);return"string"!=typeof t?()=>!1:(e=self.document)=>!!e[t]})(HTMLDocument),At=(e=>{if(void 0===e)return noop;const t=wt.find(t=>"function"==typeof e.prototype[t]);return"string"!=typeof t?noop:e=>{var r;return null===(r=e)||void 0===r?void 0:r[t]()}})(HTMLElement);function asyncGeneratorStep$1b(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$1b(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$1b(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1b(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}class Fullscreen{exit(){var e=this;return _async_to_generator$1b((function*(){if(e.isInFullscreen())return e.stopDispatchingEvents(()=>e.exitFullscreen())}))()}request(e){var t=this;return _async_to_generator$1b((function*(){if(void 0!==e)return t.stopDispatchingEvents(()=>t.requestFullscreenForElement(e))}))()}stopDispatchingEvents(e){var t=this;return _async_to_generator$1b((function*(){return t.player.windowHandlers.stopListeningToVisibilityChanges(e)}))()}exitFullscreen(){return Ot()}isInFullscreen(){return It()}requestFullscreenForElement(e){return At(e)}constructor(e){var t,r,n;n=void 0,(r="player")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.player=e}}function asyncGeneratorStep$1a(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$1E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class UnsupportedSeeker{start(){xe.warn("seeker.start is not supported in this playback method")}end(){xe.warn("seeker.end is not supported in this playback method")}seekToTime(e){return xe.warn("seekToTime is not supported in this playback method"),Promise.resolve()}constructor(){_define_property$1E(this,"ended",!1)}}class PlayerSeeker{get ended(){return this._ended}get isEngagedInPlayback(){return this._player.isEngagedInPlayback}get stillPlayingSameItem(){return this._currentItem===this._player.nowPlayingItem}end(){xe.debug("seeker: end"),-1!==this._startTime?this._ended?xe.warn("seeker: Cannot end the same seeker twice."):(this.dispatchStartEvent(),this.dispatchEndEvent()):xe.warn("seeker: Cannot end a seeker before starting it.")}seekToTime(e){var t,r=this;return(t=function*(){if(xe.debug("seeker: seekToTime",e),!r.ended)return r.stillPlayingSameItem||(r._currentItem=r._player.nowPlayingItem,r._startTime=0),r._lastSeekedTime=e,r._player.seekToTime(e);xe.warn("seeker: Cannot seek once the seeker has ended")},function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function _next(e){asyncGeneratorStep$1a(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1a(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}start(){xe.debug("seeker: start"),-1===this._startTime?(this._currentItem=this._player.nowPlayingItem,this._startTime=this._player.currentPlaybackTime,this._lastSeekedTime=this._startTime):xe.warn("seeker: Cannot start same seeker twice")}dispatch(e,t){this.isEngagedInPlayback?(xe.debug("seeker: dispatch",e),this._player.dispatch(e,t)):xe.debug("seeker: do not dispatch because isEngagedInPlayback",this.isEngagedInPlayback)}dispatchStartEvent(){this.stillPlayingSameItem||(this._startTime=0,this._lastSeekedTime=0),this.dispatch(et.playbackScrub,{item:this._currentItem,position:this._startTime})}dispatchEndEvent(){this._ended=!0,this.dispatch(et.playbackScrub,{item:this._currentItem,position:this._lastSeekedTime,endReasonType:ot.SCRUB_END})}constructor(e){_define_property$1E(this,"_ended",!1),_define_property$1E(this,"_lastSeekedTime",-1),_define_property$1E(this,"_player",void 0),_define_property$1E(this,"_startTime",-1),_define_property$1E(this,"_currentItem",void 0),xe.debug("seeker: new"),this._player=e}}function asyncGeneratorStep$19(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$1D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_decorate$B(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$B(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const{visibilityChangeEvent:$t,visibilityState:Rt,unloadEventName:Ct}=(()=>{let e="visibilitychange",t="visibilityState";void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozVisibilityState"):void 0!==document.msHidden?(e="msvisibilitychange",t="msVisibilityState"):document.webkitHidden&&(e="webkitvisibilitychange",t="webkitVisibilityState");return{visibilityChangeEvent:e,visibilityState:t,unloadEventName:"onpagehide"in window?"pagehide":"unload"}})();class WindowHandlers{activate(e=self,t=self.document){t.addEventListener($t,this.visibilityChanged),e.addEventListener("storage",this.storage,!1),e.addEventListener(Ct,this.windowUnloaded)}deactivate(){document.removeEventListener($t,this.visibilityChanged),window.removeEventListener("storage",this.storage),window.addEventListener(Ct,this.windowUnloaded)}stopListeningToVisibilityChanges(e){var t,r=this;return(t=function*(){r.dispatchVisibilityChanges=!1;const t=yield e();return r.dispatchVisibilityChanges=!0,t},function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function _next(e){asyncGeneratorStep$19(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$19(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}dispatch(e,t={}){this.player.dispatch(e,t)}storage({key:e,newValue:t}){e===je&&this.player.tsidChanged(t)}visibilityChanged(e){const t=e.target[Rt];xe.info("dc visibilityState",t,e,It()),this.runtimeEnvironment.os.isIOS&&this.dispatchVisibilityChanges&&("hidden"===t?this.dispatch(et.playerExit,{item:this.player.nowPlayingItem,position:this.player.currentPlaybackTime}):"visible"===t&&this.dispatch(et.playerActivate))}windowUnloaded(){this.player.isPlaying&&this.dispatch(et.playerExit,{item:this.player.nowPlayingItem,position:this.player.currentPlaybackTime})}constructor(e,t){_define_property$1D(this,"player",void 0),_define_property$1D(this,"runtimeEnvironment",void 0),_define_property$1D(this,"dispatchVisibilityChanges",!0),this.player=e,this.runtimeEnvironment=t}}function asyncGeneratorStep$18(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$18(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$18(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$18(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1C(e,t,r[t])}))}return e}function _ts_metadata$A(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}_ts_decorate$B([Bind(),_ts_metadata$B("design:type",Function),_ts_metadata$B("design:paramtypes",[void 0])],WindowHandlers.prototype,"storage",null),_ts_decorate$B([Bind(),_ts_metadata$B("design:type",Function),_ts_metadata$B("design:paramtypes",["undefined"==typeof Event?Object:Event])],WindowHandlers.prototype,"visibilityChanged",null),_ts_decorate$B([Bind(),_ts_metadata$B("design:type",Function),_ts_metadata$B("design:paramtypes",[])],WindowHandlers.prototype,"windowUnloaded",null);const{bufferedProgressDidChange:Mt,mediaCanPlay:Dt,mediaElementCreated:xt,mediaPlaybackError:Lt,nowPlayingItemDidChange:Nt,nowPlayingItemWillChange:jt,metadataDidChange:Ut,primaryPlayerDidChange:Ft,playbackDurationDidChange:Bt,playbackProgressDidChange:Kt,playbackStateDidChange:Vt,playbackRateDidChange:Gt,playbackStateWillChange:Ht,playbackTargetAvailableDidChange:Wt,playbackTargetIsWirelessDidChange:qt,playbackTimeDidChange:zt,playbackVolumeDidChange:Yt}=rt,Qt=["canplay","durationchange","ended","error","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","timeupdate","volumechange","waiting"],Jt=["NotAllowedError","NotSupportedError"],{ended:Xt,loading:Zt,paused:er,playing:tr,seeking:rr,stopped:nr,waiting:ir}=e.PlaybackStates;class BasePlayer{get bitrate(){return this._bitrateCalculator.bitrate}get currentBufferedProgress(){return this._currentBufferedProgress}get _currentDuration(){return this._targetElement.duration}get _currentTime(){var e;var t;return this._targetElement.currentTime-(null!==(t=null===(e=this._buffer)||void 0===e?void 0:e.currentTimestampOffset)&&void 0!==t?t:0)}get currentPlaybackDuration(){const t=this.nowPlayingItem;if(!t)return 0;const r=t.playbackType===e.PlaybackType.encryptedFull||t.playbackType===e.PlaybackType.unencryptedFull,n=t.playbackDuration;return r&&n?this.calculateTime(n/1e3):this.calculateTime(this._currentDuration)}get currentPlaybackTime(){return this.calculateTime(this._currentTime)}calculateTime(e){return this._timing.time(e)}get currentPlaybackTimeRemaining(){return this.currentPlaybackDuration-this.currentPlaybackTime}get currentPlaybackProgress(){return this._currentPlaybackProgress||0}get hasMediaElement(){return this._targetElement instanceof HTMLElement&&null!==this._targetElement.parentNode}get isEngagedInPlayback(){return!this._stopped&&!this.isPaused()}get isPlaying(){return this.playbackState===tr}get isPrimaryPlayer(){return this._isPrimaryPlayer}set isPrimaryPlayer(e){var t;e!==this._isPrimaryPlayer&&(this._isPrimaryPlayer=e,this._isPrimaryPlayer?null===(t=getLocalStorage())||void 0===t||t.setItem(je,this._serial):(this._dispatcher.publish(Ft,{target:this}),this.pause({userInitiated:!1})))}get isReady(){return 0!==this._targetElement.readyState}get nowPlayingItem(){return this._nowPlayingItem}set nowPlayingItem(e){var t,r;const n=this._dispatcher;if(void 0===e)return n.publish(jt,{item:e}),this._nowPlayingItem=e,void n.publish(Nt,{item:e});const i=this._nowPlayingItem,o=this._buffer;(null===(t=i)||void 0===t?void 0:t.isEqual(e))||(n.publish(jt,{item:e}),this.isPlaying&&(null===(r=o)||void 0===r?void 0:r.currentItem)!==e&&this._pauseMedia(),i&&(xe.debug("setting state to ended on ",i.title),i.state=E.ended,i.endMonitoringStateDidChange(),i.endMonitoringStateWillChange()),this._nowPlayingItem=e,xe.debug("setting state to playing on ",e.title),e.state=E.playing,e&&e.info&&this._setTargetElementTitle(e.info),n.publish(Nt,{item:e}),n.publish(Bt,{currentTarget:this._targetElement,duration:this.currentPlaybackDuration,target:this._targetElement,type:"durationchange"}))}get playbackRate(){return this._targetElement.playbackRate}set playbackRate(e){this._targetElement.playbackRate=e}get playbackState(){return this._playbackState}setPlaybackState(e,t){const r=this._playbackState;if(e===r)return;const n={oldState:r,state:e,nowPlayingItem:t};xe.debug("BasePlayer.playbackState is changing",n),this._dispatcher.publish(Ht,n),this._playbackState=e,this._dispatcher.publish(Vt,n)}get playbackTargetAvailable(){return void 0!==window.WebKitPlaybackTargetAvailabilityEvent&&this._playbackTargetAvailable}set playbackTargetAvailable(e){e!==this._playbackTargetAvailable&&(this._playbackTargetAvailable=e,this._dispatcher.publish(Wt,{available:e}))}get playbackTargetIsWireless(){return void 0!==window.WebKitPlaybackTargetAvailabilityEvent&&this._playbackTargetIsWireless}set playbackTargetIsWireless(e){e!==this._playbackTargetIsWireless&&(this._playbackTargetIsWireless=e,this._dispatcher.publish(qt,{playing:e}))}get volume(){return this._targetElement.volume}set volume(e){this._targetElement.volume=e}get isDestroyed(){return this._isDestroyed}clearNextManifest(){var e;null===(e=this._buffer)||void 0===e||e.clearNextManifest()}initialize(){var e=this;return _async_to_generator$18((function*(){xe.debug("BasePlayer.initialize"),e.isPlayerSupported()?(yield e.initializeMediaElement(),yield e.initializeExtension(),e.initializeEventHandlers(),e._dispatcher.publish(xt,e._targetElement)):xe.warn("{this.constructor.name} not supported")}))()}initializeEventHandlers(){if(this.windowHandlers.activate(),!this.hasMediaElement)return;const e=this._targetElement;window.WebKitPlaybackTargetAvailabilityEvent&&(e.addEventListener("webkitplaybacktargetavailabilitychanged",e=>{this.playbackTargetAvailable="available"===e.availability}),e.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",e=>{this.playbackTargetIsWireless=e.target===this._targetElement&&!this.playbackTargetIsWireless})),Qt.forEach(t=>e.addEventListener(t,this)),this._dispatcher.publish(et.playerActivate)}removeEventHandlers(){Qt.forEach(e=>this._targetElement.removeEventListener(e,this)),this.windowHandlers.deactivate()}isPaused(){return this._paused}exitFullscreen(){return this.fullscreen.exit()}requestFullscreen(e){return this.fullscreen.request(e)}newSeeker(){var e;return null===(e=this._seeker)||void 0===e||e.end(),this._seeker=new PlayerSeeker(this),this._seeker}stop(e){var t=this;return _async_to_generator$18((function*(){xe.debug("BasePlayer.stop",e),yield t._waitForPendingPlay(),t.isPlaying&&(xe.debug("BasePlayer.play dispatching playbackStop"),t.dispatch(et.playbackStop,_object_spread$E({item:t.nowPlayingItem,position:t.currentPlaybackTime,startPosition:t.initialBufferPosition,playingDate:t.currentPlayingDate,startPlayingDate:t.initialPlayingDate},e))),yield t.stopMediaAndCleanup()}))()}stopMediaAndCleanup(e=nr){var t=this;return _async_to_generator$18((function*(){xe.debug("stopMediaAndCleanup"),yield t._stopMediaElement(),t._stopped=!0,t._paused=!1;const r=t.nowPlayingItem;t.nowPlayingItem=void 0,t.initialBufferPosition=void 0,t.initialPlayingDate=void 0,t.setPlaybackState(e,r)}))()}onPlaybackError(e,t){this.resetDeferredPlay(),this.stop({endReasonType:ot.FAILED_TO_LOAD,userInitiated:!1})}calculatePlaybackProgress(){const e=Math.round(100*(this.currentPlaybackTime/this.currentPlaybackDuration||0))/100;this._currentPlaybackProgress!==e&&(this._currentPlaybackProgress=e,this._dispatcher.publish(Kt,{progress:this._currentPlaybackProgress}))}calculateBufferedProgress(e){const t=Math.round(e/this.currentPlaybackDuration*100);this._currentBufferedProgress!==t&&(this._currentBufferedProgress=t,this._dispatcher.publish(Mt,{progress:t}))}destroy(){var e,t;if(xe.debug("BasePlayer.destroy"),this._isDestroyed=!0,this._dispatcher.unsubscribe(Lt,this.onPlaybackError),!this.hasMediaElement)return;const r=this._targetElement;null===(e=this.extension)||void 0===e||e.destroy(r),this.removeEventHandlers(),this.cleanupElement(),null===(t=r.parentNode)||void 0===t||t.removeChild(r)}handleEvent(e){var t=this;return _async_to_generator$18((function*(){"timeupdate"!==e.type&&xe.debug("BasePlayer.handleEvent: ",e.type,e,t.isPaused(),t._stopped);const{nowPlayingItem:r}=t;switch(e.timestamp=Date.now(),e.type){case"canplay":t._dispatcher.publish(Dt,e),t._playbackState!==ir||t._targetElement.paused||t.setPlaybackState(tr,r);break;case"durationchange":t._targetElement.duration!==1/0&&(e.duration=t.currentPlaybackDuration,t._dispatcher.publish(Bt,e),t.calculatePlaybackProgress());break;case"ended":{var n,i;if(xe.debug('media element "ended" event'),null===(n=t.nowPlayingItem)||void 0===n?void 0:n.isLinearStream)return void xe.warn("ignoring ended event for linear stream",e);if(t.isElementCleaned()){xe.debug('media element already cleaned, ignoring "ended" event');break}const r=t.nowPlayingItem,o=(null===(i=r)||void 0===i?void 0:i.playbackDuration)?r.playbackDuration/1e3:t.currentPlaybackTime,a=t.currentPlayingDate;yield t.stopMediaAndCleanup(Xt),t.dispatch(et.playbackStop,{item:r,position:o,playingDate:a,endReasonType:ot.NATURAL_END_OF_TRACK});break}case"error":xe.error("Playback Error",e,t._targetElement.error),t._dispatcher.publish(Lt,new MKError(MKError.MEDIA_PLAYBACK,"Playback Error"));break;case"loadedmetadata":t._dispatcher.publish(Ut,e);break;case"loadstart":t.setPlaybackState(Zt,r);break;case"pause":t.setPlaybackState(t._stopped?nr:er,r);break;case"play":case"playing":t._paused=!1,t._stopped=!1,t.isPrimaryPlayer=!0,t.setPlaybackState(tr,r);break;case"progress":{const e=t._targetElement.buffered;t.handleBufferStart(),1===e.length&&0===e.start(0)&&t.calculateBufferedProgress(e.end(0));break}case"ratechange":t._dispatcher.publish(Gt,e);break;case"seeked":t._stopped?t.setPlaybackState(nr,r):t._paused?t.setPlaybackState(er,r):t.playbackState!==Xt&&t.setPlaybackState(tr,r);break;case"seeking":t.playbackState===er?t._paused=!0:t.playbackState===nr&&(t._stopped=!0),t.playbackState!==Xt&&t.setPlaybackState(rr,r);break;case"timeupdate":{t._dispatcher.publish(zt,{currentPlaybackDuration:t.currentPlaybackDuration,currentPlaybackTime:t.currentPlaybackTime,currentPlaybackTimeRemaining:t.currentPlaybackTimeRemaining}),t.calculatePlaybackProgress();const e=t._buffer;e&&(e.currentTime=t.currentPlaybackTime);break}case"volumechange":t._dispatcher.publish(Yt,e);break;case"waiting":t.setPlaybackState(ir,r)}}))()}handleBufferStart(){const{_targetElement:e}=this;void 0!==this.initialBufferPosition||e.paused||0===e.buffered.length||(this.initialBufferPosition=e.buffered.start(0),this.initialPlayingDate=this.currentPlayingDate,xe.debug("BasePlayer.handleBufferStart: setting initial buffer position ",this.initialBufferPosition))}pause(e={}){var t=this;return _async_to_generator$18((function*(){yield t._waitForPendingPlay(),t.isPlaying&&(yield t._pauseMedia(),t._paused=!0,t.dispatch(et.playbackPause,_object_spread$E({item:t.nowPlayingItem,position:t.currentPlaybackTime,playingDate:t.currentPlayingDate},e)))}))()}play(e=!0){var t=this;return _async_to_generator$18((function*(){if(xe.debug("BasePlayer.play()"),t.nowPlayingItem)try{yield t._playMedia(),xe.debug("BasePlayer.play dispatching playbackPlay"),t.dispatch(et.playbackPlay,{userInitiated:e,item:t.nowPlayingItem,position:t.currentPlaybackTime,playingDate:t.currentPlayingDate})}catch(n){var r;if(n&&Jt.includes(n.name)&&xe.error("BasePlayer.play() rejected due to",n),"NotAllowedError"===(null===(r=n)||void 0===r?void 0:r.name))throw new MKError(MKError.USER_INTERACTION_REQUIRED,"Playback of media content requires user interaction first and cannot be automatically started on page load.")}}))()}preload(){return this._loadMedia()}showPlaybackTargetPicker(){this.playbackTargetAvailable&&this._targetElement.webkitShowPlaybackTargetPicker()}dispatch(e,t){void 0===t.item&&(t.item=this.nowPlayingItem),hasOwn(t,"isPlaying")||(t.isPlaying=this.isPlaying),this._dispatcher.publish(e,t)}tsidChanged(e){void 0!==e&&""!==e&&(this.isPrimaryPlayer=e===this._serial)}_waitForPendingPlay(){var e=this;return _async_to_generator$18((function*(){e._deferredPlay&&(yield e._deferredPlay.promise,e._deferredPlay=void 0)}))()}_loadMedia(){var e=this;return _async_to_generator$18((function*(){xe.debug("BasePlayer._loadMedia",e._targetElement),e._targetElement.load()}))()}_pauseMedia(){var e=this;return _async_to_generator$18((function*(){e._targetElement.pause()}))()}_playAssetURL(e,t){var r=this;return _async_to_generator$18((function*(){xe.debug("BasePlayer._playAssetURL",e),r._targetElement.src=e;const n=r._loadMedia();if(t)return xe.debug("BasePlayer.loadOnly"),void(yield n);yield r._playMedia()}))()}playItemFromUnencryptedSource(e,t,r){var n=this;return _async_to_generator$18((function*(){var i;return(null===(i=r)||void 0===i?void 0:i.startTime)&&(e+="#t="+r.startTime),t||n.startPlaybackSequence(),yield n._playAssetURL(e,t),n.finishPlaybackSequence()}))()}_playMedia(){var e=this;return _async_to_generator$18((function*(){xe.debug("BasePlayer._playMedia",e._targetElement,e.extension);try{yield e._targetElement.play(),e._playbackDidStart=!0}catch(Ae){throw xe.error("BasePlayer._playMedia: targetElement.play() rejected",Ae),Ae}}))()}_setTargetElementTitle(e){this.hasMediaElement&&(this._targetElement.title=e)}resetDeferredPlay(){this._deferredPlay=void 0}_stopMediaElement(){var e=this;return _async_to_generator$18((function*(){e.hasMediaElement&&(e._targetElement.pause(),e.cleanupElement())}))()}cleanupElement(){const e=this._targetElement;e&&!this.isElementCleaned()&&(e.currentTime=0,e.removeAttribute("src"),e.removeAttribute("title"))}isElementCleaned(){const e=this._targetElement;return!e||0===e.currentTime&&""===e.src&&""===e.title}finishPlaybackSequence(){var e;xe.debug("BasePlayer.finishPlaybackSequence",this._deferredPlay);const t=null===(e=this._deferredPlay)||void 0===e?void 0:e.resolve(void 0);return this._deferredPlay=void 0,t}startPlaybackSequence(){return xe.debug("BasePlayer.startPlaybackSequence",this._deferredPlay),this._deferredPlay&&(xe.warn("Previous playback sequence not cleared"),this.finishPlaybackSequence()),this._deferredPlay=function(){let e,t;return{promise:new Promise((function(r,n){e=r,t=n})),resolve(t){var r;null===(r=e)||void 0===r||r(t)},reject(e){var r;null===(r=t)||void 0===r||r(e)}}}(),this._deferredPlay.promise}constructor(t){var r;_define_property$1C(this,"privateEnabled",!1),_define_property$1C(this,"siriInitiated",!1),_define_property$1C(this,"windowHandlers",void 0),_define_property$1C(this,"_dispatcher",void 0),_define_property$1C(this,"_buffer",void 0),_define_property$1C(this,"services",void 0),_define_property$1C(this,"_context",void 0),_define_property$1C(this,"_currentBufferedProgress",0),_define_property$1C(this,"initialBufferPosition",void 0),_define_property$1C(this,"initialPlayingDate",void 0),_define_property$1C(this,"_paused",!1),_define_property$1C(this,"_playbackState",e.PlaybackStates.none),_define_property$1C(this,"_stopped",!1),_define_property$1C(this,"_playbackDidStart",!1),_define_property$1C(this,"_nowPlayingItem",void 0),_define_property$1C(this,"_bitrateCalculator",void 0),_define_property$1C(this,"_currentPlaybackProgress",0),_define_property$1C(this,"_isPrimaryPlayer",!0),_define_property$1C(this,"_playbackTargetAvailable",!1),_define_property$1C(this,"_playbackTargetIsWireless",!1),_define_property$1C(this,"_seeker",void 0),_define_property$1C(this,"_serial",Date.now().toString()),_define_property$1C(this,"_timing",void 0),_define_property$1C(this,"fullscreen",void 0),_define_property$1C(this,"_isDestroyed",!1),_define_property$1C(this,"_deferredPlay",void 0),this.services=t.services,this._dispatcher=t.services.dispatcher,this._timing=t.services.timing,this._context=t.context||{},this.privateEnabled=t.privateEnabled||!1,this.siriInitiated=t.siriInitiated||!1,this._bitrateCalculator=t.services.bitrateCalculator,this.windowHandlers=new WindowHandlers(this,t.services.runtime),this.fullscreen=new Fullscreen(this),null===(r=getLocalStorage())||void 0===r||r.setItem(je,this._serial),this._dispatcher.subscribe(Lt,this.onPlaybackError)}}function generateAssetUrl(e,t){if("Preview"===e.type&&isStringNotEmpty(e.previewURL))return e.previewURL;let r=e.assetURL;if(!r)throw new Error("Cannot generate asset URL");return t&&(t.startOver&&(r=addQueryParamsToURL(r,{startOver:!0})),t.bingeWatching&&(r=addQueryParamsToURL(r,{bingeWatching:!0}))),e.supportsLinearScrubbing&&(r=addQueryParamsToURL(r,{linearScrubbingSupported:!0})),r.match(/xapsub=accepts-css/)||(r=addQueryParamsToURL(r,{xapsub:"accepts-css"})),r}function restoreSelectedTrack(e,t){xe.debug("MEDIA_TRACKS restoreSelectedTrack");const r=e.getPersistedTrack(),n=e.fields,i=t.currentTrack;if(!r)return void xe.debug("MEDIA_TRACKS no persisted track");if(i&&trackEquals(i,r,n))return void xe.debug("MEDIA_TRACKS persisted track is equal to current track, not setting");const o=t.tracks;if(o&&o.length)for(let a=0;a<o.length;a++){const e=o[a];if(xe.debug(`MEDIA_TRACKS testing track ${e.label} against persisted track ${JSON.stringify(r)}`),trackEquals(e,r,n)){xe.debug("MEDIA_TRACKS found matching track "+e.label),t.currentTrack=e;break}}}function trackEquals(e,t,r){let n=!0;for(let i=0;i<r.length;i++){const o=r[i];if(e[o]!==t[o]){n=!1;break}}return n}function _define_property$1B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$A("design:type",Function),_ts_metadata$A("design:paramtypes",[String,void 0===MKError?Object:MKError])],BasePlayer.prototype,"onPlaybackError",null);class TrackPersistence{getPersistedTrack(){var e;if(!hasLocalStorage())return!1;const t=(null===(e=getLocalStorage())||void 0===e?void 0:e.getItem(this.storageKey))||"";try{return JSON.parse(t)}catch(r){return xe.warn("MEDIA_TRACK could not parse persisted value "+t),!1}}setPersistedTrack(e){var t,r;if(!hasLocalStorage())return;if(xe.debug(`MEDIA_TRACK setPersistedTrack ${e.language},${e.label},${e.kind} with keys ${this.fields}`),!e)return void(null===(r=getLocalStorage())||void 0===r||r.setItem(this.storageKey,""));const n=JSON.stringify(this.extractFieldValuesFromTrack(e));xe.debug("MEDIA_TRACK Extracted values "+n),null===(t=getLocalStorage())||void 0===t||t.setItem(this.storageKey,n)}extractFieldValuesFromTrack(e){const t={};return this.fields.forEach(r=>{const n=e[r];null==n&&xe.warn(`MEDIA_TRACK No value for field ${r} on track ${JSON.stringify(e)}`),t[r]=n}),t}constructor(e,t){_define_property$1B(this,"storageKey",void 0),_define_property$1B(this,"fields",void 0),this.storageKey=e,this.fields=t}}var or;!function(e){e.Home="com.apple.amp.appletv.home-team-radio",e.Away="com.apple.amp.appletv.away-team-radio"}(or||(or={}));function isHomeRadioTrack(e){return void 0!==e.characteristics&&e.characteristics.includes("com.apple.amp.appletv.home-team-radio")}function isAwayRadioTrack(e){return void 0!==e.characteristics&&e.characteristics.includes("com.apple.amp.appletv.away-team-radio")}class TrackManagerStub{get isDestroyed(){return this._isDestroyed}get currentTrack(){return{}}set currentTrack(e){}get tracks(){return[]}destroy(){this._isDestroyed=!0}restoreSelectedTrack(){}constructor(){var e,t,r;r=!1,(t="_isDestroyed")in(e=this)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}}function _define_property$1z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const{audioTrackAdded:ar,audioTrackChanged:sr,audioTrackRemoved:cr}=rt,{audioTracksSwitched:lr,audioTracksUpdated:dr}=Fe;class AudioTrackManager{get isDestroyed(){return this._isDestroyed}get currentTrack(){return this.tracks.find(e=>e.enabled)}set currentTrack(e){e&&(xe.debug("MEDIA_TRACK Setting audio track "+e.label),this.extensionTracks?(xe.debug(`MEDIA_TRACK Setting track on extension ${e.id}-${e.label}`),this.extensionTracks.audioTrack=e):(xe.debug("MEDIA_TRACK disabling all audio tracks"),Array.from(this.mediaElement.audioTracks).forEach(t=>{t!==e&&(t.enabled=!1)}),xe.debug("MEDIA_TRACK enabling",e),e.enabled=!0),isHomeRadioTrack(e)||isAwayRadioTrack(e)||this.trackPersistence.setPersistedTrack(e))}get tracks(){return this.extensionTracks?this._extensionTracks||this.extensionTracks.audioTracks||[]:Array.from(this.mediaElement.audioTracks)}destroy(){if(this._isDestroyed=!0,this.extensionTracks){const e=this.extensionTracks;e.removeEventListener(dr,this.onExtensionAudioTracksUpdated),e.removeEventListener(lr,this.onExtensionAudioTrackSwitched)}else{if(!this.mediaElement.audioTracks)return;this.mediaElement.audioTracks.removeEventListener("addtrack",this.onAudioTrackAdded),this.mediaElement.audioTracks.removeEventListener("change",this.onAudioTrackChanged),this.mediaElement.audioTracks.removeEventListener("removetrack",this.onAudioTrackRemoved)}}restoreSelectedTrack(){return restoreSelectedTrack(this.trackPersistence,this)}onExtensionAudioTracksUpdated(e){xe.debug("MEDIA_TRACK Extension audio tracks updated "+JSON.stringify(e)),this._extensionTracks=e,this.restoreSelectedTrack(),this.dispatcher.publish(ar,e)}onExtensionAudioTrackSwitched(e){if(xe.debug("MEDIA_TRACK Extension audio track switched "+JSON.stringify(e)),this._extensionTracks){const preserveSelectedTrack=t=>{t.enabled=e.selectedId===t.id};this._extensionTracks.forEach(preserveSelectedTrack)}this.dispatcher.publish(sr,e)}onAudioTrackAdded(e){!function(e,t,r){const n=t.getPersistedTrack();n&&trackEquals(e,n,t.fields)&&(xe.debug("MEDIA_TRACK onTrackAdded with track that matches persisted track "+e.label),r.currentTrack=e)}(e.track,this.trackPersistence,this),this.dispatcher.publish(ar,e)}onAudioTrackChanged(e){this.dispatcher.publish(sr,e)}onAudioTrackRemoved(e){this.dispatcher.publish(cr,e)}constructor(e,t,r){if(_define_property$1z(this,"mediaElement",void 0),_define_property$1z(this,"dispatcher",void 0),_define_property$1z(this,"extensionTracks",void 0),_define_property$1z(this,"_extensionTracks",void 0),_define_property$1z(this,"trackPersistence",void 0),_define_property$1z(this,"_isDestroyed",void 0),this.mediaElement=e,this.dispatcher=t,this.extensionTracks=r,this._extensionTracks=[],this.trackPersistence=new TrackPersistence("mk-audio-track",["label","language","kind"]),this._isDestroyed=!1,this.extensionTracks){xe.debug("MEDIA_TRACK Initializing audio track manager for hls track events"),this.onExtensionAudioTracksUpdated=this.onExtensionAudioTracksUpdated.bind(this),this.onExtensionAudioTrackSwitched=this.onExtensionAudioTrackSwitched.bind(this);const e=this.extensionTracks;e.addEventListener(dr,this.onExtensionAudioTracksUpdated),e.addEventListener(lr,this.onExtensionAudioTrackSwitched)}else{if(!e.audioTracks)return;xe.debug("MEDIA_TRACK Initializing audio track manager for native track events"),this.onAudioTrackAdded=this.onAudioTrackAdded.bind(this),this.onAudioTrackChanged=this.onAudioTrackChanged.bind(this),this.onAudioTrackRemoved=this.onAudioTrackRemoved.bind(this),e.audioTracks.addEventListener("addtrack",this.onAudioTrackAdded),e.audioTracks.addEventListener("change",this.onAudioTrackChanged),e.audioTracks.addEventListener("removetrack",this.onAudioTrackRemoved)}}}const ur=[],pr=[];function nextAvailableAudioElement(){let e=pr.pop();return e?xe.debug(`dom-helpers: retrieving audio tag, ${pr.length} remain`):(xe.debug("dom-helpers: no available audio tags, creating one"),e=document.createElement("audio")),e}function deferPlayback(){fillAvailableElements("audio",pr),fillAvailableElements("video",ur),xe.debug(`dom-helpers: defer playback called.  There are ${ur.length} available video elements and ${pr.length} available audio elements.`)}function fillAvailableElements(e,t){let r=100-t.length;for(;r>0;){const n=document.createElement(e);n.load(),t.push(n),r--}}const hr=BooleanDevFlag.register("mk-load-manifest-once"),shouldLoadManifestOnce=()=>!hr.configured||hr.enabled;var yr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var _r=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isValidScrollSetting=t.isValidPositionAlignSetting=t.isValidLineAlignSetting=t.isValidLineAndPositionSetting=t.isValidDirectionSetting=t.isValidAlignSetting=t.isValidPercentValue=void 0,t.isValidPercentValue=function(e){return"number"==typeof e&&e>=0&&e<=100},t.isValidAlignSetting=function(e){return"string"==typeof e&&["start","center","end","left","right","middle"].includes(e)},t.isValidDirectionSetting=function(e){return"string"==typeof e&&["","rl","lr"].includes(e)},t.isValidLineAndPositionSetting=function(e){return"number"==typeof e||"auto"===e},t.isValidLineAlignSetting=function(e){return"string"==typeof e&&["start","center","end"].includes(e)},t.isValidPositionAlignSetting=function(e){return"string"==typeof e&&["line-left","center","line-right","auto","left","start","middle","end","right"].includes(e)},t.isValidScrollSetting=function(e){return["","up"].includes(e)}}));unwrapExports(_r),_r.isValidScrollSetting,_r.isValidPositionAlignSetting,_r.isValidLineAlignSetting,_r.isValidLineAndPositionSetting,_r.isValidDirectionSetting,_r.isValidAlignSetting,_r.isValidPercentValue;var fr=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const r={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},n={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},i={v:"title",lang:"lang"},o={rt:"ruby"},a={"text-combine-upright":"-webkit-text-combine:horizontal; text-orientation: mixed;"};class ParserUtility{static parseTimeStamp(e){function computeSeconds(e){const[t,r,n,i]=e.map(e=>e?parseInt(""+e):0);return 3600*t+60*r+n+i/1e3}const t=/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/.exec(e);return t?t[3]?computeSeconds([t[1],t[2],t[3].substring(1),t[4]]):parseInt(t[1])>59?computeSeconds([t[1],t[2],null,t[4]]):computeSeconds([null,t[1],t[2],t[4]]):null}static parseContent(e,t,s){let c=t.text;function nextToken(){if(!c)return null;const e=/^([^<]*)(<[^>]+>?)?/.exec(c);return t=e[1]?e[1]:e[2],c=c.substr(t.length),t;var t}function unescape1(e){return r[e]}function shouldAdd(e,t){return!o[t.dataset.localName]||o[t.dataset.localName]===e.dataset.localName}function createElement(t,r,o){const c=n[t];if(!c)return null;const l=e.document.createElement(c);l.dataset.localName=c;const d=i[t];if(d&&o&&(l[d]=o.trim()),r)if(s[r]){const e=function(e){let t="";for(const r in e)t+=a[r]?a[r]:r+":"+e[r]+";";return t}(s[r]);l.setAttribute("style",e)}else console.info(`WebVTT: parseContent: Style referenced, but no style defined for '${r}'!`);return l}const l=e.document.createElement("div"),d=[];let u,p,h=l;for(;null!==(u=nextToken());)if("<"!==u[0])h.appendChild(e.document.createTextNode(u.replace(/&(amp|lt|gt|lrm|rlm|nbsp);/g,unescape1)));else{if("/"===u[1]){d.length&&d[d.length-1]===u.substr(2).replace(">","")&&(d.pop(),h=h.parentNode);continue}const t=ParserUtility.parseTimeStamp(u.substr(1,u.length-2));let r;if(t){r=e.document.createProcessingInstruction("timestamp",t.toString()),h.appendChild(r);continue}if(p=/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/.exec(u),!p)continue;if(r=createElement(p[1],p[2],p[3]),!r)continue;if(!shouldAdd(h,r))continue;p[2],d.push(p[1]),h.appendChild(r),h=r}return l}}t.default=ParserUtility}));unwrapExports(fr);var vr=createCommonjsModule((function(e,t){var r=yr&&yr.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.VTTCue=void 0;let n=class{get id(){return this._id}set id(e){this._id=""+e}get pauseOnExit(){return this._pauseOnExit}set pauseOnExit(e){this._pauseOnExit=!!e}get startTime(){return this._startTime}set startTime(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number: "+e);this._startTime=e,this.hasBeenReset=!0}get endTime(){return this._endTime}set endTime(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number: "+e);this._endTime=e,this.hasBeenReset=!0}get text(){return this._text}set text(e){this._text=""+e,this.hasBeenReset=!0}get region(){return this._region}set region(e){this._region=e,this.hasBeenReset=!0}get vertical(){return this._vertical}set vertical(e){if(!_r.isValidDirectionSetting(e))throw new SyntaxError("An invalid or illegal string was specified for vertical: "+e);this._vertical=e,this.hasBeenReset=!0}get snapToLines(){return this._snapToLines}set snapToLines(e){this._snapToLines=!!e,this.hasBeenReset=!0}get line(){return this._line}set line(e){if(!_r.isValidLineAndPositionSetting(e))throw new SyntaxError("An invalid number or illegal string was specified for line: "+e);this._line=e,this.hasBeenReset=!0}get lineAlign(){return this._lineAlign}set lineAlign(e){if(!_r.isValidLineAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for lineAlign: "+e);this._lineAlign=e,this.hasBeenReset=!0}get position(){return this._position}set position(e){if(!_r.isValidLineAndPositionSetting(e))throw new Error("Position must be between 0 and 100 or auto: "+e);this._position=e,this.hasBeenReset=!0}get positionAlign(){return this._positionAlign}set positionAlign(e){if(!_r.isValidPositionAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for positionAlign: "+e);this._positionAlign=e,this.hasBeenReset=!0}get size(){return this._size}set size(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100: "+e);this._size=e,this.hasBeenReset=!0}get align(){return this._align}set align(e){if(!_r.isValidAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for align: "+e);this._align=e,this.hasBeenReset=!0}getCueAsHTML(){return fr.default.parseContent(window,this,{})}static create(e){if(!e.hasOwnProperty("startTime")||!e.hasOwnProperty("endTime")||!e.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");const t=new this(e.startTime,e.endTime,e.text);return Object.keys(e).forEach(r=>{t.hasOwnProperty(r)&&(t[r]=e[r])}),t}static fromJSON(e){return this.create(JSON.parse(e))}toJSON(){const e={};return Object.keys(this).forEach(t=>{this.hasOwnProperty(t)&&"getCueAsHTML"!==t&&"hasBeenReset"!==t&&"displayState"!==t&&(e[t]=this[t])}),e}constructor(e,t,r){this._id="",this._pauseOnExit=!1,this._region=null,this._vertical="",this._snapToLines=!0,this._line="auto",this._lineAlign="start",this._position="auto",this._positionAlign="auto",this._size=100,this._align="center",this.hasBeenReset=!1,this._startTime=e,this._endTime=t,this._text=r}};n=r([function(e){let t=e;"undefined"!=typeof window&&null!=window.VTTCue&&(t=window.VTTCue,t.create=e.create,t.fromJSON=e.fromJSON,t.prototype.toJSON=e.prototype.toJSON);return t}],n),t.VTTCue=n}));unwrapExports(vr),vr.VTTCue;var gr=createCommonjsModule((function(e,t){var r=yr&&yr.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.VTTRegion=void 0;let n=class{get id(){return this._id}set id(e){if("string"!=typeof e)throw new Error("ID must be a string.");this._id=e}get lines(){return this._lines}set lines(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");this._lines=e}get regionAnchorX(){return this._regionAnchorX}set regionAnchorX(e){if(!_r.isValidPercentValue(e))throw new TypeError("RegionAnchorX must be between 0 and 100.");this._regionAnchorX=e}get regionAnchorY(){return this._regionAnchorY}set regionAnchorY(e){if(!_r.isValidPercentValue(e))throw new TypeError("RegionAnchorY must be between 0 and 100.");this._regionAnchorY=e}get scroll(){return this._scroll}set scroll(e){if("string"==typeof e){const t=e.toLowerCase();if(_r.isValidScrollSetting(t))return void(this._scroll=t)}throw new SyntaxError("An invalid or illegal string was specified.")}get viewportAnchorX(){return this._viewportAnchorX}set viewportAnchorX(e){if(!_r.isValidPercentValue(e))throw new TypeError("ViewportAnchorX must be between 0 and 100.");this._viewportAnchorX=e}get viewportAnchorY(){return this._viewportAnchorY}set viewportAnchorY(e){if(!_r.isValidPercentValue(e))throw new TypeError("ViewportAnchorY must be between 0 and 100.");this._viewportAnchorY=e}get width(){return this._width}set width(e){if(!_r.isValidPercentValue(e))throw new TypeError("Width must be between 0 and 100.");this._lines=e}toJSON(){const e={};return Object.keys(this).forEach(t=>{this.hasOwnProperty(t)&&(e[t]=this[t])}),e}static create(e){const t=new this;return Object.keys(e).forEach(r=>{t.hasOwnProperty(r)&&(t[r]=e[r])}),t}static fromJSON(e){return this.create(JSON.parse(e))}constructor(){this._id="",this._lines=3,this._regionAnchorX=0,this._regionAnchorY=100,this._scroll="",this._viewportAnchorX=0,this._viewportAnchorY=100,this._width=100}};n=r([function(e){let t=e;"undefined"!=typeof window&&null!=window.VTTRegion&&(t=window.VTTRegion,t.create=e.create,t.fromJSON=e.fromJSON,t.prototype.toJSON=e.prototype.toJSON);return t}],n),t.VTTRegion=n}));unwrapExports(gr),gr.VTTRegion;var mr=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));unwrapExports(mr);var br=createCommonjsModule((function(e,t){var r=yr&&yr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=yr&&yr.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.VTTRegion=t.VTTCue=t.WebVTTParser=t.ParsingError=void 0,Object.defineProperty(t,"VTTCue",{enumerable:!0,get:function(){return vr.VTTCue}}),Object.defineProperty(t,"VTTRegion",{enumerable:!0,get:function(){return gr.VTTRegion}});class ParsingError extends Error{constructor(e,t){super(),this.name="ParsingError",this.code="number"==typeof e?e:e.code,t?this.message=t:e instanceof ParsingError&&(this.message=e.message)}}t.ParsingError=ParsingError,ParsingError.Errors={BadSignature:new ParsingError(0,"Malformed WebVTT signature."),BadTimeStamp:new ParsingError(1,"Malformed time stamp.")};class Settings{set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,r){return"object"==typeof t&&"string"==typeof r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(t.match(/^([\d]{1,3})(\.[\d]*)?%$/))try{const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}catch(r){return!1}return!1}constructor(){this.values={}}}class WebVTTParser{static StringDecoder(){return{decode:e=>{if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}}reportOrThrowError(e){if(!(e instanceof ParsingError&&"function"==typeof this.onparsingerror))throw e;this.onparsingerror(e)}parseOptions(e,t,r,n){const i=n?e.split(n):[e];for(const o of i){if("string"!=typeof o)continue;const e=o.split(r);if(2!==e.length)continue;t(e[0],e[1])}}parseCue(e,t,r){const n=e,consumeTimeStamp=()=>{const t=fr.default.parseTimeStamp(e);if(null===t)throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t},skipWhitespace=()=>{e=e.replace(/^\s+/,"")};if(skipWhitespace(),t.startTime=consumeTimeStamp(),skipWhitespace(),"--\x3e"!==e.substr(0,3))throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.substr(3),skipWhitespace(),t.endTime=consumeTimeStamp(),skipWhitespace(),((e,t)=>{const n=new Settings;this.parseOptions(e,(e,t)=>{let i,o;switch(e){case"region":for(let i=r.length-1;i>=0;i--)if(r[i].id===t){n.set(e,r[i].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),o=i[0],n.integer(e,o),n.percent(e,o)&&n.set("snapToLines",!1),n.alt(e,o,["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start","middle","center","end"]);break;case"position":if(i=t.split(","),n.percent(e,i[0]),2===i.length){let e=["line-left","line-right","center","auto","left","start","middle","end","right"];n.alt("positionAlign",i[1],e)}break;case"size":n.percent(e,t);break;case"align":let a=["start","center","end","left","right","middle"];n.alt(e,t,a)}},/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical",""),t.line=n.get("line",void 0===t.line?"auto":t.line);const i=n.get("lineAlign","start");t.lineAlign="center"===i||"middle"===i?this.middleOrCenter:i,t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100);const o=n.get("align","center");t.align="center"===o||"middle"===o?this.middleOrCenter:o,t.position=n.get("position","auto");let a=n.get("positionAlign",{start:"start",left:"start",center:"center",middle:"middle",right:"end",end:"end"},t.align);t.positionAlign="center"===a||"middle"===a?this.middleOrCenter:{start:"start","line-left":"start",left:"start",center:"center",middle:"middle","line-right":"end",right:"end",end:"end"}[a]})(e,t)}parseRegion(e){const t=new Settings;if(this.parseOptions(e,(e,r)=>{switch(e){case"id":t.set(e,r);break;case"width":t.percent(e,r);break;case"lines":t.integer(e,r);break;case"regionanchor":case"viewportanchor":{const n=r.split(",");if(2!==n.length)break;const i=new Settings;if(i.percent("x",n[0]),i.percent("y",n[1]),!i.has("x")||!i.has("y"))break;t.set(e+"X",i.get("x")),t.set(e+"Y",i.get("y"));break}case"scroll":t.alt(e,r,["up"])}},/=/,/\s/),t.has("id")){const e=new gr.VTTRegion;e.width=t.get("width",100),e.lines=t.get("lines",3),e.regionAnchorX=t.get("regionanchorX",0),e.regionAnchorY=t.get("regionanchorY",100),e.viewportAnchorX=t.get("viewportanchorX",0),e.viewportAnchorY=t.get("viewportanchorY",100),e.scroll=t.get("scroll",""),this.onregion&&this.onregion(e),this.regionList.push({id:t.get("id"),region:e})}}parseStyle(e){const parseStyles=e=>{const t={},r=e.split(";");for(let n=0;n<r.length;n++)if(r[n].includes(":")){const e=r[n].split(":",2),i=e[0].trim(),o=e[1].trim();""!==i&&""!==o&&(t[i]=o)}return t},t=e.split("}");t.pop();for(const r of t){let e=null,t=null;const n=r.split("{");n[0]&&(e=n[0].trim()),n[1]&&(t=parseStyles(n[1])),e&&t&&(this._styles[e]=t)}this.onStylesParsedCallback&&this.onStylesParsedCallback(this._styles)}parseHeader(e){this.parseOptions(e,(function(e,t){switch(e){case"Region":this.parseRegion(t)}}),/:/)}parse(e){e&&(this.buffer+=this.decoder.decode(e,{stream:!0}));const collectNextLine=()=>{const e=this.buffer;let t=0;const calculateBreakPosition=(e,t)=>{const r={start:-1,length:-1};if("\r"===e[t])r.start=t,r.length=1;else if("\n"===e[t])r.start=t,r.length=1;else if("<"===e[t]&&t+1<e.length&&"b"===e[t+1]&&t+2<e.length&&"r"===e[t+2]){let n=t+2;for(;n<e.length&&">"!==e[n++];);r.start=t,r.length=n-t}return r};let r={start:e.length,length:0};for(;t<e.length;){const n=calculateBreakPosition(e,t);if(n.length>0){r=n;break}++t}const n=e.substr(0,r.start);return this.buffer=e.substr(r.start+r.length),n};try{let e;if("INITIAL"===this.state){if(!/\r\n|\n/.test(this.buffer))return this;this.alreadyCollectedLine="",e=collectNextLine();const t=/^(ï»¿)?WEBVTT([ \t].*)?$/.exec(e);if(!t||!t[0])throw new ParsingError(ParsingError.Errors.BadSignature);this.state="HEADER"}for(;this.buffer;){if(!/\r\n|\n/.test(this.buffer))return this;switch(this.alreadyCollectedLine?(e=this.alreadyCollectedLine,this.alreadyCollectedLine=""):e=collectNextLine(),this.state){case"HEADER":e.includes(":")?this.parseHeader(e):e||(this.state="ID");continue;case"NOTE":e||(this.state="ID");continue;case"STYLE":e?this.styleCollector+=e:(this.parseStyle(this.styleCollector),this.state="ID",this.styleCollector="");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){this.state="NOTE";break}if(/^STYLE($|[ \t])/.test(e)){this.state="STYLE";break}if(!e)continue;if(this.cue=new vr.VTTCue(0,0,""),this.state="CUE",!e.includes("--\x3e")){this.cue.id=e;continue}case"CUE":try{this.parseCue(e,this.cue,this.regionList)}catch(t){this.reportOrThrowError(t),this.cue=null,this.state="BADCUE";continue}this.state="CUETEXT";continue;case"CUETEXT":{const t=e.includes("--\x3e");if(!e||t){this.alreadyCollectedLine=e,this.oncue&&this.oncue(this.cue),this.cue=null,this.state="ID";continue}this.cue.text&&(this.cue.text+="\n"),this.cue.text+=e;continue}case"BADCUE":e||(this.state="ID");continue}}}catch(t){this.reportOrThrowError(t),"CUETEXT"===this.state&&this.cue&&this.oncue&&this.oncue(this.cue),this.cue=null,this.state="INITIAL"===this.state?"BADWEBVTT":"BADCUE"}return this}flush(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new ParsingError(ParsingError.Errors.BadSignature)}catch(e){this.reportOrThrowError(e)}return this.onflush&&this.onflush(),this}styles(){return this._styles}constructor(e,t,r){this.window=e,this.state="INITIAL",this.styleCollector="",this.buffer="",this.decoder=t||new TextDecoder("utf8"),this.regionList=[],this.alreadyCollectedLine="",this.onStylesParsedCallback=r,this._styles={},this.middleOrCenter="center";const n=new vr.VTTCue(0,0,"middleOrCenter");try{n.align="center","center"!==n.align&&(this.middleOrCenter="middle")}catch(i){this.middleOrCenter="middle"}}}t.default=WebVTTParser,t.WebVTTParser=WebVTTParser,n(mr,t)}));unwrapExports(br),br.VTTRegion,br.VTTCue,br.WebVTTParser,br.ParsingError;var Sr=createCommonjsModule((function(e,t){var r=yr&&yr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=yr&&yr.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.VTTCue=t.WebVTTRenderer=t.BoxPosition=t.CueStyleBox=t.StyleBox=void 0,Object.defineProperty(t,"VTTCue",{enumerable:!0,get:function(){return vr.VTTCue}});const i=[/^(::cue\()(\..*)(\))/,/^(::cue\()(#.*)(\))/,/^(::cue\()(c|i|b|u|ruby|rt|v|lang)(\))/],o=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];class StyleBox{applyStyles(e,t){t=t||this.div;for(const r in e)e.hasOwnProperty(r)&&(t.style[r]=e[r])}formatStyle(e,t){return 0===e?"0":e+t}}t.StyleBox=StyleBox;class CueStyleBox extends StyleBox{determineBidi(e){let t,r=[],n="";if(!e||!e.childNodes)return"ltr";function pushNodes(e,t){for(let r=t.childNodes.length-1;r>=0;r--)e.push(t.childNodes[r])}function nextTextNode(e){if(!e||!e.length)return null;let t=e.pop(),r=t.textContent||t.innerText;if(r){const t=/^.*(\n|\r)/.exec(r);return t?(e.length=0,t[0]):r}return"ruby"===t.tagName?nextTextNode(e):t.childNodes?(pushNodes(e,t),nextTextNode(e)):void 0}function isContainedInCharacterList(e,t){for(const r of t)if(e>=r[0]&&e<=r[1])return!0;return!1}for(pushNodes(r,e);n=nextTextNode(r);)for(let e=0;e<n.length;e++)if(t=n.charCodeAt(e),isContainedInCharacterList(t,o))return"rtl";return"ltr"}parseOpacity(e){if(!e||"string"!=typeof e)return null;const t=(e=e.replace(/ /g,"").replace("rgba(","").replace(")","")).split(",");return t&&t.length>=4?t[3]:null}directionSettingToWritingMode(e){return""===e?"horizontal-tb":"lr"===e?"vertical-lr":"vertical-rl"}move(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}constructor(e,t,r,n,i){super(),this.cue=t;let o={start:"left","line-left":"left",left:"left",center:"center",middle:"center","line-right":"right",right:"right",end:"right"}[t.positionAlign]||t.align;"middle"===o&&(o="center");let a={textAlign:o,whiteSpace:"pre-line",position:"absolute"};a.direction=this.determineBidi(this.cueDiv),a.writingMode=this.directionSettingToWritingMode(t.vertical),a.unicodeBidi="plaintext",this.div=e.document.createElement("div"),this.applyStyles(a),a={backgroundColor:n.backgroundColor,display:"inline-block"},this.parseOpacity(a.backgroundColor)&&(a.padding="5px",a.borderRadius="5px"),this.backgroundDiv=e.document.createElement("div"),this.applyStyles(a,this.backgroundDiv),a={color:r.color,backgroundColor:r.backgroundColor,textShadow:r.textShadow,fontSize:r.fontSize,fontFamily:r.fontFamily,position:"relative",left:"0",right:"0",top:"0",bottom:"0",display:"inline-block",textOrientation:"upright"},a.writingMode=this.directionSettingToWritingMode(t.vertical),a.unicodeBidi="plaintext",this.cueDiv=fr.default.parseContent(e,t,i),this.applyStyles(a,this.cueDiv),this.backgroundDiv.appendChild(this.cueDiv),this.div.appendChild(this.backgroundDiv);let s=0;if("number"==typeof t.position){let e=t.positionAlign||t.align;if(e)switch(e){case"start":case"left":s=t.position;break;case"center":case"middle":s=t.position-t.size/2;break;case"end":case"right":s=t.position-t.size}}""===t.vertical?this.applyStyles({left:this.formatStyle(s,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(s,"%"),height:this.formatStyle(t.size,"%")})}}t.CueStyleBox=CueStyleBox;class BoxPosition{calculateNewLines(e){let t=1;for(let r=0;r<e.length;r++)"\n"===e[r]&&t++;return t}move(e,t){switch(t=void 0!==t?t:this.singleLineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}}overlaps(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top}overlapsAny(e){for(const t of e)if(this.overlaps(t))return!0;return!1}within(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right}moveIfOutOfBounds(e,t){switch(t){case"+x":this.left<e.left&&(this.left=e.left,this.right=this.left+this.width);break;case"-x":this.right>e.right&&(this.right=e.right,this.left=this.right-this.width);break;case"+y":this.top<e.top&&(this.top=e.top,this.bottom=this.top+this.height);break;case"-y":this.bottom>e.bottom&&(this.bottom=e.bottom,this.top=this.bottom-this.height)}}toCSSCompatValues(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}}static getSimpleBoxPosition(e){let t=null;e instanceof StyleBox&&e.div?t=e.div:e instanceof HTMLElement&&(t=e);let r=t.offsetHeight||0,n=t.offsetWidth||0,i=t.offsetTop||0,o=i+r,a=t.getBoundingClientRect();const{left:s,right:c}=a;return a.top&&(i=a.top),a.height&&(r=a.height),a.width&&(n=a.width),a.bottom&&(o=a.bottom),{left:s,right:c,top:i,height:r,bottom:o,width:n}}static getBoxPosition(e,t){if(e&&e.length>0){let r=0,n=e[0][t];for(let i=0;i<e.length;i++)t in["top","right"]?e[i][t]>n&&(r=i,n=e[i][t]):t in["bottom","left"]&&e[i][t]<n&&(r=i,n=e[i][t]);return e[r]}return null}static moveToMinimumDistancePlacement(e,t,r){"height"===e.property?"+y"===t?(e.top=r.topMostBoxPosition.bottom+0,e.bottom=e.top+e.height):"-y"===t&&(e.bottom=r.bottomMostBoxPosition.top-0,e.top=e.bottom-e.height):"width"===e.property&&("+x"===t?(e.left=r.rightMostBoxPosition.right+0,e.right=e.left+e.width):"-x"===t&&(e.right=r.leftMostBoxPosition.left-0,e.left=e.right-e.width))}static moveBoxToLinePosition(e,t,r){const n=e.cue;let i,o=new BoxPosition(e),a=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;let t=0;const r=e.track,n=r.textTrackList;for(let i=0;i<n.length&&n[i]!==r;i++)"showing"===n[i].mode&&t++;return-1*++t}(n),s=[];if(n.snapToLines){let e=0;switch(n.vertical){case"":s=["+y","-y"],i="height";break;case"rl":s=["+x","-x"],i="width";break;case"lr":s=["-x","+x"],i="width"}const r=o.lineHeight,c=t[i]+r,l=s[0];if(a<0){let i=0;switch(n.vertical){case"":i=t.height-r-.05*t.height;break;case"rl":case"lr":i=-t.width+r+.05*t.width}e=i,s=s.reverse()}else{switch(n.vertical){case"":e=r*Math.round(a);break;case"rl":e=t.width-r*Math.round(a);break;case"lr":e=r*Math.round(a)}Math.abs(e)>c&&(e=e<0?-1:1,e*=Math.ceil(c/r)*r)}o.move(l,e)}else{const r=""===n.vertical?t.height:t.width,i=o.lineHeight/r*100;switch(n.lineAlign){case"center":case"middle":a-=i/2;break;case"end":a-=i}switch(n.vertical){case"":e.applyStyles({top:e.formatStyle(a,"%")});break;case"rl":e.applyStyles({right:e.formatStyle(a,"%")});break;case"lr":e.applyStyles({left:e.formatStyle(a,"%")})}s=["+y","-y","+x","-x"],"+y"===n.axis?s=["+y","-y","+x","-x"]:"-y"===n.axis&&(s=["-y","+y","+x","-x"]),o=new BoxPosition(e)}const c=function(e,n){let i;for(let o=0;o<n.length;o++){e.moveIfOutOfBounds(t,n[o]);let a=0,s=!1;for(;e.overlapsAny(r)&&!(a>9);)s?e.move(n[o]):(r&&r.length>0&&(i||(i={topMostBoxPosition:BoxPosition.getBoxPosition(r,"top"),bottomMostBoxPosition:BoxPosition.getBoxPosition(r,"bottom"),leftMostBoxPosition:BoxPosition.getBoxPosition(r,"left"),rightMostBoxPosition:BoxPosition.getBoxPosition(r,"right")}),BoxPosition.moveToMinimumDistancePlacement(e,n[o],i)),s=!0),a++}return e}(o,s);e.move(c.toCSSCompatValues(t))}constructor(e){var t;let r,n,i,o,a,s;if(e instanceof CueStyleBox&&e.cue?(t=e.cue)&&""!==t.vertical?this.property="width":this.property="height":e instanceof BoxPosition&&(this.property=e.property||"height"),e instanceof CueStyleBox&&e.div){i=e.div.offsetHeight,o=e.div.offsetWidth,a=e.div.offsetTop;const t=e.div.firstChild;if(s=t?t.getBoundingClientRect():e.div.getBoundingClientRect(),r=s&&s[this.property]||null,t&&t.firstChild){const e=t.firstChild;if(e&&"string"==typeof e.textContent){n=r/this.calculateNewLines(e.textContent)}}}else e instanceof BoxPosition&&(s=e);this.left=s.left,this.right=s.right,this.top=s.top||a,this.height=s.height||i,this.bottom=s.bottom||a+(s.height||i),this.width=s.width||o,this.lineHeight=null!==r?r:s.lineHeight,this.singleLineHeight=null!==n?n:s.singleLineHeight,this.singleLineHeight||(this.singleLineHeight=41)}}t.BoxPosition=BoxPosition;class WebVTTRenderer{initSubtitleCSS(){const e=[new vr.VTTCue(0,0,"String to init CSS - Won't be visible to user")];this.paddedOverlay.style.opacity="0",this.processCues(e),this.processCues([]),this.paddedOverlay.style.opacity="1"}convertCueToDOMTree(e){return e?fr.default.parseContent(this.window,e,this.globalStyleCollection):null}setStyles(e){function applyStyles(e,t,r){for(const n in t)t.hasOwnProperty(n)&&(!0===r&&void 0!==e[n]||!1===r)&&(e[n]=t[n])}for(const t in e){let r=!1,n=null;"::cue"===t?(n=this.foregroundStyleOptions,r=!0):"::-webkit-media-text-track-display"===t&&(n=this.backgroundStyleOptions,r=!0);const o=e[t];if(!0===r)applyStyles(n,o,r);else for(let e=0;e<i.length;e++){const n=i[e].exec(t);if(n&&4===n.length){const e=n[2],t={};applyStyles(t,o,r),this.globalStyleCollection[e]=t}}}this.initSubtitleCSS(),this.loggingEnabled&&(console.log("WebVTTRenderer setStyles foregroundStyleOptions: "+JSON.stringify(this.foregroundStyleOptions)),console.log("WebVTTRenderer setStyles backgroundStyleOptions: "+JSON.stringify(this.backgroundStyleOptions)),console.log("WebVTTRenderer setStyles globalStyleCollection: "+JSON.stringify(this.globalStyleCollection)))}processCues(e){if(!e)return;for(;this.paddedOverlay.firstChild;)this.paddedOverlay.removeChild(this.paddedOverlay.firstChild);if(!function(e){for(let t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(e)){for(let t=0;t<e.length;t++)this.paddedOverlay.appendChild(e[t].displayState);return}const t=[],r=BoxPosition.getSimpleBoxPosition(this.paddedOverlay);e.length>1&&(e=function(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let i=e[n];if("number"!=typeof i.line)return e;r+=i.line,t.push(i)}return r/=e.length,r>50?(t.forEach((function(e){e.axis="-y"})),t.sort((e,t)=>t.line-e.line)):(t.forEach((function(e){e.axis="+y"})),t.sort((e,t)=>e.line-t.line)),t}(e));for(let n=0;n<e.length;n++){let i=e[n],o=new CueStyleBox(this.window,i,this.foregroundStyleOptions,this.backgroundStyleOptions,this.globalStyleCollection);this.paddedOverlay.appendChild(o.div),BoxPosition.moveBoxToLinePosition(o,r,t),i.displayState=o.div,t.push(BoxPosition.getSimpleBoxPosition(o))}}setSize(e,t){e&&(this.overlay.style.width=e+"px"),t&&(this.overlay.style.height=t+"px")}getOverlay(){return this.overlay}constructor(e,t,r=!0){if(!e)return null;this.window=e,this.overlay=t,this.loggingEnabled=r,this.foregroundStyleOptions={fontFamily:"Helvetica",fontSize:"36px",color:"rgba(255, 255, 255, 1)",textShadow:"",backgroundColor:"rgba(0, 0, 0, 0)"},this.backgroundStyleOptions={backgroundColor:"rgba(0, 0, 0, 0.5)"},this.globalStyleCollection={};const n=e.document.createElement("div");n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0",n.style.margin="1.5%",this.paddedOverlay=n,t.appendChild(this.paddedOverlay),this.initSubtitleCSS()}}t.default=WebVTTRenderer,t.WebVTTRenderer=WebVTTRenderer,n(mr,t)}));unwrapExports(Sr),Sr.VTTCue,Sr.WebVTTRenderer,Sr.BoxPosition,Sr.CueStyleBox,Sr.StyleBox;var Pr=createCommonjsModule((function(e,t){var r=yr&&yr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=yr&&yr.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),n(br,t),n(Sr,t)}));unwrapExports(Pr);var Er=Pr.WebVTTRenderer;function _define_property$1y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const{audioTrackAdded:Tr,audioTrackChanged:kr,forcedTextTrackChanged:wr,textTrackAdded:Or,textTrackChanged:Ir,textTrackRemoved:Ar}=rt,{textTracksSwitched:$r,textTracksUpdated:Rr,inlineStylesParsed:Cr}=Fe;class TextTrackManager{get isDestroyed(){return this._isDestroyed}get currentTrack(){return this.tracks.find(e=>"showing"===e.mode)}set currentTrack(e){if(!e)return;let t;this.trackPersistence.setPersistedTrack(e),this.extensionTracks?(xe.debug("MEDIA_TRACK Setting track on extension "+e.label),"Off"===e.label?(this.clearCurrentlyPlayingTrack(),t=this.extensionTracks.selectForcedTrack(),void 0===t&&this.onExtensionTextTrackSwitched({track:e})):this.extensionTracks.textTrack=e):(xe.debug("MEDIA_TRACK Setting track on element "+e.label),this._tracks.forEach(t=>{t!==e&&"showing"===t.mode&&(t.mode="disabled")}),e&&(xe.debug("MEDIA_TRACK setting track mode to showing for "+e.label),this.isTrackOff(e)?(this._tracks[0].mode="showing",t=this.selectNativeForcedTrack(this.mediaElement.audioTracks)):e.mode="showing")),this.dispatcher.publish(rt.forcedTextTrackChanged,t)}get tracks(){return this._tracks}destroy(){if(this._isDestroyed=!0,this.clearCurrentlyPlayingTrack(),this.extensionTracks){const e=this.extensionTracks;e.removeEventListener(Rr,this.onExtensionTextTracksAdded),e.removeEventListener($r,this.onExtensionTextTrackSwitched),e.removeEventListener(Cr,this.onExtensionInlineStylesParsed)}else this.mediaElement.textTracks.removeEventListener("addtrack",this.onTextTrackAdded),this.mediaElement.textTracks.removeEventListener("change",this.onTextTrackChanged),this.mediaElement.textTracks.removeEventListener("removetrack",this.onTextTrackRemoved),this.mediaElement.removeEventListener("playing",this.onPlayStart);this.dispatcher.unsubscribe(kr,this.onAudioTrackAddedOrChanged),this.dispatcher.unsubscribe(Tr,this.onAudioTrackAddedOrChanged)}restoreSelectedTrack(){return restoreSelectedTrack(this.trackPersistence,this)}onExtensionInlineStylesParsed(e){xe.debug("MEDIA_TRACK Extension inline styles parsed",e),this.renderer.setStyles(e.styles)}onExtensionTextTracksAdded(e){xe.debug("MEDIA_TRACK Extension text tracks updated "+JSON.stringify(e)),this._tracks.push(...e),this.restoreSelectedTrack(),this.dispatcher.publish(Or,e)}onExtensionTextTrackSwitched(e){xe.debug("MEDIA_TRACKS Extension text track switched "+e),this.handleVTT(e);const t=e.track;if(this._tracks){const preserveSelectedTrack=r=>{e.track?t.forced&&"Off"===r.label||"Off"===t.label&&"Off"===r.label?r.mode="showing":r.mode=e.track.persistentID===r.id?"showing":"disabled":r.mode="Off"===r.label?"showing":"disabled"};this._tracks.forEach(preserveSelectedTrack)}this.dispatcher.publish(Ir,e)}handleVTT(e){const t=e&&e.track&&e.track.id;if(void 0!==t&&t>=0){const e=this.filterSelectableTextTracks(this.mediaElement.textTracks)[t];this.onNativeTrackChange(e)}else this.clearCurrentlyPlayingTrack()}onAudioTrackAddedOrChanged(e,t){if(xe.debug("MEDIA_TRACKS text track manager detects audio track change"),this.shouldForceSubtitle())if(this.extensionTracks){xe.debug("MEDIA_TRACKS selecting forced text track via extension");const e=this.extensionTracks.selectForcedTrack();e?this.dispatcher.publish(wr,e):this.clearCurrentlyPlayingTrack()}else xe.debug("MEDIA_TRACKS selecting forced text track natively"),this.currentTrack=this._tracks[0]}onTextTrackAdded(e){this._tracks.push(e.track),this.dispatcher.publish(Or,e)}onPlayStart(){this.restoreSelectedTrack()}onTextTrackRemoved(e){this.dispatcher.publish(Ar,e)}onTextTrackChanged(e){const t=this.findNativeSelectedTextTrack();let r=this.trackPersistence.getPersistedTrack();if(r||(r=this._tracks[0]),t&&!trackEquals(t,r,this.trackPersistence.fields))if(this.isTrackOff(r)&&"forced"!==t.kind)this.currentTrack=r;else{const e=this.findNativeTrack(r);e&&(this.currentTrack=e)}else this.dispatcher.publish(Ir,e)}findNativeSelectedTextTrack(){for(let e=0;e<this.mediaElement.textTracks.length;e++){const t=this.mediaElement.textTracks[e];if("showing"===t.mode)return t}}findNativeTrack(e){for(let t=0;t<this.mediaElement.textTracks.length;t++){const r=this.mediaElement.textTracks[t];if(trackEquals(r,e,this.trackPersistence.fields))return r}}selectNativeForcedTrack(e){for(let t=0;t<e.length;t++){const r=e[t];if(r.enabled){const e=this.findNativeForcedTrack(r);return e&&"showing"!==e.mode&&(e.mode="showing"),e}}}findNativeForcedTrack(e){const t=this.mediaElement.textTracks;for(let r=0;r<t.length;r++){const n=t[r];if("forced"===n.kind&&n.language===e.language)return n}}onNativeTrackChange(e){this.clearCurrentlyPlayingTrack(),this._currentlyPlayingTrack=e,e.addEventListener("cuechange",this.onCueChange)}clearCurrentlyPlayingTrack(){var e;void 0!==this._currentlyPlayingTrack&&("string"==typeof(e=this._currentlyPlayingTrack).id&&"removeEventListener"in e)&&(this._currentlyPlayingTrack.removeEventListener("cuechange",this.onCueChange),this.renderer.processCues({}),delete this._currentlyPlayingTrack)}onCueChange(e){const t=e&&e.target&&e.target.activeCues;t&&this.renderer.processCues(t)}filterSelectableTextTracks(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];("captions"===n.kind||"subtitles"===n.kind||"metadata"===n.kind&&n.customTextTrackCueRenderer)&&t.push(n)}return t}shouldForceSubtitle(){xe.debug("MEDIA_TRACKS Determining whether to select forced text track");const e=this.trackPersistence.getPersistedTrack();return!e||this.isTrackOff(e)}isTrackOff(e){return"Off"===e.label||"Auto"===e.label}constructor(e,t,r){_define_property$1y(this,"mediaElement",void 0),_define_property$1y(this,"dispatcher",void 0),_define_property$1y(this,"extensionTracks",void 0),_define_property$1y(this,"_tracks",void 0),_define_property$1y(this,"trackPersistence",void 0),_define_property$1y(this,"renderer",void 0),_define_property$1y(this,"_currentlyPlayingTrack",void 0),_define_property$1y(this,"_isDestroyed",void 0),this.mediaElement=e,this.dispatcher=t,this.extensionTracks=r,this._tracks=[],this.trackPersistence=new TrackPersistence("mk-text-track",["label","language","kind"]),this._isDestroyed=!1;const n=this.trackPersistence.getPersistedTrack();if(this._tracks.push({id:-2,label:"Off",language:"",kind:"subtitles",mode:!n||this.isTrackOff(n)?"showing":"disabled"}),this.extensionTracks){xe.debug("MEDIA_TRACK Initializing text track manager for HLS.js track events");const t=e.parentElement;this.renderer=new Er(window,t,!1),this.renderer.setStyles({"::cue":{fontSize:"calc(1vw + 1em)"}}),this.onExtensionTextTracksAdded=this.onExtensionTextTracksAdded.bind(this),this.onExtensionTextTrackSwitched=this.onExtensionTextTrackSwitched.bind(this),this.onExtensionInlineStylesParsed=this.onExtensionInlineStylesParsed.bind(this),this.onCueChange=this.onCueChange.bind(this);const r=this.extensionTracks;r.addEventListener(Rr,this.onExtensionTextTracksAdded),r.addEventListener($r,this.onExtensionTextTrackSwitched),r.addEventListener(Cr,this.onExtensionInlineStylesParsed)}else xe.debug("MEDIA_TRACK Initializing text track manager for native track events"),this.onTextTrackAdded=this.onTextTrackAdded.bind(this),this.onTextTrackChanged=this.onTextTrackChanged.bind(this),this.onTextTrackRemoved=this.onTextTrackRemoved.bind(this),this.onPlayStart=this.onPlayStart.bind(this),e.textTracks.addEventListener("addtrack",this.onTextTrackAdded),e.textTracks.addEventListener("change",this.onTextTrackChanged),e.textTracks.addEventListener("removetrack",this.onTextTrackRemoved),e.addEventListener("playing",this.onPlayStart);this.onAudioTrackAddedOrChanged=debounce(this.onAudioTrackAddedOrChanged.bind(this)),t.subscribe(kr,this.onAudioTrackAddedOrChanged),t.subscribe(Tr,this.onAudioTrackAddedOrChanged)}}function asyncGeneratorStep$17(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$17(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$17(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$17(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1x(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_metadata$z(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const Mr={"picture-in-picture":e.PresentationMode.pictureinpicture,inline:e.PresentationMode.inline},Dr={};Dr[e.PresentationMode.pictureinpicture]="picture-in-picture",Dr[e.PresentationMode.inline]="inline";const{presentationModeDidChange:xr}=rt,{playbackLicenseError:Lr}=Fe,{stopped:Nr}=e.PlaybackStates;class VideoPlayer extends BasePlayer{get audioTracks(){return this._audioTrackManager.tracks}get containerElement(){return this._context.videoContainerElement?this._context.videoContainerElement:document.getElementById("apple-music-video-container")}get currentAudioTrack(){return this._audioTrackManager.currentTrack}set currentAudioTrack(e){this._audioTrackManager.currentTrack=e}get currentTextTrack(){return this._textTrackManager.currentTrack}set currentTextTrack(e){this._textTrackManager.currentTrack=e}get _targetElement(){return this.video||function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1x(e,t,r[t])}))}return e}({},document.createElement("video"))}get textTracks(){return this._textTrackManager.tracks}initializeExtension(){var e=this;return _async_to_generator$17((function*(){const{os:t}=e.services.runtime;e.restrictPlatforms&&t.isAndroid?xe.warn("videoPlayer.initializeExtension Not supported on the current platform"):e.video||xe.warn("videoPlayer.initializeExtension No video element, not initializing extension")}))()}onPlaybackLicenseError(e){this.resetDeferredPlay(),this._dispatcher.publish(Lr,e)}setupTrackManagers(e){var t,r,n,i;null===(r=this._textTrackManager)||void 0===r||null===(t=r.destroy)||void 0===t||t.call(r),this._textTrackManager=new TextTrackManager(this._targetElement,this._dispatcher,e),null===(i=this._audioTrackManager)||void 0===i||null===(n=i.destroy)||void 0===n||n.call(i),this._audioTrackManager=new AudioTrackManager(this._targetElement,this._dispatcher,e)}destroy(){this.finishPlaybackSequence(),this._textTrackManager.destroy(),this._audioTrackManager.destroy(),super.destroy()}initializeEventHandlers(){var e=this,_superprop_get_initializeEventHandlers=()=>super.initializeEventHandlers;return _async_to_generator$17((function*(){_superprop_get_initializeEventHandlers().call(e),e.hasMediaElement&&(e._targetElement.addEventListener("webkitpresentationmodechanged",e.pipEventHandler),e._targetElement.addEventListener("enterpictureinpicture",e.pipEventHandler),e._targetElement.addEventListener("leavepictureinpicture",e.pipEventHandler))}))()}removeEventHandlers(){if(super.removeEventHandlers(),!this.hasMediaElement)return;const{_targetElement:e}=this;e.removeEventListener("webkitpresentationmodechanged",this.pipEventHandler),e.removeEventListener("enterpictureinpicture",this.pipEventHandler),e.removeEventListener("leavepictureinpicture",this.pipEventHandler)}initializeMediaElement(){var e=this;return _async_to_generator$17((function*(){xe.debug("videoPlayer.initializeMediaElement Initializing media element");const t=e.containerElement;t?(e.video=function(){let e=ur.pop();return e?xe.debug(`dom-helpers: retrieving video tag, ${ur.length} remain`):(xe.debug("dom-helpers: no available video tags, creating one"),e=document.createElement("video")),e}(),e.video.autoplay=!1,e.video.controls=!1,e.video.playsInline=!0,e.video.id="apple-music-video-player",t.appendChild(e.video)):xe.warn("videoPlayer.initializeMediaElement No video element; no container defined")}))()}isPlayerSupported(){return this.services.runtime.isES2015Supported}_stopMediaElement(){var e=this,_superprop_get__stopMediaElement=()=>super._stopMediaElement;return _async_to_generator$17((function*(){yield _superprop_get__stopMediaElement().call(e),e.destroy()}))()}pipEventHandler(t){switch(t.type){case"enterpictureinpicture":this._dispatcher.publish(xr,{mode:e.PresentationMode.pictureinpicture});break;case"leavepictureinpicture":this._dispatcher.publish(xr,{mode:e.PresentationMode.inline});break;case"webkitpresentationmodechanged":{const e=this._targetElement;this._dispatcher.publish(xr,{mode:this._translateStringToPresentationMode(e.webkitPresentationMode)});break}}}playItemFromEncryptedSource(t,r=!1,n={}){var i=this;return _async_to_generator$17((function*(){if(xe.debug("videoPlayer.playItemFromEncryptedSource",t,r),i.playbackState===Nr)return void xe.debug("video-player.playItemFromEncryptedSource aborting playback because player is stopped");t.playbackType=e.PlaybackType.encryptedFull,i.nowPlayingItem=t,t.state=E.loading,i.userInitiated=r;const o=generateAssetUrl(t,n);yield i.playHlsStream(o,t,n)}))()}playItemFromUnencryptedSource(e,t,r){var n=this;return _async_to_generator$17((function*(){if(xe.debug("videoPlayer.playItemFromUnencryptedSource",e,t),n.playbackState===Nr)return void xe.debug("videoPlayer.playItemFromUnencryptedSource aborting playback because player is stopped");const[r]=e.split("?");r.endsWith("m3u")||r.endsWith("m3u8")?yield n.playHlsStream(e):yield n._playAssetURL(e,t)}))()}setPresentationMode(t){var r=this;return _async_to_generator$17((function*(){const n=r._targetElement;if(n.webkitSupportsPresentationMode&&"function"==typeof n.webkitSetPresentationMode)return n.webkitSetPresentationMode(r._translatePresentationModeToString(t));if(n.requestPictureInPicture&&document.exitPictureInPicture){if(t===e.PresentationMode.pictureinpicture)return n.requestPictureInPicture();if(t===e.PresentationMode.inline)return document.exitPictureInPicture()}}))()}_translateStringToPresentationMode(t){let r=Mr[t];return void 0===r&&(xe.warn(`videoPlayer._translateStringToPresentationMode ${t} is not a valid presentation mode, setting to inline`),r=e.PresentationMode.inline),r}_translatePresentationModeToString(e){let t=Dr[e];return void 0===t&&(xe.warn(`videoPlayer._translatePresentationModeToString ${e} is not a valid presentation mode, setting to inline`),t="inline"),t}setNextSeamlessItem(e){return _async_to_generator$17((function*(){}))()}constructor(e){super(e),_define_property$1x(this,"extension",void 0),_define_property$1x(this,"video",void 0),_define_property$1x(this,"mediaPlayerType","video"),_define_property$1x(this,"restrictPlatforms",void 0),_define_property$1x(this,"_textTrackManager",new TrackManagerStub),_define_property$1x(this,"_audioTrackManager",new TrackManagerStub),_define_property$1x(this,"_shouldLoadManifestsOnce",!1),_define_property$1x(this,"userInitiated",!1),this.restrictPlatforms=!("restrict-platforms"in Ne.features)||Ne.features["restrict-platforms"],this.pipEventHandler=this.pipEventHandler.bind(this),this._shouldLoadManifestsOnce=shouldLoadManifestOnce()}}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$z("design:type",Function),_ts_metadata$z("design:paramtypes",[void 0])],VideoPlayer.prototype,"onPlaybackLicenseError",null);const decayingOperation=(e,t,r,n=0)=>e().catch(i=>{const o=n+1;function possiblyRetry(n){if(n&&o<3){const n=1e3*o;return new Promise((i,a)=>{setTimeout(()=>{decayingOperation(e,t,r,o).then(i,a)},n)})}throw i}const a=t(i);return"boolean"==typeof a?possiblyRetry(a):a.then(possiblyRetry)});let jr={developerToken:"developerTokenNotSet",musicUserToken:"musicUserTokenNotSet",cid:"cidNotSet"};function asyncGeneratorStep$16(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$16(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$16(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$16(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$1w(e,t,r[t])}))}return e}function createHlsOffersLicenseChallengeBody(e){return{"adam-id":e.id,id:1}}function createStreamingKeysLicenseChallengeBody(e,t,r=0){var n;return _object_spread$C({id:r,"lease-action":t},null!==(n=e.keyServerQueryParameters)&&void 0!==n?n:{})}function createLicenseChallengeBody(e,t,r,n,i,o,a){let s;const c={challenge:n.challenge||d(n.licenseChallenge),"key-system":i,uri:n.keyuri};return a&&(c["extended-lease"]=a),s=r.isUTS?e.startsWith("https://play.itunes.apple.com/WebObjects/MZPlay.woa/web/video/subscription/license")?_object_spread$C({},c,function(e,t="start"){return{"extra-server-parameters":e.keyServerQueryParameters,"license-action":t}}(r,t)):{"streaming-request":{version:1,"streaming-keys":[_object_spread$C({},c,createStreamingKeysLicenseChallengeBody(r,t))]}}:r.isLiveRadioStation?_object_spread$C({},c,function(e){return{event:e.isLiveAudioStation?"beats1":"amtv"}}(r)):r.hasOffersHlsUrl?{"license-requests":[_object_spread$C({},c,createHlsOffersLicenseChallengeBody(r))]}:_object_spread$C({},c,function(e,t=!1){return{adamId:e.songId,isLibrary:e.isCloudItem,"user-initiated":t}}(r,o)),s}class License{fetch(e){const t={Authorization:"Bearer "+jr.developerToken,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+jr.musicUserToken};this.keySystem===Le.WIDEVINE&&(t["X-Apple-Renewal"]=!0);const r=new Headers(t);return decayingOperation(()=>fetch(this.licenseUrl,{method:"POST",body:JSON.stringify(e),headers:r}),e=>e instanceof TypeError,"license fetch")}reset(){this.licenseUrl=void 0,this.playableItem=void 0,this.data=void 0,this.initiated=void 0,this.keySystem=void 0,this.startResponse=void 0}start(e,t,r,n,i=!1,o=!1){var a=this;return _async_to_generator$16((function*(){a.licenseUrl=e,a.playableItem=t,a.data=r,a.keySystem=n,a.initiated=i;const s=r.isRenewalRequest?"renew":"start",c=createLicenseChallengeBody(e,s,t,r,n,i,o);t.hasOffersHlsUrl&&!a.licenseUrl.includes("start")&&(a.licenseUrl+="/"+s),a.startResponse=a.fetch(c);try{var l,d,u,p,h;const e=yield a.startResponse;if(!e.ok){let t;try{t=yield e.json()}catch(_){}a.processJsonError(t)}const t=yield e.json();let r=t;var y;return(null===(u=t)||void 0===u||null===(d=u["streaming-response"])||void 0===d||null===(l=d["streaming-keys"])||void 0===l?void 0:l.length)?r=t["streaming-response"]["streaming-keys"][0]:(null===(h=t)||void 0===h||null===(p=h["license-responses"])||void 0===p?void 0:p.length)&&(r=t["license-responses"][0]),r.status=null!==(y=r.status)&&void 0!==y?y:r.errorCode,0!==r.status&&a.processJsonError(r),r}catch(Ae){throw a.startResponse=void 0,Ae}}))()}processJsonError(e){var t,r;let n=new MKError(MKError.MEDIA_LICENSE,"Error acquiring license");if((null===(t=e)||void 0===t?void 0:t.errorCode)&&(e.status=e.errorCode),-1021===(null===(r=e)||void 0===r?void 0:r.status)&&(e.status=190121),e&&0!==e.status){if(!e.message)switch(e.status){case-1004:e.message=MKError.DEVICE_LIMIT;break;case-1017:e.message=MKError.GEO_BLOCK;break;default:e.message=MKError.MEDIA_LICENSE}n=MKError.serverError(e),n.data=e,n.errorCode===MKError.PLAYREADY_CBC_ENCRYPTION_ERROR&&function(){const e=getSessionStorage();e&&e.setItem("mk-playready-cbcs-unsupported","true")}()}throw n}stop(){var e=this;return _async_to_generator$16((function*(){if(e.startResponse)try{yield e.startResponse}catch(Ae){}if(!e.playableItem||!e.data||!e.licenseUrl)return;if(!e.playableItem.isUTS)return;const t=createLicenseChallengeBody(e.licenseUrl,"stop",e.playableItem,e.data,e.keySystem,e.initiated),r=e.fetch(t);e.reset();try{yield r}catch(Ae){xe.warn("license.stop request error",Ae)}}))()}constructor(){_define_property$1w(this,"licenseUrl",void 0),_define_property$1w(this,"playableItem",void 0),_define_property$1w(this,"data",void 0),_define_property$1w(this,"initiated",void 0),_define_property$1w(this,"keySystem",void 0),_define_property$1w(this,"startResponse",void 0)}}function asyncGeneratorStep$15(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$15(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$15(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$15(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_metadata$y(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}class KeySession extends Notifications{get extID(){if(this.extURI)return this.extURI.replace("data:;base64,","")}get isFairplay(){return this.keySystem===Le.FAIRPLAY}get isPlayReady(){return this.keySystem===Le.PLAYREADY}get isWidevine(){return this.keySystem===Le.WIDEVINE}acquirePlaybackLicense(e,t,r,n){var i=this;return _async_to_generator$15((function*(){if(!i.keyServerURL||!i.developerToken||!i.userToken)return;const{keyServerURL:r,keySystem:o}=i,a=n.item;try{return yield i.license.start(r,a,{challenge:t,keyuri:e},o,i.initiated,i.isLegacyEme&&a.isUTS)}catch(s){i.dispatchEvent(Fe.playbackLicenseError,s)}}))()}startLicenseSession(e){var t=this;return _async_to_generator$15((function*(){let r;xe.debug("Starting License Session",e);const{message:n,target:i,messageType:o}=e;if(t.keySystem!==Le.FAIRPLAY&&"license-request"!==o)return void xe.debug("not making license request for",o);if(t.isPlayReady){const e=String.fromCharCode.apply(null,new Uint16Array(n.buffer||n));r=(new DOMParser).parseFromString(e,"application/xml").getElementsByTagName("Challenge")[0].childNodes[0].nodeValue}else r=d(new Uint8Array(n));const a=i.extURI||t.extURI,s=t.mediaKeySessions[a];if(!s)return void xe.debug("no key session info, aborting license request");const c=t.acquirePlaybackLicense(a,r,t.initiated,s);if(s.delayCdmUpdate)s["license-json"]=c;else{const e=yield c;yield t.handleLicenseJson(e,i,a)}}))()}setKeyURLs(e){this.keyCertURL=e[this.isFairplay?"hls-key-cert-url":"widevine-cert-url"],this.keyServerURL=e["hls-key-server-url"]}dispatchKeyError(e){var t,r,n;this.isFairplay&&4294955417===(null===(n=e)||void 0===n||null===(r=n.target)||void 0===r||null===(t=r.error)||void 0===t?void 0:t.systemCode)?xe.error("Ignoring error",e):(console.error(MKError.MEDIA_KEY+" error in dispatchKeyError:",e),this.dispatchEvent(Fe.playbackSessionError,new MKError(MKError.MEDIA_KEY,e)))}dispatchSessionError(e){this.dispatchEvent(Fe.playbackSessionError,new MKError(MKError.MEDIA_SESSION,e))}loadCertificateBuffer(){var e=this;return _async_to_generator$15((function*(){if(!e.keyCertURL)return Promise.reject(new MKError(MKError.MEDIA_SESSION,"No certificate URL"));let t;try{t=yield fetch(`${e.keyCertURL}?t=${Date.now()}`)}catch(Ae){throw e.dispatchKeyError(Ae),Ae}const r=yield t.arrayBuffer(),n=String.fromCharCode.apply(String,new Uint8Array(r));return/^\<\?xml/.test(n)?Promise.reject(new MKError(MKError.MEDIA_CERTIFICATE,"Invalid certificate.")):r}))()}handleSessionCreation(e){var t=this;return _async_to_generator$15((function*(){return t.createSession(e).catch(e=>{t.dispatchSessionError(e)})}))()}handleLicenseJson(e,t,r){var n=this;return _async_to_generator$15((function*(){var i;if(xe.debug(`updating session ${r} with license response`,e),null===(i=e)||void 0===i?void 0:i.license){const r=s(e.license);try{yield t.update(r)}catch(o){xe.error("Failed to updated media keys",o),n.dispatchKeyError(o)}}}))()}addMediaKeySessionInfo(e,t,r,n=!1){const i=this.mediaKeySessions[e];i?(xe.debug(`keySession info exists for ${r.title}, making existing session ${i.session.sessionId} the old session`),i.oldSession=i.session,i.session=t):(xe.debug("creating key session info for "+r.title),this.mediaKeySessions[e]={session:t,item:r,delayCdmUpdate:n})}stopLicenseSession(){xe.info("key session sending license stop"),this.license.stop()}constructor(){super([Fe.playbackLicenseError,Fe.playbackSessionError]),_define_property$1v(this,"developerToken",void 0),_define_property$1v(this,"adamId",void 0),_define_property$1v(this,"userToken",void 0),_define_property$1v(this,"extURI",void 0),_define_property$1v(this,"item",void 0),_define_property$1v(this,"initiated",!0),_define_property$1v(this,"isLibrary",!1),_define_property$1v(this,"keyCertURL",void 0),_define_property$1v(this,"keyServerURL",void 0),_define_property$1v(this,"keySystem",Le.FAIRPLAY),_define_property$1v(this,"isLegacyEme",!1),_define_property$1v(this,"boundDispatchKeyError",void 0),_define_property$1v(this,"boundDispatchSessionError",void 0),_define_property$1v(this,"boundHandleSessionCreation",void 0),_define_property$1v(this,"boundStartLicenseSession",void 0),_define_property$1v(this,"mediaKeySessions",{}),_define_property$1v(this,"_pendingRenewal",void 0),_define_property$1v(this,"license",void 0),this.boundDispatchKeyError=this.dispatchKeyError.bind(this),this.boundDispatchSessionError=this.dispatchSessionError.bind(this),this.boundHandleSessionCreation=this.handleSessionCreation.bind(this),this.boundStartLicenseSession=this.startLicenseSession.bind(this),this.license=new License}}function asyncGeneratorStep$14(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$14(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$14(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$14(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_metadata$x(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$y("design:type",Function),_ts_metadata$y("design:paramtypes",[void 0])],KeySession.prototype,"startLicenseSession",null);class FairplayEncryptedSession extends KeySession{attachMedia(e,t){var r=this;return _async_to_generator$14((function*(){r.keySystem=t.keySystem,r._keySystemAccess=t,e.addEventListener("encrypted",r.boundHandleSessionCreation,!1)}))()}detachMedia(e){e.removeEventListener("encrypted",this.boundHandleSessionCreation);const t=this._mediaKeySessions,r=this._mediaKeySessionRenewals;Object.values(t).forEach(e=>{e.removeEventListener("message",this.boundStartLicenseSession),asAsync(e.close())}),this._mediaKeySessions={},Object.values(r).forEach(e=>clearTimeout(e)),this._mediaKeySessionRenewals={}}createSession(e){var t=this;return _async_to_generator$14((function*(){xe.debug("fairplay eme:  createSession",e);const r=t._keySystemAccess;if(!r)return;const{initData:n,target:i,initDataType:o}=e;t._mediaKeysPromise||(t._mediaKeysPromise=new Promise(function(){var e=_async_to_generator$14((function*(e,n){const o=yield r.createMediaKeys();try{yield i.setMediaKeys(o),t._mediaKeys=o;const e=yield t.loadCertificateBuffer();yield o.setServerCertificate(e)}catch(Ae){t.dispatchKeyError(Ae),n(Ae)}e(o)}));return function(t,r){return e.apply(this,arguments)}}()));const a=yield t._mediaKeysPromise,s=new Uint8Array(n),c=String.fromCharCode.apply(void 0,Array.from(s));if(t.mediaKeySessions[c])return void xe.error("fairplay eme: not creating new session for extURI",c);const l=a.createSession();xe.debug("fairplay eme: creating new key session for",c),t.addMediaKeySessionInfo(c,l,t.item),l.addEventListener("message",t.startFairplayLicenseSession),l.extURI=c,yield l.generateRequest(o,n),t._mediaKeySessions[l.sessionId]=l,xe.debug("fairplay eme: created session",l)}))()}startFairplayLicenseSession(e){const{message:t,target:r}=e,n=d(new Uint8Array(t)),i=r.extURI||this.extURI,o=this.mediaKeySessions[i];if(o)return this.acquirePlaybackLicense(i,n,this.initiated,o).then(e=>this.handleLicenseJson(e,r,i));xe.debug("fairplay eme: no key session info, aborting license request",i)}handleLicenseJson(e,t,r){var n=this,_superprop_get_handleLicenseJson=()=>super.handleLicenseJson;return _async_to_generator$14((function*(){if(!e)return;const i=n.mediaKeySessions[r];if(!i)return void xe.debug("fairplay eme: media key session does not exist, not updating");const o=e["renew-after"];if(e.license&&o){xe.debug("fairplay eme: got renew after value",o,r);const e=n._mediaKeySessionRenewals,a=e[t.sessionId];a&&clearTimeout(a),e[t.sessionId]=setTimeout(()=>n._renewMediaKeySession(i,r),1e3*o)}yield _superprop_get_handleLicenseJson().call(n,e,t,r)}))()}_renewMediaKeySession(e,t){delete this._mediaKeySessionRenewals[e.session.sessionId],xe.debug("fairplay eme: renewing session",e),e.session.update(c("renew"))}applyDelayedCdmUpdates(){}loadKeys(e){return _async_to_generator$14((function*(){}))()}clearSessions(){return _async_to_generator$14((function*(){}))()}constructor(...e){super(...e),_define_property$1u(this,"_keySystemAccess",void 0),_define_property$1u(this,"_mediaKeysPromise",void 0),_define_property$1u(this,"_mediaKeySessions",{}),_define_property$1u(this,"_mediaKeySessionRenewals",{}),_define_property$1u(this,"_mediaKeys",void 0)}}function asyncGeneratorStep$13(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$13(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$13(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$13(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$x("design:type",Function),_ts_metadata$x("design:paramtypes",[void 0])],FairplayEncryptedSession.prototype,"startFairplayLicenseSession",null);const Ur=/^(?:.*)(skd:\/\/.+)$/i;class WebKitSession extends KeySession{get isDestroyed(){return this._isDestroyed}attachMedia(e,t){return this.target=e,e.addEventListener("webkitneedkey",this.boundHandleSessionCreation,!1),e.addEventListener("webkitkeyerror",this.boundDispatchKeyError),e}detachMedia(e){e&&(e.removeEventListener("webkitneedkey",this.boundHandleSessionCreation,!1),e.removeEventListener("webkitkeyerror",this.boundDispatchKeyError))}destroy(){xe.debug("FPS destroy"),this._isDestroyed=!0,this.detachMedia(this.target),this.session&&(this.session.removeEventListener("webkitkeyerror",this.boundDispatchKeyError),this.session.removeEventListener("webkitkeymessage",this.boundStartLicenseSession))}createSession(e){xe.debug("FPS createSession",e);const{initData:t,target:r}=e,{item:n}=this;if(!n)return xe.error("Cannot createSession without item"),Promise.resolve();const i=this._extractAssetId(t);if(xe.debug("extURI",i),!r.webkitKeys&&window.WebKitMediaKeys){const e=new window.WebKitMediaKeys(this.keySystem);r.webkitSetMediaKeys(e)}return this.loadCertificateBuffer().then(e=>{const o=this._concatInitDataIdAndCertificate(t,i,e),a="VIDEO"===r.tagName?Be.AVC1:Be.MP4,s=r.webkitKeys.createSession(a,o);this.addMediaKeySessionInfo(i,s,n),this.session=s,s.extURI=i,s.addEventListener("webkitkeyerror",this.boundDispatchKeyError),s.addEventListener("webkitkeymessage",this.boundStartLicenseSession)})}_extractAssetId(e){let t=String.fromCharCode.apply(null,new Uint16Array(e.buffer||e));const r=t.match(Ur);return r&&r.length>=2&&(t=r[1]),xe.debug("Extracted assetId from EXT-X-KEY URI",t),t}_concatInitDataIdAndCertificate(e,t,r){"string"==typeof t&&(t=l(t)),r=new Uint8Array(r);let n=0;const i=new ArrayBuffer(e.byteLength+4+t.byteLength+4+r.byteLength),o=new DataView(i);new Uint8Array(i,n,e.byteLength).set(e),n+=e.byteLength,o.setUint32(n,t.byteLength,!0),n+=4;const a=new Uint8Array(i,n,t.byteLength);a.set(t),n+=a.byteLength,o.setUint32(n,r.byteLength,!0),n+=4;return new Uint8Array(i,n,r.byteLength).set(r),new Uint8Array(i,0,i.byteLength)}applyDelayedCdmUpdates(){}loadKeys(e){return _async_to_generator$13((function*(){}))()}clearSessions(){return _async_to_generator$13((function*(){}))()}constructor(...e){super(...e),_define_property$1t(this,"target",void 0),_define_property$1t(this,"session",void 0),_define_property$1t(this,"_isDestroyed",!1),_define_property$1t(this,"isLegacyEme",!0)}}function asyncGeneratorStep$12(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$12(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$12(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$12(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}class MSSession extends KeySession{attachMedia(e,t){return this.keySystem=t.keySystem,e.addEventListener("msneedkey",this.boundHandleSessionCreation,!1),e.addEventListener("mskeyerror",this.boundDispatchKeyError),e}detachMedia(e){e.removeEventListener("msneedkey",this.boundHandleSessionCreation,!1),e.removeEventListener("mskeyerror",this.boundDispatchKeyError)}createSession(e){const{initData:t,target:r}=e;if(!r.msKeys){const e=new MSMediaKeys(this.keySystem);r.msSetMediaKeys(e)}const n=r.msKeys.createSession(Be.MP4,t);return n.addEventListener("mskeyerror",this.dispatchKeyError),n.addEventListener("mskeymessage",this.startLicenseSession.bind(this)),n}applyDelayedCdmUpdates(){}loadKeys(e){return _async_to_generator$12((function*(){}))()}clearSessions(){return _async_to_generator$12((function*(){}))()}}const Fr={[Le.WIDEVINE]:Ke.WIDEVINE,[Le.FAIRPLAY]:Ke.FAIRPLAY,[Le.PLAYREADY]:Ke.PLAYREADY},Br=[0,0,1,222,112,115,115,104,0,0,0,0,154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149,0,0,1,190],Kr=[190,1,0,0,1,0,1,0,180,1];function concatenate(e,...t){let r=0;for(const o of t)r+=o.length;const n=new e(r);let i=0;for(const o of t)n.set(o,i),i+=o.length;return n}const{WIDEVINE:Vr,PLAYREADY:Gr}=Le,Hr={};Hr[Vr]=e=>{xe.debug("generating Widevine pssh for keyId");const t=new Uint8Array([0,0,0,52,112,115,115,104,0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,20,8,1,18,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let r=0;r<e.length;r++)t[t.length-16+r]=e[r];return xe.debug("generatePSSH",t),t},Hr[Gr]=e=>{xe.debug("generating Playready pssh for keyId"),(e=>{const swap=(e,t,r)=>{const n=e[t];e[t]=e[r],e[r]=n};swap(e,0,3),swap(e,1,2),swap(e,4,5),swap(e,6,7)})(e);const t=d(e),r='<WRMHEADER xmlns="http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader" version="4.3.0.0"><DATA><PROTECTINFO><KIDS><KID ALGID="AESCTR" VALUE="[KEYID]"></KID></KIDS></PROTECTINFO></DATA></WRMHEADER>'.replace("[KEYID]",t),n=l(r),i=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);return concatenate(Uint8Array,Br,Kr,i)};function asyncGeneratorStep$11(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$11(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$11(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$11(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class PreloadingEncryptedSession extends KeySession{attachMedia(e,t){this.keySystem=t.keySystem,this._keySystemAccess=t,this._target=e}detachMedia(){asAsync(this.clearSessions())}createSession(e){return _async_to_generator$11((function*(){}))()}_mediaKeysSetup(){var e=this;return _async_to_generator$11((function*(){const t=e._keySystemAccess;t&&(e._mediaKeysPromise||(e._mediaKeysPromise=new Promise(function(){var r=_async_to_generator$11((function*(r,n){const i=yield t.createMediaKeys();try{var o;yield null===(o=e._target)||void 0===o?void 0:o.setMediaKeys(i),e._mediaKeys=i}catch(Ae){e.dispatchKeyError(Ae),n(Ae)}if(e.isWidevine){const t=yield e.loadCertificateBuffer();yield i.setServerCertificate(t)}r(i)}));return function(e,t){return r.apply(this,arguments)}}())),yield e._mediaKeysPromise)}))()}createSessionAndGenerateRequest(e,t,r){var n=this;return _async_to_generator$11((function*(){var i,o,a;const c=!!(null===(i=r)||void 0===i?void 0:i.isRenewal),l=!!(null===(o=r)||void 0===o?void 0:o.delayCdmUpdate);if(!c&&n.mediaKeySessions[e])return;xe.debug(`createSessionAndGenerateRequest for item ${t.title}, isRenewal ${c}`);const u=null===(a=n._mediaKeys)||void 0===a?void 0:a.createSession(),{keySystem:p}=n;if(!u)return;n.addMediaKeySessionInfo(e,u,t,l);const h=(e=>{if(e.includes("data")){const[t,r]=e.split(",");return r}return e})(e),y=s(h),_=n.isWidevine&&t.isSong||16===y.length;let f;var v;return xe.debug("extracted uri",e),n.isPlayReady&&!_?(xe.debug("handling Playready object"),u.extURI=e,v=y,f=concatenate(Uint8Array,new Uint8Array(Br),v)):_?(xe.debug("handling keyId only initData"),u.extURI="data:;base64,"+d(y),f=((e,t)=>{const r=Hr[t];if(!r)return xe.warn("No pssh generator for ",t),e;return r(Uint8Array.from(e))})(y,p)):(xe.debug("handling pssh initData"),u.extURI=e,f=y),u.addEventListener("message",n.startLicenseSession),u.generateRequest("cenc",f).catch(e=>{if(e.message.match(/generateRequest.*\(75\)/))return u.generateRequest("cenc",f);throw e})}))()}handleLicenseJson(e,t,r){var n=this,_superprop_get_handleLicenseJson=()=>super.handleLicenseJson;return _async_to_generator$11((function*(){var i;if(!e)return;const o=n.mediaKeySessions[r];if(!o)return void xe.debug("media key session does not exist, not updating");const a=e["renew-after"];if(e.license&&a){xe.debug("Got renew after value",a,r);const e=n._mediaKeySessionRenewals,i=e[t.sessionId];i&&clearTimeout(i),e[t.sessionId]=setTimeout(()=>n._renewMediaKeySession(o,r),1e3*a)}yield _superprop_get_handleLicenseJson().call(n,e,t,r);const s=null===(i=n.mediaKeySessions[r])||void 0===i?void 0:i.oldSession;s&&(xe.debug("removing old key session after updating",r),yield n._removeAndCloseSession(s),delete n.mediaKeySessions[r].oldSession,delete n._mediaKeySessionRenewals[s.sessionId])}))()}_renewMediaKeySession(e,t){delete this._mediaKeySessionRenewals[e.session.sessionId],asAsync(this.createSessionAndGenerateRequest(t,e.item,{isRenewal:!0}))}applyDelayedCdmUpdates(){var e=this;return _async_to_generator$11((function*(){xe.debug("applying delayed CDM updates");const t=Object.entries(e.mediaKeySessions);for(const r of t){const[t,n]=r;if(n.delayCdmUpdate){const r=yield n["license-json"];xe.debug("delayed update of license",r),n.delayCdmUpdate=!1,yield e.handleLicenseJson(r,n.session,t)}}}))()}loadKeys(e,t,r){var n=this;return _async_to_generator$11((function*(){var i;yield n._mediaKeysSetup();const o=n.filterKeyValues(e);for(const e of o){const{dataUri:i}=e;yield n.createSessionAndGenerateRequest(i,t,r)}if(null===(i=t)||void 0===i?void 0:i.isLiveAudioStation){const e=Object.keys(n.mediaKeySessions),t=o.reduce((e,t)=>(e[t.dataUri]=!0,e),{});for(const r of e)t[r]||(yield n._scheduleRemoveSession(r))}}))()}filterKeyValues(e){let t;if(1===e.length)t=e;else{const r=Fr[this.keySystem];t=e.filter(e=>e.keyFormat===r)}return t}clearSessions(e){var t=this;return _async_to_generator$11((function*(){var r;const n=t.mediaKeySessions;if(null===(r=e)||void 0===r?void 0:r.length){const r=t.filterKeyValues(e);for(const e of r){const r=e.dataUri;clearTimeout(t._sessionRemovalTimeouts[r]),yield t._removeSessionImmediately(r)}}else{Object.values(t._sessionRemovalTimeouts).forEach(e=>clearTimeout(e)),xe.debug("clearing key sessions",n);for(const e of Object.keys(n))yield t._removeSessionImmediately(e)}}))()}_scheduleRemoveSession(e){var t=this;return _async_to_generator$11((function*(){if(!t.mediaKeySessions[e])return void xe.warn("no session for dataUri, not scheduling remove",e);if(t._sessionRemovalTimeouts[e])return;const r=setTimeout(()=>{asAsync(t._removeSessionImmediately(e))},6e4);xe.debug("deferring removal of keysession for dataUri",e),t._sessionRemovalTimeouts[e]=r}))()}_removeSessionImmediately(e){var t=this;return _async_to_generator$11((function*(){const r=t.mediaKeySessions[e];if(!r)return void xe.warn("no session for dataUri, not removing",e);xe.debug("removing keysession for",e);const{session:n,oldSession:i}=r;t._clearSessionRenewal(n),delete t.mediaKeySessions[e],yield t._removeAndCloseSession(n),i&&(yield t._removeAndCloseSession(i))}))()}_removeAndCloseSession(e){var t=this;return _async_to_generator$11((function*(){e.removeEventListener("message",t.startLicenseSession),xe.debug("tearing down session",e.sessionId);try{yield e.remove()}catch(r){xe.warn("Error invoking session.remove()",r)}finally{try{yield e.close()}catch(r){xe.warn("Error invoking session.close()",r)}}}))()}_clearSessionRenewal(e){const t=this._mediaKeySessionRenewals[e.sessionId];t&&(xe.debug("clearing scheduled license renewal for session",e.sessionId),clearTimeout(t),delete this._mediaKeySessionRenewals[e.sessionId])}constructor(...e){super(...e),_define_property$1s(this,"_keySystemAccess",void 0),_define_property$1s(this,"_mediaKeysPromise",void 0),_define_property$1s(this,"_mediaKeys",void 0),_define_property$1s(this,"_target",void 0),_define_property$1s(this,"_sessionRemovalTimeouts",{}),_define_property$1s(this,"_mediaKeySessionRenewals",{})}}function asyncGeneratorStep$10(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$10(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$10(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$10(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Wr=BooleanDevFlag.register("mk-safari-modern-eme");class MediaExtension extends Notifications{get hasMediaKeySupport(){return hasMediaKeySupport()}get hasMediaSession(){return void 0!==this._session}get isFairplay(){return this._session.isFairplay}set extURI(e){this._session.extURI=e}set initiated(e){this._session.initiated=e}get session(){return this._session}clearSessions(e){var t=this;return _async_to_generator$10((function*(){var r;return null===(r=t.session)||void 0===r?void 0:r.clearSessions(e)}))()}initializeKeySystem(){var e=this;return _async_to_generator$10((function*(){yield e._attachSession();const{_session:t}=e;t&&[Fe.playbackLicenseError,Fe.playbackSessionError].forEach(r=>{t.addEventListener(r,t=>{e.dispatchEvent(r,t)})})}))()}_requestModernFairplayAccess(){var e=this;return _async_to_generator$10((function*(){const{contentType:t}=e,r=[{initDataTypes:["skd"],audioCapabilities:[{contentType:t,robustness:""}],videoCapabilities:[{contentType:t,robustness:""}],distinctiveIdentifier:"not-allowed",persistentState:"not-allowed",sessionTypes:["temporary"]}],[,n]=yield findMediaKeySystemAccess([Le.FAIRPLAY],r);return n}))()}_attachSession(){var e=this;return _async_to_generator$10((function*(){var t,r;const{mediaElement:n,contentType:i}=e;if(null===(t=window.WebKitMediaKeys)||void 0===t?void 0:t.isTypeSupported(Le.FAIRPLAY+".1_0",Be.MP4)){let t;Wr.enabled&&e.hasMediaKeySupport&&(t=yield e._requestModernFairplayAccess()),t?(xe.warn("media-extension: Using Fairplay modern EME"),e._session=new FairplayEncryptedSession,e._session.attachMedia(n,t)):(xe.warn("media-extension: Using Fairplay legacy EME"),e._session=new WebKitSession,e._session.attachMedia(n,{keySystem:Le.FAIRPLAY}))}else if(null===(r=window.MSMediaKeys)||void 0===r?void 0:r.isTypeSupported(Le.PLAYREADY,Be.MP4))e._session=new MSSession,e._session.attachMedia(n,{keySystem:Le.PLAYREADY});else if(e.hasMediaKeySupport&&n.canPlayType(i)){e._session=new PreloadingEncryptedSession;const t=[{initDataTypes:["cenc","keyids"],audioCapabilities:[{contentType:i}],distinctiveIdentifier:"optional",persistentState:"required"}],r=potentialKeySystemsForAccess(),[,a]=yield findMediaKeySystemAccess(r,t);var o;if(a)null===(o=e._session)||void 0===o||o.attachMedia(n,a);else xe.warn("media-extension: No keysystem detected!")}}))()}setMediaItem(e){!function(e,t){t.keyURLs&&(e.developerToken=jr.developerToken,e.userToken=jr.musicUserToken,e.item=t,e.adamId=t.songId,e.isLibrary=t.isCloudItem,e.setKeyURLs(t.keyURLs))}(this._session,e)}destroy(e){var t;null===(t=this._session)||void 0===t||t.detachMedia(e)}constructor(e,t){super([Fe.playbackLicenseError,Fe.playbackSessionError]),_define_property$1r(this,"_session",void 0),_define_property$1r(this,"mediaElement",void 0),_define_property$1r(this,"contentType",void 0),this.mediaElement=e,this.contentType=t}}const qr=BooleanDevFlag.register("mk-force-audio-mse"),shouldForceAudioMse=()=>qr.enabled;function asyncGeneratorStep$$(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$1q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ByteRangeSegment{load(){var e,t=this;return(e=function*(){const{url:e,range:r}=t;if(!e)return new Uint8Array;const n=new Headers;n.append("Range",r);const i=yield fetch(e,{headers:n}),o=yield i.arrayBuffer();return new Uint8Array(o)},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$$(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$$(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor({url:e,startByte:t,length:r,isInitSegment:n=!1}){_define_property$1q(this,"url",void 0),_define_property$1q(this,"range",void 0),_define_property$1q(this,"startByte",void 0),_define_property$1q(this,"endByte",void 0),_define_property$1q(this,"length",void 0),_define_property$1q(this,"startTime",void 0),_define_property$1q(this,"endTime",void 0),_define_property$1q(this,"isInitSegment",void 0),this.url=e,this.isInitSegment=n,this.startByte=parseInt(t,10),this.length=parseInt(r,10),this.endByte=this.startByte+this.length-1,this.range=`bytes=${this.startByte}-${this.endByte}`}}function asyncGeneratorStep$_(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$1p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ContinuousSegment{load(){var e,t=this;return(e=function*(){const{url:e}=t;if(!e)return new Uint8Array;const r=yield fetch(e),n=yield r.arrayBuffer();return new Uint8Array(n)},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$_(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$_(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,t=!1){_define_property$1p(this,"url",void 0),_define_property$1p(this,"isInitSegment",void 0),this.url=e,this.isInitSegment=t}}function _define_property$1o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const zr=/^#EXT-X-BYTERANGE:([^\n]+)\n/gim,Yr=/^#EXT-X-MAP:([^\n]+)\n/im,Qr=/#EXTINF:\d*\.\d*\,[\n](.+)|^#EXT-X-MAP:URI="([^"]*)"/gim,Jr=/#EXTINF:\d*\.\d*,\s*#EXT-X-BITRATE:\d{1,3}[\n](.+)|^#EXT-X-MAP:URI="([^"]*)"/gim;class SegmentList{get segments(){return this._segments}addSegment(e,t){this._addedSegments[t]||(xe.debug("Adding segment",t),this._segments.push(e),this._addedSegments[t]=!0)}extractLiveRadioSegments(e,t){this._extractContinuousSegments(Qr,e,t)}extractHlsOffersSegments(e,t){this._extractContinuousSegments(Jr,e,t)}_extractContinuousSegments(e,t,r){if(!t||!e.test(t))return;let n;for(e.lastIndex=0;n=e.exec(t);){const e=n[0].startsWith("#EXT-X-MAP")?n[2]:n[1],t=rewriteLastUrlPath(r,e),i=n[0].startsWith("#EXT-X-MAP");this.addSegment(new ContinuousSegment(t,i),e)}}extractByteRangeSegments(e,t){if(!e||!zr.test(e))return;const r=function(e){if(!e||!Yr.test(e))return;const[,t]=e.match(Yr);return t.split(",").reduce((e,t)=>{const[r,n]=t.split("=");return e[r.toLowerCase()]=n.replace(/\"/gi,""),e},{})}(e);var n;const i=null!==(n=t.split("/").pop())&&void 0!==n?n:"",o=t.replace(i,r.uri),[a,s]=r.byterange.split("@"),c=new ByteRangeSegment({url:o,startByte:s,length:a});var l;this.addSegment(c,c.range),(null!==(l=e.match(zr))&&void 0!==l?l:[]).forEach(e=>{const[,t,r]=e.match(/^#EXT-X-BYTERANGE:(\d+)@(\d+)\n/),n=new ByteRangeSegment({url:o,startByte:r,length:t});this.addSegment(n,n.range)})}constructor(){_define_property$1o(this,"_segments",[]),_define_property$1o(this,"_addedSegments",{})}}var Xr;function asyncGeneratorStep$Z(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$Z(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$Z(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$Z(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_metadata$w(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e){e.keysParsed="keysParsed"}(Xr||(Xr={}));const Zr=/^#EXT-X-TARGETDURATION:(\d+)/im,en=/^#EXT-X-KEY:[^\n]+URI="([^"]+)"/im,tn=/^#EXT-X-KEY:[^\n]+URI="([^"]+)",KEYFORMAT="([^"]+)"/gim;function loadManifestData(e){return _loadManifestData.apply(this,arguments)}function _loadManifestData(){return(_loadManifestData=_async_to_generator$Z((function*(e){return(yield fetch(e)).text()}))).apply(this,arguments)}class Manifest extends Notifications{parse(){const e=this._item,t=this._data;if(Ve!==Le.FAIRPLAY||shouldForceAudioMse())if(this._detectKeyTags(),e.hasOffersHlsUrl)this._segmentList.extractHlsOffersSegments(t,e.assetURL);else if(e.isLiveRadioStation){this._segmentList.extractLiveRadioSegments(t,e.assetURL);const[,r]=this._data.match(Zr);xe.debug(`manifest: setting up manifest refresh interval at ${r} seconds`);const n=1e3*parseInt(r,10);this._manifestRefreshInterval=setInterval(this.liveRadioRefresh,n)}else this._segmentList.extractByteRangeSegments(t,e.assetURL)}static load(e,t=!0){var r=this;return _async_to_generator$Z((function*(){var n;xe.debug("loading manifest for item",e.title);const i=e.assetURL;let o;const a=getSessionStorage(),s=!!a&&t;var c;if(s&&(o=null===(c=a)||void 0===c?void 0:c.getItem(i),o))return new r(o,e);const l=(new Date).getTime();o=yield loadManifestData(i);const d=new r(o,e);return d.downlink=function(e,t){return 8*t.length/(((new Date).getTime()-e)/1e3)/1024}(l,o),s&&(null===(n=a)||void 0===n||n.setItem(i,o)),Promise.resolve(d)}))()}get downlink(){return this._downlink}set downlink(e){this._downlink=e}get mediaItem(){return this._item}liveRadioRefresh(){var e=this;return _async_to_generator$Z((function*(){const t=yield loadManifestData(e._url);e._data=t,e._detectKeyTags(),e._segmentList.extractLiveRadioSegments(t,e._url),e.dispatchEvent(Fe.manifestParsed)}))()}segmentsForTimeRange(e){const t=Math.floor(e.start/10)+1,r=Math.floor(e.end/10)+1,{segments:n}=this;return[n[0],...n.slice(t,r+1)]}get segments(){return this._segmentList.segments}get extURI(){if(!this._extURI){const e=this._data.match(en);xe.debug("manifest: EXT_X_KEY_URI matches",e),this._extURI=e&&e[1]||void 0}return this._extURI}get keyValues(){let e=this._modernKeys;return e.length||(e=this._legacyKeys),e}_detectKeyTags(){const e=this.keyValues;e.length&&this.dispatchEvent(Xr.keysParsed,{item:this.mediaItem,keys:e})}get _legacyKeys(){const e=this._data.match(en);xe.debug("manifest: EXT_X_KEY_URI matches",e);const t=e&&e[1]||void 0;this._extURI=t;const r=[];return t&&r.push({keyFormat:Ke.WIDEVINE,dataUri:t}),r}get _modernKeys(){let e;tn.lastIndex=0;const t=[];for(;e=tn.exec(this._data);){const[r,n,i]=e;t.push({keyFormat:i,dataUri:n})}return t}stop(){this._manifestRefreshInterval&&clearInterval(this._manifestRefreshInterval)}constructor(e,t){super([Fe.manifestParsed,Xr.keysParsed]),_define_property$1n(this,"_data",void 0),_define_property$1n(this,"_downlink",0),_define_property$1n(this,"_extURI",void 0),_define_property$1n(this,"_url",void 0),_define_property$1n(this,"_item",void 0),_define_property$1n(this,"_segmentList",new SegmentList),_define_property$1n(this,"_manifestRefreshInterval",void 0),this._data=e,this._item=t,this._url=t.assetURL}}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$w("design:type",Function),_ts_metadata$w("design:paramtypes",[])],Manifest.prototype,"liveRadioRefresh",null);const rn="seamlessAudioTransition",nn="bufferTimedMetadataDidChange",on="loadSegmentError",an=isNodeEnvironment$1()?require("util").TextDecoder:self.TextDecoder;function encodedArrayToString(e,t="utf-8"){if("iso-8859-1"===t)return String.fromCharCode(...e);return new an(t).decode(e)}function readNullTerminatedString(e,t=0,r){const n=[];r=null!=r?r:e.length;for(let i=t;i<r;i++){const t=e[i];if("\0"===String.fromCharCode(t))break;n.push(String.fromCharCode(t))}return[n.join(""),n.length]}function isBitAtPositionOn(e,t){return 0!=(e&1<<t)}function _define_property$1m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class BaseMp4Box{get size(){return this.end-this.start}get rawBytes(){return this.data.slice(this.start,this.end)}constructor(e,t,r,n){_define_property$1m(this,"id",void 0),_define_property$1m(this,"data",void 0),_define_property$1m(this,"start",void 0),_define_property$1m(this,"end",void 0),this.id=e,this.data=t,this.start=r,this.end=n}}const sn=[237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237];class PsshBox extends BaseMp4Box{get systemId(){const{data:e,start:t}=this,r=t+12;return e.slice(r,r+16)}get dataSize(){return this.view.getUint32(28)}get psshData(){const{data:e,start:t,dataSize:r}=this,n=t+32;return e.slice(n,n+r)}get keyBytes(){const{psshData:e}=this;return e.slice(2,18)}get isWidevine(){return arrayEquals(this.systemId,sn)}constructor(e,t,r){var n,i,o;super("pssh",e,t,r),o=void 0,(i="view")in(n=this)?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o,this.view=new DataView(e.buffer,t)}}function _define_property$1k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class TencBox extends BaseMp4Box{get isProtected(){const{data:e,start:t}=this;return e[t+14]}get defaultKeyId(){const{data:e,start:t}=this;return e.slice(t+16,t+32)}set defaultKeyId(e){const{data:t,start:r}=this;for(let n=0;n<e.length;n++)t[n+r+16]=e[n]}constructor(e,t,r){super("tenc",e,t,r),_define_property$1k(this,"data",void 0),_define_property$1k(this,"start",void 0),_define_property$1k(this,"end",void 0),this.data=e,this.start=t,this.end=r}}function findBox(e,t,r=[]){for(let n=t;n<e.length;){if(0===r.length)return;const t=new DataView(e.buffer,n).getUint32(0),i=encodedArrayToString(e.subarray(n+4,n+8)),o=n+t;if(1===r.length&&i===r[0])return new BaseMp4Box(i,e,n,o);if(i===r[0])return findBox(e,n+8,r.slice(1));n+=t}}const rewriteDefaultKid=e=>{const[t]=function(e){const t=findBox(e,0,["moov","trak","mdia","minf","stbl","stsd"]),r=[];if(!t)return r;for(let n=t.start+16;n<t.end;){let i=findBox(e,n,["enca"]),o=36;if(i||(i=findBox(e,n,["encv"]),o=86),!i)return r;const a=findBox(e,i.start+o,["sinf","schi","tenc"]);a?(r.push(new TencBox(a.data,a.start,a.end)),n=a.end):n=t.end}return r}(e);if(!t)return;const r=function(e){const t=findBox(e,0,["moov"]),r=[];if(!t)return r;const n=new DataView(e.buffer,0);for(let i=t.start+8;i<t.size;){const t=n.getUint32(i);"pssh"===encodedArrayToString(e.subarray(i+4,i+8))&&r.push(new PsshBox(e,i,i+t)),i+=t}return r}(e).find(e=>e.isWidevine);r&&(t.defaultKeyId=r.keyBytes)};function _define_property$1j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function readSynchSafeUint32(e){return 2097152*(127&e[0])+16384*(127&e[1])+128*(127&e[2])+(127&e[3])}const cn={0:"iso-8859-1",1:"utf-16",2:"utf-16be",3:"utf-8"},ln={TPE1:!0,TIT2:!0,WXXX:!0,PRIV:!0,TALB:!0,CHAP:!0};class ID3{_parseID3Flags(e){this.unsynchronized=isBitAtPositionOn(e,7),this.hasExtendedHeader=isBitAtPositionOn(e,6),this.isExperimental=isBitAtPositionOn(e,5),this.hasFooter=isBitAtPositionOn(e,4)}_parseID3Frames(e,t,r,n){const i=new DataView(t.buffer,0,n),{minor:o}=this;for(;r+8<=n;){const s=a(t.subarray(r,r+4));r+=4;const c=4===o?readSynchSafeUint32(t.subarray(r,r+4)):i.getUint32(r);if(r+=4,t[r++],t[r++],ln[s]){const i=r,o=this._extractID3FramePayload(t,s,c,i,n);if(o){const t=this.decodeID3Frame(o);t&&e.frames.push(t)}r+=c}else r+=c}}_extractID3FramePayload(e,t,r,n,i){const o=n+r;let a;return o<=i&&(a={type:t,size:r,data:e.slice(n,o)}),a}decodeID3Frame(e){if("TXXX"!==e.type)return"WXXX"===e.type?this.decodeWxxxFrame(e):"PRIV"===e.type?this.decodePrivFrame(e):"CHAP"===e.type?this.decodeChapFrame(e):"T"===e.type[0]?this.decodeTextFrame(e):{key:e.type,data:e.data}}decodeChapFrame(e){const{data:t}=e,r=new DataView(t.buffer),n={key:"CHAP",frames:[]};let[i,o]=readNullTerminatedString(t,0,t.length);return n.id=i,o++,n.startTime=r.getUint32(o),o+=4,n.endTime=r.getUint32(o),o+=4,o+=4,o+=4,this._parseID3Frames(n,t,o,t.length),n}decodeTextFrame(e){const{data:t}=e,r=cn[t[0]],n=encodedArrayToString(t.subarray(1),r);return{key:e.type,text:n}}decodeWxxxFrame(e){const{data:t}=e,r=cn[t[0]];let n=1;const i=encodedArrayToString(t.subarray(n),r);n+=i.length+1;return{key:"WXXX",description:i,text:encodedArrayToString(t.subarray(n))}}decodePrivFrame(e){const t=encodedArrayToString(e.data);if(!t)return;return{key:"PRIV",info:t,data:e.data.slice(t.length+1)}}constructor(e){_define_property$1j(this,"minor",void 0),_define_property$1j(this,"revision",void 0),_define_property$1j(this,"frameLength",void 0),_define_property$1j(this,"endPos",void 0),_define_property$1j(this,"frames",[]),_define_property$1j(this,"unsynchronized",!1),_define_property$1j(this,"hasExtendedHeader",!1),_define_property$1j(this,"hasFooter",!1),_define_property$1j(this,"isExperimental",!1);let t=0;const r=a(e.subarray(t,t+3));if(t+=3,"ID3"!==r)return;this.minor=e[t++],this.revision=e[t++];const n=e[t++];this._parseID3Flags(n);const i=readSynchSafeUint32(e.subarray(t,t+4));t+=4,this.frameLength=i;const o=t+i;if(this.endPos=o,this.hasExtendedHeader){t+=readSynchSafeUint32(e.subarray(t,t+4))}this.minor>2&&this._parseID3Frames(this,e,t,o)}}var dn;function checkBoxName(e,t,r){return!(t+4>e.length)&&(e[t]===r[0]&&e[t+1]===r[1]&&e[t+2]===r[2]&&e[t+3]===r[3])}function findEmsgs(e){const t=e.length,r=[];if(function(e){var t;return(null===(t=e)||void 0===t?void 0:t.length)>=8&&checkBoxName(e,4,[102,116,121,112])}(e))return r;for(let n=0;n<t;n++){if(checkBoxName(e,n,[109,111,111,102]))return r;if(checkBoxName(e,n,[101,109,115,103])){const t=n-4,i=new DataView(e.buffer,t).getUint32(0),o=e.subarray(t,t+i);n=n+i-1,r.push(o)}}return r}function _define_property$1i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e){e[e.THREE=51]="THREE",e[e.C_A=65]="C_A",e[e.C_C=67]="C_C",e[e.C_D=68]="C_D",e[e.C_H=72]="C_H",e[e.C_I=73]="C_I",e[e.C_P=80]="C_P",e[e.A=97]="A",e[e.C=99]="C",e[e.D=100]="D",e[e.E=101]="E",e[e.F=102]="F",e[e.G=103]="G",e[e.H=104]="H",e[e.I=105]="I",e[e.K=107]="K",e[e.M=109]="M",e[e.O=111]="O",e[e.P=112]="P",e[e.S=115]="S",e[e.T=116]="T",e[e.V=118]="V",e[e.Y=121]="Y"}(dn||(dn={}));const un={TALB:"album",TIT2:"title",TPE1:"performer"},pn=["performer","title","album"];class TimedMetadata{resolveAdamIdFromStorefront(e){const t=this.storefrontToIds[e];this._adamId=t}get adamId(){return this._adamId}equals(e){if(!pn.every(t=>this[t]===e[t]))return!1;const{links:t}=this,r=e.links;if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++){const e=t[n].description===r[n].description,i=t[n].url===r[n].url;if(!e||!i)return!1}return!0}constructor(e){_define_property$1i(this,"performer",void 0),_define_property$1i(this,"title",void 0),_define_property$1i(this,"album",void 0),_define_property$1i(this,"links",[]),_define_property$1i(this,"storefrontToIds",{}),_define_property$1i(this,"_adamId",void 0),e.forEach(e=>{const{key:t}=e,r=un[t];var n;if(r)this[r]=null===(n=e.text)||void 0===n?void 0:n.replace(/\0/g,"");else if("WXXX"===e.key){if(e.description){const[t,r]=e.description.split("\0");this.links.push({description:t,url:r})}}else if("PRIV"===e.key){var i;const t=null===(i=e.info)||void 0===i?void 0:i.split("\0");if(t&&t.length&&t[0].startsWith("com.apple.radio.adamid")){t[1].split(",").forEach(e=>{const[t,r]=e.split(":");t&&r&&"0"!==r&&!hasOwn(this.storefrontToIds,t)&&(this.storefrontToIds[t]=r)})}}})}}function _define_property$1h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Emsg{get length(){return this.data.length}get elementPresentationTime(){const{presentationTime:e,timeScale:t}=this;return e&&t?Math.round(e/t):NaN}get timedMetadata(){var e;if(this._timedMetadata)return this._timedMetadata;const t=null===(e=this.id3)||void 0===e?void 0:e.frames;return t?(this._timedMetadata=new TimedMetadata(t),this._timedMetadata):void 0}constructor(e){_define_property$1h(this,"data",void 0),_define_property$1h(this,"schemeIdUri",void 0),_define_property$1h(this,"eventDuration",void 0),_define_property$1h(this,"presentationTime",void 0),_define_property$1h(this,"payload",void 0),_define_property$1h(this,"timeScale",void 0),_define_property$1h(this,"id3",void 0),_define_property$1h(this,"id",void 0),_define_property$1h(this,"_timedMetadata",void 0),this.data=e;const t=new DataView(e.buffer);let r=8;if(1!==e[r])return;r+=4,this.timeScale=t.getUint32(r),r+=4;const n=t.getUint32(r);r+=4;const i=t.getUint32(r);if(r+=4,this.presentationTime=Math.pow(2,32)*n+i,!Number.isSafeInteger(this.presentationTime))throw this.presentationTime=Number.MAX_SAFE_INTEGER,new Error("Failed to create 64 bit integer");this.eventDuration=t.getUint32(r),r+=4,this.id=t.getUint32(r),r+=4;const[o,a]=readNullTerminatedString(e,r);r+=a+1,this.schemeIdUri=o;const[s,c]=readNullTerminatedString(e,r);r+=c+1,this.payload=e.subarray(r,e.byteLength),this.id3=new ID3(this.payload)}}function _define_property$1g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class TimedMetadataManager{processEmsgs(e){const t=findEmsgs(e);t.length&&(this._currentEmsgInterval||(this._currentEmsgInterval=setInterval(this._getCurrentEmsg,1e3)),t.forEach(e=>{const t=new Emsg(e);this._emsgLookup[t.elementPresentationTime]=t}))}stop(){const{_currentEmsgInterval:e}=this;e&&clearInterval(e)}_getCurrentEmsg(){const{_currentTime:e,_emsgLookup:t}=this,r=Math.round(e()),n=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const e=parseInt(i[s],10);if(!(e<r))break;n.push(e)}const o=n.pop();if(o){var a;const e=t[o];if(!e)return;const{_currentEmsg:r,_onDidChange:n}=this,i=null===(a=r)||void 0===a?void 0:a.payload,s=e.payload;i&&arrayEquals(i,s)||(this._currentEmsg=e,n(e)),this._cleanupEmsgs(o)}}_cleanupEmsgs(e){const{_emsgLookup:t}=this;Object.keys(t).forEach(r=>{parseInt(r,10)<e&&delete t[r]})}constructor(e,t){_define_property$1g(this,"_currentTime",void 0),_define_property$1g(this,"_onDidChange",void 0),_define_property$1g(this,"_currentEmsgInterval",void 0),_define_property$1g(this,"_emsgLookup",void 0),_define_property$1g(this,"_currentEmsg",void 0),this._currentTime=e,this._onDidChange=t,this._emsgLookup={},this._getCurrentEmsg=this._getCurrentEmsg.bind(this)}}function _define_property$1f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class SegmentProcessor{process(e,t){const{_item:r}=this;try{r.isLiveRadioStation?this._processLiveRadioSegment(t):r.hasOffersHlsUrl&&this._processHlsOffersSegment(e,t)}catch(n){xe.error("Error processing segment",n)}}stop(){this._timedMetadataManager.stop()}_processHlsOffersSegment(e,t){e.isInitSegment&&rewriteDefaultKid(t)}_processLiveRadioSegment(e){this._timedMetadataManager.processEmsgs(e)}constructor(e,t,r){_define_property$1f(this,"_item",void 0),_define_property$1f(this,"_timedMetadataManager",void 0),this._item=e,this._timedMetadataManager=new TimedMetadataManager(()=>t.currentTime,e=>{r.publish(nn,e.timedMetadata)})}}function asyncGeneratorStep$Y(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$Y(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$Y(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$Y(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_decorate$v(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$v(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const hn=xe.createChild("mse"),yn=BooleanDevFlag.get("mk-mse-buffer"),{manifestParsed:_n}=Fe;class MseBuffer{onSourceOpen(){hn.debug("mediaSource open handler");const{mediaSource:e}=this;if(e.activeSourceBuffers.length>0)return void hn.debug("not adding new source buffer");hn.debug("adding new source buffer");const t=e.addSourceBuffer(Ue);this.sourceBuffer=t,t.addEventListener("updateend",this.updateEndHandler);const{clip:r,hasAppendWindowSupport:n}=this;r&&(n?(hn.debug("appendWindowStart/End",r.start,r.end),t.appendWindowStart=r.start,t.appendWindowEnd=r.end):(hn.debug("seeking for clip",r.start),asAsync(this.seek(r.start)))),this.updateSegmentToFetch(0,!0)}setNextManifest(e){hn.debug("setting next manifest for ",e.mediaItem.title),this.nextSeamlessTransition?(hn.debug("abandoning transition scheduled for "+this.nextSeamlessTransition),this.revertSeamlessTransition(!0),this.playbackTimeline.next={manifest:e}):(this.playbackTimeline.next={manifest:e},this.isFullyBuffered&&(hn.debug("current song is fully buffered, beginning transition to next"),this.transitionToNextManifest()))}isItemPlaying(e){var t,r;const{playbackTimeline:n}=this,i=this.nextSeamlessTransition?null===(t=n.previous)||void 0===t?void 0:t.manifest.mediaItem:null===(r=n.current)||void 0===r?void 0:r.manifest.mediaItem;return!!i&&(hn.debug(`isItemPlaying ${e.title}, ${i.title}, ${e.id===i.id}`),e.id===i.id)}get currentItem(){return this.manifest.mediaItem}get playableUrl(){let e=this._playableUrl;return e||(e=window.URL.createObjectURL(this.mediaSource),hn.debug("created url",e),this._playableUrl=e,e)}get segments(){const{manifest:e,clip:t}=this;return t?e.segmentsForTimeRange(t):e.segments||[]}get currentTime(){return this._currentTime}set currentTime(e){if(e+=this.currentTimestampOffset,this._currentTime===e)return;const{nextSeamlessTransition:t}=this;if(t&&e>=t){var r,n;hn.debug("setting offset to",t),this.currentTimestampOffset=t||0,this.nextSeamlessTransition=void 0,this.duration=this.manifest.mediaItem.playbackDuration/1e3,hn.debug("buffer setting duration to",this.duration);const e={previous:null===(n=this.playbackTimeline.previous)||void 0===n||null===(r=n.manifest)||void 0===r?void 0:r.mediaItem,current:this.manifest.mediaItem};hn.debug("dispatching seamless audio transition",e),this.dispatcher.publish(rn,e)}this._currentTime=e;const{isOverBufferLimit:i,timeToTrim:o}=this,a=e>this.timeToTrim;i&&a&&(hn.debug("buffer over limit, trimming to ",o),this.removeToTime(o),this.timeToTrim+=10)}get hasAppendWindowSupport(){var e;return void 0!==(null===(e=this.sourceBuffer)||void 0===e?void 0:e.appendWindowStart)}seek(e){var t=this;return _async_to_generator$Y((function*(){const{duration:r,seekWhenUpdated:n,sourceBuffer:i}=t;if(t.resolveSeekPromise(!1),hn.debug("seek to ",e),(e=+e)>r&&(hn.debug("rounding seek time to duration",e,r),e=r),!i)return!1;if(t.revertSeamlessTransition(),i.updating)return hn.debug("sourcebuffer updating, deferring seek"),new Promise(r=>{n&&n.resolve(!1),t.seekWhenUpdated={seek:t.seek.bind(t,e),resolve:r}});t.currentlyLoadingSegmentIndex=void 0,t.updateSegmentToFetch(0,!0),t.removeToTime(e),t.timeToTrim=10*Math.floor(e/10);const o=t.getSegmentForTime(e);0!==o&&(yield t.firstSegmentLoadPromise),hn.debug("seeking to",e,"segment",o),t.updateSegmentToFetch(o,!0);const a=new Promise(r=>{t.seekResolver={time:e,resolve:r}});return t.checkSeekBuffered(),a}))()}clearNextManifest(){this.revertSeamlessTransition(!0),this.playbackTimeline.next=void 0}revertSeamlessTransition(e=!1){const{playbackTimeline:t,nextSeamlessTransition:r}=this;if(!r||!t.previous)return void hn.debug("no need to revert, no transition");this.isAtEndOfStream=e,hn.debug("reverting seamless transition with discardNextManifest",e),e?this.clearBufferToEnd(r):this.clearBuffer(),hn.debug("abandoning transition to "+this.manifest.mediaItem.title),t.next=e?void 0:t.current,t.current=t.previous,t.previous=void 0;const n=this.manifest.mediaItem;hn.debug("current item reverted to "+n.title),this.nextSeamlessTransition=void 0,this.duration=n.playbackDuration/1e3,hn.debug("reverted duration to "+this.duration),e||(this.currentTimestampOffset=0,this.timestampOffsetAdjustment=0,hn.debug("reverted currentTimestampOffset and timestampOffsetAdjustment to 0")),this.printInfo(),this.segmentIndexToFetch=-1}get streamHasEnding(){return!this.manifest.mediaItem.isLiveRadioStation}stop(){this.segmentProcessor.stop(),this.setEndOfStream(),this.remove()}remove(){var e;hn.debug("removing sourceBuffer and mediaSource");const{sourceBuffer:t,mediaSource:r}=this;null===(e=this.seekResolver)||void 0===e||e.resolve(!1),this.manifest.removeEventListener(_n,this.onManifestParsed);const n=this._playableUrl;n&&(hn.debug("revoking url",n),window.URL.revokeObjectURL(n)),r.removeEventListener("sourceopen",this.onSourceOpen),t&&(t.removeEventListener("updateend",this.updateEndHandler),this.sourceBuffer=void 0)}onManifestParsed(){const e=this.segmentIndexToFetch+1;hn.debug("manifestParsed, loading segment",e),this.updateSegmentToFetch(e,!0)}updateEndHandler(){if(this.kickstartBuffer(),this.clearDeferredRemove())return;if(hn.debug("update end",this.seekWhenUpdated),this.seekWhenUpdated){hn.debug("updateEndHandler resolving seekWhenUpdated");const{seekWhenUpdated:e}=this;return asAsync(e.seek().then(e.resolve)),void(this.seekWhenUpdated=void 0)}this.checkSeekBuffered();const{clip:e,sourceBuffer:t,hasAppendWindowSupport:r}=this;if(e&&t&&!r){const{buffered:r}=t;if(this.isTimeBuffered(e.end+1)){const n=r.end(r.length-1);return hn.debug("clipping sourcebuffer to",e.end,n),void t.remove(e.end,n)}}if(this.isAtEndOfStream)return hn.debug("buffer is at end of stream"),this.streamHasEnding&&(hn.debug("isAtEndOfStream, not fetching any more segments"),this.playbackTimeline.next||this.setEndOfStream(),this.transitionToNextManifest()),void(this.isAtEndOfStream=!1);hn.debug("updateEndHandler invoking loadSegment"),asAsync(this.loadSegment())}clearDeferredRemove(){var e;if(0===this.deferredRemoves.length)return!1;const t=this.deferredRemoves.shift();return null===(e=this.sourceBuffer)||void 0===e||e.remove(t.start,t.end),!0}transitionToNextManifest(){var e;hn.debug("beginning transition to next manifest");const{playbackTimeline:t,sourceBuffer:r}=this;if(!t.next||!r)return void hn.debug("no next manifest");const n=this.endOfBufferTime||this.currentTimestampOffset;hn.debug("setting seamless transition at",n),this.nextSeamlessTransition=n,this.timestampOffsetAdjustment=n,this.playbackTimeline.current.endTime=n,t.previous=t.current,hn.debug("previous manifest set to",null===(e=t.previous)||void 0===e?void 0:e.manifest.mediaItem.title),t.current=t.next,hn.debug("current manifest set to",t.current.manifest.mediaItem.title),t.next=void 0,this.updateSegmentToFetch(0,!0),this.printInfo()}updateSegmentToFetch(e,t=!1){this.segments.length&&e<this.segments.length&&e!==this.segmentIndexToFetch&&(this.segmentIndexToFetch=e,t&&(hn.debug("updateSegmentToFetch invoking loadSegment"),asAsync(this.loadSegment())))}loadSegment(){var e=this;return _async_to_generator$Y((function*(){const t=e.segmentIndexToFetch,r=e.segments[t];if(t!==e.currentlyLoadingSegmentIndex){if(r)try{hn.debug("begin loadSegment "+t),e.currentlyLoadingSegmentIndex=t;const i=r.load();0===t&&(e.firstSegmentLoadPromise=i);const o=yield i;if(0!==t&&t!==e.segmentIndexToFetch)return void hn.debug("load segment index to fetch changed, not processing bytes for segment",t);e.segmentProcessor.process(r,o),hn.debug("loadSegment processed: "+t);const{sourceBuffer:a,timestampOffsetAdjustment:s}=e;if(!a)return;try{"number"==typeof s&&(hn.debug("adjusting timestampOffset of sourcebuffer to",s),a.timestampOffset=s,e.timestampOffsetAdjustment=void 0),a.appendBuffer(o),e.isFullyBuffered=!1,e.isOverBufferLimit=!1,hn.debug("appended to buffer",o.length),e.printBufferTimes(),t===e.segments.length-1?e.isAtEndOfStream=!0:t===e.segmentIndexToFetch&&(hn.debug("loadSegment bumping segment index to fetch to ",t+1),e.updateSegmentToFetch(t+1))}catch(n){"QuotaExceededError"===n.name?(e.isOverBufferLimit=!0,hn.debug("reached buffer limit")):hn.warn("Error appending to source buffer",n)}}catch(i){hn.error("Error loading segment",i),e.dispatcher.publish(on,i)}finally{e.currentlyLoadingSegmentIndex=void 0}}else hn.debug(`segment ${t} is currently loading, not loading it again`)}))()}setEndOfStream(){const{sourceBuffer:e,mediaSource:t}=this;e&&"ended"!==t.readyState&&(e.updating||"open"!==t.readyState?hn.error("Could not end of stream (updating, readyState)",e.updating,t.readyState):(hn.debug("mediaSource.endOfStream"),t.endOfStream(),this.isFullyBuffered=!0))}removeToTime(e){hn.debug("removing to time",e),e>0&&(this.isTimeBuffered(e)||this.isOverBufferLimit)&&this.safeSourceBufferRemove(0,e)}safeSourceBufferRemove(e,t){const{sourceBuffer:r}=this;r&&(r.updating?this.deferredRemoves.push({start:e,end:t}):r.remove(e,t))}get previousOffset(){var e,t;return(null===(t=this.playbackTimeline)||void 0===t||null===(e=t.previous)||void 0===e?void 0:e.endTime)||0}get manifest(){var e;return null===(e=this.playbackTimeline.current)||void 0===e?void 0:e.manifest}checkSeekBuffered(){const{seekResolver:e,currentTimestampOffset:t}=this;if(!e)return;const{time:r}=e,n=r+t,i=this.isTimeBuffered(n);hn.debug("resolving seek for time, adjustedTime, isBuffered",r,n,i),this.printBufferTimes(),i&&(hn.debug("resolving seek to true for time:",n),this.element.currentTime=n,this.resolveSeekPromise(!0))}resolveSeekPromise(e){this.seekResolver&&(this.seekResolver.resolve(e),this.seekResolver=void 0)}get endOfBufferTime(){var e;const t=null===(e=this.sourceBuffer)||void 0===e?void 0:e.buffered;return!(!t||!t.length)&&t.end(t.length-1)}isTimeBuffered(e){var t;const r=null===(t=this.sourceBuffer)||void 0===t?void 0:t.buffered;if(!r)return!1;for(let n=0;n<r.length;n++)if(hn.debug("isTimeBuffered",r.start(n),e,r.end(n)),e>=r.start(n)&&e<=r.end(n))return!0;return!1}clearBufferToEnd(e){const{sourceBuffer:t}=this;if(!t||!t.buffered)return;const r=t.buffered.end(t.buffered.length-1);this.safeSourceBufferRemove(e,r)}clearBuffer(){const{sourceBuffer:e}=this;if(!e||!e.buffered)return;const t=e.buffered;for(let r=0;r<t.length;r++)this.safeSourceBufferRemove(t.start(r),t.end(r))}get bufferTimesString(){var e;const t=null===(e=this.sourceBuffer)||void 0===e?void 0:e.buffered;if(!t)return"";const r=[];for(let n=0;n<t.length;n++)r.push(`start ${t.start(n)} end: ${t.end(n)}`);return r.join(",")}printBufferTimes(){yn&&hn.debug("buffer times",this.bufferTimesString)}getSegmentForTime(e){return Math.floor(e/10)+1}kickstartBuffer(){const{hasKickstarted:e,element:t,clip:r}=this,{buffered:n}=t;e||(this.manifest.mediaItem.isSong?r&&this.isTimeBuffered(r.start)&&(t.currentTime=r.start,this.hasKickstarted=!0):n.length&&(t.currentTime=n.start(0),this.hasKickstarted=!0))}printInfo(){var e,t;const{playbackTimeline:r}=this;hn.info("---- Buffer Info ----"),hn.info("currently buffering item",r.current.manifest.mediaItem.title),hn.info("next item to buffer",null===(e=r.next)||void 0===e?void 0:e.manifest.mediaItem.title),hn.info("previously buffered item",null===(t=r.previous)||void 0===t?void 0:t.manifest.mediaItem.title),hn.info("currentTimestampOffset",this.currentTimestampOffset),hn.info("currentTime",this.currentTime),hn.info("duration",this.duration),hn.info("nextSeamlessTransition",this.nextSeamlessTransition),hn.info("timestampOffsetAdjustment",this.timestampOffsetAdjustment),hn.info("buffered times",this.bufferTimesString),hn.info("isAtEndOfStream",this.isAtEndOfStream),hn.info("isFullyBuffered",this.isFullyBuffered),hn.info("segmentIndexToFetch",this.segmentIndexToFetch),hn.info("segments.length",this.segments.length),hn.info("---- End Buffer Info ----")}constructor({dispatcher:e,element:t,manifest:r,currentTime:n,duration:i,clip:o}){_define_property$1e(this,"dispatcher",void 0),_define_property$1e(this,"mediaSource",void 0),_define_property$1e(this,"sourceBuffer",void 0),_define_property$1e(this,"element",void 0),_define_property$1e(this,"_currentTime",void 0),_define_property$1e(this,"currentlyLoadingSegmentIndex",void 0),_define_property$1e(this,"duration",void 0),_define_property$1e(this,"firstSegmentLoadPromise",Promise.resolve()),_define_property$1e(this,"hasKickstarted",!1),_define_property$1e(this,"isOverBufferLimit",void 0),_define_property$1e(this,"seekResolver",void 0),_define_property$1e(this,"seekWhenUpdated",void 0),_define_property$1e(this,"segmentIndexToFetch",-1),_define_property$1e(this,"segmentProcessor",void 0),_define_property$1e(this,"timeToTrim",10),_define_property$1e(this,"isAtEndOfStream",!1),_define_property$1e(this,"isFullyBuffered",!1),_define_property$1e(this,"_playableUrl",void 0),_define_property$1e(this,"clip",void 0),_define_property$1e(this,"deferredRemoves",[]),_define_property$1e(this,"timestampOffsetAdjustment",void 0),_define_property$1e(this,"playbackTimeline",void 0),_define_property$1e(this,"currentTimestampOffset",0),_define_property$1e(this,"nextSeamlessTransition",void 0),this.dispatcher=e,this.clip=o,this.element=t,this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.segmentProcessor=new SegmentProcessor(r.mediaItem,t,e),this.playbackTimeline={current:{manifest:r}},r.addEventListener(_n,this.onManifestParsed),this._currentTime=n||0,this.duration=i,window.mseBuffer=this}}function asyncGeneratorStep$X(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$X(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$X(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$X(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_decorate$u(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}_ts_decorate$v([Bind(),_ts_metadata$v("design:type",Function),_ts_metadata$v("design:paramtypes",[])],MseBuffer.prototype,"onSourceOpen",null),_ts_decorate$v([Bind(),_ts_metadata$v("design:type",Function),_ts_metadata$v("design:paramtypes",[])],MseBuffer.prototype,"onManifestParsed",null),_ts_decorate$v([Bind(),_ts_metadata$v("design:type",Function),_ts_metadata$v("design:paramtypes",[])],MseBuffer.prototype,"updateEndHandler",null);const{mediaPlaybackError:fn}=rt;class AudioPlayer extends BasePlayer{destroy(){var e=this,_superprop_get_destroy=()=>super.destroy;return _async_to_generator$X((function*(){_superprop_get_destroy().call(e),e._dispatcher.unsubscribe(on,e.onLoadSegmentError)}))()}onLoadSegmentError(e){this._dispatcher.publish(fn,new MKError(MKError.MEDIA_SESSION,e)),this.destroy()}get currentPlayingDate(){}get isPlayingAtLiveEdge(){return!1}get seekableTimeRanges(){return this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}get supportsPreviewImages(){return!1}get _targetElement(){return this.audio}initializeExtension(){var e=this;return _async_to_generator$X((function*(){e.extension=new MediaExtension(e.audio,Ue),yield e.extension.initializeKeySystem(),e.extension.addEventListener(Fe.playbackLicenseError,t=>{e.resetDeferredPlay(),e._dispatcher.publish(fn,t)}),e.extension.addEventListener(Fe.playbackSessionError,t=>{e._dispatcher.publish(fn,new MKError(MKError.MEDIA_SESSION,t)),e.destroy()})}))()}initializeMediaElement(){var e=this;return _async_to_generator$X((function*(){const t=nextAvailableAudioElement();t.autoplay=!1,t.id="apple-music-player",t.controls=!1,t.muted=!1,t.playbackRate=1,t.preload="metadata",t.volume=1,e.audio=t,document.body.appendChild(t),xe.debug("initializedMediaElement",t)}))()}removeEventHandlers(){this._targetElement.removeEventListener("timeupdate",this.onTimeUpdate),this._targetElement.removeEventListener("timeupdate",this.delayedCdmUpdateCheck),super.removeEventHandlers()}isPlayerSupported(){return!0}_stopMediaElement(){var e=this,_superprop_get__stopMediaElement=()=>super._stopMediaElement;return _async_to_generator$X((function*(){var t;yield _superprop_get__stopMediaElement().call(e),yield e.tearDownManifests(),null===(t=e._buffer)||void 0===t||t.stop(),e._buffer=void 0}))()}setNextSeamlessItem(e){var t=this;return _async_to_generator$X((function*(){var r;const{extension:n,nextManifest:i}=t,o=t._buffer;if(!o||!n)return;if((null===(r=i)||void 0===r?void 0:r.mediaItem.id)===e.id)return void xe.debug("already have next manifest for ",e.title);t._targetElement.removeEventListener("timeupdate",t.onTimeUpdate),t._targetElement.addEventListener("timeupdate",t.onTimeUpdate),xe.debug("player preparing next manifest for",e.title);const a=yield t.loadAndParseManifest(e,!1);o.setNextManifest(a),n.setMediaItem(e),n.extURI=a.extURI,t.nextManifest=a}))()}playItemFromEncryptedSource(t,r=!1,n){var i=this;return _async_to_generator$X((function*(){const o=i._paused&&!r;xe.debug("playItemFromEncryptedSource",t.title);const a=o?void 0:i.startPlaybackSequence();if(t.playRawAssetURL)return t.playbackType=e.PlaybackType.unencryptedFull,i.nowPlayingItem=t,yield i._playAssetURL(t.assetURL,o),i.finishPlaybackSequence();const{extension:s}=i;var c,l;i.delaySeamlessCdmUpdates&&(null===(l=i.extension)||void 0===l||null===(c=l.session)||void 0===c||c.applyDelayedCdmUpdates());if(!s)return a;s.initiated=r,s.setMediaItem(t),t.playbackType=e.PlaybackType.encryptedFull,i.nowPlayingItem=t,t.state=E.loading;const d=yield i.getManifestForItem(t);i.manifest=d;const u=shouldForceAudioMse();if((t.isSong||s.isFairplay&&u)&&(s.extURI=d.extURI),t.state=E.ready,s.isFairplay&&!u){var p;let e=t.assetURL;(null===(p=n)||void 0===p?void 0:p.startTime)&&(e+="#t="+n.startTime),yield i._playAssetURL(e,o)}else{const e=i._buffer;e&&i.isSeamlessAudioTransitionsEnabled&&e.isItemPlaying(d.mediaItem)?xe.debug("already have buffer, continuing playback"):yield i.beginNewBufferForItem(o,d,n)}return i.finishPlaybackSequence()}))()}getManifestForItem(e){var t=this;return _async_to_generator$X((function*(){var r,n;xe.debug("reconciling item to play against playing item");const{nextManifest:i,manifest:o,isSeamlessAudioTransitionsEnabled:a}=t,s=t._buffer;if(!s||!o)return xe.debug("no buffer or manifest, creating manifest [title, buffer, manifest]",e.title,!!s,!!o),t.loadAndParseManifest(e);if(!a)return xe.debug("seamless transitions disabled, stopping and creating manifest for",e.title),yield t.tearDownManifests(),t.loadAndParseManifest(e);const c=!s.isItemPlaying(e);let l;if(xe.debug("itemMismatch",c),i&&!c)xe.debug(`replacing manifest for ${o.mediaItem.title} with next manifest ${i.mediaItem.title}`),l=i,t.nextManifest=void 0,xe.debug("cease listening for keys on manifest for",o.mediaItem.title),yield t.tearDownManifest(o);else if(c){var d;(null===(d=i)||void 0===d?void 0:d.mediaItem.id)!==e.id?(xe.debug(`item to play ${e.title} does not match playing or next items, tearing down all manifests`),yield t.tearDownManifests(),l=yield t.loadAndParseManifest(e)):(xe.debug(`item to play ${e.title} matches next item, tearing down current manifest`),yield t.tearDownManifest(o),l=i)}else xe.debug("item is already playing, returning existing manifest"),l=o;return xe.debug("getManifestForItem loading keys for",o.mediaItem.title),null===(n=t.extension)||void 0===n||null===(r=n.session)||void 0===r||r.loadKeys(l.keyValues,l.mediaItem),l}))()}seekToTime(e){var t=this;return _async_to_generator$X((function*(){const r=t._buffer;if(r){xe.debug("audio-player: buffer seek to",e);if(!(yield r.seek(e)))return;t.isSeamlessAudioTransitionsEnabled&&t.onTimeUpdate()}else xe.debug("audio-player: media element seek to",e),t._targetElement.currentTime=e}))()}tearDownManifests(){var e=this;return _async_to_generator$X((function*(){e.manifest=yield e.tearDownManifest(e.manifest),e.nextManifest=yield e.tearDownManifest(e.nextManifest)}))()}tearDownManifest(e){var t=this;return _async_to_generator$X((function*(){const{extension:r}=t;e&&(xe.debug("tearing down manifest for",e.mediaItem.title),e.stop(),r&&(yield r.clearSessions(e.keyValues)),e.removeEventListener(Xr.keysParsed,t.loadKeysHandler))}))()}loadAndParseManifest(e,t=!0){var r=this;return _async_to_generator$X((function*(){let n;xe.debug(`will load and parse manifest for ${e.title}, loadKeys ${t}`);try{return n=yield Manifest.load(e,!1),t&&n.addEventListener(Xr.keysParsed,r.loadKeysHandler),n.parse(),n}catch(Ae){r.resetDeferredPlay();const t=new MKError(MKError.NETWORK_ERROR,"Could not fetch manifest");throw t.data=Ae,r._dispatcher.publish(fn,t),t}}))()}onTimeUpdate(){if(!this._buffer)return;const{currentPlaybackTimeRemaining:e,nextManifest:t,delaySeamlessCdmUpdates:r}=this;if(t&&e<15){var n,i,o,a;if(xe.debug("player loading keys for",t.mediaItem.title,r),r)null===(i=this.extension)||void 0===i||null===(n=i.session)||void 0===n||n.loadKeys(t.keyValues,t.mediaItem,{delayCdmUpdate:!0}),this._targetElement.addEventListener("timeupdate",this.delayedCdmUpdateCheck);else null===(a=this.extension)||void 0===a||null===(o=a.session)||void 0===o||o.loadKeys(t.keyValues,t.mediaItem);this._targetElement.removeEventListener("timeupdate",this.onTimeUpdate)}}delayedCdmUpdateCheck(){var e;const t=null===(e=this.nowPlayingItem)||void 0===e?void 0:e.playbackDuration,r=t?t/1e3:this.currentPlaybackDuration,n=this._currentTime,i=Number((r-n).toFixed(3));if(i<1){const e=1e3*i;xe.debug("delayed CDM update in ",e),setTimeout(()=>{var e,t;xe.debug("applying delayed CDM update"),null===(t=this.extension)||void 0===t||null===(e=t.session)||void 0===e||e.applyDelayedCdmUpdates()},e),this._targetElement.removeEventListener("timeupdate",this.delayedCdmUpdateCheck)}}loadKeysHandler(e){var t,r;null===(r=this.extension)||void 0===r||null===(t=r.session)||void 0===t||t.loadKeys(e.keys,e.item)}beginNewBufferForItem(e,t,r){var n=this;return _async_to_generator$X((function*(){if(xe.debug("creating new MseBuffer for item",t.mediaItem.title,e),n._buffer&&(xe.debug("stopping old buffer"),n._buffer.stop()),n._buffer=new MseBuffer({dispatcher:n._dispatcher,element:n._targetElement,duration:t.mediaItem.playbackDuration/1e3,manifest:t}),yield n._playAssetURL(n._buffer.playableUrl,!0),!e){var i;let e=Promise.resolve();return(null===(i=r)||void 0===i?void 0:i.startTime)&&(e=n.seekToTime(r.startTime)),e.then(()=>n._playMedia())}}))()}setPresentationMode(e){return _async_to_generator$X((function*(){return Promise.resolve()}))()}loadPreviewImage(e){return _async_to_generator$X((function*(){}))()}constructor(e){var t,r;super(e),_define_property$1d(this,"currentAudioTrack",void 0),_define_property$1d(this,"currentTextTrack",void 0),_define_property$1d(this,"textTracks",[]),_define_property$1d(this,"audioTracks",[]),_define_property$1d(this,"audio",void 0),_define_property$1d(this,"isSeamlessAudioTransitionsEnabled",!1),_define_property$1d(this,"delaySeamlessCdmUpdates",!1),_define_property$1d(this,"extension",void 0),_define_property$1d(this,"mediaPlayerType","audio"),_define_property$1d(this,"manifest",void 0),_define_property$1d(this,"nextManifest",void 0);const n=null!==(r=null===(t=e.bag)||void 0===t?void 0:t.features)&&void 0!==r?r:{};this.isSeamlessAudioTransitionsEnabled=!!n["seamless-audio-transitions"],this.delaySeamlessCdmUpdates=!!n["delay-seamless-cdm-updates"],window.audioPlayer=this,this._dispatcher.subscribe(on,this.onLoadSegmentError)}}function asyncGeneratorStep$W(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$W(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$W(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$W(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}_ts_decorate$u([Bind(),_ts_metadata$u("design:type",Function),_ts_metadata$u("design:paramtypes",[void 0])],AudioPlayer.prototype,"onLoadSegmentError",null),_ts_decorate$u([AsyncDebounce(250),_ts_metadata$u("design:type",Function),_ts_metadata$u("design:paramtypes",[Number])],AudioPlayer.prototype,"seekToTime",null),_ts_decorate$u([Bind(),_ts_metadata$u("design:type",Function),_ts_metadata$u("design:paramtypes",[])],AudioPlayer.prototype,"onTimeUpdate",null),_ts_decorate$u([Bind(),_ts_metadata$u("design:type",Function),_ts_metadata$u("design:paramtypes",[])],AudioPlayer.prototype,"delayedCdmUpdateCheck",null),_ts_decorate$u([Bind(),_ts_metadata$u("design:type",Function),_ts_metadata$u("design:paramtypes",[void 0])],AudioPlayer.prototype,"loadKeysHandler",null);class EncryptedSession extends KeySession{attachMedia(e,t){var r=this;return _async_to_generator$W((function*(){r.keySystem=t.keySystem,r._keySystemAccess=t,e.addEventListener("encrypted",r.boundHandleSessionCreation,!1)}))()}detachMedia(e){e.removeEventListener("encrypted",this.boundHandleSessionCreation)}createSession(e){var t=this;return _async_to_generator$W((function*(){xe.debug("Encrypted createSession",e);const r=t._keySystemAccess;if(!r)return;const{initData:n,initDataType:i,target:o}=e;return t._mediaKeysPromise||(t._mediaKeysPromise=new Promise(function(){var e=_async_to_generator$W((function*(e,n){const i=yield r.createMediaKeys();try{yield o.setMediaKeys(i)}catch(Ae){t.dispatchKeyError(Ae),n(Ae)}const a=yield t.loadCertificateBuffer();yield i.setServerCertificate(a),t._mediaKeysServerCertificate=a,e(i)}));return function(t,r){return e.apply(this,arguments)}}())),yield t._mediaKeysPromise,t._mediaKeysServerCertificate?t._createSession(o,n,i):void 0}))()}generatePSSH(e){const t=new Uint8Array([0,0,0,52,112,115,115,104,0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,20,8,1,18,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),r=s(e);for(let n=0;n<r.length;n++)t[t.length-16+n]=r[n];return xe.debug("generatePSSH",t),t}_createSession(e,t,r){const n=e.mediaKeys.createSession(),{item:i}=this;if(!i)return;this._teardownCurrentSession(),xe.debug("creating media key session",n);let o;if(this.isWidevine&&i.isSong)o=this.generatePSSH(this.extID);else{var a;const e=null===(a=function(e){const t=[],r=new DataView(e.buffer);for(let n=0;n<e.length;){const i=r.getUint32(n);t.push(new PsshBox(e,n,n+i)),n+=i}return t}(new Uint8Array(t)).find(e=>e.isWidevine))||void 0===a?void 0:a.rawBytes,r=d(e);xe.debug("extracted uri",r),n.extURI=r,o=t}return n.addEventListener("message",this.startLicenseSession),this._currentSession=n,n.generateRequest(r,o).catch(e=>{if(e.message.match(/generateRequest.*\(75\)/))return n.generateRequest(r,o);throw e})}_teardownCurrentSession(){this._currentSession&&(xe.debug("tearing down media key session",this._currentSession),this._currentSession.removeEventListener("message",this.startLicenseSession),this._currentSession=void 0)}applyDelayedCdmUpdates(){}loadKeys(e,t,r){return _async_to_generator$W((function*(){}))()}clearSessions(){return _async_to_generator$W((function*(){}))()}constructor(...e){super(...e),_define_property$1c(this,"_currentSession",void 0),_define_property$1c(this,"_keySystemAccess",void 0),_define_property$1c(this,"_mediaKeysPromise",void 0),_define_property$1c(this,"_mediaKeysServerCertificate",void 0)}}function asyncGeneratorStep$V(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$V(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$V(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$V(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class MediaExtensionStub extends Notifications{destroy(e){}setMediaItem(e){}initializeKeySystem(){var e=this;return _async_to_generator$V((function*(){e.session=new EncryptedSession}))()}clearSessions(){return _async_to_generator$V((function*(){}))()}constructor(e){super(e),_define_property$1b(this,"audioTracks",[]),_define_property$1b(this,"textTracks",[]),_define_property$1b(this,"session",void 0),_define_property$1b(this,"extURI",void 0),_define_property$1b(this,"hasMediaKeySupport",void 0),_define_property$1b(this,"hasMediaSession",void 0),_define_property$1b(this,"initiated",void 0),_define_property$1b(this,"isFairplay",void 0),this.extURI="",this.hasMediaKeySupport=!0,this.initiated=!0,this.isFairplay=!0,this.hasMediaKeySupport=!0,this.hasMediaSession=!0}}function asyncGeneratorStep$U(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$U(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$U(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$U(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$1a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class PlayerStub{get hasMediaElement(){return!0}get isEngagedInPlayback(){return!this.paused}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._dispatcher.publish(rt.playbackRateDidChange,new Event("ratechange"))}get volume(){return this._volume}set volume(e){this._volume=e,this._dispatcher.publish(rt.playbackVolumeDidChange,new Event("volumeChange"))}destroy(){}dispatch(){}exitFullscreen(){return _async_to_generator$U((function*(){}))()}loadPreviewImage(e){return _async_to_generator$U((function*(){}))()}initialize(){return _async_to_generator$U((function*(){}))()}isPaused(){return this.paused}calculateTime(e){return e}clearNextManifest(){}mute(){}newSeeker(){return new PlayerSeeker(this)}pause(e){return _async_to_generator$U((function*(){}))()}play(){return _async_to_generator$U((function*(){}))()}playItemFromEncryptedSource(e,t,r){return _async_to_generator$U((function*(){}))()}playItemFromUnencryptedSource(e,t,r){return _async_to_generator$U((function*(){}))()}preload(){return _async_to_generator$U((function*(){}))()}prepareToPlay(e,t,r){return _async_to_generator$U((function*(){}))()}seekToTime(e){return _async_to_generator$U((function*(){}))()}requestFullscreen(){return _async_to_generator$U((function*(){}))()}setPlaybackState(e,t){}setPresentationMode(e){return _async_to_generator$U((function*(){}))()}showPlaybackTargetPicker(){}stop(e){return _async_to_generator$U((function*(){}))()}stopMediaAndCleanup(){return _async_to_generator$U((function*(){}))()}supportsPictureInPicture(){return!1}tsidChanged(){}setNextSeamlessItem(e){return _async_to_generator$U((function*(){}))()}constructor(t){_define_property$1a(this,"bitrate",e.PlaybackBitrate.STANDARD),_define_property$1a(this,"audioTracks",[]),_define_property$1a(this,"currentBufferedProgress",0),_define_property$1a(this,"currentPlaybackDuration",0),_define_property$1a(this,"currentPlaybackProgress",0),_define_property$1a(this,"currentPlaybackTime",0),_define_property$1a(this,"currentPlaybackTimeRemaining",0),_define_property$1a(this,"currentPlayingDate",void 0),_define_property$1a(this,"isPlayingAtLiveEdge",!1),_define_property$1a(this,"isPlaying",!1),_define_property$1a(this,"isPrimaryPlayer",!0),_define_property$1a(this,"isReady",!1),_define_property$1a(this,"nowPlayingItem",void 0),_define_property$1a(this,"paused",!1),_define_property$1a(this,"playbackState",e.PlaybackStates.none),_define_property$1a(this,"playbackTargetAvailable",!1),_define_property$1a(this,"playbackTargetIsWireless",!1),_define_property$1a(this,"previewOnly",!1),_define_property$1a(this,"supportsPreviewImages",!1),_define_property$1a(this,"textTracks",[]),_define_property$1a(this,"extension",new MediaExtensionStub([])),_define_property$1a(this,"hasAuthorization",!0),_define_property$1a(this,"windowHandlers",void 0),_define_property$1a(this,"isDestroyed",!1),_define_property$1a(this,"services",void 0),_define_property$1a(this,"_dispatcher",void 0),_define_property$1a(this,"_volume",1),_define_property$1a(this,"_playbackRate",1),_define_property$1a(this,"currentAudioTrack",void 0),_define_property$1a(this,"currentTextTrack",void 0),_define_property$1a(this,"seekableTimeRanges",void 0),this.services=t.services,this._dispatcher=t.services.dispatcher,this.windowHandlers=new WindowHandlers(this,t.services.runtime)}}class VideoMediaExtension extends MediaExtension{destroy(e){var t;null===(t=this._session)||void 0===t||t.stopLicenseSession(),super.destroy(e)}}const vn=BooleanDevFlag.register("mk-send-manifest-headers");function asyncGeneratorStep$T(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$T(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$T(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$T(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$19(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const gn=["https://play.itunes.apple.com/","https://linear.tv.apple.com/","https://play-edge.itunes.apple.com"];const mn=new class{fetchManifest(e){var t=this;return _async_to_generator$T((function*(){return xe.info("fetching manifest at",e),shouldLoadManifestOnce()?t.fetchForCache(e):t.fetchOnly(e)}))()}getManifest(e){return this.cache.get(e)}clear(e){e?this.cache.delete(e):this.cache.clear()}fetchForCache(e){var t=this;return _async_to_generator$T((function*(){const r=function(e){const t={};gn.some(t=>e.startsWith(t))&&jr.musicUserToken&&(!vn.configured||vn.enabled)&&(t["media-user-token"]=jr.musicUserToken,t.Authorization="Bearer "+jr.developerToken);return t}(e),n=yield t.fetch(e,{headers:new Headers(r)});let i=yield n.text();var o;i=((e,t)=>{xe.info("converting manifest URIs to absolute paths");const r=new URL(e);let n=t.replace(/URI="([^"]*)"/g,(function(e,t){return`URI="${new URL(t,r).href}"`}));return n=n.replace(/^(#EXT-X-STREAM-INF:[^\n]*\n)(.*$)/gim,(function(e,t,n){return`${t}${new URL(n,r).href}`})),n})(e,i);const a={url:e,content:i,contentType:null!==(o=n.headers.get("content-type"))&&void 0!==o?o:void 0};return t.cache.set(e,a),a}))()}fetchOnly(e){var t=this;return _async_to_generator$T((function*(){const r=yield t.fetch(e),n=yield r.text();var i;return{url:e,content:n,contentType:null!==(i=r.headers.get("content-type"))&&void 0!==i?i:void 0}}))()}constructor(e={}){var t,r;_define_property$19(this,"cache",void 0),_define_property$19(this,"fetch",void 0),this.fetch=null!==(t=e.fetch)&&void 0!==t?t:fetch.bind(globalThis),this.cache=null!==(r=e.cache)&&void 0!==r?r:new Map}};function asyncGeneratorStep$S(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$S(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$S(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$S(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _ts_decorate$t(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$t(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const{mediaPlaybackError:bn}=rt,{playbackLicenseError:Sn,playbackSessionError:Pn}=Fe;class NativeSafariVideoPlayer extends VideoPlayer{get currentPlayingDate(){}get isPlayingAtLiveEdge(){return!1}get seekableTimeRanges(){return this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}get supportsPreviewImages(){return!1}initializeExtension(){var e=this;return _async_to_generator$S((function*(){if(!e.video)return void xe.warn("NativeSafariVideoPlayer.initializeExtension No video element, not initializing extension");const t=new VideoMediaExtension(e.video,'video/mp4;codecs="avc1.42E01E"');e.extension=t,yield t.initializeKeySystem(),t.addEventListener(Sn,e.onPlaybackLicenseError),t.addEventListener(Pn,e.onPlaybackSessionError)}))()}destroy(){xe.debug("native-safari-video-player.destroy");const{extension:e,video:t}=this;this._blobUrl&&(URL.revokeObjectURL(this._blobUrl),this._blobUrl=void 0),e&&t&&(e.removeEventListener(Sn,this.onPlaybackLicenseError),e.removeEventListener(Pn,this.onPlaybackSessionError),t.removeEventListener("loadedmetadata",this.onMetadataLoaded),super.destroy())}loadPreviewImage(e){return _async_to_generator$S((function*(){}))()}playHlsStream(e,t,r={}){var n=this;return _async_to_generator$S((function*(){xe.debug("native-safari-video-player.playHlsStream",e);const{video:i}=n;if(!i){const e="NativeSafariVideoPlayer.playHlsStream(): No video element";throw xe.error(e),new Error(e)}n.setupTrackManagers();const o=n.startPlaybackSequence(),a=(n._shouldLoadManifestsOnce?n.playByBlob(e,i,r):n.playBySource(e,i,r)).then(()=>o);var s;t&&(null===(s=n.extension)||void 0===s||s.setMediaItem(t));return i.addEventListener("loadedmetadata",n.onMetadataLoaded),a}))()}onPlaybackSessionError(e){this._dispatcher.publish(bn,new MKError(MKError.MEDIA_SESSION,e))}onMetadataLoaded(){var e=this;return _async_to_generator$S((function*(){xe.debug("native-safari-video-player.onMetadataLoaded");const{nowPlayingItem:t}=e;t&&(t.state=E.ready),yield e._playMedia(),e.finishPlaybackSequence()}))()}seekToTime(e){var t=this;return _async_to_generator$S((function*(){xe.debug("native-safari-video-player: media element seek to",e),t._targetElement.currentTime=e}))()}playByBlob(e,t,r={}){var n=this;return _async_to_generator$S((function*(){xe.debug("native-safari-video-player: playing video by blob");let i=mn.getManifest(e);if(!i&&(xe.debug("native-safari-video-player: fetching manifest"),i=yield mn.fetchManifest(e),!i))throw xe.error("No manifest for "+e),new MKError(MKError.CONTENT_UNAVAILABLE,"Failed to load manifest");xe.debug("native-safari-video-player: loaded manifest",!!i),mn.clear(e);const o=i.contentType,a=i.content.replace(/^#EXT-X-SESSION-DATA-ITUNES:.*$/gm,""),s=new Blob([a],{type:o});e=URL.createObjectURL(s),n._blobUrl=e;const c=document.createElement("source");c.setAttribute("src",e),o&&c.setAttribute("type",o),xe.debug("native-safari-video-player: blob url",e),void 0!==r.startTime&&(t.currentTime=r.startTime),t.appendChild(c)}))()}playBySource(e,t,r={}){return _async_to_generator$S((function*(){xe.debug("native-safari-video-player: playing video by source"),void 0!==r.startTime&&(e+="#t="+r.startTime),t.src=e}))()}constructor(...e){var t,r,n;super(...e),n=void 0,(r="_blobUrl")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}}function _define_property$17(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}_ts_decorate$t([Bind(),_ts_metadata$t("design:type",Function),_ts_metadata$t("design:paramtypes",[void 0])],NativeSafariVideoPlayer.prototype,"onPlaybackSessionError",null),_ts_decorate$t([Bind(),_ts_metadata$t("design:type",Function),_ts_metadata$t("design:paramtypes",[])],NativeSafariVideoPlayer.prototype,"onMetadataLoaded",null),_ts_decorate$t([AsyncDebounce(250),_ts_metadata$t("design:type",Function),_ts_metadata$t("design:paramtypes",[Number])],NativeSafariVideoPlayer.prototype,"seekToTime",null);class HlsJsPreviewImageLoader{loadPreviewImage(e){return this.lastPosition===e||(this.lastPosition=e,this.lastPromise=new Promise((t,r)=>{this.hls.loadImageIframeData$(e).subscribe(e=>{const{data:r}=e,n=new Blob([r],{type:"image/jpeg"});t(n)})})),this.lastPromise}constructor(e){_define_property$17(this,"hls",void 0),_define_property$17(this,"lastPosition",void 0),_define_property$17(this,"lastPromise",void 0),this.hls=e}}function _define_property$16(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$16(e,t,r[t])}))}return e}function _object_spread_props$n(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_decorate$s(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$s(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const{audioTracksSwitched:En,audioTracksUpdated:Tn,inlineStylesParsed:kn,textTracksSwitched:wn,textTracksUpdated:On}=Fe;class HlsJsTracks extends Notifications{get isDestroyed(){return this._isDestroyed}get audioTracks(){return this._audioTracks}get textTracks(){return this._textTracks}set audioTrack(e){this.session&&e&&void 0!==e.id&&(this.session.audioSelectedPersistentID=e.id)}set textTrack(e){var t,r;this.session.subtitleSelectedPersistentID=null!==(r=null===(t=e)||void 0===t?void 0:t.id)&&void 0!==r?r:-1}selectForcedTrack(){var e,t;const{session:r}=this;if(!(null===(e=r)||void 0===e?void 0:e.audioTracks))return;const n=r.audioTracks.filter(e=>e.persistentID===r.audioSelectedPersistentID),i=n&&n.length&&n[0];if(!i)return;const o=null===(t=r.subtitleMediaOptions.filter(e=>0===e.MediaSelectionOptionsDisplaysNonForcedSubtitles&&e.MediaSelectionOptionsExtendedLanguageTag===i.lang))||void 0===t?void 0:t[0];let a;return o?(xe.debug("hlsjsTracks: found forced track for "+o.MediaSelectionOptionsExtendedLanguageTag),r.subtitleSelectedPersistentID=o.MediaSelectionOptionsPersistentID,a=this.normalizeTextTrack(o)):r.subtitleSelectedPersistentID=-1,a}audioTracksUpdated(e,t){const r=(t&&t.audioMediaSelectionGroup&&t.audioMediaSelectionGroup.MediaSelectionGroupOptions||[]).map(this.normalizeAudioTrack,this);this._audioTracks=r,this.dispatchEvent(Tn,r)}handleAudioTrackSwitched(){this.dispatchEvent(En,{selectedId:this.session.audioSelectedPersistentID})}handleInlineStylesParsed(e,t){this.dispatchEvent(kn,t)}handleManifestLoaded(e,t){this.audioTracksUpdated(e,t),this.subtitleTracksUpdated(e,t)}handleSessionDataComplete(e,t){var r,n;null===(n=t)||void 0===n||null===(r=n.itemList)||void 0===r||r.forEach(e=>{if("_hls.localized-rendition-names"===e["DATA-ID"]&&e.VALUE)try{this._localizedRenditionNames=JSON.parse(e.VALUE),this._audioTracks.forEach(e=>{var t;const r=null===(t=this._localizedRenditionNames)||void 0===t?void 0:t[e.label];r&&(e.localizedRenditionNames=r)}),this.dispatchEvent(Tn,this._audioTracks)}catch(t){return void xe.error("Failed to parse _hls.localized-rendition-names",t)}})}handleSubtitleTrackSwitch(e,t){this.dispatchEvent(wn,t)}subtitleTracksUpdated(e,t){const r=t&&t.subtitleMediaSelectionGroup&&t.subtitleMediaSelectionGroup.MediaSelectionGroupOptions||[],n=[];r.forEach(e=>{0!==e.MediaSelectionOptionsDisplaysNonForcedSubtitles&&n.push(this.normalizeTextTrack(e))}),this._textTracks=n,this.dispatchEvent(On,n)}normalizeAudioTrack(e){const t=e.MediaSelectionOptionsTaggedMediaCharacteristics,r=(null!=t?t:[]).includes("public.accessibility.describes-video")?"description":"main";return _object_spread_props$n(_object_spread$B({},this.normalizeSelectionOption(e)),{enabled:!1,kind:r,characteristics:t})}normalizeTextTrack(e){var t;let r;return r=(null===(t=e.MediaSelectionOptionsTaggedMediaCharacteristics)||void 0===t?void 0:t.includes("public.accessibility.describes-music-and-sound"))||"clcp"===e.MediaSelectionOptionsMediaType?"captions":"subtitles",_object_spread_props$n(_object_spread$B({},this.normalizeSelectionOption(e)),{mode:"disabled",kind:r})}normalizeSelectionOption(e){return{id:e.MediaSelectionOptionsPersistentID,label:e.MediaSelectionOptionsName,language:e.MediaSelectionOptionsExtendedLanguageTag}}destroy(){this._isDestroyed=!0;const{MANIFEST_LOADED:e,AUDIO_TRACK_SWITCHED:t,SUBTITLE_TRACK_SWITCH:r,INLINE_STYLES_PARSED:n,SESSION_DATA_COMPLETE:i}=window.Hls.Events;this.session.off(e,this.handleManifestLoaded),this.session.off(t,this.handleAudioTrackSwitched),this.session.off(r,this.handleSubtitleTrackSwitch),this.session.off(n,this.handleInlineStylesParsed),this.session.off(i,this.handleSessionDataComplete)}constructor(e){super([En,Tn,kn,wn,On]),_define_property$16(this,"session",void 0),_define_property$16(this,"_audioTracks",void 0),_define_property$16(this,"_textTracks",void 0),_define_property$16(this,"_localizedRenditionNames",void 0),_define_property$16(this,"_isDestroyed",void 0),this.session=e,this._audioTracks=[],this._textTracks=[],this._isDestroyed=!1;const{MANIFEST_LOADED:t,AUDIO_TRACK_SWITCHED:r,SUBTITLE_TRACK_SWITCH:n,INLINE_STYLES_PARSED:i,SESSION_DATA_COMPLETE:o}=window.Hls.Events;this.session.on(t,this.handleManifestLoaded),this.session.on(r,this.handleAudioTrackSwitched),this.session.on(n,this.handleSubtitleTrackSwitch),this.session.on(i,this.handleInlineStylesParsed),this.session.on(o,this.handleSessionDataComplete)}}function asyncGeneratorStep$R(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$R(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$R(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$R(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$15(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_decorate$r(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$r(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}_ts_decorate$s([Bind(),_ts_metadata$s("design:type",Function),_ts_metadata$s("design:paramtypes",[])],HlsJsTracks.prototype,"handleAudioTrackSwitched",null),_ts_decorate$s([Bind(),_ts_metadata$s("design:type",Function),_ts_metadata$s("design:paramtypes",[void 0,void 0])],HlsJsTracks.prototype,"handleInlineStylesParsed",null),_ts_decorate$s([Bind(),_ts_metadata$s("design:type",Function),_ts_metadata$s("design:paramtypes",[void 0,void 0])],HlsJsTracks.prototype,"handleManifestLoaded",null),_ts_decorate$s([Bind(),_ts_metadata$s("design:type",Function),_ts_metadata$s("design:paramtypes",[void 0,void 0])],HlsJsTracks.prototype,"handleSessionDataComplete",null),_ts_decorate$s([Bind(),_ts_metadata$s("design:type",Function),_ts_metadata$s("design:paramtypes",[void 0,void 0])],HlsJsTracks.prototype,"handleSubtitleTrackSwitch",null);const In={bufferStalledError:"bufferStalledError",keySystemGenericError:"keySystemGenericError"};var An;!function(e){e.Seek="Seek",e.HighBuffer="HighBuffer",e.LowBuffer="LowBuffer"}(An||(An={}));const $n=new Set([MKError.DEVICE_LIMIT,MKError.GEO_BLOCK,MKError.WIDEVINE_CDM_EXPIRED]),Rn={};Rn[Le.FAIRPLAY]="fairplaystreaming",Rn[Le.PLAYREADY]="playready",Rn[Le.WIDEVINE]="widevine";const Cn=BooleanDevFlag.get("mk-block-report-cdn-server"),configureCdnReporting=e=>{const{Hls:t}=window;if(t&&Cn){const r=function deepClone(e){const t=Object.prototype.toString.call(e).toLowerCase().slice(8,-1);switch(t){case"set":return new Set([...e].map(e=>deepClone(e)));case"map":return new Map([...e].map(([e,t])=>[deepClone(e),deepClone(t)]));case"date":return new Date(e.getTime());case"regexp":{const t=e,r="string"==typeof t.flags?t.flags:[t.global?"g":void 0,t.ignoreCase?"i":void 0,t.multiline?"m":void 0,t.sticky?"y":void 0,t.unicode?"u":void 0].filter(e=>void 0!==e).join("");return RegExp(e.source,r)}case"arraybuffer":{const t=e;if("function"==typeof t.slice)return t.slice(0);{const r=new e.constructor(t.byteLength);return new Uint8Array(r).set(new Uint8Array(t)),r}}case"dataview":case"int8array":case"uint8array":case"uint8clampedarray":case"int16array":case"uint16array":case"int32array":case"uint32array":case"float32array":case"float64array":case"bigint64array":case"biguint64array":{const r=e;return new(0,r.constructor)(deepClone(r.buffer),r.byteOffset,"dataview"===t?r.byteLength:r.length)}case"array":case"object":{const t=Array.isArray(e)?[]:{};for(const r in e)hasOwn(e,r)&&(t[r]=deepClone(e[r]));return t}default:return e}}(t.DefaultConfig.fragLoadPolicy);r.default.reportCDNServer=!1,r.customURL.reportCDNServer=!1,e.fragLoadPolicy=r}},Mn={nightly:!0,carry:!0},Dn=JsonDevFlag.register("mk-hlsjs-config-overrides");class HlsJsVideoPlayer extends VideoPlayer{get shouldDispatchErrors(){return!this.userInitiated||this._playbackDidStart}get supportsPreviewImages(){var e,t;return!this.services.runtime.isMobile&&(null===(t=this._hls)||void 0===t||null===(e=t.iframeVariants)||void 0===e?void 0:e.some(e=>"mjpg"===e.imageCodec))}get currentPlayingDate(){var e;return null===(e=this._hls)||void 0===e?void 0:e.playingDate}get isPlayingAtLiveEdge(){var e;const t=this._hls;return!(!t||!(null===(e=this.nowPlayingItem)||void 0===e?void 0:e.isLinearStream))&&!!t.isPlayingAtLive}get seekableTimeRanges(){const e=this._hls;return e?e.seekableTimeRanges:this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}initializeExtension(){var e=this;return _async_to_generator$R((function*(){e._keySystem=yield findKeySystemPreference(e.services.runtime);try{var t;if(!Ne.urls.hls)throw new Error("bag.urls.hls is not configured");yield Promise.all([loadScript(Ne.urls.hls),null===(t=e._rtcTracker)||void 0===t?void 0:t.loadScript()])}catch(r){throw xe.error("hlsjs-video-player failed to load script "+Ne.urls.hls,r),r}}))()}destroy(){var e;if(xe.debug("hlsjs-video-player.destroy"),null===(e=this._hlsJsTracks)||void 0===e||e.destroy(),this._hls){const{ERROR:e,INTERNAL_ERROR:t,MANIFEST_PARSED:r,KEY_REQUEST_STARTED:n,LICENSE_CHALLENGE_CREATED:i,LEVEL_SWITCHED:o,UNRESOLVED_URI_LOADING:a}=window.Hls.Events,s=this._hls;s.stopLoad(),s.detachMedia(),s.off(e,this.handleHlsError),s.off(t,this.handleHlsError),s.off(r,this.handleManifestParsed),s.off(n,this.handleKeyRequestStarted),s.off(i,this.handleLicenseChallengeCreated),s.off(o,this.handleLevelSwitched),this._shouldLoadManifestsOnce&&s.off(a,this.handleUnresolvedUriLoading),s.destroy(),window.hlsSession=void 0}super.destroy(),asAsync(this._license.stop())}playHlsStream(e,t,r={}){var n=this;return _async_to_generator$R((function*(){xe.debug("hlsjs-video-player.playHlsStream",e,t);const{_keySystem:i}=n;if(!i)return;let o,a;n._unrecoverableError=void 0,n.createHlsPlayer();const hasKey=(e,t)=>{var r,n;return void 0!==(null===(n=t)||void 0===n||null===(r=n.keyURLs)||void 0===r?void 0:r[e])};i===Le.WIDEVINE&&hasKey("widevine-cert-url",t)&&(o="WIDEVINE_SOFTWARE",a={initDataTypes:["cenc","keyids"],distinctiveIdentifier:"optional",persistentState:"required"});const s={subs:"accepts-css",platformInfo:{requiresCDMAttachOnStart:i!==Le.NONE,maxSecurityLevel:o,keySystemConfig:a},appData:{serviceName:Ne.app.name}},{_rtcTracker:c,_hls:l}=n;if(c){const e=c.prepareReportingAgent(t);void 0!==e&&(s.appData.reportingAgent=e)}xe.debug("RTC: loadSource with load options",s);const d=n.startPlaybackSequence();return n._shouldLoadManifestsOnce&&(e=e.replace("https://","manifest://"),xe.info("Manifest already loaded, passing url to HLSJS",e)),l.loadSource(e,s,r.startTime),l.attachMedia(n.video),t&&(n._licenseServerUrl=t.keyURLs["hls-key-server-url"],i===Le.FAIRPLAY&&hasKey("hls-key-cert-url",t)?l.setProtectionData({fairplaystreaming:{serverCertUrl:t.keyURLs["hls-key-cert-url"]}}):hasKey("widevine-cert-url",t)&&l.setProtectionData({widevine:{serverCertUrl:t.keyURLs["widevine-cert-url"]}})),d}))()}createHlsPlayer(){const{_keySystem:e}=this,{Hls:t}=window,r=M.get(),{os:n}=this.services.runtime,i={clearMediaKeysOnPromise:!1,customTextTrackCueRenderer:!0,debug:!!r,debugLevel:r,enableIFramePreloading:!1,enablePerformanceLogging:!!r,enablePlayReadyKeySystem:!0,enableQueryParamsForITunes:!this._shouldLoadManifestsOnce,enableRtcReporting:void 0!==this._rtcTracker,keySystemPreference:Rn[e],useMediaKeySystemAccessFilter:!0,nativeControlsEnabled:n.isAndroid,enableContentSteering:!0,allowFastSwitchUp:!0,enableBoss:!1};configureCdnReporting(i),(e=>{const t=A.value;if(!t)return;var r;const n=null!==(r=determineCdnPathPrefix())&&void 0!==r?r:"";t.socketurl&&isAppleHostname(t.socketurl)&&Mn[n.split(".")[0]]&&(e.socketurl=t.socketurl,e.socketid=t.socketid,e.log=t.log)})(i),(e=>{const t=Dn.value;t&&"object"==typeof t&&Object.assign(e,t)})(i);const o=new t(i),{ERROR:a,INTERNAL_ERROR:s,MANIFEST_PARSED:c,KEY_REQUEST_STARTED:l,LICENSE_CHALLENGE_CREATED:d,LEVEL_SWITCHED:u,UNRESOLVED_URI_LOADING:p}=t.Events;o.on(a,this.handleHlsError),o.on(s,this.handleHlsError),o.on(c,this.handleManifestParsed),o.on(l,this.handleKeyRequestStarted),o.on(d,this.handleLicenseChallengeCreated),o.on(u,this.handleLevelSwitched),this._shouldLoadManifestsOnce&&o.on(p,this.handleUnresolvedUriLoading),this._hls=o,window.hlsSession=o,this._hlsJsTracks=new HlsJsTracks(this._hls),this.setupTrackManagers(this._hlsJsTracks),this._hlsPreviewImageLoader=new HlsJsPreviewImageLoader(this._hls)}handleUnresolvedUriLoading(e,t){var r=this;return _async_to_generator$R((function*(){const e=r._hls,n=t.uri,i=n.replace("manifest://","https://");var o;xe.debug("handleUnresolvedUriLoading for uri ",n);const a=null!==(o=mn.getManifest(i))&&void 0!==o?o:yield mn.fetchManifest(i);a?(mn.clear(i),e.off(window.Hls.Events.UNRESOLVED_URI_LOADING,r.handleUnresolvedUriLoading),e.handleResolvedUri(n,{url:i,status:200,data:a.content})):xe.error("No cached manifest for "+i)}))()}handleLevelSwitched(e,t){var r,n,i;const{level:o}=t;if(!o)return;const a=null===(r=this._levels)||void 0===r?void 0:r.find(e=>e.persistentId===o);if(!a||(null===(n=this._currentLevel)||void 0===n?void 0:n.persistentId)===(null===(i=a)||void 0===i?void 0:i.persistentId))return;this._currentLevel=a;const s=void 0!==a.audioGroupId?this._channelsByGroup[a.audioGroupId]:void 0;this._dispatcher.publish(et.hlsLevelUpdated,{level:a,channels:s})}handleHlsError(e,t){var r;if(xe.warn("HLS.js error",JSON.stringify(t)),this._unrecoverableError)return;let n=new MKError(MKError.UNSUPPORTED_ERROR,t.reason);n.data=t;const{bufferStalledError:i,keySystemGenericError:o}=In;if(t.details===o)return void this._dispatcher.publish(o,n);let a=!1;var s;t.details===i&&t.stallType===An.Seek&&-12909===(null===(r=t.response)||void 0===r?void 0:r.code)&&(n=new MKError(MKError.BUFFER_STALLED_ERROR,t.stallType),n.data={stallType:t.stallType,code:null===(s=t.response)||void 0===s?void 0:s.code},a=!0);if("output-restricted"===t.reason&&(n=new MKError(MKError.OUTPUT_RESTRICTED,t.reason)),t.fatal){if(this._hls.destroy(),!this.shouldDispatchErrors&&!a)throw n;this._dispatcher.publish(rt.mediaPlaybackError,n)}}handleManifestParsed(e,t){var r=this;return _async_to_generator$R((function*(){var e,n;let i;xe.debug("handleManifestParsed",t),r._levels=null!==(e=t.levels)&&void 0!==e?e:[],r.nowPlayingItem.state=E.ready,r._channelsByGroup=(null!==(n=t.audioTracks)&&void 0!==n?n:[]).reduce((e,t)=>(e[t.groupId]=t.channels,e),{});try{yield r._playMedia()}catch(o){throw xe.warn("error from media element, possibly non-fatal",o),o}finally{i=yield r.finishPlaybackSequence()}return i}))()}handleKeyRequestStarted(e,t){xe.debug("hlsjs-video.handleKeyRequestStarted"),this._hls.generateKeyRequest(t.keyuri,{})}handleLicenseChallengeCreated(e,t){var r=this;return _async_to_generator$R((function*(){const{_licenseServerUrl:e,nowPlayingItem:n,_keySystem:i,userInitiated:o}=r;try{var a,c;const l=yield null===(a=r._license)||void 0===a?void 0:a.start(e,n,t,i,o),d={statusCode:l.status};(null===(c=l)||void 0===c?void 0:c.license)&&(i===Le.FAIRPLAY?d.ckc=s(l.license):d.license=s(l.license));const u=l["renew-after"];u&&(d.renewalDate=new Date(Date.now()+1e3*u)),r._hls.setLicenseResponse(t.keyuri,d)}catch(d){var l;if(r._unrecoverableError)return;const e=d.data,n={};void 0!==(null===(l=e)||void 0===l?void 0:l.status)&&(n.statusCode=+e.status),xe.warn("Passing license response error to Hls.js",n),r._hls.setLicenseResponse(t.keyuri,n),$n.has(d.name)&&(r._unrecoverableError=d,r.resetDeferredPlay(),yield r.stop({endReasonType:ot.FAILED_TO_LOAD,userInitiated:o})),r.onPlaybackLicenseError(d)}}))()}seekToTime(e){var t=this;return _async_to_generator$R((function*(){t._hls?(xe.debug("hlsjs-video: hls seekTo",e),t._hls.seekTo=e):(xe.debug("hlsjs-video: media element seek to",e),t._targetElement.currentTime=e)}))()}loadPreviewImage(e){var t=this;return _async_to_generator$R((function*(){var r;return null===(r=t._hlsPreviewImageLoader)||void 0===r?void 0:r.loadPreviewImage(e)}))()}constructor(e){var t,r;super(e),_define_property$15(this,"_hls",void 0),_define_property$15(this,"_hlsPreviewImageLoader",void 0),_define_property$15(this,"_hlsJsTracks",void 0),_define_property$15(this,"_keySystem",void 0),_define_property$15(this,"_license",void 0),_define_property$15(this,"_rtcTracker",void 0),_define_property$15(this,"_levels",void 0),_define_property$15(this,"_channelsByGroup",{}),_define_property$15(this,"_currentLevel",void 0),_define_property$15(this,"_licenseServerUrl",void 0),_define_property$15(this,"_unrecoverableError",void 0),this._rtcTracker=null===(r=e)||void 0===r||null===(t=r.playbackServices)||void 0===t?void 0:t.getRTCStreamingTracker(),this._license=new License}}var xn;_ts_decorate$r([Bind(),_ts_metadata$r("design:type",Function),_ts_metadata$r("design:paramtypes",[String,"undefined"==typeof HlsUnresolvedUriData?Object:HlsUnresolvedUriData])],HlsJsVideoPlayer.prototype,"handleUnresolvedUriLoading",null),_ts_decorate$r([Bind(),_ts_metadata$r("design:type",Function),_ts_metadata$r("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleLevelSwitched",null),_ts_decorate$r([Bind(),_ts_metadata$r("design:type",Function),_ts_metadata$r("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleHlsError",null),_ts_decorate$r([Bind(),_ts_metadata$r("design:type",Function),_ts_metadata$r("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleManifestParsed",null),_ts_decorate$r([Bind(),_ts_metadata$r("design:type",Function),_ts_metadata$r("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleKeyRequestStarted",null),_ts_decorate$r([Bind(),_ts_metadata$r("design:type",Function),_ts_metadata$r("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleLicenseChallengeCreated",null),_ts_decorate$r([AsyncDebounce(250),_ts_metadata$r("design:type",Function),_ts_metadata$r("design:paramtypes",[Number])],HlsJsVideoPlayer.prototype,"seekToTime",null),_ts_decorate$r([(xn=250,(e,t,r)=>{const n=function(e,t){let r,n,i=0;const resetState=()=>{clearTimeout(n),n=0,r=void 0};return function(...o){const a=this;return new Promise((function(s,c){const l=Date.now();l-i<t?(r&&(r.resolve(void 0),resetState()),r={resolve:s,reject:c,args:o},n=setTimeout(()=>{e.apply(a,r.args).then(r.resolve).catch(r.reject),resetState()},t-(l-i+1))):(resetState(),i=l,e.apply(a,o).then(s).catch(c))}))}}(r.value,xn);r.value=n}),_ts_metadata$r("design:type",Function),_ts_metadata$r("design:paramtypes",[Number])],HlsJsVideoPlayer.prototype,"loadPreviewImage",null),e.version="2.2344.3";const Ln=e.version.split("."),Nn=Ln[0],jn=Ln[Ln.length-1];var Un,Fn;Ln[0]="3",Ln[Ln.length-1]=jn+"-prerelease",Ln[0]=Nn,Ln[Ln.length-1]=jn,e.version=Ln.join("."),function(e){e.REPEAT="REPEAT",e.SHUFFLE="SHUFFLE",e.AUTOPLAY="AUTOPLAY"}(Un||(Un={})),e.PlaybackMode=void 0,(Fn=e.PlaybackMode||(e.PlaybackMode={}))[Fn.PREVIEW_ONLY=0]="PREVIEW_ONLY",Fn[Fn.MIXED_CONTENT=1]="MIXED_CONTENT",Fn[Fn.FULL_PLAYBACK_ONLY=2]="FULL_PLAYBACK_ONLY",Fn[Fn.SHAREPLAY_PARTICIPANT=3]="SHAREPLAY_PARTICIPANT";const Bn={configured:"musickitconfigured",loaded:"musickitloaded",audioTrackAdded:rt.audioTrackAdded,audioTrackChanged:rt.audioTrackChanged,audioTrackRemoved:rt.audioTrackRemoved,authorizationStatusDidChange:le.authorizationStatusDidChange,authorizationStatusWillChange:le.authorizationStatusWillChange,bufferedProgressDidChange:rt.bufferedProgressDidChange,capabilitiesChanged:"capabilitiesChanged",autoplayEnabledDidChange:"autoplayEnabledDidChange",drmUnsupported:rt.drmUnsupported,eligibleForSubscribeView:le.eligibleForSubscribeView,forcedTextTrackChanged:rt.forcedTextTrackChanged,mediaCanPlay:rt.mediaCanPlay,mediaElementCreated:rt.mediaElementCreated,mediaItemStateDidChange:be.mediaItemStateDidChange,mediaItemStateWillChange:be.mediaItemStateWillChange,mediaPlaybackError:rt.mediaPlaybackError,mediaSkipAvailable:"mediaSkipAvailable",mediaRollEntered:"mediaRollEntered",mediaUpNext:"mediaUpNext",metadataDidChange:rt.metadataDidChange,needsGDPRDidChange:"needsGDPRDidChange",nowPlayingItemDidChange:rt.nowPlayingItemDidChange,nowPlayingItemWillChange:rt.nowPlayingItemWillChange,playInitiated:"playInitiated",playbackBitrateDidChange:rt.playbackBitrateDidChange,playbackDurationDidChange:rt.playbackDurationDidChange,playbackProgressDidChange:rt.playbackProgressDidChange,playbackRateDidChange:rt.playbackRateDidChange,playbackStateDidChange:rt.playbackStateDidChange,playbackStateWillChange:rt.playbackStateWillChange,playbackTargetAvailableDidChange:rt.playbackTargetAvailableDidChange,playbackTargetIsWirelessDidChange:rt.playbackTargetIsWirelessDidChange,playbackTimeDidChange:rt.playbackTimeDidChange,playbackVolumeDidChange:rt.playbackVolumeDidChange,playerTypeDidChange:rt.playerTypeDidChange,presentationModeDidChange:rt.presentationModeDidChange,primaryPlayerDidChange:rt.primaryPlayerDidChange,queueIsReady:"queueIsReady",queueItemsDidChange:"queueItemsDidChange",queueItemForStartPosition:"queueItemForStartPosition",queuePositionDidChange:"queuePositionDidChange",shuffleModeDidChange:"shuffleModeDidChange",repeatModeDidChange:"repeatModeDidChange",storefrontCountryCodeDidChange:le.storefrontCountryCodeDidChange,storefrontIdentifierDidChange:le.storefrontIdentifierDidChange,textTrackAdded:rt.textTrackAdded,textTrackChanged:rt.textTrackChanged,textTrackRemoved:rt.textTrackRemoved,timedMetadataDidChange:rt.timedMetadataDidChange,userTokenDidChange:le.userTokenDidChange,webComponentsLoaded:"musickitwebcomponentsloaded"};function parseSkipItems(e){const t=parseInt(e.hlsMetadata["skip.count"],10),r=[];if(isNaN(t)||0===t)return r;for(let n=0;n<t;n++){const t={start:parseFloat(e.hlsMetadata[`skip.${n}.start`]),duration:parseFloat(e.hlsMetadata[`skip.${n}.duration`]),target:parseFloat(e.hlsMetadata[`skip.${n}.target`]),label:e.hlsMetadata[`skip.${n}.label`]};void 0!==e.hlsMetadata[`skip.${n}.promo.enabled`]&&(t.promo={enabled:"true"===e.hlsMetadata[`skip.${n}.promo.enabled`],image:e.hlsMetadata[`skip.${n}.promo.image`],"image-height":parseInt(e.hlsMetadata[`skip.${n}.promo.image-height`],10),"image-width":parseInt(e.hlsMetadata[`skip.${n}.promo.image-width`],10),genre:e.hlsMetadata[`skip.${n}.promo.genre`],"release-year":parseInt(e.hlsMetadata[`skip.${n}.promo.release-year`],10),"rating-display-name":e.hlsMetadata[`skip.${n}.promo.rating-display-name`],"rating-system":e.hlsMetadata[`skip.${n}.promo.rating-system`],"canonical-id":e.hlsMetadata[`skip.${n}.promo.canonical-id`],title:e.hlsMetadata[`skip.${n}.promo.title`],"rating-tag":e.hlsMetadata[`skip.${n}.promo.rating-tag`],"rating-rank":e.hlsMetadata[`skip.${n}.promo.rating-rank`],"up-next":{"is-added":"true"===e.hlsMetadata[`skip.${n}.promo.up-next.is-added`],"add-label":e.hlsMetadata[`skip.${n}.promo.up-next.add-label`],"added-label":e.hlsMetadata[`skip.${n}.promo.up-next.added-label`]},runtime:parseInt(e.hlsMetadata[`skip.${n}.promo.runtime`],10)}),r.push(t)}return r}function parseRollItems(e,t=["pre-roll","mid-roll","post-roll"]){if(void 0===e.hlsMetadata)return[];const r=[];return t.forEach(t=>{const n=parseInt(e.hlsMetadata[t+".count"],10);if(!isNaN(n))for(let i=0;i<n;i++){const n=`${t}.${i}`,o={index:i,type:t,skippable:"true"===e.hlsMetadata[n+".skippable"],"adam-id":e.hlsMetadata[n+".adam-id"],start:Math.round(parseFloat(e.hlsMetadata[n+".start"])),duration:Math.round(parseFloat(e.hlsMetadata[n+".duration"]))},a=n+".dynamic-slot.data-set-id";void 0!==e.hlsMetadata[a]&&(o["dynamic-id"]=e.hlsMetadata[a]),r.push(o)}}),r}const addRollItemDuration=(e,t)=>e+t.duration;function asyncGeneratorStep$Q(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$14(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_metadata$q(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}class SpanWatcher{startMonitor(){this.dispatcher.unsubscribe(Bn.playbackTimeDidChange,this.handleTimeChange),this.dispatcher.subscribe(Bn.playbackTimeDidChange,this.handleTimeChange)}stopMonitor(){this.dispatcher.unsubscribe(Bn.playbackTimeDidChange,this.handleTimeChange)}handleTimeChange(e,{currentPlaybackTime:t}){var r,n=this;return(r=function*(){!Number.isFinite(t)||t<n.start||t>n.stop?n.inWatchSpan=!1:n.inWatchSpan||(n.allowMultiple||n.stopMonitor(),n.inWatchSpan=!0,yield n.callback(t,n))},function(){var e=this,t=arguments;return new Promise((function(n,i){var o=r.apply(e,t);function _next(e){asyncGeneratorStep$Q(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$Q(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,t,r,n,i=!1){_define_property$14(this,"dispatcher",void 0),_define_property$14(this,"callback",void 0),_define_property$14(this,"start",void 0),_define_property$14(this,"stop",void 0),_define_property$14(this,"allowMultiple",void 0),_define_property$14(this,"inWatchSpan",void 0),this.dispatcher=e,this.callback=t,this.start=r,this.stop=n,this.allowMultiple=i,this.inWatchSpan=!1}}function _define_property$13(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_metadata$p(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$q("design:type",Function),_ts_metadata$q("design:paramtypes",[void 0,void 0])],SpanWatcher.prototype,"handleTimeChange",null);class PlaybackMonitor{activate(){this.isActive=!0,this.startMonitor()}deactivate(){this.isActive=!1,this.clearMonitor()}clearMonitor(){this.isMonitoring&&(this.watchers.forEach(e=>e.stopMonitor()),this.isMonitoring=!1)}shouldMonitor(){return this.isActive}startMonitor(){this.shouldMonitor()&&(this.watchers.forEach(e=>e.startMonitor()),this.isMonitoring=!0)}handleMediaItemChange(){this.isActive&&(this.clearMonitor(),this.shouldMonitor()&&this.startMonitor())}constructor(e){_define_property$13(this,"isActive",!1),_define_property$13(this,"isMonitoring",!1),_define_property$13(this,"apiManager",void 0),_define_property$13(this,"dispatcher",void 0),_define_property$13(this,"playbackController",void 0),_define_property$13(this,"watchers",[]),this.handlePlaybackThreshold=this.handlePlaybackThreshold.bind(this),this.playbackController=e.controller,this.dispatcher=e.services.dispatcher,this.dispatcher.subscribe(Bn.nowPlayingItemDidChange,this.handleMediaItemChange),this.apiManager=e.services.apiManager}}function asyncGeneratorStep$P(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$p("design:type",Function),_ts_metadata$p("design:paramtypes",[])],PlaybackMonitor.prototype,"handleMediaItemChange",null);class RollMonitor extends PlaybackMonitor{handlePlaybackThreshold(e,t){var r,n=this;return(r=function*(){if(!n.rollMap.has(t))return;const e=n.rollMap.get(t);n.dispatcher.publish(Bn.mediaRollEntered,e),n.rollMap.delete(t)},function(){var e=this,t=arguments;return new Promise((function(n,i){var o=r.apply(e,t);function _next(e){asyncGeneratorStep$P(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$P(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}shouldMonitor(){if(!super.shouldMonitor())return!1;return this.getRollMetadata().length>0}startMonitor(){this.setupWatchers(this.getRollMetadata()),super.startMonitor()}getRollMetadata(){const e=this.playbackController.nowPlayingItem;return void 0===e?[]:parseRollItems(e,["pre-roll","post-roll"])}setupWatchers(e){const t=[];e.forEach(e=>{const{start:r,duration:n}=e,i=new SpanWatcher(this.dispatcher,this.handlePlaybackThreshold,r,r+n);t.push(i),this.rollMap.set(i,e)}),this.watchers=t}constructor(e){var t,r,n;super(e),t=this,r="rollMap",n=new Map,r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}}function asyncGeneratorStep$O(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}class SkipAvailable extends PlaybackMonitor{handlePlaybackThreshold(e,t){var r,n=this;return(r=function*(){if(!n.skipMap.has(t))return;const e=n.skipMap.get(t);n.dispatcher.publish(Bn.mediaSkipAvailable,e),n.skipMap.delete(t)},function(){var e=this,t=arguments;return new Promise((function(n,i){var o=r.apply(e,t);function _next(e){asyncGeneratorStep$O(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$O(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}shouldMonitor(){if(!super.shouldMonitor())return!1;return this.getNowPlayingMetadata().length>0}startMonitor(){this.setupWatchers(this.getNowPlayingMetadata()),super.startMonitor()}getNowPlayingMetadata(){const e=this.playbackController.nowPlayingItem;return void 0===e?[]:parseSkipItems(e)}setupWatchers(e){const t=[];e.forEach(e=>{const{start:r,target:n,duration:i,promo:o}=e,a=new SpanWatcher(this.dispatcher,this.handlePlaybackThreshold,r,o?n:r+i);t.push(a),this.skipMap.set(a,e)}),this.watchers=t}constructor(e){var t,r,n;super(e),t=this,r="skipMap",n=new Map,r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}}const Kn=new Logger$1("services");function asyncGeneratorStep$N(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$10(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const getContentCompletionThreshold=e=>Math.min(Math.round(getUpNextStart(e)),Math.round(getWatchedTime(e))),hasContentCompletionThresholdData=e=>!isNaN(getUpNextStart(e))&&!isNaN(getWatchedTime(e)),getUpNextStart=e=>parseFloat(e.hlsMetadata["up-next.start"]),getWatchedTime=e=>parseFloat(e.hlsMetadata["watched.time"]),Vn=function(){var e,t=(e=function*(e,t){if(e.isUTS&&e.assetURL)try{const r=generateAssetUrl(e,t),n=yield mn.fetchManifest(r);e.hlsMetadata=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$10(e,t,r[t])}))}return e}({},e.hlsMetadata,function(e,t={}){const r=/^(?:#EXT-X-SESSION-DATA:?)DATA-ID="([^"]+)".+VALUE="([^"]+)".*$/,n={};for(const i of e.split("\n")){const e=i.match(r);if(e){let r=e[1];e[1].startsWith("com.apple.hls.")&&!1!==t.stripPrefix&&(r=e[1].slice("com.apple.hls.".length));const i=e[2];n[r]=i}}return n}(n.content))}catch(Ae){Kn.error(Ae.message,Ae)}},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$N(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$N(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))});return function(e,r){return t.apply(this,arguments)}}();function asyncGeneratorStep$M(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _ts_metadata$o(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}class UpNextMonitor extends PlaybackMonitor{handlePlaybackThreshold(){var e,t=this;return(e=function*(){t.dispatcher.publish(Bn.mediaUpNext)},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$M(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$M(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}shouldMonitor(){if(!super.shouldMonitor())return!1;const e=this.playbackController.nowPlayingItem;return void 0!==e&&hasContentCompletionThresholdData(e)}startMonitor(){this.setupWatchers(),super.startMonitor()}setupWatchers(){const e=this.playbackController.nowPlayingItem;e&&hasContentCompletionThresholdData(e)&&(this.watchers=[new SpanWatcher(this.dispatcher,this.handlePlaybackThreshold,Math.round(this.getStartTime(e)),Number.POSITIVE_INFINITY)])}getStartTime(e){const t=getUpNextStart(e);return isNaN(t)?getWatchedTime(e):t}constructor(e){super(e)}}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$o("design:type",Function),_ts_metadata$o("design:paramtypes",[])],UpNextMonitor.prototype,"handlePlaybackThreshold",null);const Gn=getHlsJsCdnConfig(),Hn={app:{},autoplay:{maxQueueSizeForAutoplay:50,maxQueueSizeInRequest:10,maxUpcomingTracksToMaintain:10},features:{xtrick:!0,isWeb:!0,bookmarking:!1,"seamless-audio-transitions":!0,"enhanced-hls":!1},urls:{hls:Gn.hls,rtc:Gn.rtc,mediaApi:"https://amp-api.music.apple.com/v1",webPlayback:`https://${getCommerceHostname("play")}/WebObjects/MZPlay.woa/wa/webPlayback`}},Wn=JsonDevFlag.register("mk-offers-key-urls").get();function asyncGeneratorStep$L(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$L(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$L(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$L(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$$(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread_props$m(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}let qn;Hn.urls.hlsOffersKeyUrls=Wn||{"hls-key-cert-url":"https://s.mzstatic.com/skdtool_2021_certbundle.bin","hls-key-server-url":"https://play.itunes.apple.com/WebObjects/MZPlay.woa/podcast/hls/license/streaming/start","widevine-cert-url":"https://play.itunes.apple.com/WebObjects/MZPlay.woa/wa/widevineCert"};class Store{get authorizationStatus(){return this.storekit.authorizationStatus}get cid(){return this.storekit.cid}get developerToken(){return this.storekit.developerToken}get hasAuthorized(){return this._hasAuthorized}get isAuthorized(){return this.storekit.hasAuthorized}get isRestricted(){return this.storekit.authorizationStatus===ne.RESTRICTED}get metricsClientId(){return this._metricsClientId}set metricsClientId(e){this._metricsClientId=e}get musicUserToken(){return this.storekit.userToken}set musicUserToken(e){this.storekit.userToken=e}updateUserTokenFromStorage(){return this.storekit.updateUserTokenFromStorage()}set dynamicMusicUserToken(e){this.storekit.dynamicUserToken=e}get needsGDPR(){Kn.error("needsGDPR has been deprecated. Plesae migrate to shouldDisplayPrivacyLink()")}get realm(){return this.storekit.realm}set requestUserToken(e){this._providedRequestUserToken=!0,this.storekit.requestUserToken=e}get restrictedEnabled(){return this.storekit.restrictedEnabled}set restrictedEnabled(e){this.storekit.overrideRestrictEnabled(e)}get storefrontCountryCode(){var e;return this.isAuthorized?this.storekit.storefrontCountryCode:null!==(e=this._defaultStorefrontCountryCode)&&void 0!==e?e:this.storekit.storefrontCountryCode}get storefrontId(){return this._apiStorefrontId||this.storekit.storefrontCountryCode}set storefrontId(e){e&&(e=e.toLowerCase()),e!==this._apiStorefrontId&&(this._apiStorefrontId=e,this._dispatcher.publish(et.apiStorefrontChanged,{storefrontId:e}))}get subscribeURL(){return this.storekit.deeplinkURL({p:"subscribe"})}get subscribeFamilyURL(){return this.storekit.deeplinkURL({p:"subscribe-family"})}get subscribeIndividualURL(){return this.storekit.deeplinkURL({p:"subscribe-individual"})}get subscribeStudentURL(){return this.storekit.deeplinkURL({p:"subscribe-student"})}get userToken(){return this.musicUserToken}authorize(){var e=this;return _async_to_generator$L((function*(){if(e.storekit.userTokenIsValid)return e.storekit.userToken;let t;try{t=yield e.storekit.requestUserToken()}catch(Ae){try{yield e.unauthorize()}catch(r){}throw new MKError(MKError.AUTHORIZATION_ERROR,"Unauthorized")}return e._providedRequestUserToken&&(e.storekit.userToken=t),e.storekit.userTokenIsValid?(yield e.storekit.requestStorefrontCountryCode().catch(function(){var t=_async_to_generator$L((function*(t){return yield e.unauthorize(),Promise.reject(t)}));return function(e){return t.apply(this,arguments)}}()),t):void 0}))()}shouldDisplayPrivacyLink(e){var t=this;return _async_to_generator$L((function*(){return t.storekit.shouldDisplayPrivacyLink(e)}))()}unauthorize(){var e=this;return _async_to_generator$L((function*(){return e.storekit.revokeUserToken()}))()}validateAgeVerification(t){var r=this;return _async_to_generator$L((function*(){var n;if(r.storekit.realm!==e.SKRealm.TV)return;const i=yield r.storekit.me();if(i.info){var o;if(i.info.webAgeVerificationData&&!i.info.webAgeVerificationData.isVerified&&r._ageVerificationRequired(t.type,null!==(o=null===(n=t.defaultPlayable)||void 0===n?void 0:n.rating)&&void 0!==o?o:t.rating)&&!t.isLinearStream)return Promise.reject(new MKError(MKError.AGE_VERIFICATION,"Age verification required"));if(t.rating&&i.info.parentalControlsData&&i.info.parentalControlsData.videoContentRestrictions){const e=t.rating.system.replace(/[^a-z0-9]+/i,"-");if(i.info.parentalControlsData.videoContentRestrictions[e]<t.rating.value)return Promise.reject(new MKError(MKError.CONTENT_RESTRICTED,"Content restricted"))}}}))()}constructor(t,r={}){_define_property$$(this,"precache",void 0),_define_property$$(this,"storekit",void 0),_define_property$$(this,"_apiStorefrontId",void 0),_define_property$$(this,"_defaultStorefrontCountryCode",void 0),_define_property$$(this,"_dispatcher",void 0),_define_property$$(this,"_hasAuthorized",!1),_define_property$$(this,"_metricsClientId",void 0),_define_property$$(this,"_providedRequestUserToken",!1),_define_property$$(this,"_ageVerificationRequired",(e,t)=>!0),this._dispatcher=r.services.dispatcher,r.precache&&(this.precache=r.precache),r.storefrontId&&(this.storefrontId=r.storefrontId),this._defaultStorefrontCountryCode=r.storefrontCountryCode,(r.affiliateToken||r.campaignToken)&&(r.linkParameters=_object_spread_props$m(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$$(e,t,r[t])}))}return e}({},r.linkParameters||{}),{at:r.affiliateToken,ct:r.campaignToken})),r.ageVerificationRequired&&(this._ageVerificationRequired=r.ageVerificationRequired),this.storekit=new StoreKit(t,{apiBase:Hn.urls.mediaApi,authenticateMethod:Hn.features["legacy-authenticate-method"]?"POST":"GET",deeplink:r.linkParameters,disableAuthBridge:r.disableAuthBridge,iconURL:Hn.app.icon,meParameters:r.meParameters,persist:r.persist,realm:r.realm||e.SKRealm.MUSIC,disableLogoutURL:r.disableLogoutURL}),this.storekit.addEventListener(Bn.authorizationStatusDidChange,e=>{const{authorizationStatus:t}=e;this._hasAuthorized=[ne.AUTHORIZED,ne.RESTRICTED].includes(t)})}}function formattedSeconds(e){return{hours:Math.floor(e/3600),minutes:Math.floor(e%3600/60)}}function asyncGeneratorStep$K(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$K(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$K(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$K(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function hasAuthorization(e){return void 0===e&&(e=qn&&qn.storekit),void 0!==e&&e.hasAuthorized&&e.userTokenIsValid}function hasMusicSubscription(e){return _hasMusicSubscription.apply(this,arguments)}function _hasMusicSubscription(){return(_hasMusicSubscription=_async_to_generator$K((function*(e){return void 0===e&&(e=qn&&qn.storekit),e.hasMusicSubscription()}))).apply(this,arguments)}function _define_property$_(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_decorate$n(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$n(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}class MediaSessionManager{onCapabilitiesChanged(){this._resetHandlers(),this._setMediaSessionHandlers()}onNowPlayingItemDidChange(e,{item:t}){this._setMediaSessionMetadata(t)}_setMediaSessionMetadata(e){var t,r;this.session&&"MediaMetadata"in window&&e&&(this.session.metadata=new window.MediaMetadata({title:e.title,artist:null!==(r=e.artistName)&&void 0!==r?r:null===(t=e.attributes)||void 0===t?void 0:t.showTitle,album:e.albumName,artwork:e.artwork?[96,128,192,256,384,512].map(t=>({src:formatArtworkURL(e.artwork,t,t),sizes:`${t}x${t}`,type:"image/jpeg"})):[]}))}_setMediaSessionHandlers(){this.session&&(this._resetHandlers(),this.session.setActionHandler("play",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.play()}),this.capabilities.canPause?this.session.setActionHandler("pause",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.pause()}):this.session.setActionHandler("pause",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.stop()}),this.capabilities.canSeek&&(this.session.setActionHandler("seekforward",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.seekForward()}),this.session.setActionHandler("seekbackward",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.seekBackward()})),this.capabilities.canSkipToNextItem&&this.session.setActionHandler("nexttrack",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.skipToNextItem()}),this.capabilities.canSkipToPreviousItem&&this.session.setActionHandler("previoustrack",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.skipToPreviousItem()}))}_resetHandlers(){this.session&&(this.session.setActionHandler("play",void 0),this.session.setActionHandler("pause",void 0),this.session.setActionHandler("seekforward",void 0),this.session.setActionHandler("seekbackward",void 0),this.session.setActionHandler("nexttrack",void 0),this.session.setActionHandler("previoustrack",void 0))}constructor(e,t){_define_property$_(this,"capabilities",void 0),_define_property$_(this,"dispatcher",void 0),_define_property$_(this,"controller",void 0),_define_property$_(this,"session",void 0),this.capabilities=e,this.dispatcher=t,this.session=navigator.mediaSession,this.session&&(this.dispatcher.subscribe(Bn.nowPlayingItemDidChange,this.onNowPlayingItemDidChange),this.dispatcher.subscribe(Bn.capabilitiesChanged,this.onCapabilitiesChanged),this._setMediaSessionHandlers())}}function _define_property$Z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var zn;_ts_decorate$n([Bind(),_ts_metadata$n("design:type",Function),_ts_metadata$n("design:paramtypes",[])],MediaSessionManager.prototype,"onCapabilitiesChanged",null),_ts_decorate$n([Bind(),_ts_metadata$n("design:type",Function),_ts_metadata$n("design:paramtypes",[void 0,void 0])],MediaSessionManager.prototype,"onNowPlayingItemDidChange",null),function(e){e[e.PAUSE=0]="PAUSE",e[e.EDIT_QUEUE=1]="EDIT_QUEUE",e[e.SEEK=2]="SEEK",e[e.REPEAT=3]="REPEAT",e[e.SHUFFLE=4]="SHUFFLE",e[e.SKIP_NEXT=5]="SKIP_NEXT",e[e.SKIP_PREVIOUS=6]="SKIP_PREVIOUS",e[e.SKIP_TO_ITEM=7]="SKIP_TO_ITEM",e[e.AUTOPLAY=8]="AUTOPLAY",e[e.VOLUME=9]="VOLUME"}(zn||(zn={}));class Capabilities{set controller(e){this._mediaSession.controller=e}updateChecker(e){this._checkCapability!==e&&(this._checkCapability=e,this._dispatcher.publish(Bn.capabilitiesChanged))}get canEditPlaybackQueue(){return this._checkCapability(zn.EDIT_QUEUE)}get canPause(){return this._checkCapability(zn.PAUSE)}get canSeek(){return this._checkCapability(zn.SEEK)}get canSetRepeatMode(){return this._checkCapability(zn.REPEAT)}get canSetShuffleMode(){return this._checkCapability(zn.SHUFFLE)}get canSkipToNextItem(){return this._checkCapability(zn.SKIP_NEXT)}get canSkipToMediaItem(){return this._checkCapability(zn.SKIP_TO_ITEM)}get canSkipToPreviousItem(){return this._checkCapability(zn.SKIP_PREVIOUS)}get canAutoplay(){return this._checkCapability(zn.AUTOPLAY)}get canSetVolume(){return this._checkCapability(zn.VOLUME)}constructor(e){_define_property$Z(this,"_dispatcher",void 0),_define_property$Z(this,"_checkCapability",void 0),_define_property$Z(this,"_mediaSession",void 0),this._dispatcher=e,this._checkCapability=e=>e===zn.VOLUME,this._mediaSession=new MediaSessionManager(this,e)}}function _define_property$Y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function transform$7(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$Y(e,t,r[t])}))}return e}({attributes:{}},transform$9({id:"metadata.itemId",type:"metadata.itemType","attributes.contentRating"(){var t,r;if(1===(null===(r=e)||void 0===r||null===(t=r.metadata)||void 0===t?void 0:t.isExplicit))return"explicit"},"attributes.playParams"(){var t,r,n,i,o,a;return 0!==(null===(r=e)||void 0===r||null===(t=r.metadata)||void 0===t?void 0:t.isPlayable)&&{id:null===(i=e)||void 0===i||null===(n=i.metadata)||void 0===n?void 0:n.itemId,kind:null===(a=e)||void 0===a||null===(o=a.metadata)||void 0===o?void 0:o.itemType}},"container.id":"metadata.containerId","container.name":"metadata.containerName","container.type":"metadata.containerType"},e))}const Yn=StringDevFlag.register("mk-logging-levels"),Qn=BooleanDevFlag.register("mk-console-logging"),Jn=L.ERROR;let Xn=Jn;const Zn=new Logger$1("mk",{level:Xn,handlers:{console:new class{get hasConsole(){return"undefined"!=typeof console}process(e){if(!this.enabled||!this.hasConsole)return;let t="log";if(this.mapLevels){const n=this.levelMapping.get(e.level);void 0!==(r=n)&&r in console&&(t=n)}var r,n;const i=null!==(n=e.args)&&void 0!==n?n:[],o=this.format(e);console[t](o,...i)}constructor(e={}){var t,r,n,i;_define_property$1T(this,"enabled",void 0),_define_property$1T(this,"mapLevels",void 0),_define_property$1T(this,"levelMapping",void 0),_define_property$1T(this,"format",void 0),this.enabled=null===(t=e.enabled)||void 0===t||t,this.mapLevels=null===(r=e.mapLevels)||void 0===r||r,this.levelMapping=null!==(n=e.levelMapping)&&void 0!==n?n:V,this.format=null!==(i=e.formatter)&&void 0!==i?i:G}}({enabled:!1}),external:new CallbackHandler(()=>{})}});function applyLoggingLevels(e){!function(e,t){walk(e,(function(e){let r;const n=e.namespace;e.clearLevel(),void 0===e.parent&&void 0!==t["*"]?r=getLoggingLevel(t["*"]):void 0!==t[n]&&(r=getLoggingLevel(t[n])),void 0!==r&&e.setLevel(r)}))}(Zn,function(e){const t=getLoggingLevel(e.trim(),{allowShorthands:!0});if(void 0!==t)return{"*":t};const r={},n=e.split(",").filter(e=>""!==e.trim());for(const c of n){var i,o;const e=c.split("=",2);if(2!==e.length)continue;var a;const t=null!==(a=null===(i=e[0])||void 0===i?void 0:i.trim())&&void 0!==a?a:"";var s;const n=getLoggingLevel(null!==(s=null===(o=e[1])||void 0===o?void 0:o.trim())&&void 0!==s?s:"",{allowShorthands:!0});""!==t&&void 0!==n&&(r[t]=n)}return r}(e))}function clearLoggingLevels(){Zn.setLevel(Xn),function(e,t={includeRoot:!0}){walk(e,(function(e){(void 0!==e.parent||t.includeRoot)&&e.clearLevel()}))}(Zn,{includeRoot:!1})}function setConsoleOutput(e){Zn.handlers.console.enabled=null!=e&&e}function setRootLoggingLevel(e){var t;Xn=null!==(t=getLoggingLevel(e))&&void 0!==t?t:Xn}const ei={getLogger:(e="*")=>Zn.getByNamespace(null!=e?e:"*"),setConsoleOutput(e){!0===e?(Qn.enable(),setConsoleOutput(!0),Zn.info("Console output is enabled with level "+Zn.levelName)):(Qn.disable(),setConsoleOutput(!1))},setLoggingLevels(e,t){""!==e.trim()?(Yn.set(e),applyLoggingLevels(e),ei.setConsoleOutput(null==t||t)):ei.clearLoggingLevels(null!=t&&t)},clearLoggingLevels(e=!1){ei.setConsoleOutput(e),Yn.clear(),clearLoggingLevels()}};function _define_property$X(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$X(e,t,r[t])}))}return e}function _object_spread_props$l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}Qn.enabled&&ei.setConsoleOutput(Qn.enabled),void 0!==Yn.value&&ei.setLoggingLevels(Yn.value,Qn.enabled);const ti={condition:()=>!0,toOptions:(e,t,r)=>[_object_spread_props$l(_object_spread$x({},e),{context:r})]};function _define_property$W(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$W(e,t,r[t])}))}return e}function _object_spread_props$k(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ri={condition:e=>{var t;return"stations"===e.type&&(null===(t=e.attributes)||void 0===t?void 0:t.isLive)},toOptions:(e,t,r)=>{var n;return[_object_spread_props$k(_object_spread$w({},e),{context:r,container:{attributes:e.attributes,id:e.id,type:e.type,name:null===(n=r)||void 0===n?void 0:n.featureName}})]}},hasRelationship=e=>t=>{var r,n;return!!(null===(n=t.relationships)||void 0===n||null===(r=n[e])||void 0===r?void 0:r.data)},typeIs=(...e)=>({type:t})=>e.includes(t),withBagPrefix=e=>{if(void 0===e||""===e)return;const{prefix:t}=Hn;return t?`${t}:${e}`:e};function _define_property$V(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread_props$j(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var ni;const getContainerName=(e,t)=>{var r,n;return null!==(ni=null!=t?t:null===(n=e)||void 0===n||null===(r=n.container)||void 0===r?void 0:r.name)&&void 0!==ni?ni:nt.SONG},ii={toOptions:(e,t,r)=>{var n;const i=_object_spread_props$j(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$V(e,t,r[t])}))}return e}({id:e.id},t),{name:withBagPrefix(getContainerName(e,null===(n=r)||void 0===n?void 0:n.featureName))});return[{relationships:e.relationships,attributes:e.attributes,id:e.id,type:e.type,container:i,context:r}]},condition:typeIs("songs","library-songs","music-videos")};function _define_property$U(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$U(e,t,r[t])}))}return e}function _object_spread_props$i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const parseAssets=({type:e,attributes:{assetTokens:t}})=>e.includes("udio")?(e=>{if(void 0===e)return;const[t]=Object.keys(e);return e[t]})(t):(e=>{if(void 0===e)return;const t=Object.keys(e);return e[t[t.length-1]]})(t),oi={condition:typeIs("uploaded-audios","uploadedAudio","uploaded-videos","uploadedVideo"),toOptions:(e,t,r)=>{var n,i,o,a;const s=_object_spread_props$i(_object_spread$u({},e),{context:r,attributes:_object_spread_props$i(_object_spread$u({},e.attributes),{assetUrl:parseAssets(e),playParams:null!==(a=null===(i=e)||void 0===i||null===(n=i.attributes)||void 0===n?void 0:n.playParams)&&void 0!==a?a:{id:e.id,kind:e.type}})});var c;(void 0!==t&&(s.container=t),void 0!==(null===(o=r)||void 0===o?void 0:o.featureName))&&(s.container=_object_spread_props$i(_object_spread$u({},s.container),{name:null===(c=r)||void 0===c?void 0:c.featureName}));return[s]}};function _define_property$T(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread_props$h(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ai={toOptions:(e,t,r)=>e.relationships.episodes.data.map(e=>_object_spread_props$h(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$T(e,t,r[t])}))}return e}({},e),{context:r})),condition:hasRelationship("episodes"),requiredRelationships:["episodes"]};function asyncGeneratorStep$J(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$J(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$J(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$J(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$S(e,t,r[t])}))}return e}function formatRatingsContentType(e,t){return n(t)&&i(t)?e.replace(/^library-/,""):n(t)&&!/^library-/.test(e)?"library-"+e:e}function normalizeAdamId(e){return e.replace(/^a\./,"")}function makeRequest(e,t,r){return _makeRequest.apply(this,arguments)}function _makeRequest(){return(_makeRequest=_async_to_generator$J((function*(e,t,r,n={}){let i,o=t;const a=r&&r.ids;n=_object_spread$s({},n);const{shouldCacheResults:s=!0,returnRawJSONApiRecords:c=!1,includePagination:l=e.defaultIncludePaginationMetadata,includeResponseMeta:d=!1}=n;delete n.shouldCacheResults,delete n.returnRawJSONApiRecords,delete n.includePagination,delete n.includeResponseMeta,"string"==typeof a&&(o=`${t}/${encodeURIComponent(a)}`,r&&delete r.ids);try{(l||d)&&(n.useRawResponse=!0),i=yield e.request(o,r,n)}catch(u){return"status"in u?404===u.status?Promise.reject(new MKError(MKError.CONTENT_UNAVAILABLE,"The requested content is not available.")):Promise.reject(MKError.responseError(u)):Promise.reject(MKError.internalError(u))}try{const t=i.results||i.data||i;if("object"==typeof i&&"results"in i&&"meta"in i&&(t.meta=i.meta),0===t.length)return Promise.reject(new MKError(MKError.CONTENT_UNAVAILABLE,"The requested content is not available."));const o=c?t:e.parseResultData(s,t);if(!l&&!d)return o;if("results"in i){for(const t in i.results)"meta"!==t&&(o[t]=paginateResultSet(i.results[t],o[t],e,r,n));return o}return paginateResultSet(i,o,e,r,n)}catch(Ae){return Promise.reject(MKError.parseError(Ae))}}))).apply(this,arguments)}function paginateResultSet(e,t,r,n,i={}){let o,a;i.includePagination=!0;const s=_object_spread$s({},i);return delete s.offset,e.next&&(o=()=>makeRequest(r,formatPaginatedUrl(r.url,e.next),n,s)),e.previous&&(a=()=>makeRequest(r,formatPaginatedUrl(r.url,e.previous),n,s)),{data:t,next:o,previous:a,meta:e.meta}}function mapRequestResult(e,t){return"data"in e?(e.data=t(e.data),e):t(e)}function formatPaginatedUrl(e,t){if("function"!=typeof URL)throw new Error("formatPaginatedUrl requires an implementation of URL");const{pathname:r}=new URL(e),n=new RegExp(`^${r}/`);return t.replace(n,"")}const getFeatureName=(e,t)=>{if(t)return t;const r=function(e=[]){return 0!==e.length&&e.filter(({attributes:e})=>!!e&&(e.workName||e.movementName||e.movementCount||e.movementNumber)).length>0}(e.relationships.tracks.data);return"albums"===e.type||"library-albums"===e.type?r?nt.ALBUM_CLASSICAL:nt.ALBUM:"playlists"===e.type||"library-playlists"===e.type?r?nt.PLAYLIST_CLASSICAL:nt.PLAYLIST:void 0},si=[{toOptions:(e,t,r)=>{var n;const i={attributes:e.attributes,id:e.id,type:e.type,name:withBagPrefix(getFeatureName(e,null===(n=r)||void 0===n?void 0:n.featureName))};return e.relationships.tracks.data.map(e=>({attributes:e.attributes,id:e.id,type:e.type,container:i,context:r}))},condition:hasRelationship("tracks"),requiredRelationships:["tracks"]},ai,ii,ri,oi],ci=si.reduce((e,t)=>{const r=t.requiredRelationships;return r&&e.push(...r),e},[]),li=new Set(ci),isArrayOf=(e,t)=>Array.isArray(e)&&(0===e.length||t(e[0])),isMediaAPIResource=e=>e&&void 0!==e.id&&void 0!==e.type,isMediaItem=e=>e&&void 0!==e.id,isMPMediaItem=e=>e&&void 0!==e.contentId&&void 0!==e.metadata&&void 0!==e.metadata.itemId&&void 0!==e.metadata.itemType,isQueueLoaded=e=>e&&e.loaded,isQueueURLOption=e=>e&&e.url;function _define_property$R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const di=Zn.linkChild(new Logger$1("queue")),descriptorToMediaItems=e=>{if(!(e=>e&&e.items&&Array.isArray(e.items))(e)&&!isQueueLoaded(e))return[];const t=isQueueLoaded(e)?loadedDescriptorToMediaItem(e):unloadedDescriptorToMediaItem(e);return t.forEach(t=>t.context=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$R(e,t,r[t])}))}return e}({},e.context,t.context)),t},unloadedDescriptorToMediaItem=({items:e})=>isArrayOf(e,isMPMediaItem)?e.map(e=>new MediaItem(transform$7(e))):isArrayOf(e,isMediaItem)?e.map(e=>new MediaItem(e)):[],loadedDescriptorToMediaItem=e=>{const t=[],{loaded:r,container:n,context:i}=e;return void 0===r?[]:isArrayOf(r,isDataRecord)?(r.forEach(e=>{t.push(...dataRecordToMediaItems(e,n,i))}),t):isArrayOf(r,isMediaAPIResource)?(r.forEach(e=>{t.push(...resourceToMediaItem(e,n,i))}),t):isDataRecord(r)?dataRecordToMediaItems(r,n,i):isMediaAPIResource(r)?resourceToMediaItem(r,n,i):[]},dataRecordToMediaItems=(e,t,r={})=>{const{data:n}=e.serialize(!0,void 0,{includeRelationships:li,allowFullDuplicateSerializations:!0});return resourceToMediaItem(n,t,r)},resourceToMediaItem=(e,t,r={})=>(di.debug("_resourceToMediaItem",e),((e,t,r={})=>{var n,i,o,a;t=null!==(o=null===(i=t)||void 0===i||null===(n=i.serialize)||void 0===n?void 0:n.call(i).data)&&void 0!==o?o:t;return(null!==(a=si.find(n=>n.condition(e,t,r)))&&void 0!==a?a:ti).toOptions(e,t,r).map(e=>new MediaItem(e))})(e,t,r));function _define_property$Q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class BaseModifiableQueue{append(e){Kn.warn("Append is not supported for this type of playback")}clear(){Kn.warn("Clear is not supported for this type of playback")}insertAt(e,t){Kn.warn("InsertAt is not supported for this type of playback")}prepend(e,t=!1){Kn.warn("Prepend is not supported for this type of playback")}constructor(){_define_property$Q(this,"queue",void 0),_define_property$Q(this,"canModifyQueue",!1)}}class ModifiableQueue{append(e){const t=descriptorToMediaItems(e);this.queue.splice(this.queue.appendTargetIndex,0,t)}clear(){this.queue.length&&(this.queue.splice(0,this.queue.length),this.queue.reset())}insertAt(e,t){const r=descriptorToMediaItems(t);this.queue.splice(e,0,r)}prepend(e,t=!1){const r=descriptorToMediaItems(e),n=this.queue.position+1;t&&this.queue.splice(n,this.queue.length),this.queue.splice(n,0,r)}constructor(e,t){_define_property$Q(this,"queue",void 0),_define_property$Q(this,"canModifyQueue",!0),_define_property$Q(this,"_mediaItemPlayback",void 0),this.queue=e,this._mediaItemPlayback=t}}function _define_property$P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ui;!function(e){e[e.none=0]="none",e[e.one=1]="one",e[e.all=2]="all"}(ui||(ui={}));class BaseRepeatable{get repeatMode(){return ui.none}set repeatMode(e){e!==this.repeatMode&&Kn.warn("setting repeatMode is not supported in this playback method")}constructor(){_define_property$P(this,"canSetRepeatMode",!1)}}class Repeatable{get repeatMode(){return this._repeatMode}set repeatMode(e){e in ui&&e!==this._repeatMode&&(this._repeatMode=e,this.dispatcher.publish(Bn.repeatModeDidChange,this._repeatMode))}constructor(e,t=ui.none){_define_property$P(this,"canSetRepeatMode",!0),_define_property$P(this,"dispatcher",void 0),_define_property$P(this,"_repeatMode",void 0),this.dispatcher=e,this._repeatMode=t}}function _define_property$O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const pi=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$O(e,t,r[t])}))}return e}({},{NEXT_ITEM:"NEXT"},ot);function asyncGeneratorStep$I(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$I(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$I(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$I(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$N(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const hi=["EditorialVideoClip","uploaded-videos","uploadedVideo","musicVideo"],yi=function(){var e=_async_to_generator$I((function*(){}));return function(){return e.apply(this,arguments)}}();class BaseSeekable{getSeekSeconds(e){return Kn.warn("Seeking by predetermined amounts are not supported in this playback method"),{BACK:0,FORWARD:0}}seekBackward(e=yi){Kn.warn("seekBackward is not supported in this playback method")}seekForward(e=yi){Kn.warn("seekForward is not supported in this playback method")}seekToTime(e,t){return _async_to_generator$I((function*(){Kn.warn("seekToTime is not supported in this playback method")}))()}constructor(e){_define_property$N(this,"mediaItemPlayback",void 0),_define_property$N(this,"canSeek",void 0),this.mediaItemPlayback=e,this.canSeek=!1}}class Seekable{getSeekSeconds(e){return(e=>{var t,r,n;return(null===(t=e)||void 0===t?void 0:t.isUTS)||hi.includes(null===(r=e)||void 0===r?void 0:r.type)?{FORWARD:10,BACK:10}:(null===(n=e)||void 0===n?void 0:n.isAOD)?{FORWARD:30,BACK:30}:{FORWARD:30,BACK:15}})(e)}seekBackward(t=this._seekToBeginning){var r=this;return _async_to_generator$I((function*(){if(void 0===r.mediaItemPlayback.nowPlayingItem)return void Kn.warn("Cannot seekBackward when nowPlayingItem is not yet set.");const n=r.mediaItemPlayback.currentPlaybackTime-r.getSeekSeconds(r.mediaItemPlayback.nowPlayingItem).BACK;n<0?yield t.call(r):yield r.seekToTime(n,e.SeekReasonType.Interval)}))()}seekForward(t=this._seekToEnd){var r=this;return _async_to_generator$I((function*(){if(void 0===r.mediaItemPlayback.nowPlayingItem)return void Kn.warn("Cannot seekForward when nowPlayingItem is not yet set.");const n=r.mediaItemPlayback.currentPlaybackTime+r.getSeekSeconds(r.mediaItemPlayback.nowPlayingItem).FORWARD;n>r.mediaItemPlayback.currentPlaybackDuration?yield t.call(r):yield r.seekToTime(n,e.SeekReasonType.Interval)}))()}seekToTime(t,r=e.SeekReasonType.Manual){var n=this;return _async_to_generator$I((function*(){if(void 0===n.mediaItemPlayback.nowPlayingItem)return void Kn.warn("Cannot seekToTime when nowPlayingItem is not yet set.");const e=n.mediaItemPlayback.nowPlayingItem,i=n.mediaItemPlayback.currentPlaybackTime,o=n.mediaItemPlayback.currentPlayingDate,a=Math.min(Math.max(0,t),n.mediaItemPlayback.currentPlaybackDuration);let s;if(e.isLinearStream&&void 0!==o){const e=1e3*(a-i);s=new Date(o.getTime()+e)}yield n.mediaItemPlayback.seekToTime(a,r),n._dispatcher.publish(et.playbackSeek,{item:e,startPosition:i,position:a,playingDate:s,startPlayingDate:o,seekReasonType:r})}))()}_seekToBeginning(){var t=this;return _async_to_generator$I((function*(){yield t.seekToTime(0,e.SeekReasonType.Interval)}))()}_seekToEnd(){var t=this;return _async_to_generator$I((function*(){yield t.seekToTime(t.mediaItemPlayback.currentPlaybackDuration,e.SeekReasonType.Interval)}))()}constructor(e,t){_define_property$N(this,"_dispatcher",void 0),_define_property$N(this,"mediaItemPlayback",void 0),_define_property$N(this,"canSeek",void 0),this._dispatcher=e,this.mediaItemPlayback=t,this.canSeek=!0}}const shuffleCollection=e=>{const t=[...e],{length:r}=t;for(let n=0;n<r;++n){const e=n+Math.floor(Math.random()*(r-n)),i=t[e];t[e]=t[n],t[n]=i}return t};function _define_property$M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_without_properties$1(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}const _i=Zn.createChild("queue");class QueueItem{restrict(){return this.item.restrict()}constructor(e,t){var r,n;_define_property$M(this,"isAutoplay",!1),_define_property$M(this,"item",void 0),this.item=e,this.isAutoplay=null!==(n=null===(r=t)||void 0===r?void 0:r.isAutoplay)&&void 0!==n&&n}}function toQueueItems(e,t){return e.map(e=>new QueueItem(e,t))}function toMediaItems(e){return e.map(e=>e.item)}const{queueItemsDidChange:fi,queuePositionDidChange:vi}=Bn;class Queue{get isEmpty(){return 0===this.length}set isRestricted(e){this._isRestricted=e,this._isRestricted&&this._queueItems&&this._queueItems.forEach(e=>{e.restrict()})}get isRestricted(){return this._isRestricted}get appendTargetIndex(){let e=this.length;const t=this._queueItems.findIndex(e=>e.isAutoplay);return-1!==t&&this.position<t&&(e=t),e}get items(){return toMediaItems(this._queueItems)}get autoplayItems(){return toMediaItems(this._queueItems.filter(e=>e.isAutoplay))}get unplayedAutoplayItems(){return toMediaItems(this._unplayedQueueItems.filter(e=>e.isAutoplay))}get userAddedItems(){return toMediaItems(this._queueItems.filter(e=>!e.isAutoplay))}get unplayedUserItems(){return toMediaItems(this._unplayedQueueItems.filter(e=>!e.isAutoplay))}get playableItems(){return toMediaItems(this._queueItems.filter(e=>canPlay(e.item,this.playbackMode)))}get unplayedPlayableItems(){return toMediaItems(this._unplayedQueueItems.filter(e=>canPlay(e.item,this.playbackMode)))}get length(){return this._queueItems.length}get nextPlayableItem(){if(-1!==this.nextPlayableItemIndex)return this.item(this.nextPlayableItemIndex)}get nextPlayableItemIndex(){return this._nextPlayableItemIndex=this.findPlayableIndexForward(),this._nextPlayableItemIndex}get position(){return this._position}set position(e){this._updatePosition(e)}get isInitiated(){return this.position>=0}get previousPlayableItem(){if(-1!==this.previousPlayableItemIndex)return this.item(this.previousPlayableItemIndex)}get previousPlayableItemIndex(){return this.findPlayableIndexBackward()}removeQueueItems(e){for(let t=this.length-1;t>=0;t--)e(this.queueItem(t),t)&&this.spliceQueueItems(t,1)}indexForItem(e){return("string"==typeof e?this._itemIDs:this.items).indexOf(e)}item(e){var t;return null===(t=this.queueItem(e))||void 0===t?void 0:t.item}get currentItem(){return this.item(this.position)}queueItem(e){var t;return null===(t=this._queueItems)||void 0===t?void 0:t[e]}updateItems(e){this._queueItems=toQueueItems(e),this._reindex(),this._dispatcher.publish(Bn.queueItemsDidChange,this.items)}get currentQueueItem(){return this.queueItem(this.position)}remove(e){if(deprecationWarning("remove",{message:"The queue remove function has been deprecated"}),e===this.position)throw new MKError(MKError.INVALID_ARGUMENTS);this.splice(e,1)}append(e=[]){return this.appendQueueItems(toQueueItems(e))}appendQueueItems(e=[]){return this.spliceQueueItems(this.appendTargetIndex,0,e)}splice(e,t,r=[]){return toMediaItems(this.spliceQueueItems(e,t,toQueueItems(r)))}spliceQueueItems(e,t,r=[],n=!0){r=r.filter(e=>{var t;return isPlayable(null===(t=e)||void 0===t?void 0:t.item,this.playbackMode)});const i=this._queueItems.splice(e,t,...r);return this._itemIDs.splice(e,t,...r.map(e=>e.item.id)),n&&(this._dispatcher.publish(et.queueModified,{start:e,added:toMediaItems(r),removed:toMediaItems(i)}),this._dispatcher.publish(fi,this.items)),i}reset(){const e=this.position;this._position=-1,this._dispatcher.publish(vi,{oldPosition:e,position:this.position})}_isSameItems(e){if(e.length!==this.length)return!1;const t=e.map(e=>e.id).sort(),r=[...this._itemIDs].sort();let n,i;try{n=JSON.stringify(t),i=JSON.stringify(r)}catch(o){return!1}return n===i}_reindex(){this._queueItems&&(this._itemIDs=this._queueItems.map(e=>e.item.id))}_updatePosition(e){if(e===this._position)return;const t=this._position;this._position=e;const r=this.item(e);r&&canPlay(r,this.playbackMode)||(this._position=this.findPlayableIndexForward(e)),this._position!==t&&this._dispatcher.publish(vi,{oldPosition:t,position:this._position})}findPlayableIndexForward(e=this.position){var t;if(this.isEmpty)return-1;if(this.isInitiated&&!indexInBounds([0,this.position],e))return-1;const r=null===(t=this.repeatable)||void 0===t?void 0:t.repeatMode;if(e<this.length)for(let n=e+1;n<this.length;n++){if(canPlay(this.item(n),this.playbackMode))return n}if(r===ui.all)for(let n=0;n<=e;n++){if(canPlay(this.item(n),this.playbackMode))return n}return-1}findPlayableIndexBackward(e=this.position){var t;if(this.isEmpty)return-1;if(!indexInBounds([0,this.position],e))return-1;const r=null===(t=this.repeatable)||void 0===t?void 0:t.repeatMode;if(e>0)for(let n=e-1;n>=0;n--){if(canPlay(this.item(n),this.playbackMode))return n}if(r===ui.all)for(let n=this.length-1;n>=e;n--){if(canPlay(this.item(n),this.playbackMode))return n}return-1}get _unplayedQueueItems(){const e=this.position<0?0:this.position;return this._queueItems.slice(e)}_getStartItemPosition(e){if(void 0===e)return-1;if("object"==typeof e&&"id"in e&&(e=e.id),"string"==typeof e)return this.indexForItem(e);const t=parseInt(""+e,10);return t>=0&&t<this.length?t:-1}constructor(t){if(_define_property$M(this,"repeatable",void 0),_define_property$M(this,"hasAutoplayStation",!1),_define_property$M(this,"playbackMode",e.PlaybackMode.MIXED_CONTENT),_define_property$M(this,"_itemIDs",[]),_define_property$M(this,"_queueItems",[]),_define_property$M(this,"_isRestricted",!1),_define_property$M(this,"_nextPlayableItemIndex",-1),_define_property$M(this,"_position",-1),_define_property$M(this,"_dispatcher",void 0),this._dispatcher=t.services.dispatcher,this.playbackMode=t.playbackMode,!t.descriptor)return;const r=descriptorToMediaItems(t.descriptor).filter(e=>isPlayable(e,this.playbackMode));this._queueItems=toQueueItems(r),this._reindex(),void 0!==t.descriptor.startWith&&(this.position=this._getStartItemPosition(t.descriptor.startWith))}}function isPlayable(t,r){return t.isPlayable||r!==e.PlaybackMode.FULL_PLAYBACK_ONLY&&void 0!==t.previewURL}function canPlay(e,t){return isPlayable(e,t)&&!function(e){return e.isRestricted}(e)&&!function(e){return e.isUnavailable}(e)}function indexInBounds(e,t){return e[0]<=t&&t<=e[1]}function _define_property$L(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_metadata$m(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var gi;!function(e){e[e.off=0]="off",e[e.songs=1]="songs"}(gi||(gi={}));const mi="Shuffling is not supported in this playback method.";class BaseShuffler{set shuffle(e){Kn.warn(mi)}get shuffleMode(){return gi.off}set shuffleMode(e){Kn.warn(mi)}checkAndReshuffle(e){Kn.warn(mi)}constructor(){_define_property$L(this,"canSetShuffleMode",!1),_define_property$L(this,"queue",void 0)}}class Shuffler{get queue(){return this._queue}set queue(e){this._queue=e,this._unshuffledIDs=e.userAddedItems.map(e=>e.id),this.checkAndReshuffle(!1)}queueModifiedHandler(e,t){if(this._isSpliceFromShuffle)return void(this._isSpliceFromShuffle=!1);const{start:r,added:n,removed:i}=t;if(i.length>0){const e=i.map(e=>e.id);this._unshuffledIDs=this._unshuffledIDs.filter(t=>!e.includes(t))}n.length>0&&this._unshuffledIDs.splice(r,0,...n.map(e=>e.id))}set shuffle(e){this.shuffleMode=e?gi.songs:gi.off}get shuffleMode(){return this.mode}set shuffleMode(e){e!==this.shuffleMode&&e in gi&&(Kn.debug(`mk: set shuffleMode from ${this.shuffleMode} to ${e}`),this.mode=e,this.mode===gi.songs?this.shuffleQueue():this.unshuffleQueue(),this.controller.nowPlayingItem&&(this._queue.position=this._queue.indexForItem(this.controller.nowPlayingItem.id)),this.dispatcher.publish(Bn.shuffleModeDidChange,this.shuffleMode))}checkAndReshuffle(e=!1){this.shuffleMode===gi.songs&&this.shuffleQueue(e)}shuffleQueue(e=!0){const{userAddedItems:t}=this._queue;if(t.length<=1)return t;const r=t.slice(0),n=this._queue.position>-1?r.splice(this._queue.position,1):[];let i=[];do{i=shuffleCollection(r)}while(r.length>1&&arrayEquals(i,r));const o=[...n,...i];this._isSpliceFromShuffle=!0,this._queue.spliceQueueItems(0,o.length,toQueueItems(o),e)}unshuffleQueue(e=!0){let t=[];const r=this._unshuffledIDs.reduce((e,t,r)=>(e[t]=r,e),{}),n=[];let i=0;const o=this._queue.item(this._queue.position);this._queue.userAddedItems.forEach(e=>{var a;const s=r[e.id];void 0===s&&n.push(e),t[s]=e,e.id===(null===(a=o)||void 0===a?void 0:a.id)&&(i=s)}),t=t.filter(Boolean);const a=t.concat(n);this._isSpliceFromShuffle=!0,this._queue.spliceQueueItems(0,a.length,toQueueItems(a),e),this._queue.position=i}constructor(e,{dispatcher:t}){_define_property$L(this,"controller",void 0),_define_property$L(this,"canSetShuffleMode",void 0),_define_property$L(this,"dispatcher",void 0),_define_property$L(this,"mode",void 0),_define_property$L(this,"_queue",void 0),_define_property$L(this,"_unshuffledIDs",void 0),_define_property$L(this,"_isSpliceFromShuffle",void 0),this.controller=e,this.canSetShuffleMode=!0,this.mode=gi.off,this._unshuffledIDs=[],this._isSpliceFromShuffle=!1,this.dispatcher=t,this.dispatcher.subscribe(et.queueModified,this.queueModifiedHandler),this._queue=e.queue}}function asyncGeneratorStep$H(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$H(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$H(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$H(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$K(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$K(e,t,r[t])}))}return e}function _object_spread_props$g(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_metadata$l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var bi;!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$m("design:type",Function),_ts_metadata$m("design:paramtypes",[String,Object])],Shuffler.prototype,"queueModifiedHandler",null),function(e){e.continuous="continuous",e.serial="serial"}(bi||(bi={}));const{queueItemsDidChange:Si}=Bn;class PlaybackController{get isDestroyed(){return this._isDestroyed}updateAutoplay(e,t){this.autoplayEnabled=t}constructContext(e,t){var r;let n=e.context;var i;return void 0!==e.featureName&&void 0===(null===(r=n)||void 0===r?void 0:r.featureName)&&(Kn.warn("featureName is deprecated, pass it inside context"),n||(n={}),n.featureName=e.featureName),null!==(i=null!=n?n:t)&&void 0!==i?i:{}}get context(){return this._context}get continuous(){return this._continuous||this.hasAuthorization}set continuous(e){this._continuous=e}get autoplayEnabled(){return this._autoplayEnabled}set autoplayEnabled(e){this._autoplayEnabled=e}get previewOnly(){return this._mediaItemPlayback.previewOnly}get _dispatcher(){return this._services.dispatcher}get hasAuthorization(){return hasAuthorization(this.storekit)}get isPlaying(){return this._mediaItemPlayback.isPlaying}get isPrimaryPlayer(){return this._mediaItemPlayback.isPrimaryPlayer}set isPrimaryPlayer(e){this._mediaItemPlayback.isPrimaryPlayer=e}get isReady(){return this._mediaItemPlayback.isReady}get _mediaItemPlayback(){return this._services.mediaItemPlayback}get nowPlayingItem(){return this._mediaItemPlayback.nowPlayingItem}get nowPlayingItemIndex(){return this.queue?this.queue.position:-1}get playbackMode(){return this._playbackMode}set playbackMode(e){this._playbackMode=e,this.queue&&(this.queue.playbackMode=e)}get queue(){return this._queue}set queue(e){this._prepareQueue(e),this._queue=e,this._shuffler.queue=this._queue,this._queueModifier.queue=this._queue,this._dispatcher.publish(Si,e.items)}get repeatMode(){return this._repeatable.repeatMode}set repeatMode(e){this._repeatable.repeatMode=e}get seekSeconds(){const{nowPlayingItem:e}=this;if(void 0!==e)return this._seekable.getSeekSeconds(e)}set shuffle(e){this._shuffler.shuffle=e}get shuffleMode(){return this._shuffler.shuffleMode}set shuffleMode(e){this._shuffler.shuffleMode=e}get storekit(){return this._storekit}set storekit(e){if(e){var t=this;e.addEventListener(le.authorizationStatusWillChange,function(){var e=_async_to_generator$H((function*({authorizationStatus:e,newAuthorizationStatus:r}){e>ne.DENIED&&r<ne.RESTRICTED?yield t.stop({endReasonType:ot.PLAYBACK_SUSPENDED,userInitiated:!1}):yield t.stop({userInitiated:!1})}));return function(t){return e.apply(this,arguments)}}()),this._storekit=e}}append(e){var t=this;return _async_to_generator$H((function*(){const r=yield t._dataForQueueOptions(e);return t._queueModifier.append(r),t.queue}))()}insertAt(e,t){var r=this;return _async_to_generator$H((function*(){const n=yield r._dataForQueueOptions(t);return r._queueModifier.insertAt(e,n),r.queue}))()}_dataForQueueOptions(e){var t=this;return _async_to_generator$H((function*(){const r=t.constructContext(e,t.context);return _object_spread_props$g(_object_spread$p({},e),{context:r})}))()}clear(){var e=this;return _async_to_generator$H((function*(){return e._queueModifier.clear(),e.queue}))()}changeToMediaAtIndex(e=0){var t=this;return _async_to_generator$H((function*(){var r,n,i,o;yield t.stop();const a=null===(r=t.queue.item(e))||void 0===r?void 0:r.id;let s=(null===(o=null===(i=t._mediaItemPlayback)||void 0===i||null===(n=i.playOptions)||void 0===n?void 0:n.get(a))||void 0===o?void 0:o.startTime)||0;const c=yield t._changeToMediaAtIndex(e,{userInitiated:!0});c&&(c.id!==a&&(s=0),t._dispatcher.publish(et.playbackPlay,{item:c,position:s}))}))()}changeToMediaItem(e){var t=this;return _async_to_generator$H((function*(){const r=t.queue.indexForItem(e);return-1===r?Promise.reject(new MKError(MKError.MEDIA_DESCRIPTOR)):t.changeToMediaAtIndex(r)}))()}activate(){Kn.debug("mk: base controller - activate"),this._dispatcher.unsubscribe(Bn.playbackStateDidChange,this.onPlaybackStateDidChange),this._dispatcher.subscribe(Bn.playbackStateDidChange,this.onPlaybackStateDidChange),this._skipIntro.activate(),this._upNext.activate(),this._rollMonitor.activate()}deactivate(){var e=this;return _async_to_generator$H((function*(){yield e.stop(),e._dispatcher.unsubscribe(Bn.playbackStateDidChange,e.onPlaybackStateDidChange),e._skipIntro.deactivate(),e._upNext.deactivate(),e._rollMonitor.deactivate()}))()}destroy(){var e=this;return _async_to_generator$H((function*(){e._isDestroyed=!0,yield e.deactivate(),e._dispatcher.unsubscribe(Bn.autoplayEnabledDidChange,e.updateAutoplay)}))()}hasCapabilities(e){switch(e){case zn.SEEK:return this._seekable.canSeek;case zn.REPEAT:return this._repeatable.canSetRepeatMode;case zn.SHUFFLE:return this._shuffler.canSetShuffleMode;case zn.EDIT_QUEUE:return this._queueModifier.canModifyQueue;case zn.PAUSE:case zn.SKIP_NEXT:case zn.SKIP_TO_ITEM:case zn.AUTOPLAY:case zn.VOLUME:return!0;case zn.SKIP_PREVIOUS:default:return!1}}pause(e){var t=this;return _async_to_generator$H((function*(){return t._mediaItemPlayback.pause(e)}))()}play(){var e=this;return _async_to_generator$H((function*(){if(e.nowPlayingItem)return e._mediaItemPlayback.play();if(!e._queue||e._queue.isEmpty)return;if(e.nowPlayingItemIndex>=0)return e.changeToMediaAtIndex(e.nowPlayingItemIndex);const{queue:t}=e;if(-1!==t.nextPlayableItemIndex)return e.changeToMediaAtIndex(t.nextPlayableItemIndex);t.isRestricted&&t.items.every(e=>e.isRestricted)&&e._dispatcher.publish(Bn.mediaPlaybackError,new MKError(MKError.CONTENT_RESTRICTED,"Content restricted"))}))()}playSingleMediaItem(e,t){var r=this;return _async_to_generator$H((function*(){yield Vn(e,t),r._dispatcher.publish(Bn.queueItemsDidChange,[e]);const n=yield r._mediaItemPlayback.startMediaItemPlayback(e,!0);if(n){var i;const e={item:n,position:null!==(i=r._mediaItemPlayback.currentPlaybackTime)&&void 0!==i?i:0,playingDate:r._mediaItemPlayback.currentPlayingDate,userInitiated:!0};Kn.debug("playSingleMediaItem: Dispatching DispatchTypes.playbackPlay event",e),r._dispatcher.publish(et.playbackPlay,e)}}))()}onPlaybackStateDidChange(t,r){var n=this;return _async_to_generator$H((function*(){r.state===e.PlaybackStates.ended&&(n.continuous||n.repeatMode===ui.one)&&(Kn.debug("controller detected track ended event, moving to next item."),n._dispatcher.publish(et.applicationActivityIntent,{endReasonType:ot.TRACK_SKIPPED_FORWARDS,userInitiated:!1}),yield n._next())}))()}preload(){var e=this;return _async_to_generator$H((function*(){return e._mediaItemPlayback.preload()}))()}prepend(e,t){var r=this;return _async_to_generator$H((function*(){const n=yield r._dataForQueueOptions(e);return r._queueModifier.prepend(n,t),r.queue}))()}prepareToPlay(e){var t=this;return _async_to_generator$H((function*(){return t._mediaItemPlayback.prepareToPlay(e)}))()}showPlaybackTargetPicker(){this._mediaItemPlayback.showPlaybackTargetPicker()}seekBackward(){var e=this;return _async_to_generator$H((function*(){return e._seekable.seekBackward()}))()}seekForward(){var e=this;return _async_to_generator$H((function*(){return e._seekable.seekForward(e.skipToNextItem.bind(e))}))()}skipToNextItem(){var e=this;return _async_to_generator$H((function*(){return e._next({userInitiated:!0})}))()}skipToPreviousItem(){var e=this;return _async_to_generator$H((function*(){return e._previous({userInitiated:!0})}))()}getNewSeeker(){return this._mediaItemPlayback.getNewSeeker()}seekToTime(e,t){var r=this;return _async_to_generator$H((function*(){yield r._seekable.seekToTime(e,t)}))()}setQueue(e){var t=this;return _async_to_generator$H((function*(){return yield t.extractGlobalValues(e),yield t._mediaItemPlayback.stop(),t.returnQueueForOptions(e)}))()}extractGlobalValues(e){var t=this;return _async_to_generator$H((function*(){t._context=t.constructContext(e),void 0!==e.featureName&&e.context&&(Kn.warn("featureName is deprecated, pass it inside context"),e.context.featureName=e.featureName)}))()}stop(e){var t=this;return _async_to_generator$H((function*(){yield t._mediaItemPlayback.stop(e)}))()}_changeToMediaAtIndex(e=0,t={}){var r=this;return _async_to_generator$H((function*(){if(r.queue.isEmpty)return;r.queue.position=e;const n=r.queue.item(r.queue.position);if(!n)return;var i;const o=yield r._mediaItemPlayback.startMediaItemPlayback(n,null!==(i=t.userInitiated)&&void 0!==i&&i);if(o||n.state!==E.unsupported)return o;yield r.skipToNextItem()}))()}_next(e={}){var t=this;return _async_to_generator$H((function*(){if(t.queue.isEmpty)return;const{userInitiated:r=!1}=e;return t.repeatMode===ui.one&&void 0!==t.queue.currentItem?(yield t.stop(_object_spread$p({userInitiated:r},e)),void(yield t.play())):(!r&&e.seamlessAudioTransition&&(t._dispatcher.publish(et.playbackStop,_object_spread$p({userInitiated:r,endReasonType:ot.NATURAL_END_OF_TRACK},e)),e={userInitiated:e.userInitiated,seamlessAudioTransition:!0}),t._nextAtIndex(t.queue.nextPlayableItemIndex,e))}))()}_nextAtIndex(t,r={}){var n=this;return _async_to_generator$H((function*(){if(n.queue.isEmpty)return;const{_mediaItemPlayback:i}=n;var o;const a=null!==(o=r.userInitiated)&&void 0!==o&&o;if(t<0)return Kn.debug("controller/index._next no next item available, stopping playback"),yield n.stop({userInitiated:a,seamlessAudioTransition:r.seamlessAudioTransition}),void(i.playbackState=e.PlaybackStates.completed);const s=n.isPlaying,c=i.currentPlaybackTime,l=yield n._changeToMediaAtIndex(t,{userInitiated:a});var d;return n._notifySkip(s,l,{userInitiated:a,seamlessAudioTransition:null!==(d=r.seamlessAudioTransition)&&void 0!==d&&d,position:c,direction:ot.TRACK_SKIPPED_FORWARDS}),l}))()}_previous(e={}){var t=this;return _async_to_generator$H((function*(){if(t.queue.isEmpty)return;const{userInitiated:r=!1}=e;if(t.repeatMode===ui.one&&void 0!==t.queue.currentItem)return yield t.stop({endReasonType:ot.TRACK_SKIPPED_BACKWARDS,userInitiated:r}),void(yield t.play());const n=t.queue.previousPlayableItemIndex;if(r&&t.repeatMode===ui.none&&void 0!==t.nowPlayingItem&&-1===n)return yield t.stop({endReasonType:ot.TRACK_SKIPPED_BACKWARDS,userInitiated:!0}),void(yield t.play());if(-1===n)return;const i=t.isPlaying,o=t._mediaItemPlayback.currentPlaybackTime,a=yield t._changeToMediaAtIndex(n,{userInitiated:r});return t._notifySkip(i,a,{userInitiated:r,seamlessAudioTransition:!1,direction:ot.TRACK_SKIPPED_BACKWARDS,position:o}),a}))()}_notifySkip(e,t,r){const{userInitiated:n,direction:i,position:o,seamlessAudioTransition:a=!1}=r,s=this._dispatcher;a?(Kn.debug("seamlessAudioTransition transition, PAF play"),s.publish(et.playbackPlay,{item:t,position:0,endReasonType:ot.NATURAL_END_OF_TRACK})):e?t?s.publish(et.playbackSkip,{item:t,userInitiated:n,direction:i,position:o}):s.publish(et.playbackStop,{item:t,userInitiated:n,position:o}):t&&s.publish(et.playbackPlay,_object_spread$p({item:t,position:0},n?{endReasonType:ot.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM}:{}))}_prepareQueue(e){Kn.debug("mk: _prepareQueue"),this.hasAuthorization&&(e.isRestricted=this.storekit.restrictedEnabled||!1),e.repeatable=this._repeatable}constructor(e){var t,r;_define_property$K(this,"_context",{}),_define_property$K(this,"_continuous",void 0),_define_property$K(this,"_autoplayEnabled",void 0),_define_property$K(this,"_playerOptions",void 0),_define_property$K(this,"_queue",void 0),_define_property$K(this,"_storekit",void 0),_define_property$K(this,"_queueModifier",void 0),_define_property$K(this,"_repeatable",void 0),_define_property$K(this,"_shuffler",void 0),_define_property$K(this,"_seekable",void 0),_define_property$K(this,"_services",void 0),_define_property$K(this,"_rollMonitor",void 0),_define_property$K(this,"_skipIntro",void 0),_define_property$K(this,"_upNext",void 0),_define_property$K(this,"_playbackMode",void 0),_define_property$K(this,"_isDestroyed",!0),this.onPlaybackStateDidChange=this.onPlaybackStateDidChange.bind(this),this._autoplayEnabled=null!==(r=null===(t=e)||void 0===t?void 0:t.autoplayEnabled)&&void 0!==r&&r,this._services=e.services,this._playerOptions=e,this.storekit=e.storekit,this._skipIntro=new SkipAvailable({controller:this,services:e.services}),this._upNext=new UpNextMonitor({controller:this,services:e.services}),this._rollMonitor=new RollMonitor({controller:this,services:e.services}),this._queueModifier=new BaseModifiableQueue,this._shuffler=new BaseShuffler,this._seekable=new BaseSeekable(this._mediaItemPlayback),this._repeatable=new BaseRepeatable,this._dispatcher.subscribe(Bn.autoplayEnabledDidChange,this.updateAutoplay),this._playbackMode=e.playbackMode}}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$l("design:type",Function),_ts_metadata$l("design:paramtypes",[String,Boolean])],PlaybackController.prototype,"updateAutoplay",null);function rejectOnLast(){return Promise.reject("The last middleware in the stack should not call next")}function processMiddleware(e,...t){return e.length?function createNextFunction([e,...t]){return(...r)=>e(createNextFunction(t),...r)}([...e,rejectOnLast])(...t):Promise.reject("processMiddleware requires at mimimum one middleware function")}function parameterizeString(e,t){return function(e){try{return function recursiveTokenizeParameterizedString(e,t=[]){if(e.startsWith("{{")){const r=e.indexOf("}}");if(-1===r)throw new Error("UNCLOSED_PARAMETER");const n={type:Pi.Parameter,value:e.slice(2,r)};return r+2<e.length?recursiveTokenizeParameterizedString(e.slice(r+2),[...t,n]):[...t,n]}{const r=e.indexOf("{{");return-1===r?[...t,{type:Pi.Static,value:e}]:recursiveTokenizeParameterizedString(e.slice(r),[...t,{type:Pi.Static,value:e.slice(0,r)}])}}(e)}catch(Ae){if("UNCLOSED_PARAMETER"===Ae.message)throw new Error(`Unclosed parameter in path: "${e}"`);throw Ae}}(e).map(e=>{switch(e.type){case Pi.Parameter:return e.value in t?encodeURIComponent(""+t[e.value]):`{{${e.value}}}`;case Pi.Static:default:return e.value}}).join("")}var Pi;function _define_property$J(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread_props$f(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function constructUrlMiddleware(e,t){let r=t.url;return r||(r=addPathToURL(t.baseUrl,t.path)),t.urlParameters&&(r=parameterizeString(r,t.urlParameters)),t.queryParameters&&(r=addQueryParamsToURL(r,t.queryParameters)),e(_object_spread_props$f(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$J(e,t,r[t])}))}return e}({},t),{url:r}))}function asyncGeneratorStep$G(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$G(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$G(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$G(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function unwrapJSONFromResponse(e){return _unwrapJSONFromResponse.apply(this,arguments)}function _unwrapJSONFromResponse(){return(_unwrapJSONFromResponse=_async_to_generator$G((function*(e){try{return yield e.json()}catch(Ae){return}}))).apply(this,arguments)}function fetchMiddlewareFactory(e){return t=_async_to_generator$G((function*(t,r){const n=yield e(r.url,r.fetchOptions),i={request:r,response:n,data:yield unwrapJSONFromResponse(n)};if(!n.ok)throw MKError.responseError(n);return i})),function(e,r){return t.apply(this,arguments)};var t}!function(e){e[e.Static=0]="Static",e[e.Parameter=1]="Parameter"}(Pi||(Pi={}));const Ei=fetchMiddlewareFactory("undefined"!=typeof fetch?fetch:()=>{throw new Error("window.fetch is not defined")});function _define_property$I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$I(e,t,r[t])}))}return e}function _object_spread_props$e(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var Ti;!function(e){e.Replace="REPLACE",e.Merge="MERGE"}(Ti||(Ti={}));const ki=["url"];class APISession{get config(){return this._config}request(e,t={},r={}){var n;return processMiddleware(this.middlewareStack,_object_spread_props$e(_object_spread$n({},this.config.defaultOptions,r),{baseUrl:this.config.url,path:e,fetchOptions:mergeFetchOptions(null===(n=this.config.defaultOptions)||void 0===n?void 0:n.fetchOptions,r.fetchOptions),queryParameters:_object_spread$n({},this.config.defaultQueryParameters,t),urlParameters:_object_spread$n({},this.config.defaultUrlParameters,r.urlParameters)}))}reconfigure(e,t=Ti.Replace){t===Ti.Merge&&(e=deepmerge(this.config,e)),ki.forEach(t=>{if(void 0===e[t])throw new Error(`Session requires a valid SessionConfig, missing "${t}"`)}),this._config=e,this.middlewareStack=this.createMiddlewareStack()}createMiddlewareStack(){return Array.isArray(this.config.middleware)?[constructUrlMiddleware,...this.config.middleware,this.makeFetchMiddleware()]:[constructUrlMiddleware,this.makeFetchMiddleware()]}makeFetchMiddleware(){return"function"==typeof this.config.fetchFunction?fetchMiddlewareFactory(this.config.fetchFunction):Ei}constructor(e){_define_property$I(this,"_config",void 0),_define_property$I(this,"middlewareStack",void 0),this.reconfigure(e)}}function _object_without_properties(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}const wi={music:{url:"https://api.music.apple.com"},apps:{url:"https://amp-api.apps.apple.com"},books:{url:"https://amp-api.books.apple.com"},fitness:{url:"https://amp-api.fitness.apple.com"}};wi.music={url:"https://amp-api.music.apple.com"},wi.videos={url:"https://amp-api.videos.apple.com"},wi.podcasts={url:"https://amp-api.podcasts.apple.com"};class MediaAPIV3{configure(e,t,r=Ti.Merge){this.storefrontId=t.storefrontId;const n=function(e){let t={};e.url&&(t.url=e.url);e.storefrontId&&(t.defaultUrlParameters={storefrontId:e.storefrontId});e.mediaUserToken&&(t.defaultOptions={fetchOptions:{headers:{"Media-User-Token":e.mediaUserToken}}});e.developerToken&&(t=deepmerge(t,{defaultOptions:{fetchOptions:{headers:{Authorization:"Bearer "+e.developerToken}}}}));e.options&&(t=deepmerge(t,e.options));return t}(t);if(this[e])this[e].session.reconfigure(n,r);else{var i;const t=new APISession(n),r=t.request.bind(t);r.session=t;const o="undefined"!=typeof process&&"test"===(null===(i=process.env)||void 0===i?void 0:i.NODE_ENV);Object.defineProperty(this,e,{value:r,writable:o,enumerable:!0})}}constructor(e){var t,r,n;n=void 0,(r="storefrontId")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n;const{realmConfig:i}=e,o=_object_without_properties(e,["realmConfig"]);for(const s in wi){var a;let e=deepmerge(wi[s],o);const t=null===(a=i)||void 0===a?void 0:a[s];t&&(e=deepmerge(e,t)),this.configure(s,e)}}}function asyncGeneratorStep$F(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_metadata$k(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}class StationTrackLoader{activate(){this.dispatcher.unsubscribe(Bn.queuePositionDidChange,this.checkLoadMore),this.dispatcher.subscribe(Bn.queuePositionDidChange,this.checkLoadMore),this.isActive=!0}deactivate(){this.dispatcher.unsubscribe(Bn.queuePositionDidChange,this.checkLoadMore),this.isActive=!1}start(){return this.isActive||this.activate(),this.loadNextTracks()}checkLoadMore(){if(!(this.queue.isEmpty||this.queue.nextPlayableItemIndex>=0))return this.loadNextTracks()}loadNextTracks(){var e,t=this;return(e=function*(){var e;let r=[];const{apiManager:n}=t;if((null===(e=n)||void 0===e?void 0:e.api)instanceof MediaAPIV3){var i,o;r=null===(o=yield n.api.music("v1/me/stations/next-tracks/"+t.station.id,void 0,{fetchOptions:{method:"POST"}}))||void 0===o||null===(i=o.data)||void 0===i?void 0:i.data}else{var a;const e={};var s;Hn.features["enhanced-hls"]&&(e.extend={songs:["extendedAssetUrls"]}),r=null!==(s=yield null===(a=n.mediaAPI)||void 0===a?void 0:a.nextStationTracks(t.station.id,null,{queryParameters:e}))&&void 0!==s?s:[]}if(0===r.length)throw Kn.warn("No track data is available for the current station",{stationId:t.station.id}),new MKError(MKError.CONTENT_UNAVAILABLE,"No track data is available for the current station.");const c=descriptorToMediaItems({context:t.context,loaded:r,container:t.station});t.queue.splice(t.queue.length,0,c)},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$F(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$F(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,t,{dispatcher:r,apiManager:n},i={}){_define_property$G(this,"queue",void 0),_define_property$G(this,"station",void 0),_define_property$G(this,"context",void 0),_define_property$G(this,"apiManager",void 0),_define_property$G(this,"dispatcher",void 0),_define_property$G(this,"isActive",void 0),this.queue=e,this.station=t,this.context=i,this.isActive=!1,this.dispatcher=r,this.apiManager=n}}var Oi,Ii;!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$k("design:type",Function),_ts_metadata$k("design:paramtypes",[])],StationTrackLoader.prototype,"checkLoadMore",null),function(e){e.artist="artist",e.song="song",e.station="station",e.radioStation="radioStation"}(Oi||(Oi={})),function(e){e.BEATS1="beats1"}(Ii||(Ii={}));const isIdentityQueue=e=>e&&void 0!==e.identity;function asyncGeneratorStep$E(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$E(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$E(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$E(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_metadata$j(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const{queueIsReady:Ai}=Bn;class ContinuousPlaybackController extends PlaybackController{get continuous(){return!0}set continuous(e){if(!0!==e)throw new MKError(MKError.UNSUPPORTED_ERROR,"Continuous playback cannot be disabled for station queues.")}get context(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$F(e,t,r[t])}))}return e}({featureName:nt.STATION},this._context)}get isLive(){return this._isLive}set isLive(e){e!==this._isLive&&(this._isLive=e,this._dispatcher.publish(Bn.capabilitiesChanged))}changeToMediaItem(e){var t=this;return _async_to_generator$E((function*(){t.generateMethodNotAvailable("changeToMediaItem")}))()}hasCapabilities(e){switch(e){case zn.PAUSE:case zn.SKIP_NEXT:case zn.SKIP_PREVIOUS:return!this.isLive;case zn.SKIP_TO_ITEM:case zn.AUTOPLAY:return!1;default:return super.hasCapabilities(e)}}pause(e){var t=this,_superprop_get_pause=()=>super.pause;return _async_to_generator$E((function*(){if(!t.isLive)return _superprop_get_pause().call(t,e);t.generateMethodNotAvailable("pause")}))()}skipToPreviousItem(){var e=this,_superprop_get_skipToPreviousItem=()=>super.skipToPreviousItem;return _async_to_generator$E((function*(){if(!e.isLive)return _superprop_get_skipToPreviousItem().call(e);e.generateMethodNotAvailable("skipToPreviousItem")}))()}_dataForQueueOptions(e){var t=this,_superprop_get__dataForQueueOptions=()=>super._dataForQueueOptions;return _async_to_generator$E((function*(){const r=yield _superprop_get__dataForQueueOptions().call(t,e);return t.isLive&&(r.loaded=t.station),r}))()}returnQueueForOptions(e){var t=this;return _async_to_generator$E((function*(){var r,n,i;const o=isIdentityQueue(e)?yield t.loadStationByIdentity(e.identity):yield t.loadStationByStationId(t.generateStationId(e));if(void 0===o)return Promise.reject(new MKError(MKError.UNSUPPORTED_ERROR,"Cannot load requested station"));t.station=o,t.isLive=isIdentityQueue(e)||!!(null===(r=o)||void 0===r?void 0:r.isLive)||!!(null===(i=o)||void 0===i||null===(n=i.attributes)||void 0===n?void 0:n.isLive);const a={services:{runtime:t._services.runtime,dispatcher:t._services.dispatcher},descriptor:yield t._dataForQueueOptions(e),playbackMode:t.playbackMode};return t.queue=new Queue(a),t.isLive||(t.trackLoader=new StationTrackLoader(t.queue,o,{dispatcher:t._dispatcher,apiManager:t._services.apiManager},t.context),yield t.trackLoader.start()),t._seekable=t.isLive?new BaseSeekable(t._mediaItemPlayback):new Seekable(t._dispatcher,t._mediaItemPlayback),t._dispatcher.publish(Ai,t.queue.items),t.queue}))()}getNewSeeker(){return this.hasCapabilities(zn.SEEK)?super.getNewSeeker():new UnsupportedSeeker}skipToNextItem(){var e=this,_superprop_get_skipToNextItem=()=>super.skipToNextItem;return _async_to_generator$E((function*(){if(!e.isLive)return _superprop_get_skipToNextItem().call(e);e.generateMethodNotAvailable("skipToNextItem")}))()}generateMethodNotAvailable(e){Kn.warn(e+" is not supported for this type of playback")}generateStationId(e){let t;if(isQueueURLOption(e)){const{contentId:r,kind:n,storefrontId:i}=formattedMediaURL(e.url);n&&(e[n]=r),i&&(qn.storefrontId=i),t=n}const r=e;if(r.artist)return"ra."+r.artist;if(r.song)return"ra."+r.song;if(r.station)return r.station;if(r.radioStation)return r.radioStation;throw new MKError(MKError.UNSUPPORTED_ERROR,t?t+" is not a supported option. Use setQueue instead.":"Unsupported options specified for setStationQueue. You may want setQueue instead.")}loadStationByIdentity(e){var t=this;return _async_to_generator$E((function*(){var r,n,i;const{apiManager:o}=t._services;if((null===(r=o)||void 0===r?void 0:r.api)instanceof MediaAPIV3){var a,s,c;return null===(c=yield o.api.music("v1/catalog/{{storefrontId}}/stations",{filter:{identity:e}}))||void 0===c||null===(s=c.data)||void 0===s||null===(a=s.data)||void 0===a?void 0:a[0]}const l=yield null===(i=o)||void 0===i||null===(n=i.mediaAPI)||void 0===n?void 0:n.stations(void 0,{filter:{identity:e}});return l&&l[0]}))()}loadStationByStationId(e){var t=this;return _async_to_generator$E((function*(){var r,n,i;const{apiManager:o}=t._services;if((null===(r=o)||void 0===r?void 0:r.api)instanceof MediaAPIV3){var a,s,c;return null===(c=yield o.api.music("v1/catalog/{{storefrontId}}/stations/"+e))||void 0===c||null===(s=c.data)||void 0===s||null===(a=s.data)||void 0===a?void 0:a[0]}return null===(i=o)||void 0===i||null===(n=i.mediaAPI)||void 0===n?void 0:n.station(e)}))()}activate(){super.activate(),this.trackLoader&&this.trackLoader.activate()}deactivate(){var e=this,_superprop_get_deactivate=()=>super.deactivate;return _async_to_generator$E((function*(){yield _superprop_get_deactivate().call(e),e.trackLoader&&e.trackLoader.deactivate()}))()}constructor(e){super(e),_define_property$F(this,"type",bi.continuous),_define_property$F(this,"_isLive",!1),_define_property$F(this,"trackLoader",void 0),_define_property$F(this,"station",void 0),this._continuous=!0}}function asyncGeneratorStep$D(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_decorate$i(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$i(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$j("design:type",Function),_ts_metadata$j("design:paramtypes",[void 0===zn?Object:zn])],ContinuousPlaybackController.prototype,"hasCapabilities",null);class PercentageWatcher{startMonitor(){this.dispatcher.unsubscribe(Bn.playbackDurationDidChange,this.updateThreshold),this.dispatcher.unsubscribe(Bn.playbackTimeDidChange,this.handleTimeChange),this.dispatcher.subscribe(Bn.playbackDurationDidChange,this.updateThreshold),this.dispatcher.subscribe(Bn.playbackTimeDidChange,this.handleTimeChange)}stopMonitor(){this.dispatcher.unsubscribe(Bn.playbackDurationDidChange,this.updateThreshold),this.dispatcher.unsubscribe(Bn.playbackTimeDidChange,this.handleTimeChange),this.threshold=-1}handleTimeChange(e,{currentPlaybackDuration:t,currentPlaybackTime:r}){var n,i=this;return(n=function*(){i.threshold<0&&i.updateThreshold(e,{duration:t}),r<i.threshold||(i.stopMonitor(),yield i.callback(r,i))},function(){var e=this,t=arguments;return new Promise((function(r,i){var o=n.apply(e,t);function _next(e){asyncGeneratorStep$D(o,r,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$D(o,r,i,_next,_throw,"throw",e)}_next(void 0)}))})()}updateThreshold(e,{duration:t}){this.threshold=t*this.percentage}constructor(e,t,r){_define_property$E(this,"dispatcher",void 0),_define_property$E(this,"callback",void 0),_define_property$E(this,"percentage",void 0),_define_property$E(this,"threshold",void 0),this.dispatcher=e,this.callback=t,this.percentage=r,this.threshold=-1}}function asyncGeneratorStep$C(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}_ts_decorate$i([Bind(),_ts_metadata$i("design:type",Function),_ts_metadata$i("design:paramtypes",[void 0,void 0])],PercentageWatcher.prototype,"handleTimeChange",null),_ts_decorate$i([Bind(),_ts_metadata$i("design:type",Function),_ts_metadata$i("design:paramtypes",[void 0,void 0])],PercentageWatcher.prototype,"updateThreshold",null);class Preloader extends PlaybackMonitor{handlePlaybackThreshold(){var e,t=this;return(e=function*(){const e=t.getNextPlayableItem();e&&(yield t.playbackController.prepareToPlay(e,!0))},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$C(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$C(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}shouldMonitor(){if(!super.shouldMonitor())return!1;if(!this.playbackController.hasAuthorization||this.playbackController.previewOnly)return!1;const e=this.getNextPlayableItem(),t=void 0!==e;return this.isSeamlessAudioTransitionsEnabled?t:t&&!(null===(r=e)||void 0===r?void 0:r.isPreparedToPlay);var r}getNextPlayableItem(){return this.playbackController.queue.nextPlayableItem}constructor(e){var t,r,n;super(e),n=!1,(r="isSeamlessAudioTransitionsEnabled")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.watchers=[new PercentageWatcher(this.dispatcher,this.handlePlaybackThreshold,.3)],this.isSeamlessAudioTransitionsEnabled=Hn.features["seamless-audio-transitions"]}}function dasherize(e){return e.replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()}function asyncGeneratorStep$B(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$B(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$B(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$B(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$C(e,t,r[t])}))}return e}function _object_spread_props$d(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function loadRelationshipData(e,t,r){return _loadRelationshipData.apply(this,arguments)}function _loadRelationshipData(){return(_loadRelationshipData=_async_to_generator$B((function*(e,t,r,n={}){if(void 0===t)return r;void 0===n.limit&&(n.limit=100),void 0===n.offset&&(n.offset=0);const{relationship:i,method:o}=t,a=e[o].bind(e);let s;return isDataRecord(r)?(void 0===r[i]&&r.setProperty(i,[],"relationships"),s=r[i]):(r.relationships=r.relationships||{},void 0===r.relationships[i]&&Object.defineProperty(r.relationships,i,{value:{data:[]},enumerable:!0}),s=r.relationships[i].data),yield $i(a,[r.id,i,n],s),r}))).apply(this,arguments)}const $i=function(){var e=_async_to_generator$B((function*(e,t,r){const[n,i,o]=t,a=r.length;if(a>0&&a<o.limit+o.offset)return r;const s=_object_spread$l({},o);let c;s.offset=a;try{c=yield e(n,i,s)}catch(l){return r}return r.push(...c),c.length<s.limit?r:$i(e,t,r)}));return function(t,r,n){return e.apply(this,arguments)}}(),getNamedQueueOptions=(e,t)=>{const r=[],n=e.namedQueueOptions;for(const i in t)Object.keys(n).includes(i)&&r.push([i,n[i]]);return r},Ri=function(){var e=_async_to_generator$B((function*(e,t,r){const[n]=r,i=t[n];if(!Array.isArray(i))return loadSelectedQueueValue(e,t,r,i);const o=new Map;i.forEach(e=>{const t=e.indexOf("."),r=-1===t?"":e.substring(0,t);o.has(r)||o.set(r,[]);const n=o.get(r);n&&n.push(e)});const a=(yield Promise.all([...o.values()].map(n=>loadSelectedQueueValue(e,t,r,n)))).reduce((e,t)=>{var r;return(t=null!==(r=t.data)&&void 0!==r?r:t).forEach(t=>{e.set(t.id,t)}),e},new Map),s=[];return i.forEach(e=>{const t=a.get(e);t&&s.push(t)}),s}));return function(t,r,n){return e.apply(this,arguments)}}();function loadSelectedQueueValue(e,t,r,n){return _loadSelectedQueueValue.apply(this,arguments)}function _loadSelectedQueueValue(){return(_loadSelectedQueueValue=_async_to_generator$B((function*(e,t,r,n){const i=yield e.getAPIForItem(Array.isArray(n)?n[0]:n);return i instanceof MediaAPIV3?loadSelectedQueueValueV3(i,t,r,n):loadSelectedQueueValueV2(i,t,r,n)}))).apply(this,arguments)}function loadSelectedQueueValueV2(e,t,r,n){return _loadSelectedQueueValueV2.apply(this,arguments)}function _loadSelectedQueueValueV2(){return(_loadSelectedQueueValueV2=_async_to_generator$B((function*(e,t,r,n){const[,i]=r;let o=t.parameters;Hn.features["enhanced-hls"]&&(o=_object_spread_props$d(_object_spread$l({},o),{extend:{songs:["extendedAssetUrls"]}}));let a=yield e[i.apiMethod](n,o);return i.loadedQueueTransform&&(a=i.loadedQueueTransform(a)),Array.isArray(n)||(yield loadRelationshipData(e,i.relationshipMethod,a)),a}))).apply(this,arguments)}function loadSelectedQueueValueV3(e,t,r,n){return _loadSelectedQueueValueV3.apply(this,arguments)}function _loadSelectedQueueValueV3(){return(_loadSelectedQueueValueV3=_async_to_generator$B((function*(e,t,r,i){const[o]=r,a=Array.isArray(i),s=n(a?""+i[0]:""+i),c=/^(?:playlists?|albums?)$/i.test(o);let l=dasherize(o);l.endsWith("s")||(l+="s");let d=(s?"/v1/me/library":"/v1/catalog/{{storefrontId}}")+"/"+l;a||(d+="/{{id}}");const u={};a&&(u.ids=i),s&&c&&(u.include="tracks");const p=yield e.music(d,u,{urlParameters:{id:i}});return a?p.data.data:p.data.data[0]}))).apply(this,arguments)}function asyncGeneratorStep$A(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$A(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$A(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$A(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$B(e,t,r[t])}))}return e}function _object_spread_props$c(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_decorate$h(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$h(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const Ci=["library-songs","songs"];class AutoplayTrackLoader{activate(){this.isActive||(this.dispatcher.unsubscribe(Bn.queuePositionDidChange,this.onQueueChanged),this.dispatcher.subscribe(Bn.queuePositionDidChange,this.onQueueChanged),this.dispatcher.unsubscribe(Bn.repeatModeDidChange,this.onRepeatableChanged),this.dispatcher.subscribe(Bn.repeatModeDidChange,this.onRepeatableChanged),this.isActive=!0)}deactivate(){this.isActive&&(this.dispatcher.unsubscribe(Bn.queuePositionDidChange,this.onQueueChanged),this.dispatcher.unsubscribe(Bn.repeatModeDidChange,this.onRepeatableChanged),this.isActive=!1,this.station=void 0,this.queue.hasAutoplayStation=!1)}start(){if(!this.isActive)return this.activate(),this.loadNextTracks()}stop(){this.isActive&&(this.deactivate(),this.cleanupQueue())}onRepeatableChanged(){this.repeatable.repeatMode===ui.none?this.checkLoadMore():this.cleanupQueue()}onQueueChanged(){if(!(this.queue.nextPlayableItemIndex>=0))return this.checkLoadMore()}get api(){var e;const t=this.apiManager.mediaAPI;var r;return null!==(r=null===(e=t)||void 0===e?void 0:e.v3)&&void 0!==r?r:t}checkLoadMore(){var e;const t=null!==(e=this.queue.unplayedAutoplayItems.length)&&void 0!==e?e:0,r=Hn.autoplay.maxUpcomingTracksToMaintain;if(!(this.queue.isEmpty||this.queue.unplayedUserItems.length>Hn.autoplay.maxQueueSizeForAutoplay))return t<r?this.loadNextTracks(r-t):this.loadNextTracks()}cleanupQueue(){this.queue.removeQueueItems((e,t)=>!(t<=this.queue.position)&&!!e.isAutoplay)}loadNextTracks(e=Hn.autoplay.maxUpcomingTracksToMaintain){var t=this;return _async_to_generator$A((function*(){var r;if(t.repeatable.repeatMode!==ui.none)return;let n,{station:i}=t;if(t.station){try{var o,a;n=yield t.api.music("v1/me/stations/next-tracks/"+t.station.id,{limit:e},{fetchOptions:{method:"POST"}}),n=null===(a=n)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.data}catch(u){return}if(!t.isActive)return}else{var s,c;const r=yield t.startStation(e);if(!r||!t.isActive)return void(t.queue.hasAutoplayStation=!1);var l;if(i=t.station=r.station,t.queue.hasAutoplayStation=!0,n=r.tracks,!(null===(c=r)||void 0===c||null===(s=c.tracks)||void 0===s?void 0:s.length))Kn.warn("No track data is available for the current station",{stationId:null===(l=i)||void 0===l?void 0:l.id})}const d=descriptorToMediaItems({context:_object_spread_props$c(_object_spread$k({},t.context),{featureName:"now_playing",reco_id:(null===(r=t.context.featureName)||void 0===r?void 0:r.startsWith("listen-now"))?void 0:t.context.reco_id}),loaded:n,container:i});t.queue.appendQueueItems(toQueueItems(d,{isAutoplay:!0}))}))()}startStation(e){var t=this;return _async_to_generator$A((function*(){var r;const{userAddedItems:i}=t.queue;var o;const a=null===(r=null!==(o=i[i.length-2])&&void 0!==o?o:i[i.length-1])||void 0===r?void 0:r.container,s=a?{container:{id:a.id,type:a.type}}:void 0,c=t.queue.items.slice(-1*Hn.autoplay.maxQueueSizeInRequest).reduce((e,{id:r,type:i})=>{const o=((e,t)=>(n(e)&&!(null!=t?t:"").startsWith("library-")?"library-":"")+normalizeContentType(t))(r,i);return(e=>Ci.includes(e))(o)&&!t.errorIds.has(r)&&e.push({id:r,type:o,meta:s}),e},[]);if(0===c.length)return;const l={data:c};let d;try{var u,p;d=yield t.api.music("v1/me/stations/continuous",{"limit[results:tracks]":e,with:["tracks"]},{fetchOptions:{method:"POST",body:JSON.stringify(l,void 0,2)}}),d=null===(p=d)||void 0===p||null===(u=p.data)||void 0===u?void 0:u.results}catch(h){c.forEach(e=>t.errorIds.add(e.id))}return d}))()}constructor(e,t,{dispatcher:r,apiManager:n},i={}){_define_property$B(this,"queue",void 0),_define_property$B(this,"repeatable",void 0),_define_property$B(this,"context",void 0),_define_property$B(this,"apiManager",void 0),_define_property$B(this,"dispatcher",void 0),_define_property$B(this,"isActive",void 0),_define_property$B(this,"errorIds",void 0),_define_property$B(this,"station",void 0),this.queue=e,this.repeatable=t,this.context=i,this.isActive=!1,this.errorIds=new Set,this.dispatcher=r,this.apiManager=n}}function asyncGeneratorStep$z(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$z(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$z(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$z(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$A(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$A(e,t,r[t])}))}return e}function _object_spread_props$b(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_decorate$g(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$g(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}_ts_decorate$h([Bind(),_ts_metadata$h("design:type",Function),_ts_metadata$h("design:paramtypes",[])],AutoplayTrackLoader.prototype,"onRepeatableChanged",null),_ts_decorate$h([Bind(),_ts_metadata$h("design:type",Function),_ts_metadata$h("design:paramtypes",[])],AutoplayTrackLoader.prototype,"onQueueChanged",null),_ts_decorate$h([(e,t,r)=>{const n=r.value,i="_singlePromise_"+t,o="undefined"!=typeof Symbol?Symbol(i):i;return r.value=function(...e){if(this[o])return this[o];const t=this[o]=n.apply(this,e),reset=()=>{this[o]=void 0};return t.then(reset,reset),t},r},_ts_metadata$h("design:type",Function),_ts_metadata$h("design:paramtypes",[Number])],AutoplayTrackLoader.prototype,"loadNextTracks",null);const{queueIsReady:Mi}=Bn;var Di,xi;!function(e){e.album="album",e.musicVideo="musicVideo",e.playlist="playlist",e.song="song",e.episode="episode",e.podcast="podcast",e.uploadedAudio="uploadedAudio",e.uploadedVideo="uploadedVideo"}(Di||(Di={})),function(e){e.albums="albums",e.musicVideos="musicVideos",e.playlists="playlists",e.songs="songs",e.episodes="episodes",e.podcasts="podcasts",e.uploadedAudio="uploadedAudios",e.uploadedVideo="uploadedVideos"}(xi||(xi={}));class SerialPlaybackController extends PlaybackController{get autoplayEnabled(){return this._autoplayEnabled}set autoplayEnabled(e){var t;this._autoplayEnabled=e;const r=e?"start":"stop";null===(t=this._autoplayTrackLoader)||void 0===t||t[r]()}activate(){super.activate(),this._preloader.activate(),this._dispatcher.subscribe(rn,this.onSeamlessAudioTransition),this._dispatcher.subscribe(Bn.repeatModeDidChange,this.onRepeatModeChange)}deactivate(){var e=this,_superprop_get_deactivate=()=>super.deactivate;return _async_to_generator$z((function*(){var t;yield _superprop_get_deactivate().call(e),e._preloader.deactivate(),e._dispatcher.unsubscribe(rn,e.onSeamlessAudioTransition),e._dispatcher.unsubscribe(Bn.repeatModeDidChange,e.onRepeatModeChange),null===(t=e._autoplayTrackLoader)||void 0===t||t.stop()}))()}onSeamlessAudioTransition(e,t){Kn.debug("controller handling seamless audio transition, PAF stop",t),this._next({userInitiated:!1,seamlessAudioTransition:!0,endReasonType:ot.NATURAL_END_OF_TRACK,position:t.previous.playbackDuration/1e3,isPlaying:!1})}hasCapabilities(e){var t,r,n;return e===zn.SKIP_PREVIOUS||(e!==zn.REPEAT&&e!==zn.SHUFFLE||!(null===(r=this.queue)||void 0===r||null===(t=r.currentQueueItem)||void 0===t?void 0:t.isAutoplay))&&((e!==zn.SEEK&&e!==zn.PAUSE||!(null===(n=this.nowPlayingItem)||void 0===n?void 0:n.isAssetScrubbingDisabled))&&super.hasCapabilities(e))}onRepeatModeChange(){var e;this.queue.nextPlayableItem&&(Kn.info("SerialPlaybackController: preparing new item after RepeatMode change",null===(e=this.queue.nextPlayableItem)||void 0===e?void 0:e.title),this.prepareToPlay(this.queue.nextPlayableItem,!0))}prepareToPlay(e,t=!1){var r=this;return _async_to_generator$z((function*(){if(Kn.debug("mk: SerialController - prepareToPlay - ",{item:e,preload:t}),e.isPlayable)return r._mediaItemPlayback.prepareToPlay(e).catch(e=>{const n=!t&&-1===[MKError.DEVICE_LIMIT,MKError.STREAM_UPSELL].indexOf(e.errorCode);if(r.continuous&&n)return r._dispatcher.publish(et.applicationActivityIntent,{endReasonType:ot.TRACK_SKIPPED_FORWARDS,userInitiated:!1}),r._next();throw e})}))()}prepend(e,t){var r=this,_superprop_get_prepend=()=>super.prepend;return _async_to_generator$z((function*(){const n=yield _superprop_get_prepend().call(r,e,t);if(r.shouldTransitionSeamlessly){const e=r.queue,t=e.position,n=e.item(t+1);Kn.debug("prepend preparing ",n.title),yield r._mediaItemPlayback.prepareToPlay(n)}return n}))()}returnQueueForOptions(e){var t=this;return _async_to_generator$z((function*(){void 0!==(e=(e=>{if(!isQueueURLOption(e))return e;const{url:t}=e,r=_object_without_properties$1(e,["url"]),{contentId:n,kind:i,storefrontId:o}=formattedMediaURL(t);return i&&(r[i]=n),o&&(qn.storefrontId=o),_i.debug("parseQueueURLOption",r),r})(e)).startPosition&&(deprecationWarning("startPosition",{message:"startPosition has been deprecated in favor of startWith"}),void 0===e.startWith&&(e.startWith=e.startPosition));const r=yield t._dataForQueueOptions(e),n={services:{runtime:t._services.runtime,dispatcher:t._services.dispatcher,mediaItemPlayback:t._services.mediaItemPlayback},descriptor:r,playbackMode:t.playbackMode};if(void 0!==e.shuffleMode&&(t.shuffleMode=e.shuffleMode),t.queue=new Queue(n),"number"==typeof e.startTime){const r=t.queue.nextPlayableItem;r&&t._mediaItemPlayback.playOptions.set(r.id,{startTime:e.startTime})}if(0===t.queue.length)throw Kn.warn("No item data is available for the current media queue",e),new MKError(MKError.CONTENT_UNAVAILABLE,"No item data is available for the current media queue.");return t._autoplayTrackLoader&&t._autoplayTrackLoader.deactivate(),t._autoplayTrackLoader=new AutoplayTrackLoader(t.queue,t._repeatable,{dispatcher:t._dispatcher,apiManager:t._services.apiManager},t._context),t.autoplayEnabled&&t.hasCapabilities(zn.AUTOPLAY)&&t._autoplayTrackLoader.start(),t._dispatcher.publish(Mi,t.queue.items),t.queue}))()}_dataForQueueOptions(e){var t=this,_superprop_get__dataForQueueOptions=()=>super._dataForQueueOptions;return _async_to_generator$z((function*(){var r;const n=e,i=((e,t)=>{const r=getNamedQueueOptions(e,t);if(r.length>1)throw new MKError(MKError.UNSUPPORTED_ERROR,"Queues with multiple media types are not supported.");if(0===r.length)return;const[n]=r,[i,o]=n;if(Array.isArray(t[i])!==o.isPlural)throw new MKError(MKError.UNSUPPORTED_ERROR,o.isPlural?`Queue option ${i} must be an array of id values`:`Queue option ${i} must be a single id value`);return n})(t._services.apiManager.apiService,e);if(void 0===i)return _object_spread$j({},yield _superprop_get__dataForQueueOptions().call(t,e),n);if((null===(r=t.storekit)||void 0===r?void 0:r.restrictedEnabled)&&(e.parameters=_object_spread_props$b(_object_spread$j({},e.parameters),{restrict:"explicit"})),["playlist","playlists","library-playlists"].includes(i[0])){var o;const t=(null===(o=e.parameters)||void 0===o?void 0:o.extend)?e.parameters.extend+",hasCollaboration":"hasCollaboration";e.parameters=_object_spread_props$b(_object_spread$j({},e.parameters),{extend:t})}return n.loaded=yield Ri(t._services.apiManager.apiService,e,i),_object_spread$j({},yield _superprop_get__dataForQueueOptions().call(t,e),n)}))()}_changeToMediaAtIndex(e=0,t={userInitiated:!1}){var r=this,_superprop_get__changeToMediaAtIndex=()=>super._changeToMediaAtIndex;return _async_to_generator$z((function*(){const n=yield _superprop_get__changeToMediaAtIndex().call(r,e,t),i=r.queue.nextPlayableItem;return i&&r.shouldTransitionSeamlessly&&(yield r.prepareToPlay(i)),n}))()}_prepareQueue(e){super._prepareQueue(e),this._shuffler.checkAndReshuffle()}get shouldTransitionSeamlessly(){return this._isSeamlessAudioTransitionsEnabled&&this.hasAuthorization&&!this.previewOnly}constructor(e){var t,r;super(e),_define_property$A(this,"type",bi.serial),_define_property$A(this,"_preloader",void 0),_define_property$A(this,"_isSeamlessAudioTransitionsEnabled",void 0),_define_property$A(this,"_autoplayTrackLoader",void 0),this._queue=new Queue(e),this._repeatable=new Repeatable(this._dispatcher),this._seekable=new Seekable(this._dispatcher,this._mediaItemPlayback),this._shuffler=new Shuffler(this,{dispatcher:this._dispatcher}),this._queueModifier=new ModifiableQueue(this._queue,this._mediaItemPlayback),this._isSeamlessAudioTransitionsEnabled=!!(null===(r=e)||void 0===r||null===(t=r.bag)||void 0===t?void 0:t.features["seamless-audio-transitions"]);const n={controller:this,services:e.services};this._preloader=new Preloader(n)}}function _define_property$z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}_ts_decorate$g([Bind(),_ts_metadata$g("design:type",Function),_ts_metadata$g("design:paramtypes",[void 0,void 0])],SerialPlaybackController.prototype,"onSeamlessAudioTransition",null),_ts_decorate$g([Bind(),_ts_metadata$g("design:type",Function),_ts_metadata$g("design:paramtypes",[void 0===zn?Object:zn])],SerialPlaybackController.prototype,"hasCapabilities",null),_ts_decorate$g([Bind(),_ts_metadata$g("design:type",Function),_ts_metadata$g("design:paramtypes",[])],SerialPlaybackController.prototype,"onRepeatModeChange",null);class MKDialog{static presentError(e){const t=e.dialog;void 0!==t?MKDialog.serverDialog(t).present():new MKDialog(e.message).present()}static serverDialog(e){const t=new this(e.message,e.explanation);return e.okButtonAction&&e.okButtonAction.url&&(t._okButtonActionURL=e.okButtonAction.url),e.okButtonString&&(t._okButtonString=e.okButtonString),e.cancelButtonString&&(t._cancelButtonString=e.cancelButtonString),t}static clientDialog(e){const t=new this(e.message,e.explanation);return e.okButtonAction&&(t._okButtonAction=e.okButtonAction),e.cancelButtonAction&&(t._cancelButtonAction=e.cancelButtonAction),e.okButtonString&&(t._okButtonString=e.okButtonString),e.cancelButtonString&&(t._cancelButtonString=e.cancelButtonString),t}get actions(){return this.cancelButton?`<div id="mk-dialog-actions">${this.cancelButton}${this.okButton}</div>`:`<div id="mk-dialog-actions">${this.okButton}</div>`}get cancelButton(){if("string"==typeof this._cancelButtonString)return`<button type="button">${this._cancelButtonString}</button>`}set cancelButton(e){this._cancelButtonString=e}get explanation(){return`<p id="mk-dialog-explanation">${this._explanation}</p>`}get hasOKButtonAction(){return!!this._okButtonActionURL||!!this._okButtonAction}get message(){return`<h5 id="mk-dialog-title">${this._message}</h5>`}get okButton(){return this.hasOKButtonAction&&this._okButtonActionURL?`<button type="button" data-ok-action-url='${this._okButtonActionURL}'>${this._okButtonString}</button>`:`<button type="button">${this._okButtonString}</button>`}present(){const e=document.createDocumentFragment(),t=document.createElement("div");t.id=this.scrimId,e.appendChild(t);const r=document.createElement("div");r.id=this.id,r.classList.add("mk-dialog"),r.setAttribute("role","alertDialog"),r.setAttribute("aria-modal","true"),r.setAttribute("aria-labeledby","mk-dialog-title"),r.setAttribute("aria-describedby","mk-dialog-explanation");let n=`\n      <div id="mk-dialog-body">\n        ${this.message}\n        ${this.explanation}\n      </div>`;n=`\n      ${n}\n      ${this.actions}\n    `,r.innerHTML=n,e.appendChild(r),document.body.appendChild(e),document.querySelector(`#${r.id} #mk-dialog-actions *:first-child`).focus(),setTimeout(()=>{document.querySelector(`#${r.id} #mk-dialog-actions *:first-child`).addEventListener("click",()=>{this._cancelButtonAction&&this._cancelButtonAction(),r.parentElement.removeChild(r),t.parentElement.removeChild(t)}),this.hasOKButtonAction&&(this._okButtonActionURL?document.querySelector(`#${r.id} #mk-dialog-actions *:last-child`).addEventListener("click",e=>{window.open(e.target.dataset.okActionUrl,"_blank"),r.parentElement.removeChild(r),t.parentElement.removeChild(t)}):this._okButtonAction&&document.querySelector(`#${r.id} #mk-dialog-actions *:last-child`).addEventListener("click",e=>{this._okButtonAction(),r.parentElement.removeChild(r),t.parentElement.removeChild(t)}))})}_appendStyle(e){const t=document.createElement("style");t.id=this.styleId,t.styleSheet?t.styleSheet.cssText=e:t.innerHTML=e,document.body.appendChild(t)}constructor(e,t=""){_define_property$z(this,"_message",void 0),_define_property$z(this,"_explanation",void 0),_define_property$z(this,"id",void 0),_define_property$z(this,"scrimId",void 0),_define_property$z(this,"styleId",void 0),_define_property$z(this,"_cancelButtonString",void 0),_define_property$z(this,"_cancelButtonAction",void 0),_define_property$z(this,"_okButtonAction",void 0),_define_property$z(this,"_okButtonActionURL",void 0),_define_property$z(this,"_okButtonString",void 0),this._message=e,this._explanation=t,this.id="musickit-dialog",this.scrimId=this.id+"-scrim",this.styleId=this.id+"-style",this._okButtonString="OK",[this.id,this.scrimId,this.styleId].forEach(e=>{try{const t=document.getElementById(e);t.parentElement.removeChild(t)}catch(t){}}),this._appendStyle("\n#musickit-dialog {\n  --mk-dialog-background: rgba(255, 255, 255, 1);\n  --mk-dialog-text: rgba(0, 0, 0, 0.95);\n  --mk-dialog-border: rgba(0, 0, 0, 0.07);\n  --mk-dialog-scrim: rgba(255, 255, 255, 0.8);\n  --mk-dialog-primary: rgba(0, 122, 255, 1);\n}\n\n@media (prefers-color-scheme: dark) {\n  #musickit-dialog {\n      --mk-dialog-background: rgba(30, 30, 30, 1);\n      --mk-dialog-text: rgba(255, 255, 255, 0.85);\n      --mk-dialog-border: rgba(255, 255, 255, 0.1);\n      --mk-dialog-scrim: rgba(38, 38, 38, 0.8);\n      --mk-dialog-primary: rgba(8, 132, 255, 1);\n  }\n}\n\n#musickit-dialog-scrim {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.35);\n}\n\n#musickit-dialog * {\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n  -ms-touch-action: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  font-family: -apple-system, SF UI Text, Helvetica Neue, Helvetica, sans-serif;\n  font-size: 15px;\n  line-height: 20px;\n}\n\n#musickit-dialog *:focus { outline: 0; }\n\n#musickit-dialog {\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column;\n  -moz-flex-direction: column;\n  flex-direction: column;\n  -webkit-justify-content: space-between;\n  -moz-justify-content: space-between;\n  justify-content: space-between;\n  min-width: 277px;\n  max-width: 290px;\n  min-height: 109px;\n  background: var(--mk-dialog-background);\n  box-shadow: 0px 0px 9px rgba(0, 0, 0, 0.18);\n  border-radius: 10px;\n  color: var(--mk-dialog-text);\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  margin-left: -142px;\n  margin-top: -67px;\n  z-index: 9999999999999999999999999;\n}\n\n#musickit-dialog #mk-dialog-body {\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column;\n  -moz-flex-direction: column;\n  flex-direction: column;\n  flex-grow: 1;\n  -webkit-justify-content: space-evenly;\n  -moz-justify-content: space-evenly;\n  justify-content: space-evenly;\n  -webkit-align-items: stretch;\n  align-items: stretch;\n  padding: 10px 20px;\n  min-height: 74px;\n  text-align: center;\n}\n\n#musickit-dialog .mk-dialog h5 {\n  font-weight: 500;\n  line-height: 20px;\n  margin: 7px 0 0 0;\n  padding: 0;\n}\n\n#musickit-dialog .mk-dialog p {\n  margin: 0 0 7px 0;\n  padding: 0;\n  paddin-top: 3px;\n  line-height: 18px;\n  font-size: 13px;\n  font-weight: 300;\n}\n\n#musickit-dialog #mk-dialog-actions {\n  border-top: 1px solid var(--mk-dialog-border);\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: row;\n  -moz-flex-direction: colrowumn;\n  flex-direction: row;\n  max-height: 41px;\n  min-height: 34px;\n  -webkit-justify-self: flex-end;\n  -moz-justify-self: flex-end;\n  justify-self: flex-end;\n}\n\n#musickit-dialog #mk-dialog-actions button {\n  flex-grow: 1;\n  border: 0;\n  background: none;\n  color: var(--mk-dialog-primary);\n  padding: 0;\n  margin: 0;\n  min-height: 34px;\n  height: 41px;\n  text-align: center;\n}\n\n#musickit-dialog #mk-dialog-actions *:nth-child(2) {\n  border-left: 1px solid var(--mk-dialog-border);\n  font-weight: 500;\n}\n")}}var Li;function asyncGeneratorStep$y(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}e.SupportedAPIs=void 0,(Li=e.SupportedAPIs||(e.SupportedAPIs={})).MEDIA_API="media-api",Li.UTS_CLIENT="uts-client";class APIServiceManager{get api(){return this.getApiByType(this._defaultAPI)}get apiService(){if(void 0!==this._defaultAPI)return this._apisByType[this._defaultAPI];Kn.error("There is no API instance configured")}get mediaAPI(){return this.getApiByType(e.SupportedAPIs.MEDIA_API)}get utsClient(){return this.getApiByType(e.SupportedAPIs.UTS_CLIENT)}getApiByType(e){let t;if(void 0!==e&&(t=this._apisByType[e]),void 0===t||void 0===t.api)throw new MKError(MKError.CONFIGURATION_ERROR,"There is no API instance configured for the requested type: "+e);return t.api}set defaultApiType(e){this._defaultAPI=e}registerAPIService(e){var t,r=this;return(t=function*(){const{apiType:t,configureFn:n,options:i}=e,o=i.apiOptions||{};void 0===r._defaultAPI&&(r._defaultAPI=t),r._apisByType[t]=yield n.call(r,{apiOptions:o,store:r.store,dispatcher:r._dispatcher})},function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function _next(e){asyncGeneratorStep$y(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$y(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,t){_define_property$y(this,"store",void 0),_define_property$y(this,"_dispatcher",void 0),_define_property$y(this,"_apisByType",void 0),_define_property$y(this,"_defaultAPI",void 0),this.store=e,this._dispatcher=t,this._apisByType={}}}const Ni={};function adaptAddEventListener(e,t,r,n={}){const{once:i}=n,o=function(e,t){const r=getCallbacksForName(e),wrappedCallback=(e,r)=>{t(r)};return r.push([t,wrappedCallback]),wrappedCallback}(t,r);!0===i?e.subscribeOnce(t,o):e.subscribe(t,o)}function getCallbacksForName(e){let t=Ni[e];return t||(t=[],Ni[e]=t),t}function asyncGeneratorStep$x(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$x(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$x(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$x(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$x(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ji=Kn.createChild("rtc");class RTCStreamingTracker{get isConfigured(){return void 0!==this.instance}configure(e){var t=this;return _async_to_generator$x((function*(){t.instance=e.instance}))()}handleEvent(e,t,r){}loadScript(){return _async_to_generator$x((function*(){if(!Hn.urls.rtc)throw new Error("bag.urls.rtc is not configured");yield loadScript(Hn.urls.rtc)}))()}prepareReportingAgent(e){this.clearReportingAgent();const{Sender:t,ClientName:r,ServiceName:n,ApplicationName:i,ReportingStoreBag:o,DeviceName:a}=window.rtc.RTCReportingAgentConfigKeys;e=null!=e?e:this.instance.nowPlayingItem;const s=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$x(e,t,r[t])}))}return e}({firmwareVersion:this.generateBrowserVersion(),model:this.options.browserName},this.getMediaIdentifiers(e));void 0===this._storeBag&&(this._storeBag=this.generateStoreBag());const c={[t]:"HLSJS",[r]:this.options.clientName,[n]:this.options.serviceName,[i]:this.options.applicationName,[o]:this._storeBag,[a]:this.options.osVersion,userInfoDict:s};return ji.debug("RTC: creating reporting agent with config",c),this.reportingAgent=new window.rtc.RTCReportingAgent(c),ji.debug("RTC: created reporting agent",this.reportingAgent),this.reportingAgent}cleanup(){var e=this;return _async_to_generator$x((function*(){e.clearReportingAgent()}))()}getMediaIdentifiers(e){var t,r,n;const i=null===(t=e)||void 0===t?void 0:t.defaultPlayable;if(i){var o;const e={};return void 0!==(null===(o=i.mediaMetrics)||void 0===o?void 0:o.MediaIdentifier)&&(e.MediaIdentifier=i.mediaMetrics.MediaIdentifier),void 0!==i.channelId&&(e.ContentProvider=i.channelId),e}return"musicVideo"===(null===(r=e)||void 0===r?void 0:r.type)?{MediaIdentifier:"adamid="+e.id}:(null===(n=e)||void 0===n?void 0:n.isLiveVideoStation)?{MediaIdentifier:"raid="+e.id}:void 0}clearReportingAgent(){void 0!==this.reportingAgent&&(this.reportingAgent.destroy(),ji.debug("RTC: called destroy on reporting agent",this.reportingAgent),this.reportingAgent=void 0)}generateBrowserVersion(){return this.options.browserMajorVersion?`${this.options.browserMajorVersion}.${this.options.browserMinorVersion||0}`:"unknown"}generateStoreBag(){var e;const{storeBagURL:t,clientName:r,applicationName:n,serviceName:i,browserName:o}=this.options,a={iTunesAppVersion:`${`${Hn.app.name}-${Hn.app.build}`}/${null===(e=this.instance)||void 0===e?void 0:e.version}`},s=new window.rtc.RTCStorebag.RTCReportingStoreBag(t,r,i,n,o,a);return ji.debug("RTC: created store bag",s),s}constructor(e){_define_property$x(this,"options",void 0),_define_property$x(this,"reportingAgent",void 0),_define_property$x(this,"instance",void 0),_define_property$x(this,"currentMediaItem",void 0),_define_property$x(this,"_storeBag",void 0),_define_property$x(this,"requestedEvents",[]),this.options=e}}function asyncGeneratorStep$w(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_decorate$f(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$f(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}class PlayActivityService{cleanup(){this.trackers.forEach(e=>{var t,r;return null===(t=(r=e).cleanup)||void 0===t?void 0:t.call(r)}),this.clearIntention(),this.teardownListeners(),this.registeredEvents.clear()}configure(e){var t,r=this;return(t=function*(){r.cleanup(),r.registeredEvents=function(e){const t=[];for(const r of e)t.push(...r.requestedEvents);return new Set(t)}(r.trackers),r.setupListeners();try{yield Promise.all(r.trackers.map(t=>t.configure(e)))}catch(t){Kn.error("Error configuring a play activity service",t)}},function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function _next(e){asyncGeneratorStep$w(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$w(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}getTrackerByType(e){return this.trackers.find(t=>t instanceof e)}handleEvent(e,t={}){const r=this.addIntention(e,t);e===et.playerActivate&&(r.flush="boolean"==typeof t.isPlaying?!t.isPlaying:void 0);for(const n of this.trackers)n.handleEvent(e,r,t.item)}addIntention(e,t){if(![et.playbackPause,et.playbackStop].includes(e))return t;const r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$w(e,t,r[t])}))}return e}({},this.lastUserIntent,this.lastApplicationIntent,t);return this.clearIntention(),r}clearIntention(){this.lastUserIntent=void 0,this.lastApplicationIntent=void 0}recordApplicationIntent(e,t){this.lastApplicationIntent=t}recordUserIntent(e,t){this.lastUserIntent=t}setupListeners(){this.registeredEvents.forEach(e=>{this.dispatcher.subscribe(e,this.handleEvent)}),this.dispatcher.subscribe(et.userActivityIntent,this.recordUserIntent),this.dispatcher.subscribe(et.applicationActivityIntent,this.recordApplicationIntent)}teardownListeners(){this.registeredEvents.forEach(e=>{this.dispatcher.unsubscribe(e,this.handleEvent)}),this.dispatcher.unsubscribe(et.userActivityIntent,this.recordUserIntent),this.dispatcher.unsubscribe(et.applicationActivityIntent,this.recordApplicationIntent)}constructor(e,t){_define_property$w(this,"dispatcher",void 0),_define_property$w(this,"trackers",void 0),_define_property$w(this,"registeredEvents",void 0),_define_property$w(this,"lastUserIntent",void 0),_define_property$w(this,"lastApplicationIntent",void 0),_define_property$w(this,"isConfigured",void 0),this.dispatcher=e,this.trackers=t,this.registeredEvents=new Set,this.isConfigured=!0}}function asyncGeneratorStep$v(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$v(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$v(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$v(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}_ts_decorate$f([Bind(),_ts_metadata$f("design:type",Function),_ts_metadata$f("design:paramtypes",[String,Object])],PlayActivityService.prototype,"handleEvent",null),_ts_decorate$f([Bind(),_ts_metadata$f("design:type",Function),_ts_metadata$f("design:paramtypes",[String,"undefined"==typeof ActivityIntention?Object:ActivityIntention])],PlayActivityService.prototype,"recordApplicationIntent",null),_ts_decorate$f([Bind(),_ts_metadata$f("design:type",Function),_ts_metadata$f("design:paramtypes",[String,"undefined"==typeof ActivityIntention?Object:ActivityIntention])],PlayActivityService.prototype,"recordUserIntent",null);const Ui=BooleanDevFlag.register("mk-force-safari-hlsjs");function useNativeSafariPlayback(){return!Ui.enabled}function requiresHlsJs(e){return _requiresHlsJs.apply(this,arguments)}function _requiresHlsJs(){return(_requiresHlsJs=_async_to_generator$v((function*(e){const t=null!=e?e:yield findKeySystemPreference(),r=!useNativeSafariPlayback();return t!==Le.FAIRPLAY||r}))).apply(this,arguments)}function asyncGeneratorStep$u(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread_props$a(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Fi=function(){var e,t=(e=function*(e,t,r){const n=new Headers({Authorization:"Bearer "+t,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+r}),i=urlEncodeParameters(_object_spread_props$a(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$v(e,t,r[t])}))}return e}({},e.playParams),{keyFormat:"web"})),o=`${Hn.urls.mediaApi}/play/assets?${i}`,a=yield fetch(o,{method:"GET",headers:n});if(500===a.status){const t=new MKError(MKError.SERVER_ERROR);throw t.data=e,t}if(403===a.status){var s,c,l;let t;try{var d,u;t=yield a.json(),t=null===(u=t)||void 0===u||null===(d=u.errors)||void 0===d?void 0:d[0]}catch(y){}const r="40303"===(null===(s=t)||void 0===s?void 0:s.code)?MKError.SUBSCRIPTION_ERROR:MKError.ACCESS_DENIED;var p;const n=new MKError(r,null!==(p=null===(c=t)||void 0===c?void 0:c.title)&&void 0!==p?p:null===(l=t)||void 0===l?void 0:l.detail);throw n.data=e,n}if(!a.ok){const t=new MKError(MKError.CONTENT_UNAVAILABLE);throw t.data=e,t}const h=(yield a.json()).results;return Kn.debug(`media-item: loaded data from ${o}: ${JSON.stringify(h)}`),h},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$u(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$u(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))});return function(e,r,n){return t.apply(this,arguments)}}();function asyncGeneratorStep$t(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$t(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$t(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$t(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const Bi=function(){var e=_async_to_generator$t((function*(e,t,r){e.hasOffersHlsUrl?yield Ki(e):e.isLiveRadioStation?yield Vi(e,t,r):yield Hi(e,t,r)}));return function(t,r,n){return e.apply(this,arguments)}}(),Ki=function(){var e=_async_to_generator$t((function*(e){var t,r;const n=Hn.urls.hlsOffersKeyUrls;if(!n)throw new MKError(MKError.CONTENT_UNSUPPORTED,"HLS OFFERS");var i;e.updateWithLoadedKeys(n),e.updateWithLoadedAssets(void 0,null!==(i=null===(t=e.attributes)||void 0===t?void 0:t.assetUrl)&&void 0!==i?i:null===(r=e.attributes.offers)||void 0===r?void 0:r[0].hlsUrl),yield Gi(e,e.assetURL)}));return function(t){return e.apply(this,arguments)}}(),Vi=function(){var e=_async_to_generator$t((function*(e,t,r){if(!Hn.features["playready-live-radio"]&&Ve===Le.PLAYREADY&&"video"!==e.attributes.mediaKind&&!Hn.features["mse-live-radio"])throw new MKError(MKError.CONTENT_UNSUPPORTED,"LIVE_RADIO");const n=(yield Fi(e,t,r)).assets[0];e.updateWithLoadedKeys({"hls-key-cert-url":n.fairPlayKeyCertificateUrl,"hls-key-server-url":n.keyServerUrl,"widevine-cert-url":n.widevineKeyCertificateUrl}),filterUnavailableLiveRadioUrls(n,e),e.isLiveVideoStation?e.assetURL=n.url:yield Gi(e,n.url)}));return function(t,r,n){return e.apply(this,arguments)}}(),Gi=function(){var e=_async_to_generator$t((function*(e,t){let r;try{r=yield fetch(t)}catch(i){throw makeContentUnavailableError(e)}const n=yield r.text();extractAssetsFromMasterManifest(n,t,e)}));return function(t,r){return e.apply(this,arguments)}}(),extractAssetsFromMasterManifest=(e,t,r)=>{const n=/^#EXT-X-STREAM-INF:.*BANDWIDTH=(\d+),CODECS="(.*)"\s*\n(.*$)/gim;let i;for(;i=n.exec(e);){let[e,n,o,a]=i;/^http(s)?:\/\//.test(a)||(a=rewriteLastUrlPath(t,a)),r.assets.push({bandwidth:Number(n),codec:o,URL:a})}},filterUnavailableLiveRadioUrls=(e,t)=>{const r=new URL(e.url);if(!r.host.endsWith(".apple.com")&&!r.host.endsWith(".applemusic.com"))throw makeContentUnavailableError(t)},makeContentUnavailableError=e=>{const t=new MKError(MKError.CONTENT_UNAVAILABLE);return t.data=e,t},Hi=function(){var e=_async_to_generator$t((function*(e,t,r){var i;if(Kn.debug("mk: loadWithMZPlay",e.playParams),"podcast-episodes"===e.type)return void(e.assetURL=e.attributes.assetUrl);if(!(yield hasMusicSubscription()))return;const o=null===(i=e.playParams)||void 0===i?void 0:i.id,a=new Headers({Authorization:"Bearer "+t,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+r});let s={salableAdamId:o};if(e.isCloudItem){s={},e.playParams.purchasedId&&(s.purchaseAdamId=e.playParams.purchasedId),e.playParams.catalogId&&(s.subscriptionAdamId=e.playParams.catalogId);const t=/^a\.(\d+)$/;t.test(o)?s.subscriptionAdamId=o.replace(t,"$1"):n(o)&&(s.universalLibraryId=o)}if(!Hn.urls.webPlayback)throw new Error("bag.urls.webPlayback is not configured");const c=yield fetch(Hn.urls.webPlayback,{method:"POST",body:JSON.stringify(s),headers:a}),l=yield c.text(),d=JSON.parse(l);if(!d||!d.songList){const t=MKError.serverError(d,MKError.UNSUPPORTED_ERROR);return e.updateFromLoadError(t),Kn.debug("mk: prepareItemWithMZPlay - rejecting with error",t),Promise.reject(t)}const[u]=d.songList;e.updateFromSongList(u)}));return function(t,r,n){return e.apply(this,arguments)}}();function asyncGeneratorStep$s(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$s(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$s(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$s(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function prepareToPlayMediaItem(e,t){return _prepareToPlayMediaItem.apply(this,arguments)}function _prepareToPlayMediaItem(){return(_prepareToPlayMediaItem=_async_to_generator$s((function*(e,t){const{developerToken:r,userToken:n}=e.store;if(void 0===r||void 0===n)return Promise.reject(new MKError(MKError.AUTHORIZATION_ERROR,"Unable to prepare media item for play."));if(t.isPreparedToPlay)Kn.warn("media-item: item is prepared to play");else{if(Kn.debug("media-item: item.prepareToPlay playParams",t.playParams),t.state=E.loading,t.isUTS)return Promise.reject(new MKError(MKError.UNSUPPORTED_ERROR,"Item was not prepared to play"));yield Bi(t,r,n)}}))).apply(this,arguments)}function _shouldPlayPreview(){return(_shouldPlayPreview=_async_to_generator$s((function*(e,t){return!!e.previewURL&&(!!t||!e.playRawAssetURL&&(!e.isUTS&&!(yield hasMusicSubscription())||(!hasAuthorization()||!e.isPlayable||(e.isUTS?"Preview"===e.type:!supportsDrm()))))}))).apply(this,arguments)}function _prepareForEncryptedPlayback(){return(_prepareForEncryptedPlayback=_async_to_generator$s((function*(e,t,r){if(Kn.debug("prepareForEncryptedPlayback"),!hasAuthorization())return Promise.reject(new MKError(MKError.AUTHORIZATION_ERROR,"Unable to prepare for playback."));try{yield e.store.validateAgeVerification(t)}catch(Ae){return Ae.errorCode===MKError.CONTENT_RESTRICTED&&t.restrict(),Promise.reject(Ae)}try{yield prepareToPlayMediaItem(e,t)}catch(Ae){if([MKError.AUTHORIZATION_ERROR].includes(Ae.errorCode))yield e.store.storekit.revokeUserToken();else if(Ae.errorCode===MKError.TOKEN_EXPIRED)try{return yield e.store.storekit.renewUserToken(),yield prepareToPlayMediaItem(e,t),t.playbackData=_playbackDataForItem(t,r),t}catch(n){}if(Ae)return Promise.reject(Ae)}return t.playbackData=_playbackDataForItem(t,r),t}))).apply(this,arguments)}function _playbackDataForItem(t,r){if(Kn.debug("mk: _playbackDataForItem",t),t.isCloudUpload)return t.assets[0];if("musicVideo"!==t.type&&!t.isLiveVideoStation){if(!t.isLiveRadioStation){const[e]=t.assets.filter(e=>{if(!("flavor"in e))return!1;const t=new RegExp(`\\d{1,2}\\:(c${(null===(n=window.WebKitMediaKeys)||void 0===n?void 0:n.isTypeSupported(He+".1_0",Be.AVC1))?"bc":"tr"}p)(\\d{2,3})`,"i");var n;const i=t.test(e.flavor);var o;const a=null!==(o=e.flavor.match(t))&&void 0!==o?o:[];return i&&parseInt(a[2],10)<=r.bitrate});return e}{var n,i;const o=t.assets.reduce((e,t)=>{const r=t.bandwidth;return e[r]||(e[r]=[]),e[r].push(t),e},{}),a=Object.keys(o).sort((e,t)=>parseInt(e,10)-parseInt(t,10)),s=r.bitrate===e.PlaybackBitrate.STANDARD?a[0]:a[a.length-1];(null===(i=o)||void 0===i||null===(n=i[s])||void 0===n?void 0:n[0].URL)&&(t.assetURL=o[s][0].URL)}}}function asyncGeneratorStep$r(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$r(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$r(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$r(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_decorate$e(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$e(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const Wi={keySystemGenericError:"keySystemGenericError"},qi=new Set([MKError.DEVICE_LIMIT,MKError.GEO_BLOCK]),zi={};zi[Le.FAIRPLAY]="fairplaystreaming",zi[Le.PLAYREADY]="playready",zi[Le.WIDEVINE]="widevine";const Yi=xe.createChild("hlsjs-audio"),Qi=JsonDevFlag.register("mk-hlsjs-config-overrides");class HlsJsAudioPlayer extends BasePlayer{loadPreviewImage(){return _async_to_generator$r((function*(){}))()}get _targetElement(){return this.mediaElement}setNextSeamlessItem(e){return _async_to_generator$r((function*(){}))()}setPresentationMode(e){return _async_to_generator$r((function*(){return Promise.resolve()}))()}get shouldDispatchErrors(){return!this.userInitiated||this._playbackDidStart}get currentPlayingDate(){var e;return null===(e=this.hls)||void 0===e?void 0:e.playingDate}get isPlayingAtLiveEdge(){var e;const t=this.hls;return!(!t||!(null===(e=this.nowPlayingItem)||void 0===e?void 0:e.isLinearStream))&&!!t.isPlayingAtLive}playItemFromEncryptedSource(t,r=!1,n={}){var i=this;return _async_to_generator$r((function*(){i.playbackState!==e.PlaybackStates.stopped?(t.playbackType=e.PlaybackType.encryptedFull,i.nowPlayingItem=t,t.state=E.loading,i.userInitiated=r,yield i.playHlsStream(t.assetURL,t,n)):Yi.debug("hlsjsAudioPlayer.playItemFromEncryptedSource aborting playback because player is stopped")}))()}isPlayerSupported(){return!0}initializeMediaElement(){var e=this;return _async_to_generator$r((function*(){const t=nextAvailableAudioElement();t.autoplay=!1,t.id="apple-music-player",t.controls=!1,t.muted=!1,t.playbackRate=1,t.preload="metadata",t.volume=1,e.mediaElement=t,document.body.appendChild(t),Yi.debug("initializedMediaElement",t)}))()}get seekableTimeRanges(){const e=this.hls;return e?e.seekableTimeRanges:this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}initializeExtension(){var e=this;return _async_to_generator$r((function*(){e._keySystem=yield findKeySystemPreference();try{var t;if(!Ne.urls.hls)throw new Error("bag.urls.hls is not configured");yield Promise.all([loadScript(Ne.urls.hls),null===(t=e._rtcTracker)||void 0===t?void 0:t.loadScript()])}catch(r){throw Yi.error("hlsjs-audio-player failed to load script "+Ne.urls.hls,r),r}}))()}_stopMediaElement(){var e=this,_superprop_get__stopMediaElement=()=>super._stopMediaElement;return _async_to_generator$r((function*(){yield _superprop_get__stopMediaElement().call(e),e.destroy()}))()}destroy(){if(Yi.debug("hlsjs-audio-player.destroy"),this.hls){const{ERROR:e,INTERNAL_ERROR:t,MANIFEST_PARSED:r,KEY_REQUEST_STARTED:n,LICENSE_CHALLENGE_CREATED:i,LEVEL_SWITCHED:o}=window.Hls.Events,a=this.hls;a.stopLoad(),a.detachMedia(),a.off(e,this.handleHlsError),a.off(t,this.handleHlsError),a.off(r,this.handleManifestParsed),a.off(n,this.handleKeyRequestStarted),a.off(i,this.handleLicenseChallengeCreated),a.off(o,this.handleLevelSwitched),a.destroy()}super.destroy(),asAsync(this._license.stop())}playHlsStream(e,t,r={}){var n=this;return _async_to_generator$r((function*(){const{_keySystem:i}=n;if(!i)return;let o,a;n._unrecoverableError=void 0,n.createHlsPlayer(),i===Le.WIDEVINE&&(o="WIDEVINE_SOFTWARE",a={initDataTypes:["cenc","keyids"],distinctiveIdentifier:"optional",persistentState:"required"});const s={subs:"accepts-css",platformInfo:{requiresCDMAttachOnStart:i!==Le.NONE,maxSecurityLevel:o,keySystemConfig:a},appData:{serviceName:Ne.app.name}},{_rtcTracker:c,hls:l}=n;if(c){const e=c.prepareReportingAgent(t);void 0!==e&&(s.appData.reportingAgent=e)}Yi.debug("RTC: loadSource with load options",s);const d=n.startPlaybackSequence();return Yi.info("Manifest already loaded, passing url to HLSJS",e),l.loadSource(e,s,r.startTime),l.attachMedia(n.mediaElement),t&&(n._licenseServerUrl=t.keyURLs["hls-key-server-url"],i===Le.FAIRPLAY?l.setProtectionData({fairplaystreaming:{serverCertUrl:t.keyURLs["hls-key-cert-url"]}}):l.setProtectionData({widevine:{serverCertUrl:t.keyURLs["widevine-cert-url"]}})),d}))()}createHlsPlayer(){const{_keySystem:e}=this,{os:t}=this.services.runtime,{Hls:r}=window,n=M.get(),i={clearMediaKeysOnPromise:!1,debug:!!n,debugLevel:n,enablePerformanceLogging:!!n,enablePlayReadyKeySystem:!0,enableRtcReporting:void 0!==this._rtcTracker,keySystemPreference:zi[e],useMediaKeySystemAccessFilter:!0,nativeControlsEnabled:t.isAndroid,enableID3Cues:!0};(e=>{const t=A.value;t&&t.socketurl&&isAppleHostname(t.socketurl)&&"carry-"===determineCdnBasePrefix()&&(e.socketurl=t.socketurl,e.socketid=t.socketid,e.log=t.log)})(i),(e=>{const t=Qi.value;t&&"object"==typeof t&&Object.assign(e,t)})(i);const o=new r(i),{ERROR:a,INTERNAL_ERROR:s,MANIFEST_PARSED:c,KEY_REQUEST_STARTED:l,LICENSE_CHALLENGE_CREATED:d,LEVEL_SWITCHED:u}=r.Events;o.on(a,this.handleHlsError),o.on(s,this.handleHlsError),o.on(c,this.handleManifestParsed),o.on(l,this.handleKeyRequestStarted),o.on(d,this.handleLicenseChallengeCreated),o.on(u,this.handleLevelSwitched),this.hls=o}handleLevelSwitched(e,t){var r,n,i;const{level:o}=t;if(!o)return;const a=null===(r=this._levels)||void 0===r?void 0:r.find(e=>e.persistentId===o);if(!a||(null===(n=this._currentLevel)||void 0===n?void 0:n.persistentId)===(null===(i=a)||void 0===i?void 0:i.persistentId))return;this._currentLevel=a;const s=void 0!==a.audioGroupId?this._channelsByGroup[a.audioGroupId]:void 0;this._dispatcher.publish(et.hlsLevelUpdated,{level:a,channels:s})}handleHlsError(e,t){if(Yi.warn("HLS.js error",JSON.stringify(t)),this._unrecoverableError)return;let r=new MKError(MKError.UNSUPPORTED_ERROR,t.reason);r.data=t;const{keySystemGenericError:n}=Wi;if(t.details!==n){if("output-restricted"===t.reason&&(r=new MKError(MKError.OUTPUT_RESTRICTED,t.reason)),t.fatal){if(this.hls.destroy(),!this.shouldDispatchErrors)throw r;this._dispatcher.publish(rt.mediaPlaybackError,r)}}else this._dispatcher.publish(n,r)}handleManifestParsed(e,t){var r=this;return _async_to_generator$r((function*(){var e,n;let i;Yi.debug("handleManifestParsed",t),r._levels=null!==(e=t.levels)&&void 0!==e?e:[],r.nowPlayingItem.state=E.ready,r._channelsByGroup=(null!==(n=t.audioTracks)&&void 0!==n?n:[]).reduce((e,t)=>(e[t.groupId]=t.channels,e),{});try{yield r._playMedia()}catch(o){throw Yi.warn("error from media element, possibly non-fatal",o),o}finally{i=yield r.finishPlaybackSequence()}return i}))()}handleKeyRequestStarted(e,t){Yi.debug("hlsjs-video.handleKeyRequestStarted"),this.hls.generateKeyRequest(t.keyuri,{})}handleLicenseChallengeCreated(e,t){var r=this;return _async_to_generator$r((function*(){const{_licenseServerUrl:e,nowPlayingItem:n,_keySystem:i,userInitiated:o}=r;try{var a,c;const l=yield null===(a=r._license)||void 0===a?void 0:a.start(e,n,t,i,o),d={statusCode:l.status};(null===(c=l)||void 0===c?void 0:c.license)&&(i===Le.FAIRPLAY?d.ckc=s(l.license):d.license=s(l.license));const u=l["renew-after"];u&&(d.renewalDate=new Date(Date.now()+1e3*u)),r.hls.setLicenseResponse(t.keyuri,d)}catch(d){var l;if(r._unrecoverableError)return;const e=d.data,n={};void 0!==(null===(l=e)||void 0===l?void 0:l.status)&&(n.statusCode=+e.status),Yi.warn("Passing license response error to Hls.js",n),r.hls.setLicenseResponse(t.keyuri,n),qi.has(d.name)&&(r._unrecoverableError=d,r.resetDeferredPlay(),yield r.stop({endReasonType:ot.FAILED_TO_LOAD,userInitiated:o})),r.onPlaybackLicenseError(d)}}))()}onPlaybackLicenseError(e){this.resetDeferredPlay(),this._dispatcher.publish(Fe.playbackLicenseError,e)}seekToTime(e){var t=this;return _async_to_generator$r((function*(){t.hls?(Yi.debug("hlsjs-video: hls seekTo",e),t.hls.seekTo=e):(Yi.debug("hlsjs-video: media element seek to",e),t._targetElement.currentTime=e)}))()}constructor(e){var t,r;super(e),_define_property$u(this,"currentAudioTrack",void 0),_define_property$u(this,"currentTextTrack",void 0),_define_property$u(this,"textTracks",[]),_define_property$u(this,"audioTracks",[]),_define_property$u(this,"userInitiated",!1),_define_property$u(this,"mediaElement",void 0),_define_property$u(this,"mediaPlayerType","hlsjs-audio"),_define_property$u(this,"hls",void 0),_define_property$u(this,"supportsPreviewImages",!1),_define_property$u(this,"extension",void 0),_define_property$u(this,"_keySystem",void 0),_define_property$u(this,"_license",void 0),_define_property$u(this,"_rtcTracker",void 0),_define_property$u(this,"_levels",void 0),_define_property$u(this,"_channelsByGroup",{}),_define_property$u(this,"_currentLevel",void 0),_define_property$u(this,"_licenseServerUrl",void 0),_define_property$u(this,"_unrecoverableError",void 0),this._rtcTracker=null===(r=e)||void 0===r||null===(t=r.playbackServices)||void 0===t?void 0:t.getRTCStreamingTracker(),this._license=new License}}function asyncGeneratorStep$q(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$q(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$q(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$q(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}_ts_decorate$e([Bind(),_ts_metadata$e("design:type",Function),_ts_metadata$e("design:paramtypes",[void 0,void 0])],HlsJsAudioPlayer.prototype,"handleLevelSwitched",null),_ts_decorate$e([Bind(),_ts_metadata$e("design:type",Function),_ts_metadata$e("design:paramtypes",[void 0,void 0])],HlsJsAudioPlayer.prototype,"handleHlsError",null),_ts_decorate$e([Bind(),_ts_metadata$e("design:type",Function),_ts_metadata$e("design:paramtypes",[void 0,void 0])],HlsJsAudioPlayer.prototype,"handleManifestParsed",null),_ts_decorate$e([Bind(),_ts_metadata$e("design:type",Function),_ts_metadata$e("design:paramtypes",[void 0,void 0])],HlsJsAudioPlayer.prototype,"handleKeyRequestStarted",null),_ts_decorate$e([Bind(),_ts_metadata$e("design:type",Function),_ts_metadata$e("design:paramtypes",[void 0,void 0])],HlsJsAudioPlayer.prototype,"handleLicenseChallengeCreated",null),_ts_decorate$e([Bind(),_ts_metadata$e("design:type",Function),_ts_metadata$e("design:paramtypes",["undefined"==typeof Error?Object:Error])],HlsJsAudioPlayer.prototype,"onPlaybackLicenseError",null),_ts_decorate$e([AsyncDebounce(250),_ts_metadata$e("design:type",Function),_ts_metadata$e("design:paramtypes",[Number])],HlsJsAudioPlayer.prototype,"seekToTime",null);const Ji=BooleanDevFlag.register("mk-force-native-safari-video-player"),Xi=BooleanDevFlag.register("mk-force-hlsjs-video-player"),Zi=BooleanDevFlag.register("mk-force-hls-audio-player"),eo=xe.createChild("factory");class Factory{get isDestroyed(){return this._isDestroyed}getPlayerForMediaItem(e){var t=this;return _async_to_generator$q((function*(){let r;if(eo.debug("Factory.getPlayerForMediaItem",e),function(e){return null!=e&&!isVideo(e)}(e)){const n=t.playersByType.get("audio");if(!e.hasOffersHlsUrl&&n&&!n.isDestroyed)return eo.debug("Returning pooled AudioPlayer"),n;r=yield t.createAudioPlayer(e,t.playerOptions),"audio"===r.mediaPlayerType&&t.playersByType.set("audio",r)}else isVideo(e)&&(r=yield t.createVideoPlayer(e,t.playerOptions));var n;if(void 0===r)throw new Error("Unable to create player for MediaItem: "+(null===(n=e)||void 0===n?void 0:n.id));return eo.debug("Initializing player: "+r.constructor.name),yield r.initialize(),r}))()}createAudioPlayer(e,t){return _async_to_generator$q((function*(){return e.hasOffersHlsUrl||Zi.enabled?(eo.debug("Creating HLSAudioPlayer"),new HlsJsAudioPlayer(t)):(eo.debug("Creating AudioPlayer"),new AudioPlayer(t))}))()}createVideoPlayer(e,t){return _async_to_generator$q((function*(){var r,n,i,o;return eo.debug("Creating VideoPlayer"),Ji.enabled?(eo.debug("Creating NativeSafariVideoPlayer with mkForceSafariNativeVideoPlayer enabled"),new NativeSafariVideoPlayer(t)):Xi.enabled?(eo.debug("Creating HlsJsVideoPlayer with mkForceHlsjsVideoPlayer enabled"),new HlsJsVideoPlayer(t)):(yield null===(r=t.playbackServices)||void 0===r?void 0:r.requiresHlsJs())?(eo.debug("Creating HlsJsVideoPlayer required for the KeySystem"),new HlsJsVideoPlayer(t)):e.isLiveVideoStation||e.isLinearStream||(null===(o=e.defaultPlayable)||void 0===o||null===(i=o.assets)||void 0===i||null===(n=i.fpsKeyServerUrl)||void 0===n?void 0:n.startsWith("https://linear.tv.apple.com"))?(eo.debug("Creating HlsJsVideoPlayer for Live Video stream"),new HlsJsVideoPlayer(t)):(eo.debug("Creating NativeSafariVideoPlayer as a fall through"),new NativeSafariVideoPlayer(t))}))()}destroy(){this._isDestroyed=!0;for(const e of this.playersByType.values())e.destroy();this.playersByType.clear()}constructor(e){_define_property$t(this,"playerOptions",void 0),_define_property$t(this,"playersByType",void 0),_define_property$t(this,"_isDestroyed",!1),this.playersByType=new Map,this.playerOptions=e}}function asyncGeneratorStep$p(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$p(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$p(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$p(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_decorate$d(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$d(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const{mediaPlaybackError:to,playerTypeDidChange:ro}=rt,{playbackLicenseError:no}=Fe,{keySystemGenericError:io}=In,oo=function(){var e=_async_to_generator$p((function*(e,t){var r,n;if(null===(n=e.container)||void 0===n||null===(r=n.attributes)||void 0===r?void 0:r.requiresSubscription){if(!(yield t())){const t=new MKError(MKError.SUBSCRIPTION_ERROR);throw t.data=e,t}}}));return function(t,r){return e.apply(this,arguments)}}();let ao=!1;class MediaItemPlayback{get isDestroyed(){return this._isDestroyed}get currentPlaybackTime(){return this._currentPlayer.currentPlaybackTime}get currentPlaybackTimeRemaining(){return this._currentPlayer.currentPlaybackTimeRemaining}get currentPlayingDate(){return this._currentPlayer.currentPlayingDate}get isPlayingAtLiveEdge(){return this._currentPlayer.isPlayingAtLiveEdge}get seekableTimeRanges(){return this._currentPlayer.seekableTimeRanges}get audioTracks(){return this._currentPlayer.audioTracks}get currentAudioTrack(){return this._currentPlayer.currentAudioTrack}set currentAudioTrack(e){this._currentPlayer.currentAudioTrack=e}get currentPlaybackDuration(){return this._currentPlayer.currentPlaybackDuration}get currentBufferedProgress(){return this._currentPlayer.currentBufferedProgress}get currentPlaybackProgress(){return this._currentPlayer.currentPlaybackProgress}get currentTextTrack(){return this._currentPlayer.currentTextTrack}set currentTextTrack(e){this._currentPlayer.currentTextTrack=e}get previewOnly(){return this._previewOnly}set previewOnly(e){this._previewOnly=e}get isPlaying(){return this._currentPlayer.isPlaying}get isPrimaryPlayer(){return this._currentPlayer.isPrimaryPlayer}set isPrimaryPlayer(e){this._currentPlayer.isPrimaryPlayer=e}get isReady(){return this._currentPlayer.isReady}get nowPlayingItem(){return this._currentPlayer.nowPlayingItem}get playbackRate(){return this._currentPlayer.playbackRate}set playbackRate(e){this._updatePlayerState("playbackRate",e)}get playbackState(){return this._currentPlayer.playbackState}set playbackState(e){this._currentPlayer.setPlaybackState(e,this.nowPlayingItem)}get playbackTargetAvailable(){return this._currentPlayer.playbackTargetAvailable}get playbackTargetIsWireless(){return this._currentPlayer.playbackTargetIsWireless}get supportsPreviewImages(){return this._currentPlayer.supportsPreviewImages}get textTracks(){return this._currentPlayer.textTracks}get volume(){return this._currentPlayer.volume}set volume(e){var t;this._currentPlayer.isDestroyed&&(null===(t=this._dispatcher)||void 0===t||t.publish(rt.playbackVolumeDidChange,{}));this._updatePlayerState("volume",e)}clearNextManifest(){this._currentPlayer.clearNextManifest()}destroy(){var e,t;this._isDestroyed=!0,this._playerFactory.destroy(),null===(e=this._dispatcher)||void 0===e||e.unsubscribe(no,this.onPlaybackLicenseError),null===(t=this._dispatcher)||void 0===t||t.unsubscribe(io,this.onKeySystemGenericError)}exitFullscreen(){return this._currentPlayer.exitFullscreen()}loadPreviewImage(e){var t=this;return _async_to_generator$p((function*(){return t._currentPlayer.loadPreviewImage(e)}))()}getNewSeeker(){return this._currentPlayer.newSeeker()}mute(){this._volumeAtMute=this.volume,this.volume=0}pause(e){var t=this;return _async_to_generator$p((function*(){return t._currentPlayer.pause(e)}))()}play(){var e=this;return _async_to_generator$p((function*(){return e._currentPlayer.play()}))()}preload(){var e=this;return _async_to_generator$p((function*(){return e._currentPlayer.preload()}))()}prepareToPlay(e){var t=this;return _async_to_generator$p((function*(){var r,n;Zn.debug("invoking prepareToPlay for ",e.title);const i=yield t.prepareForEncryptedPlayback(e,{bitrate:t._bitrateCalculator.bitrate}),o=null===(r=t._currentPlayback)||void 0===r?void 0:r.item,a=Ne.features["seamless-audio-transitions"],s="song"===(null===(n=o)||void 0===n?void 0:n.type)&&"song"===e.type,c=!e.playRawAssetURL;return a&&s&&c&&(Zn.debug(`setting ${e.title} for seamless audio transition`),yield t._currentPlayer.setNextSeamlessItem(e)),i}))()}requestFullscreen(e){return this._currentPlayer.requestFullscreen(e)}showPlaybackTargetPicker(){this._currentPlayer.showPlaybackTargetPicker()}seekToTime(t,r=e.SeekReasonType.Manual){var n=this;return _async_to_generator$p((function*(){yield n._currentPlayer.seekToTime(t,r)}))()}setPresentationMode(e){var t=this;return _async_to_generator$p((function*(){return t._currentPlayer.setPresentationMode(e)}))()}startMediaItemPlayback(e,t=!1){var r=this;return _async_to_generator$p((function*(){var n;Zn.debug("MediaItemPlayback: startMediaItemPlayback",e),e.resetState(),((e,t)=>{const{os:r}=t;if(e.isLinearStream&&("ios"===r.name||"ipados"===r.name)){Zn.warn("Cannot play linear stream on iOS or iPad");const t=new MKError(MKError.CONTENT_UNSUPPORTED,"IOS LINEAR");throw t.data={item:e},t}})(e,r.services.runtime),yield oo(e,r.hasMusicSubscription);const i=yield r._getPlayerForMediaItem(e);if(yield r.setCurrentPlayer(i),!(null===(n=r._currentPlayer)||void 0===n?void 0:n.hasMediaElement))return Zn.warn(`MediaItemPlayback: Could not play media of type ${e.type}, marking item as unsupported and skipping.`),void e.notSupported();try{const{dispatcher:n}=r.services;e.beginMonitoringStateDidChange(e=>n.publish(be.mediaItemStateDidChange,e)),e.beginMonitoringStateWillChange(e=>n.publish(be.mediaItemStateWillChange,e));const i=r.playOptions.get(e.id);i&&r.playOptions.delete(e.id);const o=yield r._playAccordingToPlaybackType(e,t,i);return r._currentPlayback={item:e,userInitiated:t},o}catch(Ae){throw e.updateFromLoadError(Ae),Zn.error(Ae.message,Ae),Ae}}))()}_playAccordingToPlaybackType(e,t,r){var n=this;return _async_to_generator$p((function*(){return(yield function(e,t){return _shouldPlayPreview.apply(this,arguments)}(e,n._previewOnly))?n._playPreview(e,t):function(e){return!(!e.playRawAssetURL||!e.attributes.assetUrl)}(e)?n._playRawAsset(e,t,r):isBroadcastRadio(e)?n._playBroadcastRadio(e,t):((e=>{if(!supportsDrm()){const t=new MKError(MKError.CONTENT_UNSUPPORTED,"NO DRM");throw t.data={item:e},Zn.warn("No DRM detected"),t}})(e),n._playEncryptedFull(e,t,r))}))()}_playEncryptedFull(e,t,r){var n=this;return _async_to_generator$p((function*(){if(Zn.debug("MediaItemPlayback: play encrypted full",e),!e||!e.isPlayable)return Promise.reject(new MKError(MKError.MEDIA_PLAYBACK,"Not Playable"));const i=n._currentPlayer;try{yield n.prepareForEncryptedPlayback(e,{bitrate:n._bitrateCalculator.bitrate})}catch(Ae){return Zn.error("prepareForEncryptedPlayback Error: userInitiated "+t),i.destroy(),t?Promise.reject(Ae):void i.dispatch(rt.mediaPlaybackError,Ae)}return yield function(e){return new Promise((t,r)=>{var n,i;const{ageGatePolicy:o}=e;if(!o||!o.age||!o.frequencyInMinutes)return Kn.debug("No ageGatePolicy. Resolving handleAgeGate()"),t(void 0);const a=getLocalStorage(),s=null===(n=a)||void 0===n?void 0:n.ageGatePolicyAge,c=null===(i=a)||void 0===i?void 0:i.ageGatePolicyExpiration;if(s&&c&&parseInt(c,10)>Date.now()&&parseInt(s,10)>=o.age)return t(void 0);MKDialog.clientDialog({okButtonString:"Yes",okButtonAction:()=>{var e,r;return null===(e=a)||void 0===e||e.setItem("ageGatePolicyAge",o.age.toString()),null===(r=a)||void 0===r||r.setItem("ageGatePolicyExpiration",(Date.now()+60*o.frequencyInMinutes*1e3).toString()),t(void 0)},cancelButtonString:"No",cancelButtonAction:()=>r(new MKError("AGE_GATE","Age Gate Declined")),explanation:`This content may not be appropriate for ages younger than ${o.age}.`,message:`Are you ${o.age} or older?`}).present()})}(e),Zn.debug("About to play item as encrypted",e),yield i.playItemFromEncryptedSource(e,t,r),e}))()}_playBroadcastRadio(t,r){var n=this;return _async_to_generator$p((function*(){if(Zn.debug("MediaItemPlayback: play broadcast radio",t),!Ne.features["broadcast-radio"]){const e=new MKError(MKError.CONTENT_UNAVAILABLE);throw e.data=t,e}const i=n._currentPlayer,o=i.isPaused()&&!r,a=yield Fi(t,jr.developerToken,jr.musicUserToken),s=a.assets[0];return t.playbackType=e.PlaybackType.unencryptedFull,t.trackInfo=a["track-info"],i.nowPlayingItem=t,yield i.playItemFromUnencryptedSource(s.url,o),t}))()}_playRawAsset(t,r,n){var i=this;return _async_to_generator$p((function*(){Zn.debug("MediaItemPlayback: play raw asset",t);const o=i._currentPlayer,a=o.isPaused()&&!r;return t.playbackType=e.PlaybackType.unencryptedFull,o.nowPlayingItem=t,yield o.playItemFromUnencryptedSource(t.attributes.assetUrl,a,n),t}))()}_playPreview(t,r){var n=this;return _async_to_generator$p((function*(){Zn.debug("MediaItemPlayback: play preview",t);const i=n._currentPlayer,o=i.isPaused()&&!r;return supportsDrm()||i.dispatch(rt.drmUnsupported,{item:t}),t.playbackType=e.PlaybackType.preview,i.nowPlayingItem=t,yield i.playItemFromUnencryptedSource(t.previewURL,o),t}))()}stop(e){var t=this;return _async_to_generator$p((function*(){yield t._currentPlayer.stop(e)}))()}unmute(){this.volume>0||(this.volume=this._volumeAtMute||1,this._volumeAtMute=void 0)}_getPlayerForMediaItem(e){var t=this;return _async_to_generator$p((function*(){Zn.trace("MediaItemPlayback._getPlayerForMediaItem",e);const r=yield t._playerFactory.getPlayerForMediaItem(e);return Zn.trace("Applying default player state",r,t.playerState),Object.assign(r,t.playerState),r}))()}setCurrentPlayer(e){var t=this;return _async_to_generator$p((function*(){var r;t._currentPlayer!==e&&(Zn.debug("MediaItemPlayback: setting currentPlayer",e),yield t._currentPlayer.stop(),t._currentPlayer=e,null===(r=t._dispatcher)||void 0===r||r.publish(ro,{player:e}))}))()}onKeySystemGenericError(e,t){var r=this;return _async_to_generator$p((function*(){var e;ao?null===(e=r._dispatcher)||void 0===e||e.publish(to,t):(ao=!0,Zn.warn("Retrying playback after keysystemGenericError"),yield r.restartPlayback())}))()}onPlaybackLicenseError(e,t){var r=this;return _async_to_generator$p((function*(){var e;t.errorCode===MKError.PLAYREADY_CBC_ENCRYPTION_ERROR?(Zn.warn("MediaItemPlayback: PLAYREADY_CBC_ENCRYPTION_ERROR...retrying with different key system"),yield r.restartPlayback()):null===(e=r._dispatcher)||void 0===e||e.publish(to,t)}))()}restartPlayback(){var e=this;return _async_to_generator$p((function*(){yield e.stop();const{_currentPlayback:t}=e;if(t){const{item:r,userInitiated:n}=t;r.resetState(),yield e.startMediaItemPlayback(r,n)}}))()}_updatePlayerState(e,t){this.playerState[e]=t,this._currentPlayer[e]=t}constructor(e){_define_property$s(this,"playerState",{playbackRate:1,volume:1}),_define_property$s(this,"playOptions",new Map),_define_property$s(this,"hasMusicSubscription",void 0),_define_property$s(this,"prepareForEncryptedPlayback",void 0),_define_property$s(this,"_currentPlayer",void 0),_define_property$s(this,"services",void 0),_define_property$s(this,"_dispatcher",void 0),_define_property$s(this,"_playerFactory",void 0),_define_property$s(this,"_previewOnly",!1),_define_property$s(this,"_volumeAtMute",void 0),_define_property$s(this,"_currentPlayback",void 0),_define_property$s(this,"_bitrateCalculator",void 0),_define_property$s(this,"_isDestroyed",!1);const{playbackServices:t}=e;var r,n;this.hasMusicSubscription=t.hasMusicSubscription,this.prepareForEncryptedPlayback=t.prepareForEncryptedPlayback,r=e.tokens,jr=r,e.bag&&(n=e.bag,Object.assign(Ne,n)),this.services=e.services,this._dispatcher=e.services.dispatcher,this._bitrateCalculator=e.services.bitrateCalculator,this._playerFactory=new Factory(e),this._currentPlayer=new PlayerStub(e),this._dispatcher.subscribe(no,this.onPlaybackLicenseError),this._dispatcher.subscribe(io,this.onKeySystemGenericError)}}function asyncGeneratorStep$o(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$o(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$o(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$o(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$r(e,t,r[t])}))}return e}function _ts_decorate$c(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$c(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}_ts_decorate$d([Bind(),_ts_metadata$d("design:type",Function),_ts_metadata$d("design:paramtypes",[void 0,void 0])],MediaItemPlayback.prototype,"onKeySystemGenericError",null),_ts_decorate$d([Bind(),_ts_metadata$d("design:type",Function),_ts_metadata$d("design:paramtypes",[void 0,void 0])],MediaItemPlayback.prototype,"onPlaybackLicenseError",null);const so=[MKError.AGE_VERIFICATION,MKError.CONTENT_EQUIVALENT,MKError.CONTENT_RESTRICTED,MKError.CONTENT_UNAVAILABLE,MKError.CONTENT_UNSUPPORTED,MKError.SERVER_ERROR,MKError.SUBSCRIPTION_ERROR,MKError.UNSUPPORTED_ERROR,MKError.USER_INTERACTION_REQUIRED],co=JsonDevFlag.register("mk-bag-features-overrides");class MKInstance{get developerToken(){return qn.developerToken}get api(){return this._services.apiManager.api}get audioTracks(){return this._mediaItemPlayback.audioTracks}get authorizationStatus(){return qn.authorizationStatus}get bitrate(){return this._services.bitrateCalculator.bitrate}set bitrate(e){this._services.bitrateCalculator.bitrate=e}get browserSupportsPictureInPicture(){return detectPictureInPictureSupport()}get browserSupportsVideoDrm(){return supportsDrm()}get cid(){return(this.realm===e.SKRealm.TV||this.sourceType!==St.MUSICKIT)&&qn.cid}get continuous(){return this._playbackController.continuous}set continuous(e){this._playbackController.continuous=e}get autoplayEnabled(){return this._autoplayEnabled}set autoplayEnabled(t){this.realm!==e.SKRealm.MUSIC&&(t=!1),t!==this.autoplayEnabled&&(this._autoplayEnabled=t,this._services.dispatcher.publish(Bn.autoplayEnabledDidChange,this.autoplayEnabled))}get currentAudioTrack(){return this._mediaItemPlayback.currentAudioTrack}set currentAudioTrack(e){this._mediaItemPlayback.currentAudioTrack=e}get currentPlaybackDuration(){return this._mediaItemPlayback.currentPlaybackDuration}get currentPlaybackProgress(){return this._mediaItemPlayback.currentPlaybackProgress}get currentPlaybackTime(){return this._mediaItemPlayback.currentPlaybackTime}get currentPlayingDate(){return this._mediaItemPlayback.currentPlayingDate}get isPlayingAtLiveEdge(){return this._mediaItemPlayback.isPlayingAtLiveEdge}get seekableTimeRanges(){return this._mediaItemPlayback.seekableTimeRanges}get currentPlaybackTimeRemaining(){return this._mediaItemPlayback.currentPlaybackTimeRemaining}get currentTextTrack(){return this._mediaItemPlayback.currentTextTrack}set currentTextTrack(e){this._mediaItemPlayback.currentTextTrack=e}get isAuthorized(){return qn.isAuthorized}get isPlaying(){return this._playbackController.isPlaying}get isRestricted(){return qn.isRestricted}get metricsClientId(){return qn.metricsClientId}set metricsClientId(e){qn.metricsClientId=e}get musicUserToken(){return qn.musicUserToken}set musicUserToken(e){e&&qn.musicUserToken===e||(qn.musicUserToken=e)}updateUserTokenFromStorage(){return qn.updateUserTokenFromStorage()}get needsGDPR(){return qn.needsGDPR}get nowPlayingItem(){return this._mediaItemPlayback.nowPlayingItem}get nowPlayingItemIndex(){return this._playbackController.nowPlayingItemIndex}get playbackMode(){return this._playbackMode}set playbackMode(t){if(-1===Object.values(e.PlaybackMode).indexOf(t))return;const r=t===e.PlaybackMode.PREVIEW_ONLY,n=this._services.mediaItemPlayback;n&&(n.previewOnly=r),this._playbackMode!==t&&(this._playbackController.playbackMode=t,this._playbackMode=t)}get playbackRate(){return this._mediaItemPlayback.playbackRate}set playbackRate(e){this._mediaItemPlayback.playbackRate=e}get playbackState(){return this._mediaItemPlayback.playbackState}get playbackTargetAvailable(){return this._mediaItemPlayback.playbackTargetAvailable}get playbackTargetIsWireless(){return this._mediaItemPlayback.playbackTargetIsWireless}get previewOnly(){return this.playbackMode===e.PlaybackMode.PREVIEW_ONLY}set previewOnly(t){this.playbackMode=t?e.PlaybackMode.PREVIEW_ONLY:e.PlaybackMode.MIXED_CONTENT}get queue(){return this._playbackController.queue}get queueIsEmpty(){return this._playbackController.queue.isEmpty}get realm(){return qn.realm}get repeatMode(){return this._playbackController.repeatMode}set repeatMode(e){this._playbackController.repeatMode=e}set requestUserToken(e){qn.requestUserToken=e}get restrictedEnabled(){return qn.restrictedEnabled}set restrictedEnabled(e){qn.restrictedEnabled=e}get supportsPreviewImages(){return this._mediaItemPlayback.supportsPreviewImages}get seekSeconds(){return this._playbackController.seekSeconds}get services(){return this._services}set shuffle(e){this._playbackController.shuffle=e}get shuffleMode(){return this._playbackController.shuffleMode}set shuffleMode(e){this._playbackController.shuffleMode=e}get storefrontCountryCode(){return qn.storefrontCountryCode}get subscribeURL(){return qn.subscribeURL}get subscribeFamilyURL(){return qn.subscribeFamilyURL}get subscribeIndividualURL(){return qn.subscribeIndividualURL}get subscribeStudentURL(){return qn.subscribeStudentURL}get textTracks(){return this._mediaItemPlayback.textTracks}get videoContainerElement(){return this.context.videoContainerElement}set videoContainerElement(e){this.context.videoContainerElement=e}get volume(){return this._mediaItemPlayback.volume}set volume(e){this._mediaItemPlayback.volume=e}get storefrontId(){return qn.storefrontId}set storefrontId(e){qn.storefrontId=e}get _mediaItemPlayback(){return this._services.mediaItemPlayback}get _playbackController(){if(void 0!==this._playbackControllerInternal)return this._playbackControllerInternal;Zn.debug("setting _playbackController");const e=this._getPlaybackControllerByType(bi.serial);return this._playbackController=e,e}set _playbackController(e){this._playbackControllerInternal=e,this._playbackControllerInternal.autoplayEnabled=this._autoplayEnabled,this._playbackControllerInternal.activate(),this.capabilities.updateChecker(this._playbackControllerInternal.hasCapabilities),this.capabilities.controller=this._playbackControllerInternal}addEventListener(e,t,r={}){adaptAddEventListener(this._services.dispatcher,e,t,r)}authorize(){var e=this;return _async_to_generator$o((function*(){return e.deferPlayback(),qn.authorize()}))()}canAuthorize(){return supportsDrm()&&!this.isAuthorized}canUnauthorize(){return supportsDrm()&&this.isAuthorized}changeToMediaAtIndex(e){var t=this;return _async_to_generator$o((function*(){t._isPlaybackSupported()&&(yield t._validateAuthorization(),t._signalChangeItemIntent(),yield t._playbackController.changeToMediaAtIndex(e))}))()}changeToMediaItem(e){var t=this;return _async_to_generator$o((function*(){Zn.debug("instance.changeToMediaItem",e),t._isPlaybackSupported()&&(yield t._validateAuthorization(),t._signalChangeItemIntent(),yield t._playbackController.changeToMediaItem(e))}))()}changeUserStorefront(e){var t=this;return _async_to_generator$o((function*(){t.storefrontId=e}))()}cleanup(){var e=this;return _async_to_generator$o((function*(){var t;null===(t=e._services.mediaItemPlayback)||void 0===t||t.destroy(),e._signalIntent({endReasonType:ot.EXITED_APPLICATION});const r=Object.keys(e._playbackControllers).map(t=>e._playbackControllers[t].destroy());try{yield Promise.all(r)}catch(n){Zn.error("Error cleaning up controller",n)}e._services.dispatcher.clear()}))()}configure(e){var t=this;return _async_to_generator$o((function*(){return t._whenConfigured=t._configure(e),t._whenConfigured}))()}_configure(e){var t=this;return _async_to_generator$o((function*(){yield qn.storekit.whenAuthCompleted;const r=e.map(t._services.apiManager.registerAPIService,t._services.apiManager);yield Promise.all(r),yield t._configurePlayActivity(),t._initializeExternalEventPublishing()}))()}deferPlayback(){Zn.debug("deferPlayback",this._playbackControllerInternal),deferPlayback()}getApiByType(e){var t;return null===(t=this._services.apiManager)||void 0===t?void 0:t.getApiByType(e)}me(){return _async_to_generator$o((function*(){try{return yield qn.storekit.me()}catch(e){return Promise.reject(new MKError(MKError.AUTHORIZATION_ERROR,"Unauthorized"))}}))()}musicSubscriptionOffers(){return qn.storekit.musicSubscriptionOffers(this.storefrontId)}musicSubcriptionOffers(){return deprecationWarning("musicSubcriptionOffers",{message:"musicSubcriptionOffers has been deprecated, use musicSubscriptionOffers instead"}),this.musicSubscriptionOffers()}hasMusicSubscription(){return hasMusicSubscription(qn.storekit)}mute(){return this._mediaItemPlayback.mute()}pause(e){var t=this;return _async_to_generator$o((function*(){if(t._isPlaybackSupported()){try{t._signalIntent({endReasonType:ot.PLAYBACK_MANUALLY_PAUSED}),yield t._playbackController.pause(e)}catch(Ae){t._handlePlaybackError(Ae)}return Promise.resolve()}}))()}play(){var e=this;return _async_to_generator$o((function*(){if(Zn.debug("instance.play()"),e._isPlaybackSupported()){yield e._validateAuthorization();try{yield e._playbackController.play()}catch(Ae){e._handlePlaybackError(Ae)}return Promise.resolve()}}))()}playMediaItem(e,t){var r=this;return _async_to_generator$o((function*(){var n,i,o,a;if(Zn.debug("mk: playMediaItem",e),(null===(n=t)||void 0===n?void 0:n.bingeWatching)||r.deferPlayback(),t=_object_spread$f({},t),(null===(i=e)||void 0===i?void 0:i.playEvent)&&!hasOwn(t,"startTime")){const{playEvent:r}=e;r.isDone||void 0===r.playCursorInSeconds||(t.startTime=r.playCursorInSeconds)}r.services.dispatcher.publish(Bn.playInitiated,{item:e,timestamp:null!==(a=null===(o=t.meta)||void 0===o?void 0:o.initiatedTimestamp)&&void 0!==a?a:Date.now()});try{t&&r._mediaItemPlayback.playOptions.set(e.id,t);const n=yield r._playbackController.playSingleMediaItem(e,t);return r.services.dispatcher.publish(Bn.capabilitiesChanged),n}catch(Ae){Zn.error("mk:playMediaItem error",Ae),r._handlePlaybackError(Ae)}}))()}removeEventListener(e,t){!function(e,t,r){const n=getCallbacksForName(t);let i;for(let o=n.length-1;o>=0;o--){const[e,t]=n[o];if(e===r){i=t,n.splice(o,1);break}}i&&e.unsubscribe(t,i)}(this._services.dispatcher,e,t)}shouldDisplayPrivacyLink(e){return _async_to_generator$o((function*(){return qn.shouldDisplayPrivacyLink(e)}))()}exitFullscreen(){return this._mediaItemPlayback.exitFullscreen()}requestFullscreen(e){return this._mediaItemPlayback.requestFullscreen(e)}loadPreviewImage(e){var t=this;return _async_to_generator$o((function*(){return t._mediaItemPlayback.loadPreviewImage(e)}))()}getNewSeeker(){return this._playbackController.getNewSeeker()}seekToTime(t,r=e.SeekReasonType.Manual){var n=this;return _async_to_generator$o((function*(){if(n._isPlaybackSupported()){yield n._validateAuthorization();try{yield n._playbackController.seekToTime(t,r)}catch(Ae){n._handlePlaybackError(Ae)}return Promise.resolve()}}))()}setPresentationMode(e){var t=this;return _async_to_generator$o((function*(){return t._mediaItemPlayback.setPresentationMode(e)}))()}skipToNextItem(){var e=this;return _async_to_generator$o((function*(){if(e._isPlaybackSupported()){yield e._validateAuthorization(),e._signalIntent({endReasonType:ot.TRACK_SKIPPED_FORWARDS,direction:ot.TRACK_SKIPPED_FORWARDS});try{yield e._playbackController.skipToNextItem()}catch(Ae){e._handlePlaybackError(Ae)}}}))()}skipToPreviousItem(){var e=this;return _async_to_generator$o((function*(){if(e._isPlaybackSupported()){yield e._validateAuthorization(),e._signalIntent({endReasonType:ot.TRACK_SKIPPED_BACKWARDS,direction:ot.TRACK_SKIPPED_BACKWARDS});try{yield e._playbackController.skipToPreviousItem()}catch(Ae){e._handlePlaybackError(Ae)}}}))()}seekForward(){var e=this;return _async_to_generator$o((function*(){if(e._isPlaybackSupported()){yield e._validateAuthorization();try{e._signalIntent({endReasonType:ot.TRACK_SKIPPED_FORWARDS,direction:ot.TRACK_SKIPPED_FORWARDS}),yield e._playbackController.seekForward()}catch(Ae){e._handlePlaybackError(Ae)}}}))()}seekBackward(){var e=this;return _async_to_generator$o((function*(){if(e._isPlaybackSupported()){yield e._validateAuthorization();try{yield e._playbackController.seekBackward()}catch(Ae){e._handlePlaybackError(Ae)}}}))()}showPlaybackTargetPicker(){this._playbackController.showPlaybackTargetPicker()}stop(e){var t=this;return _async_to_generator$o((function*(){var r,n;if(t._isPlaybackSupported()){var i;t._signalIntent({endReasonType:null===(r=e)||void 0===r?void 0:r.endReasonType,userInitiated:null===(i=null===(n=e)||void 0===n?void 0:n.userInitiated)||void 0===i||i});try{yield t._playbackController.stop(e)}catch(Ae){t._handlePlaybackError(Ae)}}}))()}resetSubscribeViewEligibility(){qn.storekit.resetSubscribeViewEligibility()}unauthorize(){return _async_to_generator$o((function*(){return qn.unauthorize()}))()}unmute(){return this._mediaItemPlayback.unmute()}_createPlayerControllerOptions(){var e;return{tokens:qn,bag:Hn,playbackServices:{getRTCStreamingTracker:()=>{var e;return null===(e=this._services.playActivity)||void 0===e?void 0:e.getTrackerByType(RTCStreamingTracker)},hasMusicSubscription:hasMusicSubscription,prepareForEncryptedPlayback:(e,t)=>function(e,t,r){return _prepareForEncryptedPlayback.apply(this,arguments)}(this._services.apiManager,e,t),requiresHlsJs:requiresHlsJs},services:this._services,context:this.context,autoplayEnabled:this.autoplayEnabled,privateEnabled:this.privateEnabled,siriInitiated:this.siriInitiated,storekit:null===(e=qn)||void 0===e?void 0:e.storekit,playbackMode:this.playbackMode}}_getPlaybackControllerByType(e){const t=this._playbackControllers[e];if(t)return t;let r;switch(e){case bi.serial:r=new SerialPlaybackController(this._createPlayerControllerOptions());break;case bi.continuous:r=new ContinuousPlaybackController(this._createPlayerControllerOptions());break;default:throw new MKError(MKError.UNSUPPORTED_ERROR,"Unsupported controller requested: "+e)}return this._playbackControllers[e]=r,r}_handlePlaybackError(e){if(Zn.error("mediaPlaybackError",e),so.includes(e.name))throw e;this._playbackErrorDialog&&!this._services.runtime.isNodeEnvironment&&MKDialog.presentError(e)}_initializeInternalEventHandling(){qn.storekit.addEventListener(Bn.userTokenDidChange,()=>{this._whenConfigured&&this._whenConfigured.then(()=>this._configurePlayActivity().catch()).catch()});const t=this._services.dispatcher;t.subscribe(Bn.mediaPlaybackError,(e,t)=>this._handlePlaybackError(t)),t.subscribe(Bn.playbackStateDidChange,(t,r)=>{r.state===e.PlaybackStates.paused&&(Zn.debug("mk: playbackStateDidChange callback - calling storekit.presentSubscribeViewForEligibleUsers"),qn.storekit.presentSubscribeViewForEligibleUsers({state:r.state,item:this.nowPlayingItem},!1))})}_initializeExternalEventPublishing(){[Bn.authorizationStatusDidChange,Bn.needsGDPRDidChange,Bn.storefrontCountryCodeDidChange,Bn.storefrontIdentifierDidChange,Bn.userTokenDidChange,Bn.eligibleForSubscribeView].forEach(e=>{qn.storekit.addEventListener(e,t=>this._services.dispatcher.publish(e,t))});const e=k[this.storefrontId.toUpperCase()],t=T[e];this._services.dispatcher.subscribe(nn,(e,r)=>{r.resolveAdamIdFromStorefront(t),this._services.dispatcher.publish(Bn.timedMetadataDidChange,r)})}configureLogger(e){var t;Zn.level===Jn&&(!0===e.debug?setRootLoggingLevel(L.DEBUG):void 0!==e.logLevel&&setRootLoggingLevel(e.logLevel)),void 0!==e.logHandler&&(t=e.logHandler,Zn.handlers.external=new CallbackHandler(t))}_configurePlayActivity(){var e=this;return _async_to_generator$o((function*(){void 0!==e._services.playActivity&&(yield e._services.playActivity.configure({instance:e,services:e._services}))}))()}_isPlaybackSupported(){return!this._services.runtime.isNodeEnvironment||(Zn.warn("Media playback is not supported in Node environments."),!1)}_updatePlaybackController(e){var t=this;return _async_to_generator$o((function*(){Zn.debug("mk: _updatePlaybackController",e),t._playbackControllerInternal!==e&&(t._playbackControllerInternal&&(yield t._playbackControllerInternal.deactivate()),t._playbackController=e)}))()}_signalChangeItemIntent(){this._signalIntent({endReasonType:ot.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM})}_signalIntent(e){this.services.dispatcher.publish(et.userActivityIntent,_object_spread$f({userInitiated:!0},e))}_validateAuthorization(t=!1){var r=this;return _async_to_generator$o((function*(){(t||r.playbackMode===e.PlaybackMode.FULL_PLAYBACK_ONLY)&&(void 0!==r._playbackControllerInternal&&r._playbackControllerInternal.isReady&&r._playbackControllerInternal.isPlaying||(yield r.authorize()))}))()}constructor(t,r,n){if(_define_property$r(this,"app",void 0),_define_property$r(this,"capabilities",void 0),_define_property$r(this,"context",void 0),_define_property$r(this,"_autoplayEnabled",!1),_define_property$r(this,"id",void 0),_define_property$r(this,"prefix",void 0),_define_property$r(this,"privateEnabled",!1),_define_property$r(this,"siriInitiated",!1),_define_property$r(this,"sourceType",St.MUSICKIT),_define_property$r(this,"version",e.version),_define_property$r(this,"playbackActions",void 0),_define_property$r(this,"guid",void 0),_define_property$r(this,"_bag",Hn),_define_property$r(this,"_playbackControllers",{}),_define_property$r(this,"_playbackControllerInternal",void 0),_define_property$r(this,"_services",void 0),_define_property$r(this,"_playbackErrorDialog",!0),_define_property$r(this,"_playbackMode",e.PlaybackMode.MIXED_CONTENT),_define_property$r(this,"_whenConfigured",void 0),"string"!=typeof t)throw new Error("MusicKit was initialized without an developerToken.");Object.assign(Hn.features,function(e=[]){const t={};return e.forEach(e=>{"-"===e.charAt(0)?(e=e.substr(1),t[e]=!1):t[e]=!0}),t}(n.features));const i=co.get();i&&(Zn.warn("Overriding bag.features with",i),Hn.features=_object_spread$f({},Hn.features,i)),Object.assign(Hn.autoplay,n.autoplay),this.context={};const o=new PubSub;this.capabilities=new Capabilities(o),n.playbackActions&&(this.playbackActions=n.playbackActions),n.guid&&(this.guid=n.guid);const a=new TimingAccuracy(!!Hn.features["player-accurate-timing"]),s=new BitrateCalculator(o,n.bitrate);this._services={runtime:r,dispatcher:o,timing:a,bitrateCalculator:s},void 0!==n.playActivityAPI&&(this._services.playActivity=new PlayActivityService(o,n.playActivityAPI)),n.services=this._services,this.configureLogger(n),Hn.app=n.app||{},Hn.store=new DataStore({filter:getFilterFromFlags(n.storeFilterTypes||[]),shouldDisableRecordReuse:!!Hn.features["disable-data-store-record-reuse"]}),Object.assign(Hn.urls,n.urls||{});const c=function(e,t){return qn=new Store(e,t),qn}(t,n);this._services.apiManager=new APIServiceManager(c,o);const l=new MediaItemPlayback(this._createPlayerControllerOptions());if(this._services.mediaItemPlayback=l,n.sourceType&&(this.sourceType=n.sourceType),this._initializeInternalEventHandling(),n.bitrate&&(this.bitrate=n.bitrate),n.prefix&&/^(?:web|preview)$/.test(n.prefix)&&(this.prefix=Hn.prefix=n.prefix),n.suppressErrorDialog&&(this._playbackErrorDialog=!n.suppressErrorDialog),void 0!==n.playbackMode&&(this.playbackMode=n.playbackMode),this.privateEnabled=n.privateEnabled||!1,this.siriInitiated=n.siriInitiated||!1,this.id=generateUUID(),Zn.info("MusicKit JS Version: "+this.version),Zn.info("InstanceId",this.id),Zn.debug("Link Parameters",n.linkParameters),Hn.app&&Zn.debug("App",Hn.app),n.userToken){const{userToken:e}=n;"function"==typeof e?qn.dynamicMusicUserToken=e:this.musicUserToken=e}}}function asyncGeneratorStep$n(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$n(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$n(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$n(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function dispatchDocumentEvent(e){if(detectNodeEnvironment())return;const t=new Event(e,{bubbles:!0,cancelable:!0});setTimeout(()=>document.dispatchEvent(t))}function _loadWebComponents(){return(_loadWebComponents=_async_to_generator$n((function*(){var e,t;if(detectNodeEnvironment())return;const r=findScript("musickit.js");if(""!==(null===(t=r)||void 0===t||null===(e=t.dataset)||void 0===e?void 0:e.webComponents))return;const n="noModule"in r,i=`components/musickit-components/musickit-components${n?".esm":""}.js`,o="https:"+cdnBaseURL(i)+i,a={};n&&(a.type="module"),r.hasAttribute("async")&&(a.async=""),r.hasAttribute("defer")&&(a.defer=""),yield loadScript(o,a),dispatchDocumentEvent(Bn.webComponentsLoaded)}))).apply(this,arguments)}function asyncGeneratorStep$m(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$m(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$m(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$m(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$q(e,t,r[t])}))}return e}_ts_decorate$c([AsyncDebounce(250,{isImmediate:!0}),_ts_metadata$c("design:type",Function),_ts_metadata$c("design:paramtypes",["undefined"==typeof ActivityNotificationOptions?Object:ActivityNotificationOptions])],MKInstance.prototype,"pause",null),_ts_decorate$c([AsyncDebounce(250,{isImmediate:!0}),_ts_metadata$c("design:type",Function),_ts_metadata$c("design:paramtypes",[])],MKInstance.prototype,"play",null),_ts_decorate$c([SerialAsync("skip"),_ts_metadata$c("design:type",Function),_ts_metadata$c("design:paramtypes",[])],MKInstance.prototype,"skipToNextItem",null),_ts_decorate$c([SerialAsync("skip"),_ts_metadata$c("design:type",Function),_ts_metadata$c("design:paramtypes",[])],MKInstance.prototype,"skipToPreviousItem",null),_ts_decorate$c([SerialAsync("seek"),_ts_metadata$c("design:type",Function),_ts_metadata$c("design:paramtypes",[])],MKInstance.prototype,"seekForward",null),_ts_decorate$c([SerialAsync("seek"),_ts_metadata$c("design:type",Function),_ts_metadata$c("design:paramtypes",[])],MKInstance.prototype,"seekBackward",null);const lo="undefined"!=typeof window&&"undefined"!=typeof document;let uo=!1;const po=[];function cleanupInstances(){return _cleanupInstances.apply(this,arguments)}function _cleanupInstances(){return(_cleanupInstances=_async_to_generator$m((function*(){const e=po.map(e=>e.cleanup());yield Promise.all(e),po.splice(0,po.length)}))).apply(this,arguments)}function configure$3(e){return _configure$2.apply(this,arguments)}function _configure$2(){return(_configure$2=_async_to_generator$m((function*(e,t=MKInstance,r){if(!e)throw new MKError(MKError.INVALID_ARGUMENTS,"configuration required");const n={},{developerToken:i,mergeQueryParams:o}=e;if(!i)throw new MKError(MKError.CONFIGURATION_ERROR,"Missing developer token");o&&lo&&window.location&&(n.linkParameters=_object_spread$e({},e.linkParameters||{},parseQueryParams(window.location.href)));const a=yield RuntimeEnvironment.detect();yield findKeySystemPreference(a);const s=new t(i,a,_object_spread$e({},e,n));return uo||(yield cleanupInstances()),r&&(yield r(s)),po.push(s),dispatchDocumentEvent(Bn.configured),s}))).apply(this,arguments)}function _define_property$p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$p(e,t,r[t])}))}return e}function transformParameters(e,t=25){if(e)return e.limit&&(e.limit=e.limit>t?t:e.limit),e}function transformStoreData(e){const t=_object_spread$d({},e),{href:r}=t;return void 0!==r&&(delete t.href,t.attributes=_object_spread$d({},t.attributes,{href:r})),t}lo&&(asAsync(function(){return _loadWebComponents.apply(this,arguments)}()),dispatchDocumentEvent(Bn.loaded));function transformTrackParameters(e){return e.map(e=>"string"==typeof e?{id:e,type:"songs"}:{id:e.id,type:e.type||"songs"})}function _define_property$o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ho=["extend","include","l","platform","views"];class LocalDataStore{get hasDataStore(){return this.enableDataStore&&void 0!==this._store}delete(e,t){this.hasDataStore&&this._store.remove(e,t)}read(e,t,r,n){n||"function"!=typeof r||(n=r,r=void 0);const i={};let o=!1;if(r&&(o=Object.keys(r).some(e=>/^(fields|extend)/.test(e)),r.views&&(i.views=r.views),r.include&&(i.relationships=r.include)),this.hasDataStore&&!o){let n,o=[];if(r&&(o=Object.keys(r).reduce((e,t)=>(-1===ho.indexOf(t)&&e.push([t,r[t]]),e),o)),n=o&&1===o.length?this._store.query(o[0][0],o[0][1]):this._store.peek(e,t,i),Array.isArray(n)){if(!r&&n.length)return n}else if(n)return n}if("function"==typeof n)return n()}write(e){return this._prepareDataForDataStore(e,e=>this._store.save(e))}parse(e){return this._prepareDataForDataStore(e,e=>this._store.populateDataRecords(e,{}))}_prepareDataForDataStore(e,t){return this.hasDataStore?Array.isArray(e)?t({data:e}):Object.keys(e).reduce((r,n)=>{const i=e[n];return hasOwn(i,"data")&&(r[n]=t({data:i.data})),"meta"===n&&(r[n]=e[n]),r},{}):e}constructor(e={}){_define_property$o(this,"_store",void 0),_define_property$o(this,"enableDataStore",!1);let t=!1;e.features&&hasOwn(e.features,"api-data-store")&&(this.enableDataStore=!!e.features["api-data-store"]),e.features&&hasOwn(e.features,"disable-data-store-record-reuse")&&(t=!!e.features["disable-data-store-record-reuse"]),this.enableDataStore&&(this._store=e.store||new DataStore({shouldDisableRecordReuse:t}),this._store.mapping=transformStoreData)}}function asyncGeneratorStep$l(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$l(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$l(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const ChunkedIdApi=(e,t=100,r=1e3)=>(n,i,o)=>{if(void 0===o||"function"!=typeof o.value)throw new TypeError(`Only methods can be decorated with @ChunkedIdApi, but ${i} is not a method.`);return{configurable:!0,get(){const n=o.value;function chunkedIdApi(){return _chunkedIdApi.apply(this,arguments)}function _chunkedIdApi(){return(_chunkedIdApi=_async_to_generator$l((function*(...i){const o=i[e];if(o&&Array.isArray(o)){const a=o[0].length||20,s=Math.min(t,Math.floor(r/a)),c=Math.ceil(o.length/s);if(c>1){const t=i.slice(0,e),r=i.slice(e+1),a=[];let l=0;for(let e=1;e<=c;e++){const i=Math.min(e*s,o.length),c=[...t,o.slice(l,i),...r];a.push(n.apply(this,c)),l+=s}const d=yield Promise.all(a);return[].concat(...d)}}return n.apply(this,i)}))).apply(this,arguments)}return Object.defineProperty(this,i,{value:chunkedIdApi,configurable:!0,writable:!0}),chunkedIdApi}}},formatTimezoneOffset=(e=new Date)=>{const t=e.getTimezoneOffset(),r=Math.floor(Math.abs(t)/60),n=Math.round(Math.abs(t)%60);let i="+";return 0!==t&&(i=t>0?"-":"+"),`${i}${leadingZeros(r,2)}:${leadingZeros(n,2)}`},leadingZeros=(e,t=2)=>{let r=""+e;for(;r.length<t;)r="0"+r;return r};function asyncGeneratorStep$k(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$k(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$k(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$k(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread_props$9(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_metadata$b(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}class Books extends TokenSession{audioBook(e,t,r){return this.resource("audio-books",e,t,r)}audioBooks(e,t,r){return this.collection("audio-books",e,t,r)}collection(e,t,r,n){var i=this;return _async_to_generator$k((function*(){const o=`catalog/${i.storefrontId}/${e}`;return t&&((r=r||{}).ids=t),makeRequest(i,o,r,n)}))()}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}resource(e,t,r,n){var i=this;return _async_to_generator$k((function*(){var o;if(!(null===(o=n)||void 0===o?void 0:o.reload)){const n=i._store.read(e,t,r);if(n)return n}const[a]=yield i.collection(e,t,r,n);return a}))()}constructor(e,t,r,n,i={},o){super("https://api.books.apple.com/v1",e,_object_spread_props$9(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$n(e,t,r[t])}))}return e}({},o),{userToken:t,storage:n})),_define_property$n(this,"_store",void 0),_define_property$n(this,"defaultIncludePaginationMetadata",void 0),_define_property$n(this,"storefrontId",ce.ID),r&&(this.storefrontId=r),this._store=new LocalDataStore(i),this.defaultIncludePaginationMetadata=i.features&&hasOwn(i.features,"api-pagination-metadata")}}function asyncGeneratorStep$j(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$j(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$j(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$j(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$m(e,t,r[t])}))}return e}function _object_spread_props$8(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_metadata$a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([ChunkedIdApi(1),_ts_metadata$b("design:type",Function),_ts_metadata$b("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],Books.prototype,"collection",null);class Podcasts extends TokenSession{catalogResource(e,t,r,n){return this.resource(e,t,r,n)}catalogResources(e,t,r,n){return this.collection(e,t,r,n)}catalogResourceRelationship(e,t,r,n,i){return this.collection(`${e}/${t}/${r}`,void 0,n,i)}search(e,t,r){return this.collection("search",void 0,_object_spread$b({term:e,types:"podcasts"},t),r)}artist(e,t,r){return this.catalogResource("artists",e,t,r)}artists(e,t,r){return this.catalogResources("artists",e,t,r)}artistRelationship(e,t,r,n){return this.catalogResourceRelationship("artists",e,t,r,n)}charts(e,t,r){return this.catalogResources("charts",void 0,_object_spread$b({types:e},t),r)}podcast(e,t,r){return this.catalogResource("podcasts",e,_object_spread$b({include:"episodes"},t),r)}podcasts(e,t,r){var n=this;return _async_to_generator$j((function*(){return n.catalogResources("podcasts",e,_object_spread$b({include:"episodes"},t),r)}))()}podcastRelationship(e,t,r,n){var i=this;return _async_to_generator$j((function*(){return i.catalogResourceRelationship("podcasts",e,t,r,n)}))()}episode(e,t,r){var n=this;return _async_to_generator$j((function*(){return n.resource("podcast-episodes",e,t,r)}))()}episodes(e,t,r){var n=this;return _async_to_generator$j((function*(){return n.catalogResources("podcast-episodes",e,t,r)}))()}collection(e,t,r,n){var i=this;return _async_to_generator$j((function*(){let o;if(t){const n={};n["charts"===e?"types":"ids"]=t,o=Object.assign(n,r)}else o=r;const a=`catalog/${i.storefrontId}/${e}`;return makeRequest(i,a,o,n)}))()}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}resource(e,t,r,n){var i=this;return _async_to_generator$j((function*(){var o;if(!(null===(o=n)||void 0===o?void 0:o.reload)){const n=i._store.read(e,t,r);if(n)return n}const[a]=yield i.collection(e,t,r,n);return a}))()}constructor(e,t,r=ce.ID,n,i={},o){super("https://amp-api.podcasts.apple.com/v1",e,_object_spread_props$8(_object_spread$b({},o),{userToken:t,storage:n})),_define_property$m(this,"_store",void 0),_define_property$m(this,"defaultIncludePaginationMetadata",void 0),_define_property$m(this,"storefrontId",void 0),this.storefrontId=r,this._store=new LocalDataStore(i),this.defaultIncludePaginationMetadata=i.features&&hasOwn(i.features,"api-pagination-metadata")}}function asyncGeneratorStep$i(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$l(e,t,r[t])}))}return e}function _object_spread_props$7(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_metadata$9(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([ChunkedIdApi(1),_ts_metadata$a("design:type",Function),_ts_metadata$a("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],Podcasts.prototype,"collection",null);const yo=new Set(["editorial-items"]);class Fitness extends TokenSession{workout(e,t,r){return this.resource("workouts",e,t,r)}contributor(e,t,r){return this.resource("contributors",e,t,r)}editorialItem(e,t,r){return this.resource("editorial-items",e,t,r)}modalities(e,t,r){return this.collection("modalities",e,t,r)}modality(e,t,r){return this.resource("modalities",e,t,r)}workoutProgram(e,t,r){return this.resource("workout-programs",e,t,r)}collection(e,t,r,n){let i;i=t?_object_spread$a({ids:t},r):r;let o="catalog";yo.has(e)&&(o="editorial");return makeRequest(this,`${o}/${this.storefrontId}/${e}`,i,n)}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}resource(e,t,r,n){var i,o=this;return(i=function*(){const i=o._store.read(e,t,r);if(i)return i;const[a]=yield o.collection(e,t,r,n);return a},function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function _next(e){asyncGeneratorStep$i(o,r,n,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$i(o,r,n,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,t,r=ce.ID,n,i={},o){var a,s;super("https://amp-api.fitness.apple.com/v1",e,_object_spread_props$7(_object_spread$a({},o),{userToken:t,storage:n})),_define_property$l(this,"_store",void 0),_define_property$l(this,"defaultIncludePaginationMetadata",void 0),_define_property$l(this,"storefrontId",ce.ID),this.storefrontId=r,this._store=new LocalDataStore(i),this.defaultIncludePaginationMetadata=!!(null===(s=i)||void 0===s||null===(a=s.features)||void 0===a?void 0:a["api-pagination-metadata"])}}function asyncGeneratorStep$h(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$h(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$h(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$h(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$9(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$k(e,t,r[t])}))}return e}function _object_spread_props$6(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_metadata$8(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([ChunkedIdApi(1),_ts_metadata$9("design:type",Function),_ts_metadata$9("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions])],Fitness.prototype,"collection",null);class TVLibrary extends TokenSession{genres(e,t){var r=this;return _async_to_generator$h((function*(){return r.collection("genres",_object_spread$9({types:"tv-episodes,movies"},e),t)}))()}movies(e,t){var r=this;return _async_to_generator$h((function*(){return r.collection("movies",e,t)}))()}purchases(e,t){var r=this;return _async_to_generator$h((function*(){return r.collection("",_object_spread$9({types:"tv-episodes,movies"},e),t)}))()}tvEpisodes(e,t){var r=this;return _async_to_generator$h((function*(){return r.collection("tv-episodes",e,t)}))()}collection(e,t,r){var n=this;return _async_to_generator$h((function*(){try{return yield makeRequest(n,"me/purchases/"+e,t,r)}catch(Ae){var i;if(Ae.name===MKError.CONTENT_UNAVAILABLE)return(null===(i=r)||void 0===i?void 0:i.includePagination)?{data:[],meta:{}}:[];throw Ae}}))()}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}constructor(e,t,r,n={},i){super("https://amp-api.videos.apple.com/v1",e,_object_spread_props$6(_object_spread$9({},i),{userToken:t,storage:r})),_define_property$k(this,"_store",void 0),_define_property$k(this,"defaultIncludePaginationMetadata",void 0),this._store=new LocalDataStore(n),this.defaultIncludePaginationMetadata=n.features&&hasOwn(n.features,"api-pagination-metadata")}}function asyncGeneratorStep$g(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$g(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$g(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$g(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$j(e,t,r[t])}))}return e}function _object_spread_props$5(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([ChunkedIdApi(1),_ts_metadata$8("design:type",Function),_ts_metadata$8("design:paramtypes",[String,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],TVLibrary.prototype,"collection",null);const RecommendationUpdate=()=>(e,t,r)=>{if(void 0===r||"function"!=typeof r.value)throw new TypeError(`Only methods can be decorated with @RecommendationUpdate, but ${t} is not a method.`);return{configurable:!0,get(){const e=r.value;function recommendationUpdate(){return _recommendationUpdate.apply(this,arguments)}function _recommendationUpdate(){return(_recommendationUpdate=_async_to_generator$g((function*(...t){const r=yield e.apply(this,t),n=new Map,i=[],o=new Date;if(!r||!Array.isArray(r))return r;if(r.forEach((e,t)=>{var r;const a=e.id;var s;const c=null!==(s=e.nextUpdateDate)&&void 0!==s?s:null===(r=e.attributes)||void 0===r?void 0:r.nextUpdateDate;if(!a||!c)return;new Date(c)<o&&(i.push(a),n.set(a,t))}),!i.length)return r;let[a,s,c,...l]=t;c=_object_spread_props$5(_object_spread$8({},c),{reload:!0});const d=[i,s,c,...l];return(yield e.apply(this,d)).forEach(e=>{const t=n.get(e.id);void 0!==t&&(r[t]=e)}),r}))).apply(this,arguments)}return Object.defineProperty(this,t,{value:recommendationUpdate,configurable:!0,writable:!0}),recommendationUpdate}}};function asyncGeneratorStep$f(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function makeAlbumKey(e){var t;return(null===(t=e.artwork)||void 0===t?void 0:t.url)+""+e.artistName+""+e.name}class ServerLedger{_initData(){return{lastTimestamp:0,albums:{added:Object.create(null),removed:Object.create(null)},playlists:{added:Object.create(null),removed:Object.create(null)}}}_checkTimestamp(){const e=this._data.lastTimestamp;e&&e+24e5<Date.now()&&(this._data=this._initData(),this._sessionStorage&&this._sessionStorage.removeItem(this._storageKey))}added(e){var t,r;this.load();const n=null===(t=e)||void 0===t?void 0:t.playlists,i=null===(r=e)||void 0===r?void 0:r.albums;return n||i?(n&&n.forEach(e=>{const t=Date.now();this._data.playlists.added[e]=t,this._data.lastTimestamp=t}),i&&i.forEach(e=>{const t=Date.now();this._data.albums.added[e]=t,this._data.lastTimestamp=t}),this.save(),e):e}removed(e){var t;this.load();const r=null===(t=e)||void 0===t?void 0:t.playlists;return r?(ensureArray(r).forEach(e=>{if(0!==e.indexOf("pl.")){const t=Date.now();this._data.playlists.removed[e]=t,this._data.lastTimestamp=t}}),this.save(),e):e}reconcile(e,t,r,n,i){var o,a=this;return(o=function*(){a._checkTimestamp();const i=t.data||t;if(!i||!Array.isArray(i)||Array.isArray(r))return t;const o=a._data.albums.added,s=a._data.playlists.removed,c=a._data.playlists.added,l=[],d=n&&!n.offset||!!r&&(void 0===r.offset||0===r.offset);let u=!1;if("all"===e||"playlists"===e){for(let e=i.length-1;e>=0;e--){var p;const t=i[e],r=null===(p=t.playParams)||void 0===p?void 0:p.globalId;"library-playlists"===t.type&&(s[t.id]?i.splice(e,1):r&&c[r]&&(delete c[r],u=!0,d||i.splice(e,1)))}if(d&&a._catalogApi){const e=Object.keys(c);if(e.length){const t=yield a._catalogApi.playlists(e);l.splice(0,0,...t)}}}if(a._catalogApi&&("all"===e||"albums"===e)){const e=Object.keys(o);if(e.length){const t=yield a._catalogApi.albums(e),r=Object.create(null);t.forEach((t,n)=>{const i=makeAlbumKey(t);r[i]={catalogId:e[n],album:t}});for(let e=i.length-1;e>=0;e--){var h;const t=i[e];if(null===(h=t.playParams)||void 0===h||h.globalId,"library-albums"===t.type){const n=makeAlbumKey(t),a=r[n];a&&(delete o[a.catalogId],u=!0,d?delete r[n]:i.splice(e,1))}}if(d){const e=Object.keys(r).map(e=>r[e].album);e.length&&l.splice(0,0,...e)}}}if(u&&a.save(),d&&l.length&&(l.sort((e,t)=>{const r=a._data.albums.added[e.id]||a._data.playlists.added[e.id]||0;return(a._data.albums.added[t.id]||a._data.playlists.added[t.id]||0)-r}),i.splice(0,0,...l)),!i.length)throw new MKError(MKError.CONTENT_UNAVAILABLE,"The requested content is not available.");const y=t.meta;return y&&void 0===y.total&&(y.total=i.length),t},function(){var e=this,t=arguments;return new Promise((function(r,n){var i=o.apply(e,t);function _next(e){asyncGeneratorStep$f(i,r,n,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$f(i,r,n,_next,_throw,"throw",e)}_next(void 0)}))})()}load(){if(!this._sessionStorage)return;const e=this._sessionStorage.getItem(this._storageKey);if(e)try{this._data=JSON.parse(e),this._data.albums&&this._data.playlists||(this._data=this._initData())}catch(t){this._data||(this._data=this._initData())}else this._data=this._initData()}save(){if(!this._sessionStorage)return;const e=this._data,t=0===Object.keys(e.albums.added).length&&0===Object.keys(e.albums.removed).length&&0===Object.keys(e.playlists.added).length&&0===Object.keys(e.playlists.removed).length;try{if(t)this._sessionStorage.getItem(this._storageKey)&&this._sessionStorage.removeItem(this._storageKey);else{const e=JSON.stringify(this._data);this._sessionStorage.setItem(this._storageKey,e)}}catch(r){}}constructor(e,t,r){_define_property$i(this,"_storageKey",void 0),_define_property$i(this,"_data",this._initData()),_define_property$i(this,"_catalogApi",void 0),_define_property$i(this,"_sessionStorage",void 0),this._catalogApi=t,this._storageKey="mk-server-ledger:"+(e||""),this._sessionStorage=r||getSessionStorage(),this.load()}}function asyncGeneratorStep$e(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$e(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$e(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$e(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$h(e,t,r[t])}))}return e}function _object_spread_props$4(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_metadata$7(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const _o="me/library";class Library extends TokenSession{add(e){var t=this;return _async_to_generator$e((function*(){const r=transformKeys(e,dasherize),n=Date.now();if(n-t._last<1e3)return Promise.reject(new MKError(MKError.QUOTA_EXCEEDED));const i=new Headers({Authorization:"Bearer "+t.developerToken,[O]:t.userToken}),o=Object.keys(r).map(e=>`ids[${e}]=${r[e].join(",")}`).join("&");try{const e=yield fetch(`${t.url}/${_o}?${o}`,{method:"POST",headers:i});return e.ok?(t._last=n,t._serverLedger.added(r)):Promise.reject(MKError.responseError(e))}catch(a){return Promise.reject(MKError.responseError(a))}}))()}remove(e){var t=this;return _async_to_generator$e((function*(){if(!t.developerToken||!t.userToken)return Promise.reject("Invalid tokens");const r=new Headers({Authorization:"Bearer "+t.developerToken,[O]:t.userToken}),n=transformKeys(e,dasherize),i=Object.keys(n)[0],o=Object.values(n)[0];try{const e=yield fetch(`${t.url}/${_o}/${i}/${o}`,{method:"DELETE",headers:r});return e.ok?t._serverLedger.removed(n):Promise.reject(MKError.responseError(e))}catch(a){return Promise.reject(MKError.responseError(a))}}))()}album(e,t,r){var n=this;return _async_to_generator$e((function*(){return n.resource("albums",e,t,r)}))()}albumRelationship(e,t,r,n){var i=this;return _async_to_generator$e((function*(){return i.collection(`albums/${e}/${t}`,void 0,r,n)}))()}albums(e,t,r){var n=this;return _async_to_generator$e((function*(){let i;try{i=yield n.collection("albums",e,t,_object_spread_props$4(_object_spread$7({},r),{shouldCacheResults:!1}))}catch(o){if(o.errorCode!==MKError.CONTENT_UNAVAILABLE)throw o;i={data:[],meta:{}}}return n._serverLedger.reconcile("albums",i,e,t,r)}))()}artist(e,t,r){var n=this;return _async_to_generator$e((function*(){return n.resource("artists",e,t,r)}))()}artistRelationship(e,t="albums",r,n){var i=this;return _async_to_generator$e((function*(){return i.collection(`artists/${e}/${t}`,void 0,r,n)}))()}artists(e,t,r){var n=this;return _async_to_generator$e((function*(){return n.collection("artists",e,t,r)}))()}createPlaylist(e={},t){var r=this;return _async_to_generator$e((function*(){let n;const{name:i,description:o,tracks:a=[]}=e,s={attributes:{name:i,description:o},relationships:{tracks:{data:transformTrackParameters(a)}}},c=JSON.stringify(s);try{n=yield r.request(_o+"/playlists",t,{body:c,method:"POST"})}catch(Ae){return Promise.reject(MKError.responseError(Ae))}try{const[e]=r._store.write(n);return e}catch(Ae){return Promise.reject(MKError.parseError(Ae))}}))()}deletePlaylist(e,t){var r=this;return _async_to_generator$e((function*(){let n;const i=`${_o}/playlists/${e}`;try{n=yield r.request(i,t,{method:"DELETE"})}catch(Ae){return Promise.reject(MKError.responseError(Ae))}r.purgePlaylistFromCaches(e)}))()}editPlaylist(e,t,r){var n=this;return _async_to_generator$e((function*(){let i;const o=JSON.stringify({attributes:t});try{i=yield n.request(`${_o}/playlists/${e}`,r,{body:o,method:"PATCH"})}catch(Ae){return Promise.reject(MKError.responseError(Ae))}try{const r=t,i="library-playlists";return n._store.write({data:[{type:i,id:e,attributes:r}]}),t}catch(Ae){return Promise.reject(MKError.parseError(Ae))}}))()}updatePlaylistTracklist(e,t){var r=this;return _async_to_generator$e((function*(){yield r.putPlaylistTracklisting(e,t,"PUT"),r.purgePlaylistFromCaches(e)}))()}appendTracksToPlaylist(e,t){var r=this;return _async_to_generator$e((function*(){yield r.putPlaylistTracklisting(e,t,"POST"),r.purgePlaylistFromCaches(e)}))()}playlistFolder(e,t,r){return this.resource("playlist-folders",e,t,r)}playlistFolders(e,t,r){return this.collection("playlist-folders",e,t,r)}playlistFoldersRoot(e,t){var r;return e=_object_spread_props$4(_object_spread$7({},e),{filter:_object_spread_props$4(_object_spread$7({},null===(r=e)||void 0===r?void 0:r.filter),{identity:"playlistsroot"})}),this.playlistFolders(void 0,e,t)}playlistFolderChildren(e,t,r){const n=`playlist-folders/${e}/children`;return this.collection(n,void 0,t,r)}musicVideo(e,t,r){var n=this;return _async_to_generator$e((function*(){return n.resource("music-videos",e,t,r)}))()}musicVideos(e,t,r){var n=this;return _async_to_generator$e((function*(){return n.collection("music-videos",e,t,r)}))()}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}playlist(e,t,r){var n=this;return _async_to_generator$e((function*(){return t=_object_spread$7({include:"tracks"},t),n.resource("playlists",e,t,r)}))()}createCatalogPlaylist(e,t,r){var n=this;return _async_to_generator$e((function*(){return r=_object_spread$7({method:"POST"},r),n.resource(`playlists/${e}/catalog`,void 0,t,r)}))()}playlistRelationship(e,t="tracks",r,n){var i=this;return _async_to_generator$e((function*(){return i.collection(`playlists/${e}/${t}`,void 0,r,n)}))()}playlists(e,t,r){var n=this;return _async_to_generator$e((function*(){let i;try{i=e&&e.length>0?yield Promise.all(e.map(e=>n.playlist(e,t,r))):yield n.collection("playlists",e,t,_object_spread_props$4(_object_spread$7({},r),{shouldCacheResults:!1}))}catch(o){if(o.errorCode!==MKError.CONTENT_UNAVAILABLE)throw o;i={data:[],meta:{}}}return n._serverLedger.reconcile("playlists",i,e,t,r)}))()}recentlyAdded(e,t){var r=this;return _async_to_generator$e((function*(){var n;const i=null===(n=e)||void 0===n?void 0:n.limit;let o;try{o=yield r.collection("recently-added",void 0,transformParameters(e,i||10),_object_spread_props$4(_object_spread$7({},t),{shouldCacheResults:!1}))}catch(a){if(a.errorCode!==MKError.CONTENT_UNAVAILABLE)throw a;o={data:[],meta:{}}}return r._serverLedger.reconcile("all",o,void 0,e,t)}))()}search(e,t,r){var n=this;return _async_to_generator$e((function*(){t=n._denormalizeLibraryTypes(t);const i=_object_spread$7({term:e,types:"library-albums"},t);return n.collection("search",void 0,i,_object_spread_props$4(_object_spread$7({},r),{shouldCacheResults:!1}))}))()}song(e,t,r){var n=this;return _async_to_generator$e((function*(){return n.resource("songs",e,t,r)}))()}songRelationship(e,t,r,n){var i=this;return _async_to_generator$e((function*(){return i.collection(`songs/${e}/${t}`,void 0,r,n)}))()}songs(e,t,r){var n=this;return _async_to_generator$e((function*(){return n.collection("songs",e,t,r)}))()}collection(e,t,r,n){var i=this;return _async_to_generator$e((function*(){!t||t.length||r||(r=transformParameters(t,100),t=void 0);const o=t?_object_spread$7({ids:t},r):r;return makeRequest(i,`${_o}/${e}`,o,n)}))()}resource(e,t,r,n){var i=this;return _async_to_generator$e((function*(){var o;if(!(null===(o=n)||void 0===o?void 0:o.reload)){const n=i._store.read(e,t,r);if(n)return n}let a=`${_o}/${e}`;t&&(a=`${a}/${t}`);const[s]=yield makeRequest(i,a,r,n);return s}))()}purgePlaylistFromCaches(e){this._store.delete("library-playlists",e),this.networkCache.removeItemsMatching(this.constructURL(`${_o}/playlists/${e}`,{}),!1)}putPlaylistTracklisting(e,t,r="PUT"){var n=this;return _async_to_generator$e((function*(){const i=transformTrackParameters(t),o=JSON.stringify({data:i});try{yield n.request(`${_o}/playlists/${e}/tracks`,void 0,{body:o,method:r})}catch(Ae){return Promise.reject(MKError.responseError(Ae))}}))()}_denormalizeLibraryTypes(e={},t="types"){let r=e[t];return r?("string"==typeof r&&(r=r.split(",")),e[t]=r.map(e=>e.replace(/^(albums|music-videos|playlists|songs)$/,"library-$1")),e):e}constructor(e,t,r,n={},i,o){super(e,t,_object_spread_props$4(_object_spread$7({},o),{userToken:r})),_define_property$h(this,"_last",0),_define_property$h(this,"_store",void 0),_define_property$h(this,"defaultIncludePaginationMetadata",void 0),_define_property$h(this,"_serverLedger",void 0),this._store=new LocalDataStore(n),this._serverLedger=new ServerLedger(r,i),this.defaultIncludePaginationMetadata=n.features&&hasOwn(n.features,"api-pagination-metadata")}}function asyncGeneratorStep$d(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$d(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$d(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$6(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$g(e,t,r[t])}))}return e}function _object_spread_props$3(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_decorate$6(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$6(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var fo,vo;!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([ChunkedIdApi(1),_ts_metadata$7("design:type",Function),_ts_metadata$7("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions])],Library.prototype,"collection",null),function(e){e[e.Global=0]="Global",e.Lyrics="lyrics",e.Catalog="catalog",e.Personalized="me",e.Editorial="editorial",e.Engagement="engagement",e.Social="social"}(fo||(fo={})),function(e){e.songs="songs",e.albums="albums",e.playlists="playlists",e.stations="stations",e["music-videos"]="music-videos",e["library-music-videos"]="library-music-videos",e["library-playlists"]="library-playlists",e["library-songs"]="library-songs"}(vo||(vo={}));class API extends TokenSession{get needsEquivalents(){const{userStorefrontId:e}=this;return void 0!==e&&""!==e&&e!==this.storefrontId}activity(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Catalog,"activities",e,t,r)}))()}activities(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Catalog,"activities",e,t,r)}))()}album(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Catalog,"albums",e,t,r)}))()}albumRelationship(e,t,r,n){var i=this;return _async_to_generator$d((function*(){return i.collection(fo.Catalog,`albums/${e}/${t}`,void 0,r,n)}))()}albums(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Catalog,"albums",e,t,r)}))()}appleCurator(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Catalog,"apple-curators",e,t,r)}))()}appleCurators(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Catalog,"apple-curators",e,t,r)}))()}artist(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Catalog,"artists",e,t,r)}))()}artistRelationship(e,t,r,n){var i=this;return _async_to_generator$d((function*(){return i.collection(fo.Catalog,`artists/${e}/${t}`,void 0,r,n)}))()}artistView(e,t,r,n){return this.collection(fo.Catalog,`artists/${e}/view/${t}`,void 0,r,n)}artists(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Catalog,"artists",e,t,r)}))()}audioBook(e,t,r){return this.books.audioBook(e,t,r)}audioBooks(e,t,r){return this.books.audioBooks(e,t,r)}catalogResources(e,t={},r){const n=function(e){const t={};if(!e)return t;for(const r of e){if(!r)continue;const{type:e,id:n}=r;e in t||(t[e]=[]),t[e].push(n)}return t}(e);return t=_object_spread_props$3(_object_spread$6({},t),{ids:n}),makeRequest(this,`${fo.Catalog}/${this.storefrontId}`,t,r)}changeStation(e,t,r={}){var n=this;return _async_to_generator$d((function*(){return yield makeRequest(n,"me/stations/change-station/"+e,t,_object_spread_props$3(_object_spread$6({},r),{reload:!0,method:"POST",shouldCacheResults:!1}))}))()}charts(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Catalog,"charts",e,t,_object_spread_props$3(_object_spread$6({},r),{returnRawJSONApiRecords:!0}))}))()}contents(e,t,r){return this.collection(fo.Catalog,"contents",e,t,r)}curator(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Catalog,"contents",e,t,r)}))()}curators(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Catalog,"contents",e,t,r)}))()}curatorRelationship(e,t,r,n){var i=this;return _async_to_generator$d((function*(){return i.collection(fo.Catalog,`curators/${e}/${t}`,void 0,r,n)}))()}episode(e,t,r){var n=this;return _async_to_generator$d((function*(){return n._podcastsAPI.catalogResource("podcast-episodes",e,t,r)}))()}episodes(e,t,r){var n=this;return _async_to_generator$d((function*(){return n._podcastsAPI.catalogResources("podcast-episodes",e,t,r)}))()}genre(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Catalog,"genres",e,t,r)}))()}genres(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Catalog,"genres",e,t,r)}))()}grouping(e,t,r){var n=this;return _async_to_generator$d((function*(){!t&&isObject$1(e)&&(t=e,e=void 0);const i=_object_spread$6({},{platform:"desktop"},t);return n.resource(fo.Editorial,"groupings",e,i,_object_spread_props$3(_object_spread$6({},r),{shouldCacheResults:!1}))}))()}groupings(e,t={},r){var n=this;return _async_to_generator$d((function*(){const i=_object_spread$6({},{platform:"desktop"},t);return n.collection(fo.Editorial,"groupings",e,i,_object_spread_props$3(_object_spread$6({},r),{shouldCacheResults:!1}))}))()}lyric(e,t,r){return this.resource(fo.Catalog,`songs/${e}/lyrics`,"",t,_object_spread$6({reload:!0},r))}lyricSnippet(e,t,r){return this.collection(fo.Lyrics,"snippet/songs",e,t,_object_spread_props$3(_object_spread$6({},r),{returnRawJSONApiRecords:!0}))}historyHeavyRotation(e,t){var r=this;return _async_to_generator$d((function*(){return r.collection(fo.Personalized,"history/heavy-rotation",void 0,transformParameters(e,10),t)}))()}multiplex(e,t,r){var n=this;return _async_to_generator$d((function*(){const i=n._store.read("multiplex",e,t);return i||(r=_object_spread$6({returnRawJSONApiRecords:!0},r),makeRequest(n,`${fo.Editorial}/${n.storefrontId}/multiplex/${e}`,t,r))}))()}multiroom(e,t,r){var n=this;return _async_to_generator$d((function*(){const i=n._store.read("multirooms",e,t);if(i)return i;const[o]=yield n.collection(fo.Editorial,"multirooms/"+e,void 0,t,r);return o}))()}musicMovie(e,t,r){return this.resource(fo.Catalog,"music-movies",e,t,r)}musicMovies(e,t,r){return this.collection(fo.Catalog,"music-movies",e,t,r)}musicVideo(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Catalog,"music-videos",e,t,r)}))()}musicVideos(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Catalog,"music-videos",e,t,r)}))()}nextStationTracks(e,t,r={}){var n=this;return _async_to_generator$d((function*(){var i,o,a;const s=null!==(a=r.queryParameters)&&void 0!==a?a:{};(null===(i=t)||void 0===i?void 0:i.clean)&&(s.clean=t.clean,delete t.clean),(null===(o=t)||void 0===o?void 0:o.limit)&&(s.limit=t.limit,delete t.limit);return yield makeRequest(n,"me/stations/next-tracks/"+e,t,_object_spread_props$3(_object_spread$6({},r),{reload:!0,method:"POST",queryParameters:s,shouldCacheResults:!1}))}))()}continuousStation(e,t,r={}){var n=this;return _async_to_generator$d((function*(){return yield makeRequest(n,"me/stations/continuous",e,_object_spread_props$3(_object_spread$6({},r),{reload:!0,method:"POST",queryParameters:t,returnRawJSONApiRecords:!0,shouldCacheResults:!1}))}))()}playlist(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Catalog,"playlists",e,t,r)}))()}playlistRelationship(e,t,r,n){var i=this;return _async_to_generator$d((function*(){return i.collection(fo.Catalog,`playlists/${e}/${t}`,void 0,r,n)}))()}playlists(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Catalog,"playlists",e,t,r)}))()}podcast(e,t,r){var n=this;return _async_to_generator$d((function*(){return n._podcastsAPI.catalogResource("podcasts",e,_object_spread$6({include:"episodes"},t),r)}))()}podcastRelationship(e,t,r,n){var i=this;return _async_to_generator$d((function*(){return i._podcastsAPI.catalogResourceRelationship("podcasts",e,t,r,n)}))()}podcasts(e,t,r){var n=this;return _async_to_generator$d((function*(){return n._podcastsAPI.catalogResources("podcasts",e,_object_spread$6({include:"episodes"},t),r)}))()}recentPlayed(e,t){var r=this;return _async_to_generator$d((function*(){return r.collection(fo.Personalized,"recent/played",void 0,transformParameters(e,10),t)}))()}recentRadioStations(e,t){var r=this;return _async_to_generator$d((function*(){return r.collection(fo.Personalized,"recent/radio-stations",void 0,transformParameters(e,10),t)}))()}recordLabel(e,t,r){return this.resource(fo.Catalog,"record-labels",e,t,r)}recordLabels(e,t,r){return this.collection(fo.Catalog,"record-labels",e,t,r)}recordLabelView(e,t,r,n){return this.collection(fo.Catalog,`record-labels/${e}/view/${t}`,void 0,r,n)}personalRecommendation(e,t,r,n=!0){var i=this;return _async_to_generator$d((function*(){const o=yield i.personalRecommendations(e,t,r,n),[a]=o;return a}))()}refreshPersonalRecommendation(e,t,r){return t=_object_spread$6({timezone:formatTimezoneOffset()},t),r=_object_spread_props$3(_object_spread$6({},r),{method:"POST",queryParameters:t}),this.resource(fo.Personalized,"recommendations",e,void 0,r)}personalRecommendations(e,t,r={},n=!0){var i=this;return _async_to_generator$d((function*(){const o=formatTimezoneOffset(),a=yield i.collection(fo.Personalized,"recommendations",e,_object_spread$6({timezone:o},t),_object_spread_props$3(_object_spread$6({},r),{shouldCacheResults:n,returnRawJSONApiRecords:!0}));i._reindexRelationships(a,"recommendations");try{return mapRequestResult(a,e=>i.parseResultData(!1,e))}catch(Ae){return Promise.reject(MKError.parseError(Ae))}}))()}personalRecommendationView(e,t,r,n={}){var i=this;return _async_to_generator$d((function*(){return i.collection(fo.Personalized,`recommendations/${e}/view/${t}`,void 0,r,n)}))()}recommendations(e,t,r={}){var n=this;return _async_to_generator$d((function*(){const i=formatTimezoneOffset(),o=yield n.collection(fo.Global,"recommendations/"+n.storefrontId,e,_object_spread$6({timezone:i},t),_object_spread_props$3(_object_spread$6({},r),{shouldCacheResults:!1,returnRawJSONApiRecords:!0}));n._reindexRelationships(o,"recommendations");try{return mapRequestResult(o,e=>n.parseResultData(!1,e))}catch(Ae){return Promise.reject(MKError.parseError(Ae))}}))()}recommendedFriends(e,t,r={}){return r=_object_spread_props$3(_object_spread$6({},r),{method:"POST",body:JSON.stringify(_object_spread$6({ids:{socialProfiles:e}},r.body))}),this.collection(fo.Global,"social/recommended-friends",void 0,t,_object_spread_props$3(_object_spread$6({},r),{shouldCacheResults:!1,returnRawJSONApiRecords:!0}))}room(e,t,r){var n=this;return _async_to_generator$d((function*(){const i=n._store.read("rooms",e,t);if(i&&i.hasAttributes("title"))return i;const o=yield n.collection(fo.Editorial,"rooms/"+e,void 0,t,r),[a]=o;return a}))()}roomContents(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Editorial,`rooms/${e}/contents`,void 0,t,r)}))()}search(e,t,r){var n=this;return _async_to_generator$d((function*(){const i=_object_spread$6({term:e},t);return r=_object_spread_props$3(_object_spread$6({},r),{useRawResponse:!0}),n.collection(fo.Catalog,"search",void 0,i,_object_spread_props$3(_object_spread$6({},r),{shouldCacheResults:!1}))}))()}searchHints(e,t,r){var n=this;return _async_to_generator$d((function*(){var i;const o=_object_spread$6({term:e},t),a=yield n.collection(fo.Catalog,"search/hints",void 0,o,_object_spread_props$3(_object_spread$6({},r),{returnRawJSONApiRecords:!0}));return"topResults"===(null===(i=o)||void 0===i?void 0:i.with)&&"topResults"in a&&(a.topResults=n.parseResultData(!0,a.topResults)),a}))()}searchQuery(e,t){var r=this;return _async_to_generator$d((function*(){return t=_object_spread_props$3(_object_spread$6({},t),{useRawResponse:!0}),r.collection(fo.Catalog,"search/query",void 0,e,_object_spread_props$3(_object_spread$6({},t),{shouldCacheResults:!1}))}))()}searchSuggestions(e,t,r){var n=this;return _async_to_generator$d((function*(){var i;t=_object_spread$6({term:e},t);const o=yield n.collection(fo.Catalog,"search/suggestions",void 0,t,_object_spread_props$3(_object_spread$6({},r),{returnRawJSONApiRecords:!0}));return Array.isArray(null===(i=o)||void 0===i?void 0:i.suggestions)&&o.suggestions.forEach(e=>{"topResults"===e.kind&&(e.content=n.parseResultData(!0,[e.content])[0])}),o}))()}socialBadgingMap(e,t){return this.collection(fo.Global,"social/badging-map",void 0,e,_object_spread_props$3(_object_spread$6({},t),{returnRawJSONApiRecords:!0}))}socialProfile(e,t,r){return this.resource(fo.Social,"social-profiles",e,t,r)}socialProfiles(e,t,r){return this.collection(fo.Social,"social-profiles",e,t,r)}personalSocialProfile(e,t){return this.resource(fo.Personalized,"social-profile",void 0,e,t)}socialPost(e,t={},r){var n=this;return _async_to_generator$d((function*(){e.startsWith("sa.")?t.filter={post:e}:t.ids=e;const[i]=yield n.collection(fo.Catalog,"contents","",t,r);return i}))()}socialSearch(e,t={},r){var n=this;return _async_to_generator$d((function*(){return t=_object_spread_props$3(_object_spread$6({},t),{term:e}),n.collection(fo.Social,"search",void 0,t,r)}))()}song(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Catalog,"songs",e,t,r)}))()}songRelationship(e,t,r,n){var i=this;return _async_to_generator$d((function*(){return i.collection(fo.Catalog,`songs/${e}/${t}`,void 0,r,n)}))()}songs(e,t,r){var n=this;return _async_to_generator$d((function*(){return!t&&isObject$1(e)&&(t=e,e=void 0),n.collection(fo.Catalog,"songs",e,t,r)}))()}tastePreferences(e,t){var r=this;return _async_to_generator$d((function*(){return r.collection(fo.Personalized,"taste/taste-preferences",void 0,e,_object_spread_props$3(_object_spread$6({},t),{shouldCacheResults:!1}))}))()}saveTastePreferences(e){var t=this;return _async_to_generator$d((function*(){e=e.map(e=>e instanceof DataRecord?e.serialize().data:e);const r={method:"POST",body:JSON.stringify({data:e}),shouldCacheResults:!0};try{return yield makeRequest(t,"me/taste/taste-preferences",void 0,r)}catch(Ae){return Ae.name===MKError.CONTENT_UNAVAILABLE?[]:Promise.reject(MKError.parseError(Ae))}}))()}tvEpisode(e,t,r){return this.resource(fo.Catalog,"tv-episodes",e,_object_spread$6({include:"seasons"},t),r)}tvEpisodes(e,t,r){return this.collection(fo.Catalog,"tv-episodes",e,_object_spread$6({include:"seasons"},t),r)}tvSeason(e,t,r){return this.resource(fo.Catalog,"tv-seasons",e,_object_spread$6({include:"episodes"},t),r)}tvSeasons(e,t,r){return this.collection(fo.Catalog,"tv-seasons",e,_object_spread$6({include:"episodes"},t),r)}tvShow(e,t,r){return this.resource(fo.Catalog,"tv-shows",e,t,r)}tvShows(e,t,r){return this.collection(fo.Catalog,"tv-shows",e,t,r)}uploadedAudio(e,t,r){var n=this;return _async_to_generator$d((function*(){return t=_object_spread$6({include:"curator,artists"},t),n.resource(fo.Catalog,"uploaded-audios",e,t,r)}))()}uploadedAudios(e,t,r){var n=this;return _async_to_generator$d((function*(){return t=_object_spread$6({include:"curator,artists"},t),n.collection(fo.Catalog,"uploaded-audios",e,t,r)}))()}uploadedVideo(e,t,r){var n=this;return _async_to_generator$d((function*(){return t=_object_spread$6({include:"curator,artists"},t),n.resource(fo.Catalog,"uploaded-videos",e,t,r)}))()}uploadedVideos(e,t,r){var n=this;return _async_to_generator$d((function*(){return t=_object_spread$6({include:"curator,artists"},t),n.collection(fo.Catalog,"uploaded-videos",e,t,r)}))()}upsellMarketingItems(e,t){return this.collection(fo.Engagement,"upsell/marketing-items",void 0,e,t)}station(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Catalog,"stations",e,t,r)}))()}stations(e,t,r){var n=this;return _async_to_generator$d((function*(){return!t&&isObject$1(e)&&(t=e,e=void 0),n.collection(fo.Catalog,"stations",e,t,r)}))()}storefront(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Global,"storefronts",e,t,r)}))()}storefronts(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.collection(fo.Global,"storefronts",e,t,r)}))()}musicSummary(e,t,r){var n=this;return _async_to_generator$d((function*(){return n.resource(fo.Personalized,"music-summaries",e,t,r)}))()}musicSummarySearch(e={},t){var r=this;return _async_to_generator$d((function*(){return r.collection(fo.Personalized,"music-summaries/search",void 0,e,t)}))()}addToLibrary(e){var t=this;return _async_to_generator$d((function*(){return t.developerToken&&t.userToken&&t.library?t.library.add(e):Promise.reject("Invalid tokens")}))()}rating(e,t,r){var n=this;return _async_to_generator$d((function*(){const[i]=yield n.ratings(e,t,r);return i}))()}ratings(e,t,r){if(!this.developerToken||!this.userToken)return Promise.reject("Invalid tokens");const[n]=Object.keys(e),i=e[n],o=Array.isArray(i);if(o&&0===i.length)return Promise.resolve([]);let a="me/ratings/"+formatRatingsContentType(n,o?i[0]:i);return o?t=_object_spread_props$3(_object_spread$6({},t),{ids:i.map(normalizeAdamId)}):a=`${a}/${normalizeAdamId(i)}`,makeRequest(this,a,t,_object_spread$6({shouldCacheResults:!1,reload:!0,includePagination:!1},r))}putRating(e,t,r){var n=this;return _async_to_generator$d((function*(){if(!n.developerToken||!n.userToken)return Promise.reject("Invalid tokens");const[i]=Object.keys(e),o=e[i],a=formatRatingsContentType(i,o),s={method:"PUT",body:JSON.stringify({type:"rating",attributes:{value:t}}),includePagination:!1},c=yield makeRequest(n,`me/ratings/${a}/${normalizeAdamId(o)}`,r,_object_spread$6({shouldCacheResults:!1},s)),[l]=c;return l}))()}deleteRating(e,t){var r=this;return _async_to_generator$d((function*(){if(!r.developerToken||!r.userToken)return Promise.reject("Invalid tokens");const[n]=Object.keys(e),i=e[n],o=formatRatingsContentType(n,i);if(Array.isArray(i))return Promise.all(i.map(e=>r.deleteRating({[n]:e},t))).then(()=>{});yield makeRequest(r,`me/ratings/${o}/${i}`,t,{method:"DELETE",shouldCacheResults:!1,returnRawJSONApiRecords:!0});try{r._store.delete(o,i)}catch(Ae){return Promise.reject(MKError.parseError(Ae))}}))()}equivalent(e,t){var r=this;return _async_to_generator$d((function*(){let n=`catalog/${r.userStorefrontId}/${e}`,i={};switch(e){case"albums":case"songs":i={"filter[equivalents]":t};break;case"artists":case"playlists":n=`${n}/${t}`;break;default:return Promise.reject(new MKError(MKError.INVALID_ARGUMENTS,"Invalid equivalent type"))}return r.resource(fo.Global,n,"",i)}))()}collection(e,t,r,n,i){var o=this;return _async_to_generator$d((function*(){var a;let s,c,l=null===(a=i)||void 0===a?void 0:a.shouldCacheResults;switch(s=r?_object_spread$6({["charts"===t?"types":"ids"]:r},n):n,e){case fo.Catalog:case fo.Editorial:case fo.Engagement:case fo.Social:case fo.Lyrics:const r=o.storefrontId;c=`${e}/${r}/${t}`;break;case fo.Global:c=t;break;case fo.Personalized:c=`${e}/${t}`,l=!1}return makeRequest(o,c,s,_object_spread_props$3(_object_spread$6({},i),{shouldCacheResults:l}))}))()}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}resource(e,t,r,n,i){var o=this;return _async_to_generator$d((function*(){var a;if(!(null===(a=i)||void 0===a?void 0:a.reload)){const e=o._store.read(t,r,n);if(e)return e}const[s]=yield o.collection(e,t,r,n,i);return s}))()}_reindexRelationships(e,t){("data"in e?e.data:e).forEach(e=>{hasOwn(e,"relationships")&&hasOwn(e.relationships,t)&&hasOwn(e.relationships[t],"data")&&Array.isArray(e.relationships[t].data)&&e.relationships[t].data.forEach((e,t)=>{e.id=`${e.id}-${t}`})})}constructor(e,t,r,n,i,o,a={},s){super(e,t,_object_spread_props$3(_object_spread$6({},s),{userToken:n,storage:o})),_define_property$g(this,"_store",void 0),_define_property$g(this,"v3",void 0),_define_property$g(this,"storefrontId",ce.ID),_define_property$g(this,"defaultIncludePaginationMetadata",void 0),_define_property$g(this,"resourceRelatives",{artists:{albums:{include:"tracks"},playlists:{include:"tracks"},songs:null}}),_define_property$g(this,"userStorefrontId",void 0),_define_property$g(this,"library",void 0),_define_property$g(this,"books",void 0),_define_property$g(this,"tvLibrary",void 0),_define_property$g(this,"_podcastsAPI",void 0),_define_property$g(this,"fitness",void 0),this.defaultIncludePaginationMetadata=a.features&&hasOwn(a.features,"api-pagination-metadata"),this._store=new LocalDataStore(a),r&&(this.storefrontId=r.toLowerCase()),n&&i&&(this.userStorefrontId=i.toLowerCase()),this._podcastsAPI=new Podcasts(t,n,r,o,a,_object_spread$6({},s)),this.fitness=new Fitness(t,n,r,o,a,_object_spread$6({},s)),this.tvLibrary=new TVLibrary(t,n,o,a,_object_spread$6({},s)),this.library=new Library(e,t,n,a,this,_object_spread$6({},s)),this.books=new Books(t,n,r,o,a,_object_spread$6({},s)),this.v3=new MediaAPIV3({developerToken:t,mediaUserToken:n,storefrontId:r,realmConfig:{music:{url:e.replace(/\/v[0-9]+(\/)?$/,"")}}})}}function asyncGeneratorStep$c(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$c(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$c(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$c(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let go;_ts_decorate$6([RecommendationUpdate(),_ts_metadata$6("design:type",Function),_ts_metadata$6("design:paramtypes",[Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions,void 0])],API.prototype,"personalRecommendations",null),_ts_decorate$6([RecommendationUpdate(),_ts_metadata$6("design:type",Function),_ts_metadata$6("design:paramtypes",[Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions])],API.prototype,"recommendations",null),_ts_decorate$6([ChunkedIdApi(2),_ts_metadata$6("design:type",Function),_ts_metadata$6("design:paramtypes",[void 0===fo?Object:fo,String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],API.prototype,"collection",null);const mo=function(){var e=_async_to_generator$c((function*(e,t=!1){if(go&&!t){if(void 0===e.storefrontId||e.storefrontId===go.storefrontId)return go;go.clear()}return go=new MediaAPIService(e.dispatcher),yield go.configure(e),go}));return function(t){return e.apply(this,arguments)}}(),bo={album:{isPlural:!1,apiMethod:"album",relationshipMethod:{method:"albumRelationship",relationship:"tracks"}},albums:{isPlural:!0,apiMethod:"albums"},audioBook:{isPlural:!1,apiMethod:"audioBook"},audioBooks:{isPlural:!0,apiMethod:"audioBooks"},episode:{isPlural:!1,apiMethod:"episode"},episodes:{isPlural:!0,apiMethod:"episodes"},musicVideo:{isPlural:!1,apiMethod:"musicVideo"},musicVideos:{isPlural:!0,apiMethod:"musicVideos"},musicMovie:{isPlural:!1,apiMethod:"musicMovie"},musicMovies:{isPlural:!0,apiMethod:"musicMovies"},podcast:{isPlural:!1,apiMethod:"podcast"},podcasts:{isPlural:!0,apiMethod:"podcasts"},playlist:{isPlural:!1,apiMethod:"playlist",relationshipMethod:{method:"playlistRelationship",relationship:"tracks"}},playlists:{isPlural:!0,apiMethod:"playlists"},song:{isPlural:!1,apiMethod:"song"},songs:{isPlural:!0,apiMethod:"songs"},tvEpisode:{isPlural:!1,apiMethod:"tvEpisode"},tvEpisodes:{isPlural:!0,apiMethod:"tvEpisodes"},uploadedAudio:{isPlural:!1,apiMethod:"uploadedAudio"},uploadedAudios:{isPlural:!0,apiMethod:"uploadedAudios"},uploadedVideo:{isPlural:!1,apiMethod:"uploadedVideo"},uploadedVideos:{isPlural:!0,apiMethod:"uploadedVideos"}};class MediaAPIService{get isConfigured(){return void 0!==this._api}get api(){if(void 0===this._api)throw new MKError(MKError.CONFIGURATION_ERROR,"The API cannot be accessed before it is configured.");return this._api}get storefrontId(){return this.store&&this.store.storefrontId}configure(e){var t=this;return _async_to_generator$c((function*(){void 0!==e.store&&(t.store=e.store,[Bn.authorizationStatusDidChange,Bn.userTokenDidChange,Bn.storefrontIdentifierDidChange,Bn.storefrontCountryCodeDidChange].forEach(e=>{t.store.storekit.addEventListener(e,()=>t.resetAPI())}),t._initializeAPI(e))}))()}clear(){this.api&&this.api.clearNetworkCache&&this.api.clearNetworkCache()}getAPIForItem(e){var t=this;return _async_to_generator$c((function*(){return n(e)?(yield t.store.authorize(),t.api.library||t.api):t.api}))()}resetAPI(){var e=this;return _async_to_generator$c((function*(){e.clear(),e._initializeAPI()}))()}_initializeAPI(e){var t;if(void 0!==(null===(t=e)||void 0===t?void 0:t.api))return void(this._api=e.api);const r=e&&e.store||this.store;if(void 0===r)return;const n=Hn.features["api-session-storage"]?getSessionStorage():void 0,i=e&&e.storefrontId||r.storefrontId,o=new API(this.url,r.developerToken,i,r.storekit.userToken,r.storekit.storefrontCountryCode,n,Hn,e&&e.apiOptions&&e.apiOptions.sessionOptions);this._api=o.v3,this._api=o}_updateStorefrontId(e){var t=this;return _async_to_generator$c((function*(){t.api&&e===t.api.storefrontId||(yield t.configure({dispatcher:t._dispatcher,store:t.store,storefrontId:e}))}))()}constructor(e){if(_define_property$f(this,"_dispatcher",void 0),_define_property$f(this,"namedQueueOptions",void 0),_define_property$f(this,"url",void 0),_define_property$f(this,"store",void 0),_define_property$f(this,"_api",void 0),this._dispatcher=e,!Hn.urls.mediaApi)throw new Error("bag.urls.mediaApi is not configured");this.url=Hn.urls.mediaApi,this.namedQueueOptions=bo;var t=this;this._dispatcher.subscribe(et.apiStorefrontChanged,function(){var e=_async_to_generator$c((function*(e,{storefrontId:r}){yield t._updateStorefrontId(r)}));return function(t,r){return e.apply(this,arguments)}}())}}function asyncGeneratorStep$b(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$b(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$b(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$b(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _configure$1(){return(_configure$1=_async_to_generator$b((function*(e){const t=new UTSClientService;return yield t.configure(e),t}))).apply(this,arguments)}class UTSClientService{get isConfigured(){return void 0!==this.api}configure(e){var t=this;return _async_to_generator$b((function*(){var r;t.api=(null!==(r=e.apiOptions)&&void 0!==r?r:{}).client}))()}clear(){}getAPIForItem(e){var t=this;return _async_to_generator$b((function*(){if(void 0===t.api)throw new Error("UTS has not been configured");return t.api}))()}constructor(){_define_property$e(this,"api",void 0),_define_property$e(this,"namedQueueOptions",{}),_define_property$e(this,"url","")}}function asyncGeneratorStep$a(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class NpPlay{getNpPayloadContent(e,t,r,n="com.apple.tv"){var i,o,a,s;const c={context:{user:{id:r,keyspace:"cid"},userAgent:navigator.userAgent,appleStoreFront:null===(s=this.utsClient)||void 0===s||null===(a=s.configuration)||void 0===a||null===(o=a.applicationProps)||void 0===o||null===(i=o.storefront)||void 0===i?void 0:i.storefrontId,source:"Client_Device",cadence:"Contract",bundleId:n,millisecondsSinceEvent:0},event:{}};return"vod"===e?c.event.vodEvent=t:"live"===e&&(c.event.liveEvent=t),c}send(e,t,r,n="com.apple.tv"){var i,o=this;return(i=function*(){var i;const a={headers:{Authorization:"Bearer "+o.tokens.developerToken,"Media-User-Token":null!==(i=o.tokens.musicUserToken)&&void 0!==i?i:""},method:"POST",body:JSON.stringify(o.getNpPayloadContent(e,t,r,n))};return yield fetch("/api/np/play/json",a)},function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function _next(e){asyncGeneratorStep$a(o,r,n,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$a(o,r,n,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,t){_define_property$d(this,"tokens",void 0),_define_property$d(this,"utsClient",void 0),this.tokens=e,this.utsClient=t}}function _define_property$c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_metadata$5(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}class LegacyDecorateLiveMonitor{startMonitor(){this.dispatcher.unsubscribe(Bn.playbackTimeDidChange,this.handleTimeChange),this.dispatcher.subscribe(Bn.playbackTimeDidChange,this.handleTimeChange)}stopMonitor(){this.dispatcher.unsubscribe(Bn.playbackTimeDidChange,this.handleTimeChange)}handleTimeChange(){const e=Date.now(),t=this.decoratedLive.events[this.currentIndex];t?(e>=t.startTime&&!this.hasSentEventStart&&(this.hasSentEventStart=!0,this.callback("Event_Start",this.decoratedLive,t)),e>=t.endTime&&(this.hasSentEventStart=!1,this.currentIndex+=1,this.callback("Event_End",this.decoratedLive,t)),this.currentIndex>=this.decoratedLive.events.length&&this.stopMonitor()):this.stopMonitor()}constructor(e,t,r){_define_property$c(this,"dispatcher",void 0),_define_property$c(this,"callback",void 0),_define_property$c(this,"decoratedLive",void 0),_define_property$c(this,"currentIndex",void 0),_define_property$c(this,"hasSentEventStart",void 0),this.dispatcher=e,this.callback=t,this.decoratedLive=r,this.currentIndex=0,this.hasSentEventStart=!1}}function asyncGeneratorStep$9(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$5("design:type",Function),_ts_metadata$5("design:paramtypes",[])],LegacyDecorateLiveMonitor.prototype,"handleTimeChange",null);class PlayMetadata{get isDestroyed(){return this._isDestroyed}destroy(){var e;this._isDestroyed=!0,null===(e=this.watcher)||void 0===e||e.stopMonitor(),this.watcher=void 0}trackActivity(e,t){return(r=function*(){return Promise.resolve()},function(){var e=this,t=arguments;return new Promise((function(n,i){var o=r.apply(e,t);function _next(e){asyncGeneratorStep$9(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$9(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})();var r}getAppBundleIds(e,t){var r,n,i,o;const a=null===(r=t)||void 0===r?void 0:r.channels;if(!Array.isArray(a)||void 0===(null===(n=e)||void 0===n?void 0:n.channelId))return;var s;return null!==(s=null===(o=a.find(t=>t.id===e.channelId))||void 0===o||null===(i=o.appBundleIds)||void 0===i?void 0:i[0])&&void 0!==s?s:void 0}determineRelativePosition(e,t){return e<=t.mainContentStarts?0:e>=t.mainContentEnds?t.mainContentEnds:e-t.mainContentStarts}constructor(e,t,r,n,i,o,a){_define_property$b(this,"appBundleIds",void 0),_define_property$b(this,"dispatcher",void 0),_define_property$b(this,"item",void 0),_define_property$b(this,"itemTiming",void 0),_define_property$b(this,"mediaItemPlayback",void 0),_define_property$b(this,"npPlay",void 0),_define_property$b(this,"playable",void 0),_define_property$b(this,"pldfltcid",void 0),_define_property$b(this,"utsClient",void 0),_define_property$b(this,"watcher",void 0),_define_property$b(this,"_isDestroyed",!1),this.dispatcher=e,this.item=r,this.mediaItemPlayback=t,this.npPlay=a,this.playable=n,this.pldfltcid=i,this.utsClient=o,this.appBundleIds=this.getAppBundleIds(n,r),this.itemTiming=function(e){const t=parseRollItems(e,["pre-roll"]),r=parseRollItems(e,["post-roll"]),n=t.reduce(addRollItemDuration,0),i=r.reduce(addRollItemDuration,0);var o,a;const s=null!==(a=null!==(o=e.hlsMetadata["up-next.start"])&&void 0!==o?o:e.hlsMetadata["watched.time"])&&void 0!==a?a:e.hlsMetadata["feature.duration"],c=parseFloat(s);return{mainContentStarts:n,mainContentEnds:c,mainContentLength:c-n,totalContentLength:c+i}}(r)}}function asyncGeneratorStep$8(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$8(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$8(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$8(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _ts_metadata$4(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const So=new Set(["play","stop","Event_End","Event_Start"]);class LegacyLive extends PlayMetadata{init(){var e=this;return _async_to_generator$8((function*(){var t,r,n;const{playable:i}=e,o=yield null===(t=e.utsClient)||void 0===t?void 0:t.refresh("activityDecorateLive",{channelId:i.channelId,externalServiceId:i.externalServiceId});var a;e.legacyDecoratedLive=null!==(a=null===(r=o)||void 0===r?void 0:r.data)&&void 0!==a?a:o,e.legacyDecoratedLive&&(null===(n=e.legacyDecoratedLive.events)||void 0===n?void 0:n.length)&&e.setupLegacyLiveWatcher(e.legacyDecoratedLive)}))()}setupLegacyLiveWatcher(e){var t;this.watcher=new LegacyDecorateLiveMonitor(this.dispatcher,this.onLegacyLiveEvent,e),null===(t=this.watcher)||void 0===t||t.startMonitor()}onLegacyLiveEvent(e,t,r){var n=this;return _async_to_generator$8((function*(){if("Event_Start"===e||"Event_End"===e){var i;const o=n.pldfltcid,{appBundleIds:a,playable:s,utsClient:c}=n;if(!o||!c||!s)return;const l=n.generateLiveEvent(e,t,r);yield null===(i=n.npPlay)||void 0===i?void 0:i.send("live",l,o,null!=a?a:"com.apple.tv")}}))()}trackActivity(e,t){var r=this;return _async_to_generator$8((function*(){var t;const{legacyDecoratedLive:n}=r;if(!n||!r.playable||!So.has(e))return;const i=r.generateLiveEvent(e,n);var o;yield null===(t=r.npPlay)||void 0===t?void 0:t.send("live",i,r.pldfltcid,null!==(o=r.appBundleIds)&&void 0!==o?o:"com.apple.tv")}))()}generateLiveEvent(e,t,r){let n;var i,o;"play"===e?n="Tune_In":"stop"===e?n="Tune_Out":"Event_Start"!==e&&"Event_End"!==e||(n=e);const a={bundleId:null!==(i=this.appBundleIds)&&void 0!==i?i:"com.apple.tv",millisecondsSinceEvent:0,channel:{channelCanonicalId:t.serviceId,channelBrandId:t.channelId,channelExternalLiveServiceId:t.externalServiceId,channelInternalLegId:null!==(o=t.legId)&&void 0!==o?o:t.serviceId},cause:n};if(a.expectedStartTimeEpochMillis=t.scheduleStartTime,a.cleanupTimeEpochMillis=t.scheduleEndTime,r){let e;"number"==typeof r.endTime&&"number"==typeof r.startTime&&(e=r.endAirTime-r.startAirTime),a.content={contentCanonicalId:r.canonicalId,contentBrandId:r.channelId,contentExternalPlayableId:r.playableExternalId,contentMediaLengthInMilliseconds:e,contentLiveFeatureOrLiveEndCredits:"Event_Start"===n?"Live_Feature":"Live_End_Credits",contentInternalLegId:r.legId},a.expectedStartTimeEpochMillis=r.startTime,a.cleanupTimeEpochMillis=r.endTime}return a}constructor(...e){var t,r,n;super(...e),n=void 0,(r="legacyDecoratedLive")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}}function asyncGeneratorStep$7(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$7(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$7(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$7(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$9(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread_props$2(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_metadata$3(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$4("design:type",Function),_ts_metadata$4("design:paramtypes",["undefined"==typeof LiveEventCause?Object:LiveEventCause,"undefined"==typeof LegacyDecorateLiveProperties?Object:LegacyDecorateLiveProperties,"undefined"==typeof LegacyDecorateLiveEvent?Object:LegacyDecorateLiveEvent])],LegacyLive.prototype,"onLegacyLiveEvent",null);const Po=new Set(["exit","pause","play","scrub","seek","skip","stop"]);class LegacyVod extends PlayMetadata{init(){var e=this;return _async_to_generator$7((function*(){var t,r,n,i;const{item:o,playable:a}=e;if(hasContentCompletionThresholdData(o)){const t=getContentCompletionThreshold(o);e.setupLegacyVodWatcher(t,Number.POSITIVE_INFINITY)}const s=1e3*parseInt(""+a.duration,10),c=`${a.channelId}:${a.externalId}:${s}`,l=yield null===(t=e.utsClient)||void 0===t?void 0:t.refresh("activityPlayablesDecorate",{ids:c});var d;e.legacyDecorated=null!==(d=null===(r=l)||void 0===r?void 0:r[c])&&void 0!==d?d:null===(i=l)||void 0===i||null===(n=i.data)||void 0===n?void 0:n[c]}))()}setupLegacyVodWatcher(e,t){this.watcher=new SpanWatcher(this.dispatcher,this.onContentCompletionThreshhold,e,t,!0),this.watcher.startMonitor()}onContentCompletionThreshhold(e){var t=this;return _async_to_generator$7((function*(){yield t.trackActivity("exit",e),t.dispatcher.publish(et.mediaContentComplete,t.item)}))()}trackActivity(e,t){var r=this;return _async_to_generator$7((function*(){var n,i;const{appBundleIds:o,legacyDecorated:a,playable:s,pldfltcid:c}=r;let{itemTiming:l}=r;if(!(a&&s&&l&&Po.has(e)))return;if("stop"===e){var d;const e=r.itemTiming.totalContentLength;if(!(null===(d=r.item)||void 0===d?void 0:d.isLinearStream)&&void 0!==e&&void 0!==t){const r=e-t;r>=0&&r<5&&(t=e+.5)}}const u=null===(n=r.mediaItemPlayback)||void 0===n?void 0:n.currentPlaybackDuration;if(isNaN(l.totalContentLength)||u&&u<l.totalContentLength){const e=null!=u?u:NaN;isNaN(e)||(r.itemTiming=l=_object_spread_props$2(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$9(e,t,r[t])}))}return e}({},l),{mainContentEnds:e,mainContentLength:e,totalContentLength:e}))}const p=r.generateVodEvent(s,a,l,t);yield null===(i=r.npPlay)||void 0===i?void 0:i.send("vod",p,c,null!=o?o:"com.apple.tv")}))()}generateVodEvent(e,t,r,n){const i={playable:{externalPlayableId:e.externalId,brandId:t.brandId},internalLegId:t.internalLegId,canonicalId:t.canonicalId,mediaLengthInMilliseconds:Math.floor(1e3*r.totalContentLength),mainContentLengthInMilliseconds:Math.floor(1e3*r.mainContentLength),playHeadInMilliseconds:Math.floor(1e3*n),mainContentPlayHeadInMilliseconds:Math.floor(1e3*this.determineRelativePosition(n,r)),featureOrEndCredits:n>r.mainContentEnds?"End_Credits":"Feature"};return"Episode"===t.contentType&&(i.tvEpisode={externalShowId:t.externalShowId,canonicalShowId:t.canonicalShowId,currentOrPreviousEpisode:t.isCurrent?"Latest_And_Current_Episode":"Previous_Episode",openOrClosedShow:t.isShowClosed?"Show_Closed_No_More_Episodes_Expected":"Show_Open_More_Episodes_Expected"}),i}constructor(...e){super(...e),_define_property$9(this,"legacyDecorated",void 0)}}function asyncGeneratorStep$6(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$6(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$6(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$6(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$8(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ts_decorate$2(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata$2(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$3("design:type",Function),_ts_metadata$3("design:paramtypes",[Number])],LegacyVod.prototype,"onContentCompletionThreshhold",null);class Live extends PlayMetadata{init(){var e=this;return _async_to_generator$6((function*(){var t,r;const{playable:n}=e,i=yield null===(t=e.utsClient)||void 0===t?void 0:t.refresh("getContentsPlayMetadataLive",{brandId:n.channelId,externalServiceId:n.externalServiceId});var o;e.playMetadataLive=null!==(o=null===(r=i)||void 0===r?void 0:r.data)&&void 0!==o?o:i,e.resetListening()}))()}destroy(){this.unsubscribe()}trackActivity(e,t){var r=this;return _async_to_generator$6((function*(){"scrub"!==e&&"seek"!==e||r.resetListening()}))()}handleTimeChange(){var e,t;const{scheduleItems:r}=this;var n;const i=null!==(n=null===(t=this.mediaItemPlayback)||void 0===t||null===(e=t.currentPlayingDate)||void 0===e?void 0:e.getTime())&&void 0!==n?n:0;if(0!==i&&r){for(let e=0;e<r.length;e++){const t=r[e],n="eventTime"in t?t.eventTime.liveBadgeTime.startTime:t.startAirTime,o="eventTime"in t?t.eventTime.liveBadgeTime.endTime:t.endAirTime;if(i>=n&&i<=o)r.splice(e,1),e-=1,this.onLiveEvent(t);else if(i>n)r.splice(e,1),e-=1;else if(i<n)return}0===r.length&&this.unsubscribe()}}onLiveEvent(e){var t=this;return _async_to_generator$6((function*(){var r;const n=t.pldfltcid,{appBundleIds:i,playable:o,utsClient:a}=t;if(!n||!a||!o)return;const s=t.generateEventStartEvent(e);yield null===(r=t.npPlay)||void 0===r?void 0:r.send("live",s,n,null!=i?i:"com.apple.tv")}))()}generateEventStartEvent(e){var t;return{bundleId:"com.apple.tv",millisecondsSinceEvent:0,cause:"Event_Start",passThrough:null===(t=e)||void 0===t?void 0:t.nowPlayingPassThrough}}resetListening(){var e;const t=null===(e=this.playMetadataLive)||void 0===e?void 0:e.schedule;t&&t.length&&(this.scheduleItems=[...t],this.unsubscribe(),this.subscribe())}subscribe(){this.dispatcher.subscribe(Bn.playbackTimeDidChange,this.handleTimeChange)}unsubscribe(){this.dispatcher.unsubscribe(Bn.playbackTimeDidChange,this.handleTimeChange)}constructor(...e){super(...e),_define_property$8(this,"playMetadataLive",void 0),_define_property$8(this,"scheduleItems",[])}}function asyncGeneratorStep$5(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$5(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$5(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$5(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$7(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread_props$1(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_metadata$1(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}_ts_decorate$2([Bind(),_ts_metadata$2("design:type",Function),_ts_metadata$2("design:paramtypes",[])],Live.prototype,"handleTimeChange",null),_ts_decorate$2([Bind(),_ts_metadata$2("design:type",Function),_ts_metadata$2("design:paramtypes",[Object])],Live.prototype,"onLiveEvent",null);const Eo=new Set(["exit","pause","play","scrub","seek","skip","stop"]);class Vod extends PlayMetadata{init(){var e=this;return _async_to_generator$5((function*(){var t,r;const{item:n,playable:i}=e;if(hasContentCompletionThresholdData(n)){const t=getContentCompletionThreshold(n);e.setupVodWatcher(t,Number.POSITIVE_INFINITY)}const o=yield null===(t=e.utsClient)||void 0===t?void 0:t.refresh("getContentsPlayMetadataVOD",{externalId:i.externalId,brandId:i.channelId,hlsAssetDuration:e.mediaItemPlayback.currentPlaybackDuration});var a;e.metadata=null!==(a=null===(r=o)||void 0===r?void 0:r.data)&&void 0!==a?a:o}))()}setupVodWatcher(e,t){this.watcher=new SpanWatcher(this.dispatcher,this.onContentCompletionThreshhold,e,t,!0),this.watcher.startMonitor()}onContentCompletionThreshhold(e){var t=this;return _async_to_generator$5((function*(){yield t.trackActivity("exit",e),t.dispatcher.publish(et.mediaContentComplete,t.item)}))()}trackActivity(e,t){var r=this;return _async_to_generator$5((function*(){var n,i;const{appBundleIds:o,metadata:a,playable:s,pldfltcid:c}=r;let{itemTiming:l}=r;if(!(a&&s&&l&&Eo.has(e)))return;if("stop"===e){var d;const e=r.itemTiming.totalContentLength;if(!(null===(d=r.item)||void 0===d?void 0:d.isLinearStream)&&void 0!==e&&void 0!==t){const r=e-t;r>=0&&r<5&&(t=e+.5)}}const u=null===(n=r.mediaItemPlayback)||void 0===n?void 0:n.currentPlaybackDuration;if(isNaN(l.totalContentLength)||u&&u<l.totalContentLength){const e=null!=u?u:NaN;isNaN(e)||(r.itemTiming=l=_object_spread_props$1(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$7(e,t,r[t])}))}return e}({},l),{mainContentEnds:e,mainContentLength:e,totalContentLength:e}))}const p=r.generateVodEvent(s,a,l,t);yield null===(i=r.npPlay)||void 0===i?void 0:i.send("vod",p,c,null!=o?o:"com.apple.tv")}))()}generateVodEvent(e,t,r,n){var i,o;return{playHeadInMilliseconds:Math.floor(1e3*n),mediaLengthInMilliseconds:Math.floor(1e3*r.totalContentLength),mainContentInfo:{isDone:n>=r.mainContentEnds?"Done":"Not_Done",playHeadInMilliseconds:Math.floor(1e3*this.determineRelativePosition(n,r)),lengthInMilliseconds:Math.floor(1e3*r.mainContentLength),passThrough:null!==(o=null===(i=this.metadata)||void 0===i?void 0:i.nowPlayingPassThrough)&&void 0!==o?o:""}}}constructor(...e){super(...e),_define_property$7(this,"metadata",void 0)}}function asyncGeneratorStep$4(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$4(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$4(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$4(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$6(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);o>3&&a&&Object.defineProperty(t,r,a)}([Bind(),_ts_metadata$1("design:type",Function),_ts_metadata$1("design:paramtypes",[Number])],Vod.prototype,"onContentCompletionThreshhold",null);class Ebs extends PlayMetadata{init(){var e=this;return _async_to_generator$4((function*(){var t,r;const{playable:n}=e,i=yield null===(t=e.utsClient)||void 0===t?void 0:t.refresh("getContentsPlayMetadataEBS",{brandId:n.channelId,externalId:n.externalId});var o;const a=null!==(o=null===(r=i)||void 0===r?void 0:r.data)&&void 0!==o?o:i;e.playMetadataEbs=a}))()}trackActivity(e,t){var r=this;return _async_to_generator$4((function*(){if("exit"!==e&&"stop"!==e){if("play"===e&&!r.sentEventStart){var t;const e=r.pldfltcid,{appBundleIds:n,playable:i,utsClient:o}=r;if(!e||!o||!i)return;const a=r.generateEventStartEvent();yield null===(t=r.npPlay)||void 0===t?void 0:t.send("live",a,e,null!=n?n:"com.apple.tv"),r.sentEventStart=!0}}else r.sentEventStart=!1}))()}generateEventStartEvent(){var e,t;return{bundleId:"com.apple.tv",millisecondsSinceEvent:0,cause:"Event_Start",passThrough:null!==(t=null===(e=this.playMetadataEbs)||void 0===e?void 0:e.nowPlayingPassThrough)&&void 0!==t?t:""}}constructor(...e){super(...e),_define_property$6(this,"playMetadataEbs",void 0),_define_property$6(this,"sentEventStart",!1)}}function asyncGeneratorStep$3(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$3(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$3(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$3(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$5(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class BookmarkTracker{get requestedEvents(){return Array.from(this.dispatchTable.keys())}get isConfigured(){return void 0!==this.npPlay}configure(e){var t=this;return _async_to_generator$3((function*(){var r,n,i,o,a,s;if(!t.shouldConfigure(e.instance))return;const c=e.instance;t.dispatcher=e.services.dispatcher,t.mediaItemPlayback=e.services.mediaItemPlayback,t.utsClient=null===(r=e.services.apiManager)||void 0===r?void 0:r.utsClient,t.npPlay=new NpPlay({get developerToken(){return c.developerToken},get musicUserToken(){var e;return null!==(e=c.musicUserToken)&&void 0!==e?e:""}},t.utsClient);const l=null===(s=t.utsClient)||void 0===s||null===(a=s.configuration)||void 0===a||null===(o=a.applicationProps)||void 0===o||null===(i=o.requiredParamsMap)||void 0===i||null===(n=i.Default)||void 0===n?void 0:n.v;parseInt(null!=l?l:"0",10)>=64&&(t.usePlayMetadataEndpoints=!0)}))()}cleanup(){var e=this;return _async_to_generator$3((function*(){e.clearItem()}))()}shouldConfigure(e){return _async_to_generator$3((function*(){return!!Hn.features.bookmarking&&e.isAuthorized}))()}shouldTrackPlayActivity(t,r){if(!r||!this.utsClient)return!1;const n=-1===[e.PlaybackType.none,e.PlaybackType.preview].indexOf(r.playbackType),i="Bonus"!==r.type&&"Extra"!==r.contentType;return Kn.debug("Bookmark shouldTrackPlayActivity",n&&i,t),n&&i}handleEvent(e,t,r){if(!this.shouldTrackPlayActivity(e,r))return;const n=this.dispatchTable.get(e);void 0!==n&&"function"==typeof this[n]&&this[n](r,t)}exit(e,t={}){var r=this;return _async_to_generator$3((function*(){yield r.trackActivity("exit",void 0,t.position),r.clearItem()}))()}pause(e,t={}){var r=this;return _async_to_generator$3((function*(){yield r.trackActivity("pause",e,t.position)}))()}play(e,t={}){var r=this;return _async_to_generator$3((function*(){const n=void 0===t.position?0:t.position;yield r.trackActivity("play",e,n)}))()}scrub(e,t={}){var r=this;return _async_to_generator$3((function*(){yield r.trackActivity("scrub",e,t.position)}))()}seek(e,t={}){var r=this;return _async_to_generator$3((function*(){yield r.trackActivity("seek",e,t.position)}))()}skip(e,t={}){var r=this;return _async_to_generator$3((function*(){yield r.trackActivity("skip",e,t.position)}))()}stop(e,t={}){var r=this;return _async_to_generator$3((function*(){yield r.trackActivity("stop",e,t.position),r.clearItem()}))()}clearItem(){var e;this.currentItem=void 0,null===(e=this.playMetadata)||void 0===e||e.destroy(),this.playMetadata=void 0}trackActivity(e,t,r){var n=this;return _async_to_generator$3((function*(){var i,o;if(void 0!==r&&void 0!==n.utsClient&&(void 0!==t&&t.id!==(null===(i=n.currentItem)||void 0===i?void 0:i.id)&&(yield n.updateItem(t)),void 0!==n.currentItem))return null===(o=n.playMetadata)||void 0===o?void 0:o.trackActivity(e,r)}))()}updateItem(e){var t=this;return _async_to_generator$3((function*(){var r,n;const i=yield qn.storekit.pldfltcid();if(void 0===t.utsClient||!t.dispatcher||!i)return;if(t.currentItem&&t.currentItem.id!==e.id&&t.clearItem(),void 0!==t.currentItem)return;t.currentItem=e;const o=e.defaultPlayable;if(void 0===o)return;let a;null===(r=t.playMetadata)||void 0===r||r.destroy(),a=e.isLinearStream?t.usePlayMetadataEndpoints?"EbsEvent"===o.type?Ebs:Live:LegacyLive:t.usePlayMetadataEndpoints?Vod:LegacyVod,t.playMetadata=new a(t.dispatcher,t.mediaItemPlayback,e,o,i,t.utsClient,t.npPlay),yield null===(n=t.playMetadata)||void 0===n?void 0:n.init()}))()}constructor(){_define_property$5(this,"currentItem",void 0),_define_property$5(this,"playMetadata",void 0),_define_property$5(this,"dispatcher",void 0),_define_property$5(this,"mediaItemPlayback",void 0),_define_property$5(this,"utsClient",void 0),_define_property$5(this,"usePlayMetadataEndpoints",!1),_define_property$5(this,"npPlay",void 0),_define_property$5(this,"dispatchTable",new Map([[et.playbackPlay,"play"],[et.playbackPause,"pause"],[et.playbackScrub,"scrub"],[et.playbackSeek,"seek"],[et.playbackSkip,"skip"],[et.playbackStop,"stop"],[et.playerExit,"exit"]]))}}var To={setDelegate:!0};function isDefined(e){return void 0!==e}function isDefinedNonNull(e){return isDefined(e)&&null!==e}function isEmptyString(e){return isString(e)&&0===e.length}function isEmptyArray(e){return isArray$1(e)&&0===e.length}function isEmptyObject(e){return isObject(e)&&0===Object.keys(e).length}function isFunction$1(e){return"function"==typeof e}function isNumber$1(e){return"number"==typeof e}function isInteger$2(e){return isNumber$1(e)&&e%1==0}function isString(e){return"string"==typeof e||e instanceof String}function isArray$1(e){return!!e&&e.constructor===Array}function isObject(e){return!!e&&e.constructor===Object}function hasGetterAndSetterMethods(e){return isObject(e)&&isFunction$1(e.__lookupGetter__)&&isFunction$1(e.__lookupSetter__)&&isFunction$1(e.__defineGetter__)&&isFunction$1(e.__defineSetter__)}function extend$5(e){var t=[!0,!0,!0].concat(Array.prototype.slice.call(arguments));return copyKeysAndValues$1.apply(null,t)}function copyKeysAndValues$1(e,t,r,n){for(var i,o=r&&n||{},a=3;a<arguments.length;a++)for(var s in i=arguments[a])if(Object.prototype.hasOwnProperty.call(i,s)){var c=i[s];(e||null!=c)&&(t||"function"!=typeof c)&&(o[s]=c)}return o}function attachMethods$1(e,t,r,n){var i=!1;if(e&&t){n=n||{},r=r||t;var captureFunction=function(e,t,r,n){var returnValue=function(){return r[n].apply(e,arguments)};return t&&(returnValue.origFunction=t),returnValue.attachedMethod=!0,returnValue};for(var o in t)if(!(o in n)&&t[o]&&isFunction$1(t[o])){var a=e[o],s=null;a&&isFunction$1(a)&&(s=!0===a.attachedMethod?a:a.bind(e)),e[o]=captureFunction(r,s,t,o),i=!0}}return i}function detachMethods(e){var t=!1;for(var r in e){if(isFunction$1(e[r])&&!0===e[r].attachedMethod)if(e[r].origFunction)for(;e[r].origFunction;)e[r]=e[r].origFunction,t=!0;else delete e[r]}return t}function dedupedArray(e,t){var r={};if(e)for(var n=0;n<e.length;n++)r[e[n]]=0;if(t)for(var i=0;i<t.length;i++)r[t[i]]=0;return Object.keys(r)}var ko=Object.freeze({__proto__:null,_utResetNonOverridableFunctions:function(){To={setDelegate:!0}},shallowClone:function(e){var t,r,n={},i=hasGetterAndSetterMethods(e);for(var o in e)t=null,r=null,i&&(t=e.__lookupGetter__(o),r=e.__lookupSetter__(o)),t||r?(t&&n.__defineGetter__(o,t),r&&n.__defineSetter__(o,r)):n[o]=e[o];return n},isDefined:isDefined,isDefinedNonNull:isDefinedNonNull,isDefinedNonNullNonEmpty:function(e){return isDefinedNonNull(e)&&!isEmptyString(e)&&!isEmptyArray(e)&&!isEmptyObject(e)},isEmptyString:isEmptyString,isEmptyArray:isEmptyArray,isEmptyObject:isEmptyObject,isFunction:isFunction$1,isNumber:isNumber$1,isInteger:isInteger$2,isString:isString,isElement:function(e){return!!e&&1==e.nodeType},isArray:isArray$1,isObject:isObject,values:function(e){var t=[];for(var r in e){var n=e[r];e.hasOwnProperty(r)&&!isFunction$1(n)&&t.push(n)}return t},keys:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&!isFunction$1(e[r])&&t.push(r);return t},hasAnyKeys:function(e){for(var t in e)if(e.hasOwnProperty(t))return!0},hasAnyNonNullKeys:function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!0},hasGetterAndSetterMethods:hasGetterAndSetterMethods,methods:function(e){var t=[];for(var r in e){var n=e[r];e.hasOwnProperty(r)&&isFunction$1(n)&&t.push(n)}return t},invert:function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&!isFunction$1(e[r])&&(t[e[r]]=r);return t},extend:extend$5,copyKeysAndValues:copyKeysAndValues$1,addNonOverrideableFunctions:function(e){for(var t=0;t<e.length;t++){var r=e[t];To[r]=!0}},attachMethods:attachMethods$1,detachMethods:detachMethods,attachDelegate:function(e,t){var r=!1;if(e&&t&&e!==t){var n={};Object.keys(t).forEach((function(t){e[t]||(n[t]=!0)})),extend$5(n,To),r=attachMethods$1(e,t,null,n)}return r},setDelegates:function(e,t){var r={};for(var n in e)t[n]&&isFunction$1(e[n].setDelegate)&&(r[n]=e[n].setDelegate(t[n]));return r},resetDelegates:function(e){var t=!1;for(var r in e){var n=e[r];n&&"object"==typeof n&&isFunction$1(n.setDelegate)&&(t|=detachMethods(n))}return!!t},copyDelegatedFunctions:function(e,t){var r=null;if(e&&t&&t.setDelegate){var n,i={};for(n in e)isFunction$1(e[n])&&e[n].origFunction&&(i[n]=e[n]);r=t.setDelegate(i)}return r},dedupedArray:dedupedArray}),wo={maxWait:1500,initialDelay:100,factor:2},ExponentialStrategy=function(e,t,r){this.delay=e||wo.initialDelay,this.maxWait=isNumber$1(t)?t:wo.maxWait,this.factor=r||wo.factor,this.timeWaited=0};ExponentialStrategy.prototype.nextDelay=function(){var e=null,t=this.maxWait-this.timeWaited;return t>0&&(this.delay=Math.min(this.delay,t),this.timeWaited+=this.delay),(0===this.maxWait||t>0)&&(e=this.delay,this.delay=this.delay*this.factor),e};var Oo=Object.freeze({__proto__:null,exponentialBackoff:function(e,t,r,n,i,o){!function _backoff(e,t,r,n){t.call(t,r,(function(){var i=e.nextDelay();i?setTimeout(_backoff.bind(null,e,t,r,n),i):n.apply(n,arguments)}))}(new ExponentialStrategy(n,i,o),e,t,r)}});function disabled(e){return!!this.value("disabled",e)}function denylistedEvents(e){var t=this.value("denylistedEvents",e);return dedupedArray(this.value("blacklistedEvents",e),t)}function denylistedFields(e){var t=this.value("denylistedFields",e);return dedupedArray(this.value("blacklistedFields",e),t)}function removeDenylistedFields$1(e,t){if(e)for(var r=denylistedFields.call(this,t),n=0;n<r.length;n++){var i=r[n];i&&i in e&&delete e[i]}return e}function metricsDisabledOrDenylistedEvent$1(e,t){return disabled.call(this,t)||!!e&&denylistedEvents.call(this,t).indexOf(e)>-1}function deResFields(e){return this.value("deResFields",e)||[]}var Io=Object.freeze({__proto__:null,disabled:disabled,blacklistedEvents:function(e){return denylistedEvents.call(this,e)},denylistedEvents:denylistedEvents,blacklistedFields:function(e){return denylistedFields.call(this,e)},denylistedFields:denylistedFields,removeBlacklistedFields:function(e,t){return removeDenylistedFields$1.call(this,e,t)},removeDenylistedFields:removeDenylistedFields$1,metricsDisabledOrBlacklistedEvent:function(e,t){return metricsDisabledOrDenylistedEvent$1.call(this,e,t)},metricsDisabledOrDenylistedEvent:metricsDisabledOrDenylistedEvent$1,deResFields:deResFields,applyDeRes:function(e,t){var r;return e&&deResFields.call(this,t).forEach((function(t){(r=t.fieldName)in e&&(e[r]=function(e,t,r){var n=void 0;if(isDefined(e))if(isDefined(t)||(t=1048576),isDefined(r)||(r=2),isNumber$1(e)&&isNumber$1(t)&&t>0&&isInteger$2(r)&&r>=0){var i=Math.pow(10,r);n=Math[e>0?"floor":"ceil"](e/t/i)*i}else n=NaN;return n}(e[r],t.magnitude,t.significantDigits))})),e}}),Ao="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxy",$o=Ao+"z";function snakeCaseToCamelCase(e,t){var r="";if(e)for(var n,i=e.toLowerCase().split("_"),o=0;o<i.length;o++)n=i[o][0],(0!==o||t)&&(n=n.toUpperCase()),r+=n+i[o].slice(1);return r}function randomHexCharacter(e,r,n){var i,o=t.crypto||t.msCrypto;return i=e?(16*e()|0).toString(16):o&&o.getRandomValues?(15&o.getRandomValues(new Uint8Array(1))[0]).toString(16):o&&o.randomBytes?o.randomBytes(1).toString("hex")[0]:(16*Math.random()|0).toString(16),r&&n&&(i<r||i>n)&&(i=randomHexCharacter(e,r,n)),i}var Ro=Object.freeze({__proto__:null,base10Alphabet:"0123456789",base16Alphabet:"0123456789ABCDEF",base36Alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",base61Alphabet:Ao,base62Alphabet:$o,startsWith:function(e,t,r){var n=!1;return e&&t&&(e=e.substr(0,t.length),r&&(e=e.toLowerCase(),t=t.toLowerCase()),n=0===e.indexOf(t)),n},endsWith:function(e,t,r){var n=!1;if(e&&t){r&&(e=e.toLowerCase(),t=t.toLowerCase());var i=e.length-t.length;n=i>=0&&e.lastIndexOf(t)===i}return n},trim:function(e,t,r){var n=null,i=new RegExp("^[\t\n\v\f\r             　\u2028\u2029​]+"),o=new RegExp("[\t\n\v\f\r             　\u2028\u2029​]+$");if(e)if(r||t&&"\t\n\v\f\r             　\u2028\u2029​"!=t||!e.trim){var a=null,s=null,c=null;t&&void 0!==t?(a="["+(t=t.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1"))+"]",s=new RegExp("^"+a+"+"),c=new RegExp(a+"+$")):(a="\t\n\v\f\r             　\u2028\u2029​",s=i,c=o),n=e.replace(s,"").replace(c,"")}else n=e.trim();return n},snakeCaseToCamelCase:snakeCaseToCamelCase,snakeCaseToUpperCamelCase:function(e){return snakeCaseToCamelCase(e,!0)},exceptionString:function(e,t){return"The function "+e+"."+t+"() must be overridden with a platform-specific delegate function.If you have no data for this function, have your delegate return null or undefined (no 'return')"},paramString:function(e){var t="",r="",n=!0;for(var i in e){var o=e[i];(o||0===o||!1===o)&&(t+=r+i+"="+encodeURIComponent(o),n&&(r="&",n=!1))}return t},versionStringFromUserAgent:function(e,t){var r=null;t=t||"\\S+";var n=new RegExp("\\b"+t+"/(\\S+)\\b","i").exec(e);return n&&n[1]&&(r=n[1]),r},requestId:function(e){var t=Date.now(),r=Math.floor(1e5*Math.random());return e+"z"+(t=t.toString(36).toUpperCase())+"z"+(r=r.toString(36).toUpperCase())},uuid:function(e){for(var t,r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",n="",i=0,o=r.length;i<o;i++)n+="x"===(t=r.charAt(i))?randomHexCharacter(e):"y"===t?randomHexCharacter(e,"8","b"):t;return n},randomHexCharacter:randomHexCharacter,convertNumberToBaseAlphabet:function(e,t){var r="",n=t.length;if(n<=36)r=e.toString(n).toUpperCase();else{for(var i,o,a=[];e>0;)i=e%n,o=t.charAt(i),a.push(o),e=(e-i)/n;r=a.reverse().join("")}return""===r&&(r="0"),r},cryptoRandomBase62String:function(e){var r;if(16777215==Math.floor(4294967295/256)){var n,i,o,a,s,c=t.crypto||t.msCrypto;if(c&&c.getRandomValues)n=c.getRandomValues(new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT)),s=!0;else if(c&&c.randomBytes){var l=c.randomBytes(16);n=new Uint32Array(l.buffer,l.byteOffset,l.byteLength/Uint32Array.BYTES_PER_ELEMENT),s=!0}else for(n=new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT),i=0;i<n.length;i++)n[i]=Math.floor(Math.random()*Math.floor(4294967295));if(n){for(r="",i=0;i<n.length;i++)for(a=n[i],o=0;o<6;o++)r+=$o[a%62],a=Math.floor(a/62);e&&(r="1_"+(s?"1":"2")+"_"+r)}}return r}});function _valueForKeyPath(e,t,r){var n=t;if(e&&t)for(var i=e.split("."),o=0;n&&o<i.length;o++){var a=i[o];!(a in n)&&r&&(n[a]={}),n=a in n?n[a]:null}return n}function valueForKeyPath$1(e){var t=null;if(e&&arguments.length>1)for(var r=sourcesArray(Array.prototype.slice.call(arguments,1)),n=r.length-1;n>=0;n--){var i=r[n];if(isDefinedNonNull(t=_valueForKeyPath(e,i)))break}return t}function sourcesArray(e){var t=[],r=[];r=r.concat(e),arguments&&arguments.length>1&&(r=r.concat(Array.prototype.slice.call(arguments,1)));for(var n=0;n<r.length;n++){var i=r[n];t=t.concat(i)}return t}var Co=Object.freeze({__proto__:null,valueForKeyPath:valueForKeyPath$1,createObjectAtKeyPath:function(e,t){return _valueForKeyPath(e,t,!0)},sourcesArray:sourcesArray});function mergeAndCleanEventFields(e){for(var t=[!1,!1,!1].concat(Array.prototype.slice.call(arguments)),r=[],n=0;n<t.length;n++){var i=t[n];if(i&&i.constructor===Array)for(var o=0;o<i.length;o++)r.push(i[o]);else r.push(i)}return copyKeysAndValues$1.apply(null,r)}var Mo=Object.freeze({__proto__:null,mergeAndCleanEventFields:mergeAndCleanEventFields,processMetricsData:function(e,t,r,n){var i=mergeAndCleanEventFields(n),o=i;if(e&&t){var a={};if(r||(t=t.filter((function(e){return e in i}))),t.length)for(var s=0;s<t.length;s++){var c=t[s],l=e[c];isFunction$1(l)&&(a[c]=l.call(e,i))}o=mergeAndCleanEventFields(o,a)}return o},applyFieldsMap:function(e,t,r,n){var i,o,a;if(e&&t&&r){var s,c;if(o={},i=valueForKeyPath$1(t,r,r.custom))if(isArray$1(i))for(s=0;s<i.length;++s)isDefinedNonNull(c=e[i[s]])&&(o[i[s]]=c);else if(isObject(i)){for(var l in i)for(s=0;s<i[l].length;++s)if(isDefinedNonNull(c=valueForKeyPath$1(i[l][s],e))){o[l]=c;break}}else a="metrics: incorrect data type provided to applyFieldsMap (only accepts objects and Arrays)";else a="metrics: unable to get "+t+" section from fieldsMap"}else{var d=[];e||d.push("data"),t||d.push("sectionName"),r||d.push("fieldsMap"),a="metrics: missing argument(s): "+d.join(",")+" not provided to applyFieldsMap"}return a&&isFunction$1(n)&&n(a),o}});function makeAjaxRequest$2(e,t,r,n,i,o){var a=new XMLHttpRequest;r=r||void 0,o=o||{},n=isFunction$1(n)?n:function(){},i=isFunction$1(i)?i:function(){};var s=!1!==o.async;o.timeout&&s&&(a.timeout=o.timeout),a.onload=function(){a.status>=200&&a.status<300?n(a.response):i(new Error("XHR error: server responded with status "+a.status+" "+a.statusText),a.status)},a.onerror=function(){i(new Error("XHR error"))},a.open(t,e,s),a.withCredentials="boolean"!=typeof o.withCredentials||o.withCredentials,a.setRequestHeader("Content-type","application/json"),a.send(r)}var Do=Object.freeze({__proto__:null,makeAjaxGetRequest:function(e,t,r){makeAjaxRequest$2(e,"GET",null,t,r)},makeAjaxRequest:makeAjaxRequest$2}),xo={LOCAL_STORAGE:"localStorage",SESSION_STORAGE:"sessionStorage"},_storageObject=function(e){var t=null,r=!1;return function(){return e?t=e:(r||(console.error("storageObject: storage object not found. Override this function if there is a platform-specific implementation"),r=!0),t||(t={storage:{},getItem:function(e){return this.storage[e]},setItem:function(e,t){this.storage[e]=t},removeItem:function(e){delete this.storage[e]}})),t}};function _defaultStorageObject(e){var t=null,r=e===xo.LOCAL_STORAGE;try{t="undefined"!==(r?typeof localStorage:typeof sessionStorage)?r?localStorage:sessionStorage:null}catch(n){t=null,console.error("_utils.storage._defaultStorageObject: Unable to retrieve storage object: "+n)}return t}var Lo=_storageObject(_defaultStorageObject(xo.LOCAL_STORAGE)),No=_storageObject(_defaultStorageObject(xo.SESSION_STORAGE));var jo=Object.freeze({__proto__:null,_utDefaultStorageObject:function(e){return _defaultStorageObject(e)},localStorageObject:Lo,sessionStorageObject:No,saveObjectToStorage:function(e,t,r){var n=null;if(r)try{e.setItem(t,JSON.stringify(r)),n=r}catch(i){}else n=e.removeItem(t);return n},objectFromStorage:function(e,t){var r=null,n=e.getItem(t);if(n)try{r=JSON.parse(n)}catch(i){r=void 0}return r}});function FlagSymbol(e){this.key=e}FlagSymbol.prototype.toString=function(){return this.key};var Uo={flagArguments:{INCLUDE_CALL_STACK:new FlagSymbol("INCLUDE_CALL_STACK"),MIRROR_TO_SERVER:new FlagSymbol("MIRROR_TO_SERVER"),SUPPRESS_CLIENT_OUTPUT:new FlagSymbol("SUPPRESS_CLIENT_OUTPUT")},setDelegate:function(e){return ko.attachDelegate(this,e)},execute:function(e,t,r){var n=e.levelStringToIntMap[t];if(e.level()!==e.NONE&&e.level()<=n){var i=Array.prototype.slice.call(r),o=Uo.nonFlagLogArguments(i),a=Uo.logOptions(e,n,i),s=a.includeCallStack?(new Error).stack:null,c=s?o.concat("\n"+s):o;if(e[t]._lastLog=c,a.mirrorToServer,a.throwInsteadOfPrint)throw new Error(o.toString());a.suppressClientOutput||(console[t]?console[t].apply(console,c):console.log.apply(console,c))}},isFlagObject:function(e){return e&&e===Uo.flagArguments[e.toString()]},nonFlagLogArguments:function(e){return e.filter((function(e){return!Uo.isFlagObject(e)}))},logOptions:function(e,t,r){var n,i={};return r.forEach((function(e){Uo.isFlagObject(e)&&(n=Ro.snakeCaseToCamelCase(e.toString()),i[n]=!0)})),ko.isFunction(e.mirrorToServerLevel)&&e.mirrorToServerLevel()!==e.NONE&&e.mirrorToServerLevel()<=t&&(i.mirrorToServer=!0),e.throwLevel()!==e.NONE&&e.throwLevel()<=t&&(i.throwInsteadOfPrint=!0),i},sendToServer:function(e,t,r,n){}},Fo={NONE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4},Bo={MIN_LEVEL:Fo.NONE,MAX_LEVEL:Fo.ERROR,levelIntToStringMap:{0:"none",1:"debug",2:"info",3:"warn",4:"error"},levelStringToIntMap:{none:0,debug:1,info:2,warn:3,error:4}};ko.extend(Bo,Fo);var Ko={loggerName:"defaultLogger",level:Bo.INFO,throwLevel:Bo.NONE},Vo=!1,Go={};function Logger(e){this._loggerName=e,this._level,this._throwLevel,Vo||(Vo=!0,ko.extend(Logger.prototype,Bo),ko.extend(Logger.prototype,Uo.flagArguments))}function loggerNamed(e){var t=Go[e=e||Ko.loggerName];return t||(t=new Logger(e),Go[e]=t),t}Logger.level=function(){return Ko.level},Logger.throwLevel=function(){return Ko.throwLevel},Logger.prototype.setDelegate=function(e){return ko.attachDelegate(this,e)},Logger.prototype.loggerName=function(){return this._loggerName},Logger.prototype.levelParameterAsInt=function(e){var t,r=null;return ko.isString(e)?t=this.levelStringToIntMap[e.toLowerCase()]:ko.isNumber(e)&&(t=e),t>=this.MIN_LEVEL&&t<=this.MAX_LEVEL&&(r=t),r},Logger.prototype.setLevel=function(e){var t=this.levelParameterAsInt(e);null!==t&&(this._level=t)},Logger.prototype.setThrowLevel=function(e){var t=this.levelParameterAsInt(e);null!==t&&(this._throwLevel=t)},Logger.prototype.level=function(){var e=this._level;return ko.isNumber(e)?e:Logger.level()},Logger.prototype.levelString=function(){return this.levelIntToStringMap[this.level()]},Logger.prototype.throwLevel=function(){var e=this._throwLevel;return ko.isNumber(e)?e:Logger.throwLevel()},Logger.prototype.debug=function(){Uo.execute(this,"debug",arguments)},Logger.prototype.info=function(){Uo.execute(this,"info",arguments)},Logger.prototype.warn=function(){Uo.execute(this,"warn",arguments)},Logger.prototype.error=function(){Uo.execute(this,"error",arguments)},Logger.prototype.lastLog=function(e){return this[e]?this[e]._lastLog:null},Logger.level,Logger.throwLevel;var Ho=ko.attachDelegate,Wo={setDelegate:function(e){return Ho(this,e)},localStorageObject:jo.localStorageObject,sessionStorageObject:jo.sessionStorageObject},qo=ko.attachDelegate,zo={setDelegate:function(e){return qo(this,e)},makeAjaxRequest:Do.makeAjaxRequest},Yo=ko.attachDelegate,Qo=ko.hasAnyKeys,Jo=ko.isArray,Xo=jo.saveObjectToStorage,Zo=jo.objectFromStorage,ea=Oo.exponentialBackoff,ta=Co.valueForKeyPath,ra={blacklistedFields:["capacitySystem","capacitySystemAvailable","capacityDisk","capacityData","capacityDataAvailable"],compoundSeparator:"_",configBaseUrl:"https://xp.apple.com/config/1/report",constraints:{profiles:{AMPWeb:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedOut",expirationPeriod:864e5}}},{filters:{valueMatches:{isSignedIn:[!0]}},fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedIn",expirationPeriod:15552e6}}}]},strict:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,scopeFieldName:"parentPageUrl",scopeStrategy:"mainDomain",expirationPeriod:864e5},consumerId:{blacklisted:!0},dsId:{blacklisted:!0},parentPageUrl:{scope:"hostname"}}},{filters:{valueMatches:{eventType:["click"],actionType:["signUp"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{eventType:["dialog"],dialogType:["upsell"],result:["upsell"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{userType:["signedIn"]}},fieldConstraints:{clientId:{scopeStrategy:"all"}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["click","dialog","media","search"]}},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["page","impressions"]},nonEmptyFields:["pageHistory"]},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}}]}}},fieldsMap:{cookies:["itcCt","itscc"],custom:{impressions:["id","adamId","link.type","station-hash"],location:["id","adamId","dataSetId","name","fcKind","kindIds","type","link.type","station-hash","core-seed-name"]},single:{targetId:["id","adamId","contentId","type","link.type","fcId","userPreference","label","station-hash","linkIdentifier"]}},metricsUrl:"https://xp.apple.com/report",postFrequency:6e4,postFrequencyLowLatency:5e3,tokenSeparator:"|"},na={},_appendSectionAndSubsectionToConfigSources=function(e,t,r){if(r){e.push(r);var n=r[t];n&&Qo(n)&&e.push(n)}},Config=function(e){this._topic=e,this._debugSource=null,this._cachedSource=null,this._serviceSource=null,this._initCalled=!1,this._initialized=!1,this._showedDebugWarning=!1,this._showedNoProvidedSourceWarning=!1,this._keyPathsThatSuppressWarning={configBaseUrl:!0},this.DEBUG_SOURCE_KEY="mtClientConfig_debugSource"+ra.compoundSeparator+this._topic,this.CACHED_SOURCE_KEY="mtClientConfig_cachedSource"+ra.compoundSeparator+this._topic};Config.createConfig=function(e,t,r,n){var i=Config.getConfig(e);return e&&"noTopicConfig"!==e&&!i._initCalled&&i.init(t,r,n),i},Config.getConfig=function(e){var t=na[e=e||"noTopicConfig"];return t||(t=new Config(e),na[e]=t),t},Config.cleanupConfig=function(e){if(e&&na[e]){var t=na[e];t.setCachedSource(),t.setDebugSource(),delete na[e]}},Config.defaultConfig=function(){return Config.getConfig()},Config.value=function(e,t){var r=t&&na[t]||Config.defaultConfig();return r.value.call(r,e)},Config.environment=Wo,Config.logger=loggerNamed("mt-client-config"),Config.network=zo,Config.prototype._defaults=function(){return ra},Config.prototype._setInitialized=function(e){this._initialized=e},Config.prototype._setInitCalled=function(e){this._initCalled=e},Config.prototype._setShowedDebugWarning=function(e){this._showedDebugWarning=e},Config.prototype._setShowedNoProvidedSourceWarning=function(e){this._showedNoProvidedSourceWarning=e},Config.prototype.setDelegate=function(e){return Yo(this,e)},Config.prototype.topic=function(){return this._topic},Config.prototype.configHostname=function(){},Config.prototype.configUrl=function(){var e,t=this.configHostname();return e=t?"https://"+t+"/config/1/report":this.value("configBaseUrl"),"noTopicConfig"!==this._topic?e+="/"+this.topic():Config.logger.error("config.configUrl(): Topic must be provided"),e},Config.prototype.sources=function(){},Config.prototype.value=function(e){var t,r=this.cachedSource(),n=this.serviceSource(),i=this.sources(),o=this.debugSource(),a=r||n||i||o;return i||n||e in this._keyPathsThatSuppressWarning||this._showedNoProvidedSourceWarning||(this._showedNoProvidedSourceWarning=!0,Config.logger.warn("Metrics config: No config provided via delegate or fetched via init(), using default/cached config values.")),o&&(this._showedDebugWarning||(this._showedDebugWarning=!0,Config.logger.warn('"debugSource" found.\nThis will override any same-named client-supplied configSource fields.\nThis setting "sticks" across session, use "setDebugSource(null)" to clear'))),Jo(i)||(i=[i]),t=0===e.indexOf("blacklisted")?a?[r,n,i,o]:[ra]:[ra,r,n,i,o],t=this.configSourcesWithOverrides(t,this.topic()),ta.apply(null,[e].concat(t))},Config.prototype.configSourcesWithOverrides=function(e,t){var r=e;if(e&&e.length&&t){r=[];for(var n=0;n<e.length;n++){var i=e[n];if(i)if(Jo(i)&&i.length){for(var o=[],a=0;a<i.length;a++)_appendSectionAndSubsectionToConfigSources(o,t,i[a]);r.push(o)}else _appendSectionAndSubsectionToConfigSources(r,t,i)}}return r},Config.prototype.setDebugSource=function(e){return this._debugSource=e||null,Xo(Wo.localStorageObject(),this.DEBUG_SOURCE_KEY,this._debugSource)},Config.prototype.debugSource=function(){return this._debugSource||(this._debugSource=Zo(Wo.localStorageObject(),this.DEBUG_SOURCE_KEY)),this._debugSource},Config.prototype.setCachedSource=function(e){return this._cachedSource=e||null,Xo(Wo.localStorageObject(),this.CACHED_SOURCE_KEY,this._cachedSource)},Config.prototype.cachedSource=function(){return this._cachedSource||(this._cachedSource=Zo(Wo.localStorageObject(),this.CACHED_SOURCE_KEY)),this._cachedSource},Config.prototype.setServiceSource=function(e){return this._serviceSource=e,this._serviceSource},Config.prototype.serviceSource=function(){return this._serviceSource},Config.prototype.fetchConfig=function(e,t,r){r=r||function(){};ea(zo.makeAjaxRequest.bind(zo,e,"GET",null),(function(e){var n;try{e=JSON.parse(e),n=!0}catch(i){r.call(r,i)}n&&t&&t.call(t,e)}),r)},Config.prototype.init=function(e,t,r){if(!this._initCalled){this._initCalled=!0,t=t||function(){};var n=function(){this._initialized=!0,t.call(t)}.bind(this);if(e)this.setDelegate({sources:e}),n();else{this.setCachedSource(this.cachedSource());var i=this.configUrl(),o=function(e){this.setCachedSource(e),this.setServiceSource(e),n()}.bind(this);this.fetchConfig(i,o,r)}}},Config.prototype.initialize=function(e,t,r){return this.init.apply(this,Array.prototype.slice.call(arguments))},Config.prototype.initialized=function(){return this._initialized},ko.attachDelegate;var ia=Io.metricsDisabledOrDenylistedEvent,oa=Io.removeDenylistedFields,aa={},sa=["dsId","consumerId"];function recordEvent(e,t,r){var n=null;return r&&!ia.call(Config,r.eventType,t)&&(oa.call(Config,r,t),_removeIdentifiableFieldsForTopic(t,r),e.apply(null,Array.prototype.slice.call(arguments,1)),n=r),n}function _removeIdentifiableFieldsForTopic(e,t){aa[e]=aa[e]||{},aa[e].anonymous&&sa.forEach((function(e){delete t[e]}))}var ca=ko.attachDelegate,la={setDelegate:function(e){return ca(this,e)},makeAjaxRequest:Do.makeAjaxRequest};ko.isString,ko.isFunction,Io.disabled;var da=1e4,ua="events",pa="1.0",ha=2;function enrichAndSerializeEvents(e){var t=null;if(e&&e.length){var r={};r.deliveryVersion=pa,r.postTime=Date.now(),r[ua]=e;try{t=JSON.stringify(r)}catch(n){loggerNamed("mt-event-queue").error("Error stringifying events as JSON: "+n)}}return t}function _immediateRecordEvent(e,t){var r=enrichAndSerializeEvents([t]);if(r){var n=function(e){return Config.value("metricsUrl",e)+"/"+ha+"/"+e}(e),i={timeout:function(e){var t=Config.value("requestTimeout",e)||da;return t=Math.min(t,Config.value("postFrequency",e))}(e)};aa[e]&&aa[e].anonymous&&(i.withCredentials=!1),la.makeAjaxRequest(n,"POST",r,null,null,i)}}ko.attachDelegate;var ya,_a,fa={_document:function(){if("undefined"!=typeof document)return document;throw"metricskit-delegates-html.environment HTML delegate 'document' object not found"},_window:function(){if("undefined"!=typeof window)return window;throw"metricskit-delegates-html.environment HTML delegate 'window' object not found"},cookie:function(){return fa._window().document.cookie},pageUrl:function(){return fa._window().location.href},parentPageUrl:function(){var e,t=fa._window(),r=t.parent;if(r!==t)try{e=r.location.href}catch(n){e=fa._document().referrer}return e},pixelRatio:function(){return fa._window().devicePixelRatio},screenHeight:function(){return fa._window().screen.height},screenWidth:function(){return fa._window().screen.width},userAgent:function(){return fa._window().navigator.userAgent},windowInnerHeight:function(){return fa._window().innerHeight},windowInnerWidth:function(){return fa._window().innerWidth},windowOuterHeight:function(){return fa._window().outerHeight},windowOuterWidth:function(){return fa._window().outerWidth},timeOriginOffset:function(){var e=null,t=fa._window().performance;return t&&t.timing&&(e=t.timing.navigationStart),e},app:function(){},appVersion:function(){},capacityData:function(){},capacityDataAvailable:function(){},capacityDisk:function(){},capacitySystem:function(){},capacitySystemAvailable:function(){},connectionType:function(){},dsId:function(){},hardwareBrand:function(){},hardwareFamily:function(){},hardwareModel:function(){},hostApp:function(){},hostAppVersion:function(){},os:function(){},osBuildNumber:function(){},osLanguages:function(){},osVersion:function(){},resourceRevNum:function(){},storeFrontCountryCode:function(){},storeFrontHeader:function(){},userType:function(){}},va={recordEvent:function(e,t){return recordEvent.apply(null,[_immediateRecordEvent].concat(Array.prototype.slice.call(arguments)))},sendMethod:function(){return"javascript"},setProperties:function(e,t){aa[e]=aa[e]||{},aa[e]=t},cleanup:function(){aa={}}};function environmentBaseFieldNames(){return _a||(_a=["app","appVersion","hardwareFamily","hardwareModel","os","osBuildNumber","osLanguages","osVersion","resourceRevNum","screenHeight","screenWidth","userAgent"].concat(["delegateApp","hardwareBrand","storeFrontCountryCode","storeFrontHeader"])),_a}var ga,ma=ko.attachDelegate,ba=Ro.cryptoRandomBase62String,Sa=Ro.exceptionString;function Base$1(e){this.setDelegate({topic:e}),ga||(ga=!0,environmentBaseFieldNames().forEach((function(e){Base$1.prototype[e]=function(t){return t&&t.hasOwnProperty(e)?t[e]:this.environment()[e]()}})))}Base$1._className="eventHandlers.base",Base$1.prototype.setDelegate=function(e){return ma(this,e)},Base$1.prototype.topic=function(){throw Sa(Base$1._className,"topic")},Base$1.prototype.environment=function(){throw Sa(Base$1._className,"environment")},Base$1.prototype.eventRecorder=function(){throw Sa(Base$1._className,"eventRecorder")},Base$1.prototype.metricsData=function(){throw Sa(Base$1._className,"metricsData")},Base$1.prototype.processMetricsData=function(){throw Sa(Base$1._className,"processMetricsData")},Base$1.prototype.knownFields=function(){return ya||(ya=environmentBaseFieldNames().concat(["baseVersion","clientEventId","connection","eventTime","eventType","eventVersion","timezoneOffset","xpPostFrequency","xpSendMethod"])),ya},Base$1.prototype.baseVersion=function(){return 1},Base$1.prototype.clientEventId=function(e){return e&&e.clientEventId||ba(!0)},Base$1.prototype.connection=function(e){return e&&e.connection||this.environment().connectionType()},Base$1.prototype.dsId=function(e){return e&&e.dsId||this.environment().dsId()},Base$1.prototype.eventTime=function(e){return e&&e.eventTime||Date.now()},Base$1.prototype.eventVersion=function(e){return e&&e.eventVersion||null},Base$1.prototype.timezoneOffset=function(e){return e&&e.timezoneOffset||(new Date).getTimezoneOffset()},Base$1.prototype.xpPostFrequency=function(e){return e&&e.xpPostFrequency||Config.value("postFrequency",this.topic())},Base$1.prototype.xpSendMethod=function(e){return e&&e.xpSendMethod||this.eventRecorder().sendMethod()};var Pa,Ea=Base$1,Ta=ko.attachDelegate,ka=Ro.exceptionString,wa=jo.localStorageObject,Oa=jo.sessionStorageObject;function Environment$1(){Pa||(Pa=!0,["app","appVersion","hardwareFamily","hardwareModel","os","osBuildNumber","osLanguages","osVersion","resourceRevNum","screenHeight","screenWidth","userAgent"].forEach((function(e){Environment$1.prototype[e]=function(){throw ka(Environment$1._className,e)}})),["delegateApp","hardwareBrand","storeFrontCountryCode","storeFrontHeader"].forEach((function(e){Environment$1.prototype[e]=function(){}})))}Environment$1._className="system.environment",Environment$1.prototype.setDelegate=function(e){return Ta(this,e)},Environment$1.prototype.connectionType=function(){throw ka(Environment$1._className,"connectionType")},Environment$1.prototype.dsId=function(){},Environment$1.prototype.localStorageObject=wa,Environment$1.prototype.sessionStorageObject=Oa;var Ia=Environment$1,Aa=ko.extend;function MetricsData$2(){this._eventData={}}MetricsData$2.prototype.updateData=function(){Aa.apply(null,[this._eventData].concat(Array.prototype.slice.call(arguments)))};var $a,Ra=MetricsData$2;function topic(){return $a}var Ca="unknown",Ma="next",Da="previous",xa="location",La="interval",Na="playhead",ja="scrub",Ua="transition",Fa="interruption",Ba="buffering",Ka="play",Va="seek",Ga="skipIntro",Ha="actionType",Wa="consumerId",qa="consumerNs",za="dsId",Ya="eventType",Qa="eventVersion",Ja="isOffline",Xa="videoViewportHeight",Za="videoViewportWidth",es={TYPE:{MANUAL:"manual",AUTOMATIC:"automatic",UNKNOWN:Ca},PLAY_START_REASON:{PLAY:Ka,UNPAUSE:"unpause",NEXT:Ma,PREVIOUS:Da,SEEK:Va,TRANSITION:Ua,INTERRUPTION:Fa,FOREGROUND:"foreground",FOCUS:"focus",BUFFERING:Ba,UNKNOWN:Ca},PLAY_START_REASON_TYPE:{SKIP_INTRO:Ga},PLAY_STOP_REASON:{COMPLETE:"complete",TRANSITION:Ua,PLAY_OTHER:"playOther",PAUSE:"pause",SEEK:Va,NEXT:Ma,INTERRUPTION:Fa,BACKGROUND:"background",EXIT:"exit",INACTIVITY:"inactivity",BUFFERING:Ba,ERROR:"error",FAILURE:"failure",UNKNOWN:Ca,CLOSE_PLAYER:"closePlayer"},PLAY_STOP_REASON_TYPE:{SKIP_INTRO:Ga},SEEK_START_REASON:{NEXT:Ma,PREVIOUS:Da,LOCATION:xa,INTERVAL:La,PLAYHEAD:Na,SCRUB:ja,UNKNOWN:Ca,SKIP_INTRO:Ga},SEEK_STOP_REASON:{NEXT:Ma,PREVIOUS:Da,LOCATION:xa,INTERVAL:La,PLAYHEAD:Na,SCRUB:ja,UNKNOWN:Ca,SKIP_INTRO:Ga}},ts={ACTIVITY_TYPE:{PLAY:Ka,SEEK:Va},ACTION_TYPE:{START:"start",STOP:"stop"},EVENT_TYPE:{PLAY_ACTIVITY:"playActivity",SEEK_ACTIVITY:"seekActivity"}},rs={INCLUDES_START_POSITIONS:"includesStartPositions",INCLUDES_END_POSITIONS:"includesEndPositions"},ns=Ia;function VPAFKitEnvironment(){ns.apply(this,arguments)}VPAFKitEnvironment.prototype=new ns,VPAFKitEnvironment.prototype.constructor=VPAFKitEnvironment,VPAFKitEnvironment.prototype.consumerId=function(){},VPAFKitEnvironment.prototype.consumerNs=function(){},VPAFKitEnvironment.prototype.isOffline=function(){},VPAFKitEnvironment.prototype.videoViewportHeight=function(){},VPAFKitEnvironment.prototype.videoViewportWidth=function(){};var is=ko.attachDelegate,os=Ro.exceptionString,as={setDelegate:function(e){return is(this,e)},recordEvent:function(e,t){throw os("system.eventRecorder","recordEvent")},sendMethod:function(){throw os("system.eventRecorder","sendMethod")},flushUnreportedEvents:function(e){}},ss={};ss.environment=new VPAFKitEnvironment,ss.eventRecorder=as,ss.logger=loggerNamed("mt-vpafkit");var cs=Ea,ls=Mo.processMetricsData,VPAFKitBase=function(){cs.apply(this,arguments)};(VPAFKitBase.prototype=new cs).constructor=VPAFKitBase,VPAFKitBase.prototype.environment=function(){return ss.environment},VPAFKitBase.prototype.eventRecorder=function(){return ss.eventRecorder},VPAFKitBase.prototype.knownFields=function(){var e=cs.prototype.knownFields().concat([Ha,Wa,qa,za,Ja,Xa,Za]);return e},VPAFKitBase.prototype.consumerId=function(e){var t=Wa;return e&&t in e?e[t]:this.environment().consumerId()},VPAFKitBase.prototype.consumerNs=function(e){var t=qa;return e&&t in e?e[t]:this.environment().consumerNs()},VPAFKitBase.prototype.isOffline=function(e){var t=Ja;return e&&t in e?e[t]:this.environment().isOffline()},VPAFKitBase.prototype.videoViewportHeight=function(e){var t=Xa;return e&&t in e?e[t]:this.environment().videoViewportHeight()},VPAFKitBase.prototype.videoViewportWidth=function(e){var t=Za;return e&&t in e?e[t]:this.environment().videoViewportWidth()};var ds=new VPAFKitBase((function(){return topic()}));ds.metricsData=function(){return ds.processMetricsData.apply(ds,[null].concat(Array.prototype.slice.call(arguments)))},ds.processMetricsData=function(e){var t=null;if(!Config.metricsDisabledOrBlacklistedEvent(e,topic())){var r=Array.prototype.slice.call(arguments,1);if(this!==ds){var n=ds.metricsData.apply(ds,r);r=[n].concat(r)}t=ls(this,this.knownFields(),!0,r)}return Config.removeBlacklistedFields(t,topic()),t};var us=ko.attachDelegate,ps=ko.extend,MediaActivity=function(e,t){this._defaultEventType=e,this._reasonConstants=t,this._defaultActionType};ps(MediaActivity,ts),Object.defineProperties(MediaActivity.prototype,{TYPE:{get:function(){return es.TYPE}},REASON:{get:function(){return this._reasonConstants}}}),MediaActivity.prototype.setDelegate=function(e){return us(this,e)},MediaActivity.prototype.knownFields=function(){var e=[Ha,Ya,Qa];return e},MediaActivity.prototype.eventType=function(e){return this._defaultEventType},MediaActivity.prototype.eventVersion=function(e){var t=ds.eventVersion(e);return null!==t?t:1},MediaActivity.prototype.actionType=function(e){return this._defaultActionType};var StartMediaActivity=function(e,t){MediaActivity.apply(this,arguments),this._defaultActionType=MediaActivity.ACTION_TYPE.START};(StartMediaActivity.prototype=new MediaActivity).constructor=StartMediaActivity,StartMediaActivity.prototype.metricsData=function(e,t,r,n){var i=this.eventType(),o={position:e,overallPosition:t,startType:r,startReason:n},a=Array.prototype.slice.call(arguments,4);return ds.processMetricsData.apply(this,[i,o].concat(a))};var StopMediaActivity=function(e,t){MediaActivity.apply(this,arguments),this._defaultActionType=MediaActivity.ACTION_TYPE.STOP};(StopMediaActivity.prototype=new MediaActivity).constructor=StopMediaActivity,StopMediaActivity.prototype.metricsData=function(e,t,r,n,i){var o=this.eventType(),a={position:e,overallPosition:t,stopType:r,stopReason:n,startPosition:(i=i||{}).position,startOverallPosition:i.overallPosition,startTime:i.eventTime,startType:i.startType,startReason:i.startReason,startReasonType:i.startReasonType};o===MediaActivity.EVENT_TYPE.SEEK_ACTIVITY&&(a.startAssetId=i.assetId);var s=Array.prototype.slice.call(arguments,5);return ds.processMetricsData.apply(this,[o,a].concat(s))};var hs=new StartMediaActivity(MediaActivity.EVENT_TYPE.PLAY_ACTIVITY,es.PLAY_START_REASON),ys=new StopMediaActivity(MediaActivity.EVENT_TYPE.PLAY_ACTIVITY,es.PLAY_STOP_REASON),_s=new StartMediaActivity(MediaActivity.EVENT_TYPE.SEEK_ACTIVITY,es.SEEK_START_REASON),fs=new StopMediaActivity(MediaActivity.EVENT_TYPE.SEEK_ACTIVITY,es.SEEK_STOP_REASON),vs=Object.freeze({__proto__:null,base:ds,playStart:hs,playStop:ys,seekStart:_s,seekStop:fs}),gs=ko.extend,MediaActivity$1=function(e){this._activityType=e,this._startMetricsData=null,this._isStopped=!1};MediaActivity$1.ACTIVITY_TYPE=ts.ACTIVITY_TYPE,Object.defineProperties(MediaActivity$1.prototype,{isStopped:{get:function(){return this._isStopped}},type:{get:function(){return this._activityType}},startOverallPosition:{get:function(){return this._startMetricsData?this._startMetricsData.overallPosition:null}}}),gs(MediaActivity$1.prototype,es),MediaActivity$1.prototype.started=function(e,t,r,n){var i=this._startEventHandler();i&&(this._startMetricsData=i.metricsData.apply(i,arguments),this.type!=MediaActivity$1.ACTIVITY_TYPE.SEEK&&as.recordEvent(topic(),this._startMetricsData))},MediaActivity$1.prototype.stopped=function(e,t,r,n){var i=this._stopEventHandler();if(i){this._isStopped=!0;var o=[e,t,r,n,this._startMetricsData].concat(Array.prototype.slice.call(arguments,4)),a=i.metricsData.apply(i,o);as.recordEvent(topic(),a)}},MediaActivity$1.prototype._startEventHandler=function(){var e;switch(this.type){case MediaActivity$1.ACTIVITY_TYPE.PLAY:e=hs;break;case MediaActivity$1.ACTIVITY_TYPE.SEEK:e=_s}return e},MediaActivity$1.prototype._stopEventHandler=function(){var e;switch(this.type){case MediaActivity$1.ACTIVITY_TYPE.PLAY:e=ys;break;case MediaActivity$1.ACTIVITY_TYPE.SEEK:e=fs}return e};var ms=ko.isInteger,TimeTracker=function(e,t){this._date=new Date,this._position=t,this._validatePlaybackRate(e),this._playbackRate=e};Object.defineProperties(TimeTracker.prototype,{playbackRate:{get:function(){return this._playbackRate}}}),TimeTracker.prototype.update=function(e,t){this._date=new Date,this._position=t,this._validatePlaybackRate(e),this._playbackRate=e},TimeTracker.prototype.estimatedTime=function(e){var t;ms(e)?t=e:(ss.logger.error("VPAFKit error: position should be an integer"),t=Math.round(e));var r=(t-this._position)/(0==this.playbackRate?1:this.playbackRate);return this._date.getTime()+Math.round(r)},TimeTracker.prototype._validatePlaybackRate=function(e){0==e&&ss.logger.error("VPAFKit error: playbackRate should not be zero.")};var bs=ko.attachDelegate,Ss=ko.extend,Ps=ko.isFunction,Es=ko.isNumber,Ts=Ra,ks=rs.INCLUDES_START_POSITIONS,ws=rs.INCLUDES_END_POSITIONS,MediaActivityTracker=function(e){Ts.apply(this,arguments),this._playlist=e,this._playActivity=null,this._playStartPlaylistItem=null,this._seekActivity=null,this._timeTracker=null,this._shouldGenerateTransitions=!0};(MediaActivityTracker.prototype=new Ts).constructor=MediaActivityTracker,Ss(MediaActivityTracker.prototype,es),Object.defineProperties(MediaActivityTracker.prototype,{shouldGenerateTransitions:{get:function(){return this._shouldGenerateTransitions},set:function(e){this._shouldGenerateTransitions=e}}}),MediaActivityTracker.prototype.setDelegate=function(e){return bs(this,e)},MediaActivityTracker.prototype.playStarted=function(e,t,r){return this.playStartedWithPlaybackRate.apply(this,[1].concat(Array.prototype.slice.call(arguments)))},MediaActivityTracker.prototype.playStartedWithPlaybackRate=function(e,t,r,n){if(this._hasUnstoppedActivity(this._playActivity))this._error("inconsistent state: did you forget to call playStopped?");else{var i=this._playlistItem(t,ks);i&&(this._playStarted.apply(this,[i].concat(Array.prototype.slice.call(arguments,1))),this.shouldGenerateTransitions&&(this._timeTracker=new TimeTracker(e,t)))}},MediaActivityTracker.prototype.playStopped=function(e,t,r){this._generatePlaylistTransitionsIfNecessary(e),this._hasUnstoppedActivity(this._playActivity)?this._playStopped.apply(this,Array.prototype.slice.call(arguments)):this._error("inconsistent state: did you forget to call playStarted?"),this._playStartPlaylistItem=null,this._timeTracker=null},MediaActivityTracker.prototype.playTransitioned=function(e){this.playStopped.apply(this,[e,this.TYPE.AUTOMATIC,this.PLAY_STOP_REASON.TRANSITION].concat(Array.prototype.slice.call(arguments,1))),this.playStarted.apply(this,[e,this.TYPE.AUTOMATIC,this.PLAY_START_REASON.TRANSITION].concat(Array.prototype.slice.call(arguments,1)))},MediaActivityTracker.prototype.seekStarted=function(e,t,r){if(this._hasUnstoppedActivity(this._seekActivity))this._error("inconsistent state: did you forget to call seekStopped?");else{var n=this._playlistItem(e,ks);if(n){var i=this._activityArguments.apply(this,[n].concat(Array.prototype.slice.call(arguments)));this._seekActivity=new MediaActivity$1(MediaActivity$1.ACTIVITY_TYPE.SEEK),this._seekActivity.started.apply(this._seekActivity,i)}}},MediaActivityTracker.prototype.seekStopped=function(e,t,r){var n=this._playlistItem(e,ws);if(n&&this._hasUnstoppedActivity(this._seekActivity)){var i=this._activityArguments.apply(this,[n].concat(Array.prototype.slice.call(arguments)));this._seekActivity.stopped.apply(this._seekActivity,i)}else this._error("inconsistent state: did you forget to call seekStarted?")},MediaActivityTracker.prototype.synchronize=function(e,t){if(this.shouldGenerateTransitions){var r=e>0,n=this._hasUnstoppedActivity(this._playActivity);n&&r?(this._generatePlaylistTransitionsIfNecessary(t),this._timeTracker.update(e,t)):n&&!r?this._error("inconsistent state: did you forget to call playStopped?"):!n&&r&&this._error("inconsistent state: did you forget to call playStarted?")}},MediaActivityTracker.prototype._playStarted=function(e,t,r,n){var i=this._activityArguments.apply(this,[e].concat(Array.prototype.slice.call(arguments,1)));this._playStartPlaylistItem=e,this._playActivity=new MediaActivity$1(MediaActivity$1.ACTIVITY_TYPE.PLAY),this._playActivity.started.apply(this._playActivity,i)},MediaActivityTracker.prototype._playStopped=function(e,t,r){var n=this._playStartPlaylistItem,i=this._activityArguments.apply(this,[n].concat(Array.prototype.slice.call(arguments)));this._playActivity.stopped.apply(this._playActivity,i)},MediaActivityTracker.prototype._playlistItem=function(e,t){var r;return this._playlist&&Ps(this._playlist.getItem)&&(r=this._playlist.getItem(e,t)),r||this._error("unable to get item from playlist"),r},MediaActivityTracker.prototype._playlistItems=function(e,t){var r=[];return this._playlist&&Ps(this._playlist.getItems)?r=this._playlist.getItems(e,t):this._error("unable to get items from playlist"),r},MediaActivityTracker.prototype._relativePosition=function(e,t){var r;return(t=t||this._playlistItem(e))&&Es(t.startOverallPosition)&&(r=e-t.startOverallPosition+(t.startPosition||0)),r},MediaActivityTracker.prototype._combineEventData=function(e,t){var r=this._playlist?this._playlist.eventData:null,n=e?e.eventData:null,i=[];return r&&i.push(r),n&&i.push(n),this._eventData&&i.push(this._eventData),t&&(i=i.concat(t)),i},MediaActivityTracker.prototype._activityArguments=function(e,t,r,n){var i=this._relativePosition(t,e),o=this._combineEventData(e,Array.prototype.slice.call(arguments,4)),a=[i,t,r,n].concat(o);return a},MediaActivityTracker.prototype._generatePlaylistTransitionsIfNecessary=function(e){if(this.shouldGenerateTransitions&&this._hasUnstoppedActivity(this._playActivity)){var t,r,n,i=this._playActivity.startOverallPosition||0,o=this._playlistItems(i,e);this._playlist._returnsOrderedItems||o.sort(this._playlistItemComparator);for(var a=0;a+1<o.length;a++)if(o[a],!((t=(r=o[a+1]).startOverallPosition)<=i)){if(t>=e)break;n={eventTime:this._timeTracker?this._timeTracker.estimatedTime(t):null},this._playStopped(t,this.TYPE.AUTOMATIC,this.PLAY_STOP_REASON.TRANSITION,n),this._playStarted(r,t,this.TYPE.AUTOMATIC,this.PLAY_START_REASON.TRANSITION,n)}}},MediaActivityTracker.prototype._hasUnstoppedActivity=function(e){return e&&!e.isStopped},MediaActivityTracker.prototype._error=function(e){ss.logger.error(this.constructor.name+" error: "+e)},MediaActivityTracker.prototype._playlistItemComparator=function(e,t){return e.startOverallPosition==t.startOverallPosition?0:e.startOverallPosition<t.startOverallPosition?-1:1};var Os=Ra,MediaPlaylistItem=function(e){Os.apply(this,arguments),this._startOverallPosition=e,this._startPosition=0};(MediaPlaylistItem.prototype=new Os).constructor=MediaPlaylistItem,Object.defineProperties(MediaPlaylistItem.prototype,{startOverallPosition:{get:function(){return this._startOverallPosition}},startPosition:{get:function(){return this._startPosition},set:function(e){this._startPosition=e}},eventData:{get:function(){return this._eventData}}});var HLSRollItem=function(e,t){MediaPlaylistItem.apply(this,arguments),this._duration=t};(HLSRollItem.prototype=new MediaPlaylistItem).constructor=HLSRollItem,Object.defineProperties(HLSRollItem.prototype,{duration:{get:function(){return this._duration}},endOverallPosition:{get:function(){return this.startOverallPosition+this.duration}}}),HLSRollItem.prototype.containsOverallPosition=function(e){return this.startOverallPosition<=e&&this.endOverallPosition>e};var MediaPlaylist=function(){};MediaPlaylist.prototype.RANGE_OPTIONS=rs,Object.defineProperties(MediaPlaylist.prototype,{eventData:{get:function(){}}}),MediaPlaylist.prototype.getItem=function(e,t){},MediaPlaylist.prototype.getItems=function(e,t){};var Is=ko.attachDelegate,As=ko.copyKeysAndValues,$s=ko.extend,Rs=ko.isInteger,HLSVideoPlaylist=function(e){MediaPlaylist.apply(this,arguments),this._startPosition=e,this._mainFeatureMetricsData=As.apply(null,[!1,!1,!1,null].concat(Array.prototype.slice.call(arguments,1))),this._rollItems=[]};(HLSVideoPlaylist.prototype=new MediaPlaylist).constructor=HLSVideoPlaylist,HLSVideoPlaylist.prototype.setDelegate=function(e){return Is(this,e)},HLSVideoPlaylist.prototype.addRollInfoItems=function(e){e&&e.length&&e.forEach((function(e){this.addRollInfoItem(e)}),this)},HLSVideoPlaylist.prototype.addRollInfoItem=function(e){e&&this.addRollItem(1e3*e.start,1e3*e.duration,e.metricsData)},HLSVideoPlaylist.prototype.addRollItem=function(e,t){var r=new HLSRollItem(e,t);r.updateData.apply(r,Array.prototype.slice.call(arguments,2)),this._addRollItem(r)},HLSVideoPlaylist.prototype.updateMainFeatureMetricsData=function(){$s.apply(null,[this._mainFeatureMetricsData].concat(Array.prototype.slice.call(arguments)))},HLSVideoPlaylist.prototype.getItem=function(e,t){var r,n=this._indexOfLastRollItemWithStartBeforePosition(e);if(Rs(n)){for(;t!=this.RANGE_OPTIONS.INCLUDES_START_POSITIONS&&this._rollItems[n].startOverallPosition==e&&n>0;)n--;(r=this._rollItems[n]).containsOverallPosition(e)||t==this.RANGE_OPTIONS.INCLUDES_END_POSITIONS&&r.endOverallPosition==e||(r=this._mainFeatureItemWithStartOverallPosition(r.endOverallPosition))}else r=this._mainFeatureItemWithStartOverallPosition(this._startPosition);return r},HLSVideoPlaylist.prototype.getItems=function(e,t){var r=[];if(this._rollItems.length){var n=this._indexOfLastRollItemWithStartBeforePosition(e);for(Rs(n)||(r.push(this._mainFeatureItemWithStartOverallPosition(this._startPosition)),n=0);n<this._rollItems.length;){var i=this._rollItems[n];if(i.startOverallPosition>t)break;if(i.endOverallPosition>=e&&r.push(i),n++,i.endOverallPosition<t)if(n<this._rollItems.length){var o=this._rollItems[n];o.startOverallPosition&&o.startOverallPosition>i.endOverallPosition&&r.push(this._mainFeatureItemWithStartOverallPosition(i.endOverallPosition))}else r.push(this._mainFeatureItemWithStartOverallPosition(i.endOverallPosition))}}else r.push(this._mainFeatureItemWithStartOverallPosition(this._startPosition));return r},HLSVideoPlaylist.prototype._addRollItem=function(e){if(e){var t=this._insertionIndexForItemWithPosition(e.startOverallPosition);this._rollItems.splice(t,0,e)}},HLSVideoPlaylist.prototype._indexOfLastRollItemWithStartBeforePosition=function(e){var t,r=this._rollItems[0];return r&&Rs(e)&&r.startOverallPosition<=e&&(t=this._insertionIndexForItemWithPosition(e)-1),t},HLSVideoPlaylist.prototype._insertionIndexForItemWithPosition=function(e){for(var t=0,r=this._rollItems.length;t<r;){var n=Math.floor((t+r)/2);this._rollItems[n].startOverallPosition>e?r=n:t=n+1}return t},HLSVideoPlaylist.prototype._mainFeatureItemWithStartOverallPosition=function(e){var t=new MediaPlaylistItem(e);return t.startPosition=this._featurePlayheadProgress(e),t.updateData(this._mainFeatureMetricsData),t},HLSVideoPlaylist.prototype._featurePlayheadProgress=function(e){e=e||0;var t,r,n=this._indexOfLastRollItemWithStartBeforePosition(e),i=this._startPosition||0;Rs(n)||(n=-1);for(var o=n;o>=0;o--)t=this._rollItems[o],0===o?i+=t.startOverallPosition:(r=this._rollItems[o-1],i+=t.startOverallPosition-r.endOverallPosition);return i};var Cs=Object.freeze({__proto__:null,createTracker:function(e){var t=new MediaActivityTracker(e);return t.updateData.apply(t,Array.prototype.slice.call(arguments,1)),t},createHLSVideoPlaylist:function(e){var t=new HLSVideoPlaylist(e);return t.updateMainFeatureMetricsData.apply(t,Array.prototype.slice.call(arguments,1)),t}});var Ms=Object.freeze({__proto__:null,applyFieldsMap:function(e,t){var r=Config.value("fieldsMap",topic());return Mo.applyFieldsMap(e,t,r)}}),Ds=Object.freeze({__proto__:null,eventFields:Ms}),xs=ko.setDelegates,Ls=ko.attachMethods,Ns=ko.copyDelegatedFunctions,js=Io.metricsDisabledOrBlacklistedEvent,Us=Io.removeBlacklistedFields;function PlayActivity(){this.config=Config.defaultConfig(),this._initCalled=!1}PlayActivity.prototype._utReset=function(){this.config=Config.defaultConfig(),this._initCalled=!1},PlayActivity.prototype.init=function(e,t,r,n,i){if(!this._initCalled){this._initCalled=!0,r&&(xs(vs,r),xs(ss,r)),function(e){$a=e}(e);var o=Config.getConfig(e),a={metricsDisabledOrBlacklistedEvent:js,removeBlacklistedFields:Us};Ls(o,a,o),Ls(Config,a,Config),Ns(this.config,o),o.setDebugSource(this.config.debugSource()),o.init(t,n,i),this.config=o}},PlayActivity.prototype.system=ss,PlayActivity.prototype.eventHandlers=vs,PlayActivity.prototype.mediaActivityTracker=Cs,PlayActivity.prototype.utils=Ds;var Fs=new PlayActivity;const Bs={"ac-3":"AC3","mp4a.a5":"AC3",alac:"Apple Lossless","ec-3":"EC3","mp4a.a6":"EC3",flac:"Free Lossless","mp4a.40.2":"AAC","mp4a.40.5":"AAC","mp4a.40.29":"AAC","mp4a.40.34":"MP3","mp4a.40.42":"AAC"},Ks=/^[0-9]+\/JOC$/,isAtmos=(e,t)=>"EC3"===Bs[e]&&(e=>Ks.test(e))(t),Vs=["dvh1.05.01","dvhe.05.06"],Gs={PQ:"HDR",HLG:"HDR",SDH:"SDH"};var Hs;const convertToVideoColorRange=(e,t)=>(e=>-1!==Vs.indexOf(e))(e)?"DolbyVision":(e=>null!==(Hs=Gs[e])&&void 0!==Hs?Hs:e)(t);function _define_property$4(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ws,qs,zs;!function(e){e.MANUAL="MANUAL",e.AUTOMATIC="AUTOMATIC",e.UNKNOWN="UNKNOWN"}(Ws||(Ws={})),function(e){e.buffering="buffering",e.idle="idle",e.paused="paused",e.playing="playing"}(qs||(qs={})),function(e){e.bufferStart="BUFFER_START",e.bufferStop="BUFFER_STOP",e.exit="EXIT",e.play="PLAY",e.pause="PAUSE",e.stop="STOP",e.next="NEXT",e.newItem="NEW"}(zs||(zs={}));const Ys={initial:"idle",states:{idle:{on:{PLAY:{target:"playing",context:{reason:"PLAY",manual:"MANUAL",fromInitialPlay:!0}}}},playing:{on:{BUFFER_START:{target:"buffering",context:{reason:"BUFFERING",manual:"AUTOMATIC",fromInitialPlay:"~~previous~~"}},EXIT:{target:"idle",context:{reason:"EXIT"}},PAUSE:{target:"paused",context:{reason:"PAUSE"}},STOP:{target:"idle",context:{}},NEXT:{target:"idle",context:{reason:"NEXT"}},NEW:{target:"idle",context:{}}}},paused:{on:{PLAY:{target:"playing",context:{reason:"UNPAUSE"}},NEW:{target:"idle",context:{}},EXIT:{target:"idle",context:{reason:"EXIT"}}}},buffering:{on:{BUFFER_STOP:{target:"playing",context:{reason:"BUFFERING",manual:"AUTOMATIC"}},EXIT:{target:"idle",context:{reason:"EXIT"}}}}}},Qs={manual:"UNKNOWN",reason:"UNKNOWN",fromInitialPlay:!1};class VPAFStateMachine{isAllowedTransition(e){return void 0!==this.getNextState(e)}transition(e,t={}){const r=this.getNextState(e);if(!r)return;Kn.debug(`[mk/activity/vpaf] Transitioning from ${this.currentState} to ${r.target} because ${e}`);const n={};return hasOwn(t,"manual")&&(void 0!==t.manual?n.manual=t.manual?"MANUAL":"AUTOMATIC":n.manual="UNKNOWN"),void 0!==t.reason&&(n.reason=t.reason),this.currentContext=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$4(e,t,r[t])}))}return e}({},Qs,r.context,n,this.preservePreviousContext(r.context)),this.currentState=r.target,this.currentContext}reset(){this.currentState=Ys.initial,this.currentContext=Qs}getNextState(e){return Ys.states[this.currentState].on[e]}preservePreviousContext(e){const t={};return["manual","reason","reasonType","fromInitialPlay"].forEach(r=>{"~~previous~~"===e[r]&&(t[r]=this.currentContext[r])}),t}constructor(){_define_property$4(this,"currentState",Ys.initial),_define_property$4(this,"currentContext",Qs)}}function asyncGeneratorStep$2(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator$2(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep$2(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$2(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property$3(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread$2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$3(e,t,r[t])}))}return e}function _object_spread_props(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _ts_decorate(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function _ts_metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const Js=Kn.createChild("vpaf");var Xs;!function(e){e.SEEK_STARTED="seekStarted",e.SEEK_STOPPED="seekStopped",e.PLAY_STARTED="playStarted",e.PLAY_STOPPED="playStopped"}(Xs||(Xs={}));const Zs={[et.playbackPause]:zs.pause,[et.playbackPlay]:zs.play,[et.playbackStop]:zs.stop,[et.playerExit]:zs.exit},ec={[ot.EXITED_APPLICATION]:"EXIT",[ot.FAILED_TO_LOAD]:"FAILURE",[ot.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM]:"PLAY_OTHER",[ot.NATURAL_END_OF_TRACK]:"COMPLETE",[ot.PLAYBACK_PAUSED_DUE_TO_INACTIVITY]:"INACTIVITY",[ot.SCRUB_BEGIN]:"SEEK",[ot.TRACK_SKIPPED_BACKWARDS]:"SEEK",[ot.TRACK_SKIPPED_FORWARDS]:"SEEK",[pi.NEXT_ITEM]:"NEXT"},tc={[e.PresentationMode.pictureinpicture]:"pictureInPicture",[e.PresentationMode.inline]:"foreground",_default:"foreground"};function asMilliseconds(e){return Math.round(1e3*e)}function ensurePositionData(e,t){var r;if(null===(r=t)||void 0===r?void 0:r.isLinearStream){if(void 0===e.playingDate)throw new Error('VPAFTracker: The property `playingDate` is required on data for "linear" content');return e}if(void 0===e.position)throw new Error('VPAFTracker: The property `position` is required on data "vod" content');return e}class VPAFTracker{get requestedEvents(){return Array.from(this.dispatchTable.keys())}get isConfigured(){return void 0!==this.instance}get currentItem(){return this._currentItem}set currentItem(e){this._currentItem=e,this.currentSkipItems=e?parseSkipItems(e):void 0}configure(e){var t=this;return _async_to_generator$2((function*(){var r;if(t.instance=e.instance,t.services=e.services,t.dispatcher=e.services.dispatcher,!qn.storekit.cid)try{yield qn.storekit.infoRefresh()}catch(i){}const n=null===(r=e.services.apiManager)||void 0===r?void 0:r.utsClient;return new Promise((e,r)=>{const i=function(){if(Array.isArray(navigator.languages))return navigator.languages;if("string"==typeof navigator.language)return[navigator.language];if("string"==typeof globalThis.navigator.userLanguage)return[globalThis.navigator.userLanguage];return[]}(),onSuccess=()=>(Fs.system.environment.setDelegate({app:()=>"com.apple.tv",appVersion:()=>"1.0",consumerId:()=>qn.storekit.cid,consumerNs:()=>"TV",isOffline:()=>!1,delegateApp:()=>"web-tv-player",osLanguages:()=>i,resourceRevNum:()=>Hn.app.build,storeFrontCountryCode(){var e,t,r,i;return null!==(i=null===(r=n)||void 0===r||null===(t=r.configuration)||void 0===t||null===(e=t.userProps)||void 0===e?void 0:e.country)&&void 0!==i?i:""}}),t.setupListeners(),t.vpafKitInited=!0,e());if(t.vpafKitInited)return onSuccess();const o={environment:fa,eventRecorder:va};Fs.init("xp_amp_tv_vpaf",null,o,onSuccess,e=>{r(e)})})}))()}cleanup(){var e=this;return _async_to_generator$2((function*(){e.tracker=void 0,e.isScrubbing=!1,e.scrubStopPosition=void 0,e.teardownListeners(),e.stopSynchronizing()}))()}shouldTrackPlayActivity(e,t){if(!t)return!1;const r=t.defaultPlayable;if(!r||!r.vpafMetrics)return!1;const n=Zs[e];return void 0===n||this.state.isAllowedTransition(n)}handleEvent(e,t,r){if(!this.shouldTrackPlayActivity(e,r))return;const n=this.dispatchTable.get(e);void 0!==n&&"function"==typeof this[n]&&this[n](r,t)}bufferStart(e,t){var r=this;return _async_to_generator$2((function*(){var n;if(Js.debug("VPAFTracker: handling bufferStart()"),!(yield r.canTrackItem(e)))return void Js.debug("VPAFTracker: aborting bufferStart, no tracker");if(r.state.currentState!==qs.playing)return void Js.debug("VPAFTracker: aborting bufferStart, not playing");if("seek"===(null===(n=r.lastTrackedEvent)||void 0===n?void 0:n.reason))return void Js.debug("VPAFTracker: aborting bufferStart, after a seek");const i=r.state.currentContext.fromInitialPlay,o=r.calculatePlaybackPosition(e,ensurePositionData(t,e));r.state.transition(zs.bufferStart),i?Js.debug("VPAFTracker: bufferStart() not tracking PLAY_STOPPED, it is from initial play"):r.trackEvent("playStopped",o)}))()}bufferEnd(e,t){var r=this;return _async_to_generator$2((function*(){var n;if(Js.debug("VPAFTracker: handling bufferEnd()"),!(yield r.canTrackItem(e)))return;if(r.state.currentState!==qs.buffering)return void Js.debug("VPAFTracker: aborting bufferEnd, not buffering");if("seek"===(null===(n=r.lastTrackedEvent)||void 0===n?void 0:n.reason))return void Js.debug("VPAFTracker: aborting bufferEnd, after a seek");const i=r.state.currentContext.fromInitialPlay,o=r.calculatePlaybackPosition(e,ensurePositionData(t,e));r.state.transition(zs.bufferStop),i?Js.debug("VPAFTracker: bufferEnd() not tracking PLAY_STARTED, it is from initial play"):r.trackEvent("playStarted",o)}))()}exit(e,t={}){var r=this;return _async_to_generator$2((function*(){(yield r.canTrackItem(r.currentItem))&&(Js.debug("VPAFTracker.exit()"),r.state.transition(zs.exit),r.trackEvent("playStopped",r.calculatePlaybackPosition(void 0,ensurePositionData(t,t.item))),r.stopSynchronizing(),r.currentItem=void 0)}))()}pause(e,t={}){var r=this;return _async_to_generator$2((function*(){if(!(yield r.canTrackItem(e)))return;Js.debug("VPAFTracker.pause()");const n=r.calculatePlaybackPosition(e,ensurePositionData(t,e)),i=t.endReasonType===pi.NEXT_ITEM?zs.next:zs.pause;r.state.transition(i,r.getExplicitStateContext(t)),r.trackEvent("playStopped",n)}))()}play(e,t={}){var r=this;return _async_to_generator$2((function*(){if(!(yield r.canTrackItem(e)))return;Js.debug("VPAFTracker.play()");const n=r.calculatePlaybackPosition(e,_object_spread$2({position:0},t));r.state.transition(zs.play,r.getExplicitStateContext(t)),r.trackEvent("playStarted",n)}))()}scrub(e,t={}){var r=this;return _async_to_generator$2((function*(){if(void 0===e||void 0===t.position)return;const n=r.calculatePlaybackPosition(e,ensurePositionData(t,e));r.isScrubbing&&void 0===t.endReasonType?r.scrubStopPosition=n:r.isScrubbing&&r.scrubEnd(e,n)}))()}seek(e,t={}){var r=this;return _async_to_generator$2((function*(){void 0!==e&&(!e.isLinearStream||void 0!==t.playingDate&&void 0!==t.startPlayingDate)&&(e.isLinearStream||void 0!==t.position&&void 0!==t.startPosition)&&(r.isSkippingIntro(t)||r.isSeekingInterval(t)?yield r.trackSeek(e,t):yield r.trackScrub(e,t))}))()}skip(e,t={}){return _async_to_generator$2((function*(){}))()}stop(e,t={}){var r=this;return _async_to_generator$2((function*(){if(!(yield r.canTrackItem(e)))return;Js.debug("VPAFTracker.stop()");const n=r.calculatePlaybackPosition(e,ensurePositionData(t,e));r.state.transition(zs.stop,r.getExplicitStateContext(t)),r.trackEvent("playStopped",n),r.stopSynchronizing(),r.currentItem=void 0}))()}lyricsPlay(e,t){return _async_to_generator$2((function*(){}))()}lyricsStop(){return _async_to_generator$2((function*(){}))()}trackSeek(e,t){var r=this;return _async_to_generator$2((function*(){const n={},i=r.getSkipActionName(t.position);r.isSkippingIntro(t)&&"string"==typeof i&&(n.actionName=i);const o=_object_spread_props(_object_spread$2({},t),{position:t.startPosition,playingDate:t.startPlayingDate});yield r.trackSeekStart(e,o,n),yield r.trackSeekStop(e,t,n)}))()}trackSeekStart(t,r,n={}){var i=this;return _async_to_generator$2((function*(){const o=r.seekReasonType===e.SeekReasonType.SkipIntro?i.tracker.SEEK_START_REASON.SKIP_INTRO:i.tracker.SEEK_START_REASON.INTERVAL,a=i.calculatePlaybackPosition(t,ensurePositionData(r,t)),s=i.tracker.TYPE.MANUAL;if(i.state.currentState===qs.playing){const e=i.isSkippingIntro(r)?_object_spread_props(_object_spread$2({},n),{stopReasonType:i.tracker.PLAY_STOP_REASON_TYPE.SKIP_INTRO}):n;i.trackEvent("playStopped",a,s,i.tracker.PLAY_STOP_REASON.SEEK,e)}i.trackEvent("seekStarted",a,s,o,n)}))()}trackSeekStop(e,t,r={}){var n=this;return _async_to_generator$2((function*(){const i=n.isSeekingInterval(t)?n.tracker.SEEK_STOP_REASON.INTERVAL:n.tracker.SEEK_STOP_REASON.SKIP_INTRO,o=n.calculatePlaybackPosition(e,ensurePositionData(t,e)),a=n.tracker.TYPE.AUTOMATIC;if(n.trackEvent("seekStopped",o,a,i,r),n.state.currentState===qs.playing){const e=n.isSkippingIntro(t)?_object_spread_props(_object_spread$2({},r),{startReasonType:n.tracker.PLAY_START_REASON_TYPE.SKIP_INTRO}):r;n.trackEvent("playStarted",o,a,n.tracker.PLAY_START_REASON.SEEK,e)}}))()}trackScrub(e,t){var r=this;return _async_to_generator$2((function*(){const n=e.isLinearStream?t.playingDate.getTime():asMilliseconds(t.position),i=e.isLinearStream?t.startPlayingDate.getTime():asMilliseconds(t.startPosition);yield r.scrubStart(e,i),yield r.scrubEnd(e,n)}))()}scrubStart(e,t){var r=this;return _async_to_generator$2((function*(){(yield r.canTrackItem(e))&&(r.isScrubbing=!0,r.scrubStopPosition=t,r.state.currentState===qs.playing&&r.trackEvent("playStopped",r.scrubStopPosition,r.tracker.TYPE.AUTOMATIC,r.tracker.PLAY_STOP_REASON.SEEK),r.trackEvent("seekStarted",t,r.tracker.TYPE.MANUAL,r.tracker.SEEK_START_REASON.SCRUB))}))()}scrubEnd(e,t){var r=this;return _async_to_generator$2((function*(){r.trackEvent("seekStopped",t,r.tracker.TYPE.MANUAL,r.tracker.SEEK_STOP_REASON.SCRUB),r.state.currentState===qs.playing&&r.trackEvent("playStarted",t,r.tracker.TYPE.AUTOMATIC,r.tracker.PLAY_START_REASON.SEEK),r.isScrubbing=!1,r.scrubStopPosition=void 0}))()}trackEvent(e,t,r,n,i){void 0===r&&(r=this.tracker.TYPE[this.state.currentContext.manual]),void 0===n&&(n="playStarted"===e?this.tracker.PLAY_START_REASON[this.state.currentContext.reason]:this.tracker.PLAY_STOP_REASON[this.state.currentContext.reason]),Js.debug(`VPAFTracker.trackEvent(${e}, ${t}, ${r}, ${n})`,i),this.tracker[e].call(this.tracker,Math.round(t),r,n,i),this.lastTrackedEvent={eventType:e,position:t,type:r,reason:n,namedArgs:i}}calculatePlaybackPosition(e,t){var r,n;if(null===(r=e)||void 0===r?void 0:r.isLinearStream){if(void 0===t.playingDate)throw new Error("VPAF: Can't report playback position for linear stream without playingDate value");return t.playingDate.getTime()}return asMilliseconds(null!==(n=t.position)&&void 0!==n?n:0)}createTracker(e){var t=this;return _async_to_generator$2((function*(){var r;const n=e.defaultPlayable,i=function(e){var t,r;const n={url:e.attributes.url,assetId:null===(r=e)||void 0===r||null===(t=r.hlsMetadata)||void 0===t?void 0:t["feature.adam-id"]};e.isLinearStream||(n.assetPlacement="feature");!0===e.attributes.isAdultContent&&(n.sensitiveContentType="adult");return n}(e),o=parseRollItems(e).map(e=>{const t={start:e.start,duration:e.duration,metricsData:{assetPlacement:e.type.replace("-",""),assetId:e["adam-id"],isSkippable:e.skippable}};return void 0!==e["dynamic-id"]&&(t.metricsData["data.dynamicSlot.dataSetId"]=e["dynamic-id"]),t});Js.debug("VPAF: Creating HLS Playlist",i);const a=Fs.mediaActivityTracker.createHLSVideoPlaylist(0,i);Js.debug("VPAF: adding roll items",o),a.addRollInfoItems(o);const s=_object_spread_props(_object_spread$2({},n.vpafMetrics,function(e,t,r){var n,i,o,a;const s=null===(i=e)||void 0===i||null===(n=i.videoContainerElement)||void 0===n?void 0:n.querySelector("video"),c={programmingType:t.isLinearStream?"live":"videoOnDemand",downloadState:"streaming",playbackFocus:"foreground",videoViewportHeight:null===(o=s)||void 0===o?void 0:o.clientHeight,videoViewportWidth:null===(a=s)||void 0===a?void 0:a.clientWidth,delegatedPlayback:determineDelegatedPlayback(e)},l=currentAudioData(e,r),d=function(e,t){var r;const{language:n,kind:i}=null!==(r=e.currentTextTrack)&&void 0!==r?r:{};if("captions"===i)return{subtitleLocale:void 0,closedCaptionLocale:n};if("subtitles"===i)return{subtitleLocale:n,closedCaptionLocale:void 0};return{subtitleLocale:void 0,closedCaptionLocale:void 0}}(e);return _object_spread$2({},c,l,d)}(t.instance,e,n)),{overallLength:calculateOverallLength(e,n,o),featureAssetId:i.assetId});return Js.debug("VPAFTracker.createTracker: creating new tracker for "+(null===(r=e)||void 0===r?void 0:r.id)),t.tracker=Fs.mediaActivityTracker.createTracker(a,Fs.utils.eventFields.applyFieldsMap(n,"utsVpafPlayable"),Fs.utils.eventFields.applyFieldsMap(e.attributes,"utsVpafContent"),s),t.startSynchronizing(),t.tracker}))()}getMappedStopReason(e){if(void 0!==e.endReasonType)return ec[e.endReasonType]}getExplicitStateContext(e){return{manual:e.userInitiated,reason:this.getMappedStopReason(e)}}onPlaybackStateChange(t,r){var n=this;return _async_to_generator$2((function*(){const{state:t}=r,i=n.currentItem;var o;const a={position:n.instance.currentPlaybackTime,playingDate:n.instance.currentPlayingDate,userInitiated:null!==(o=r.userInitiated)&&void 0!==o&&o},s="PlaybackStates."+e.PlaybackStates[r.oldState],c="PlaybackStates."+e.PlaybackStates[r.state];Js.debug(`onPlaybackStateChange: ${s} -> ${c}`,a),t===e.PlaybackStates.waiting?(n.isBuffering=!0,Js.debug("VPAFTracker.onPlaybackStateChange: triggering bufferStart()",a),yield n.bufferStart(i,a)):t===e.PlaybackStates.playing?n.isBuffering&&(n.isBuffering=!1,Js.debug("VPAFTracker.onPlaybackStateChange: triggering bufferEnd()",a),yield n.bufferEnd(i,a)):t!==e.PlaybackStates.stalled&&(Js.debug("VPAFTracker.onPlaybackStateChange: resetting isBuffering=false"),n.isBuffering=!1)}))()}handleLevelUpdated(e,t){var r;const{level:n,channels:i}=t;if(!n)return;const{audioCodec:o,videoRange:a,videoCodec:s}=n;if(!(o&&i||a&&s))return;const c={};o&&i&&(c.audioFormat=((e,t)=>{var r,n;const i=null!==(n=null===(r=e)||void 0===r?void 0:r.toLowerCase())&&void 0!==n?n:"";var o;return isAtmos(i,t)?"Atmos":null!==(o=Bs[i])&&void 0!==o?o:e})(o,i)),a&&s&&(c.videoColorRange=convertToVideoColorRange(s,a)),null===(r=this.tracker)||void 0===r||r.updateData(c)}handleAudioTrackChange(){if(void 0===this.tracker||void 0===this.instance)return;const e=currentAudioData(this.instance);e&&(Js.debug("Updating AudioData",e),this.tracker.updateData(e))}handleForcedTextTrackChange(e,t){var r,n;null===(n=this.tracker)||void 0===n||n.updateData({forcedSubtitleLocale:null===(r=t)||void 0===r?void 0:r.language})}handlePresentationModeChange(e,{mode:t}){var r,n;const i=null!==(n=tc[t])&&void 0!==n?n:tc._default;null===(r=this.tracker)||void 0===r||r.updateData({playbackFocus:i})}handleTargetWirelessChange(){var e;void 0!==this.instance&&(null===(e=this.tracker)||void 0===e||e.updateData({delegatedPlayback:determineDelegatedPlayback(this.instance)}))}handleTextTrackChange(){var e,t;const{tracker:r}=this;if(void 0===r)return;const n=null===(e=this.instance)||void 0===e?void 0:e.currentTextTrack;if(!n||"captions"!==n.kind&&"subtitles"!==(null===(t=n)||void 0===t?void 0:t.kind))return;const i=""===n.language?void 0:n.language,o={closedCaptionLocale:"captions"===n.kind?i:void 0,subtitleLocale:"subtitles"===n.kind?i:void 0};r.updateData(o)}handleNowPlayingItemDidChange(e,t){const{item:r}=t;r||(Js.debug("handleNowPlayingItemDidChange: calling exit and clearing currentItem"),this.state.transition(zs.exit),this.stopSynchronizing(),this.currentItem=void 0)}isSkippingIntro(t){return t.seekReasonType===e.SeekReasonType.SkipIntro}isSeekingInterval(t){return t.seekReasonType===e.SeekReasonType.Interval}canTrackItem(e){var t=this;return _async_to_generator$2((function*(){var r;return void 0!==e&&void 0!==e.defaultPlayable&&((null===(r=t.currentItem)||void 0===r?void 0:r.id)!==e.id&&(t.state.transition(zs.newItem),t.currentItem=e,yield t.createTracker(e)),void 0!==t.tracker)}))()}getSkipActionName(e){var t,r;return null===(t=(null!==(r=this.currentSkipItems)&&void 0!==r?r:[]).find(t=>t.target===e))||void 0===t?void 0:t.label}onVideoComponentScrubStart(e){return this.scrubStart(this.currentItem,asMilliseconds(e.detail.currentSeconds))}setupListeners(){var e,t;void 0!==this.dispatcher&&(this.dispatcher.subscribe(Bn.audioTrackChanged,this.handleAudioTrackChange),this.dispatcher.subscribe(Bn.textTrackChanged,this.handleTextTrackChange),this.dispatcher.subscribe(Bn.forcedTextTrackChanged,this.handleForcedTextTrackChange),this.dispatcher.subscribe(Bn.nowPlayingItemDidChange,this.handleNowPlayingItemDidChange),this.dispatcher.subscribe(Bn.playbackStateDidChange,this.onPlaybackStateChange),this.dispatcher.subscribe(et.hlsLevelUpdated,this.handleLevelUpdated),this.dispatcher.subscribe(Bn.playbackTargetIsWirelessDidChange,this.handleTargetWirelessChange),this.dispatcher.subscribe(Bn.presentationModeDidChange,this.handlePresentationModeChange)),(null===(t=this.services)||void 0===t||null===(e=t.runtime)||void 0===e?void 0:e.isBrowserEnvironment)&&window.addEventListener("triggerSeekStart",this.onVideoComponentScrubStart)}teardownListeners(){var e,t;void 0!==this.dispatcher&&(this.dispatcher.unsubscribe(Bn.audioTrackChanged,this.handleAudioTrackChange),this.dispatcher.unsubscribe(Bn.textTrackChanged,this.handleTextTrackChange),this.dispatcher.unsubscribe(Bn.forcedTextTrackChanged,this.handleForcedTextTrackChange),this.dispatcher.unsubscribe(Bn.nowPlayingItemDidChange,this.handleNowPlayingItemDidChange),this.dispatcher.unsubscribe(Bn.playbackStateDidChange,this.onPlaybackStateChange),this.dispatcher.unsubscribe(et.hlsLevelUpdated,this.handleLevelUpdated),this.dispatcher.unsubscribe(Bn.playbackTargetIsWirelessDidChange,this.handleTargetWirelessChange),this.dispatcher.unsubscribe(Bn.presentationModeDidChange,this.handlePresentationModeChange)),(null===(t=this.services)||void 0===t||null===(e=t.runtime)||void 0===e?void 0:e.isBrowserEnvironment)&&window.removeEventListener("triggerSeekStart",this.onVideoComponentScrubStart)}startSynchronizing(){void 0===this.synchronizeTimeout&&(this.synchronizeTimeout=setInterval(this.synchronize,6e4))}stopSynchronizing(){void 0!==this.synchronizeTimeout&&(clearInterval(this.synchronizeTimeout),this.synchronizeTimeout=void 0)}synchronize(){if(void 0===this.tracker||void 0===this.instance||void 0===this.currentItem)return void this.stopSynchronizing();const e=this.state.currentState===qs.paused,{playbackRate:t,currentPlaybackTime:r}=this.instance,n=e?0:t,i=Math.round(1e3*r);Js.debug(`VPAF: synchronize rate: ${n} and current time: ${i}`),this.tracker.synchronize(n,i)}constructor(){_define_property$3(this,"_currentItem",void 0),_define_property$3(this,"currentSkipItems",void 0),_define_property$3(this,"dispatcher",void 0),_define_property$3(this,"instance",void 0),_define_property$3(this,"services",void 0),_define_property$3(this,"isScrubbing",!1),_define_property$3(this,"isBuffering",!1),_define_property$3(this,"scrubStopPosition",void 0),_define_property$3(this,"tracker",void 0),_define_property$3(this,"vpafKitInited",!1),_define_property$3(this,"synchronizeTimeout",void 0),_define_property$3(this,"state",void 0),_define_property$3(this,"lastTrackedEvent",void 0),_define_property$3(this,"dispatchTable",new Map([[et.playbackPlay,"play"],[et.playbackPause,"pause"],[et.playbackScrub,"scrub"],[et.playbackSeek,"seek"],[et.playbackSkip,"skip"],[et.playbackStop,"stop"],[et.playerExit,"exit"]])),this.state=new VPAFStateMachine,Fs.config.setDelegate({configHostname:()=>"daf.xp.apple.com"})}}function calculateOverallLength(e,t,r){if("EbsEvent"===t.type)return;var n;let i=parseFloat(null!==(n=e.hlsMetadata["feature.duration"])&&void 0!==n?n:t.duration);for(const o of r)i+=o.duration;return asMilliseconds(i)}function currentAudioData(e,t){var r,n;const{currentAudioTrack:i,nowPlayingItem:o}=e;let a,s;var c,l,d,u,p;"description"===(null===(r=i)||void 0===r?void 0:r.kind)?(s=null===(c=i)||void 0===c?void 0:c.language,a=void 0):(a=null!==(p=null===(l=i)||void 0===l?void 0:l.language)&&void 0!==p?p:null===(u=t)||void 0===u||null===(d=u.primaryLocale)||void 0===d?void 0:d.locale,s=void 0);let h;if((null===(n=o)||void 0===n?void 0:n.isLinearStream)&&i){const e=null===(y=i.characteristics)||void 0===y?void 0:y.find(e=>e.startsWith("com.apple.amp.appletv.identifier"));isHomeRadioTrack(i)?h=or.Home:isAwayRadioTrack(i)?h=or.Away:e&&(h=e)}var y;return{audioLocale:a,audioDescriptionLocale:s,audioVariantId:h}}function determineDelegatedPlayback(e){return e.playbackTargetIsWireless?"Airplay":"None"}function _define_property$2(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}_ts_decorate([Bind(),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[String,Object])],VPAFTracker.prototype,"onPlaybackStateChange",null),_ts_decorate([Bind(),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[Object,Object])],VPAFTracker.prototype,"handleLevelUpdated",null),_ts_decorate([Bind(),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[])],VPAFTracker.prototype,"handleAudioTrackChange",null),_ts_decorate([Bind(),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[Object,Object])],VPAFTracker.prototype,"handleForcedTextTrackChange",null),_ts_decorate([Bind(),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[Object,void 0])],VPAFTracker.prototype,"handlePresentationModeChange",null),_ts_decorate([Bind(),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[])],VPAFTracker.prototype,"handleTargetWirelessChange",null),_ts_decorate([Bind(),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[])],VPAFTracker.prototype,"handleTextTrackChange",null),_ts_decorate([Bind(),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[String,Object])],VPAFTracker.prototype,"handleNowPlayingItemDidChange",null),_ts_decorate([Bind(),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",["undefined"==typeof CustomEvent?Object:CustomEvent])],VPAFTracker.prototype,"onVideoComponentScrubStart",null),_ts_decorate([Bind(),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[])],VPAFTracker.prototype,"synchronize",null);const augmentUrlQueryParameters=e=>addQueryParamsToURL(e,{webbrowser:!0}),addPreviewFromPlayable=(e,t)=>{var r,n,i,o;const a=null!==(o=null!==(i=null===(r=t.assets)||void 0===r?void 0:r.hlsUrl)&&void 0!==i?i:t.hlsUrl)&&void 0!==o?o:null===(n=t.clipAssets)||void 0===n?void 0:n[0].url;e.previews=a?[{url:augmentUrlQueryParameters(a)}]:[]},addKeysFromPlayable=(e,t)=>{const{assets:r}=t;r&&(r.fpsKeyServerUrl&&(e.keyServerQueryParameters=r.fpsKeyServerQueryParameters,e.keyURLs={"hls-key-cert-url":r.fpsCertificateUrl,"hls-key-server-url":r.fpsKeyServerUrl,"widevine-cert-url":r.wideVineCertificateUrl}),e.assetURL=augmentUrlQueryParameters(r.hlsUrl))},addPlayableToItem=(e,t,r)=>{var n,i,o,a,s,c;e.type=null!==(i=null!==(n=e.type)&&void 0!==n?n:t.type)&&void 0!==i?i:r,e.contentType=null!==(o=e.contentType)&&void 0!==o?o:t.contentType,e.attributes=null!==(a=e.attributes)&&void 0!==a?a:{},e.attributes.title=null!==(c=null!==(s=e.attributes.title)&&void 0!==s?s:e.title)&&void 0!==c?c:t.title,delete e.title,addPreviewFromPlayable(e.attributes,t),addKeysFromPlayable(e,t),e.id||(e.id=generateUUID()),e.playables=[t]},createMediaItem=e=>{var t;const r=JSON.stringify(e),n=JSON.parse(r),i=null===(t=n.playables)||void 0===t?void 0:t[0];var o;n.attributes=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property$2(e,t,r[t])}))}return e}({},null!==(o=n.attributes)&&void 0!==o?o:{},n),addPlayableToItem(n,i);return new MediaItem(n)},rc=["contributors","modalities","movie","musicVideo","musicMovie","trailer","tvEpisode","uploadedVideo","uploaded-videos","music-videos","music-movies","tv-episodes","workouts"];function asyncGeneratorStep$1(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _define_property$1(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const nc=Kn.createChild("ctp");class ClickToPlayTracker{get active(){return void 0!==this.rtcTracker}get isConfigured(){return this._isConfigured}configure(e){var t,r=this;return(t=function*(){var t;r.instance=e.instance,r.rtcTracker=null===(t=e.services.playActivity)||void 0===t?void 0:t.getTrackerByType(RTCStreamingTracker),r._isConfigured=!0},function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function _next(e){asyncGeneratorStep$1(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}handleEvent(e,t,r){e===Bn.playInitiated?(nc.debug("ClickToPlayTracker.handleEvent",e,t),this.registerPlay(t.item,t.timestamp)):e===Bn.mediaCanPlay&&(nc.debug("ClickToPlayTracker.handleEvent",e,t),this.trackPlay(this.instance.nowPlayingItem,t.timestamp))}registerPlay(e,t){if(this.active&&void 0!==e){if(void 0!==t)return void 0!==this.tracking&&nc.warn(`Replacing item ${this.tracking.item.id} with item ${e.id}`),nc.debug(`Registering ${e.id} initiated at ${t}`),this.tracking={item:e,initiatedTimestamp:t},this.tracking;nc.warn(`registerPlay timestamp value for item ${e.id} is missing, discarding`)}}trackPlay(e,t){if(!this.active||void 0===e)return;if(void 0===this.tracking)return void nc.warn("ClickToPlayTracker.trackPlay called without a registered tracking item");const r=null!=t?t:Date.now(),n=this.tracking.initiatedTimestamp,i=r-n;if(nc.debug(`trackPlay: item=${e.id}, initiated=${n}, started=${r}, timestampDiff=${i}`),n>r)return void nc.warn("Initiated timestamp is not before started timestamp, ignoring");const o=this.getReportingAgent(e);if(void 0!==o)return nc.info(`Reporting playback success after ${i}ms`),o.issueReportingEvent(ClickToPlayTracker.EVENT_ID,{event:"playbackStartup",playbackStartupResult:"success",tapToFirstFrame:i,PlayType:e.isLinearStream?"LIVE":"VOD"}),this.tracking=void 0,{item:e,initiatedTimestamp:n,playbackTimestamp:r};nc.warn(`No reporting agent for ${e.id}, discarding`)}getReportingAgent(e){if(void 0===this.rtcTracker)return void nc.warn("Could not get RTCReportingAgent from RTCStreamingTracker service");const t=this.rtcTracker.getMediaIdentifiers(e),r=this.rtcTracker.reportingAgent.SessionInfo;if(void 0===t||void 0===r)return;if(Object.entries(t).every((function([e,t]){return r[e]===t})))return this.rtcTracker.reportingAgent;nc.warn("RTCReportingAgent is not associated with item "+e.id)}constructor(){_define_property$1(this,"_isConfigured",!1),_define_property$1(this,"tracking",void 0),_define_property$1(this,"instance",void 0),_define_property$1(this,"rtcTracker",void 0),_define_property$1(this,"requestedEvents",[Bn.playInitiated,Bn.mediaCanPlay])}}function asyncGeneratorStep(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Ae){return void r(Ae)}s.done?t(c):Promise.resolve(c).then(n,i)}function _async_to_generator(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function _next(e){asyncGeneratorStep(o,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(o,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _define_property(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_define_property(e,t,r[t])}))}return e}_define_property$1(ClickToPlayTracker,"EVENT_ID",4101);const ic={mediaApi:{configureFn:mo,apiType:e.SupportedAPIs.MEDIA_API,allowDefault:!1},utsClient:{configureFn:function(e){return _configure$1.apply(this,arguments)},apiType:e.SupportedAPIs.UTS_CLIENT,allowDefault:!1}},createAPIConfiguration=(e,t)=>{var r,n;const{configureFn:i,apiType:o,allowDefault:a}=ic[e];var s;const c=((e,...t)=>{const r={};return Object.keys(e).forEach(n=>{t.includes(n)||(r[n]=e[n])}),r})(null!==(s=t.apiOptions)&&void 0!==s?s:{},"mediaApi","utsClient"),l={apiType:o,configureFn:i,options:{}};if(null===(n=t.apiOptions)||void 0===n||null===(r=n[e])||void 0===r?void 0:r.api)l.options.api=t.apiOptions[e].api;else{var d,u,p,h;const r=a?c:{};var y,_,f;l.options.apiOptions=null!==(f=null!==(_=null!==(y=null===(u=t.apiOptions)||void 0===u||null===(d=u[e])||void 0===d?void 0:d.configureOptions)&&void 0!==y?y:null===(h=t.apiOptions)||void 0===h||null===(p=h[e])||void 0===p?void 0:p.apiOptions)&&void 0!==_?_:r)&&void 0!==f?f:{}}return l};class MediaKitInstance extends MKInstance{playUtsItem(e,t,r){var n=this;return _async_to_generator((function*(){e=JSON.parse(JSON.stringify(e)),t?t=JSON.parse(JSON.stringify(t)):"EditorialVideoClip"===(t=JSON.parse(JSON.stringify(e))).type&&(t.type="Vod");const{id:i,type:o}=e,a={id:i,type:o,attributes:_object_spread({},e),playables:[t]};"Show"===o?(a.attributes.showId=e.id,a.attributes.showTitle=a.attributes.title,a.attributes.title=t.title):"Season"===o&&(a.attributes.title=t.title),addPreviewFromPlayable(a.attributes,t),addKeysFromPlayable(a,t);const s=new MediaItem(a);return n.playMediaItem(s,r)}))()}}function _configure(){return(_configure=_async_to_generator((function*(t){Zn.linkChild(Kn),Zn.linkChild(xe),Zn.linkChild(W),t.playActivityAPI=[new VPAFTracker,new BookmarkTracker],t.realm=e.SKRealm.TV,t.rtcOptions&&(t.playActivityAPI=[...t.playActivityAPI,new RTCStreamingTracker(t.rtcOptions),new ClickToPlayTracker]);return yield configure$3(t,MediaKitInstance,function(){var e=_async_to_generator((function*(e){var r,n;const i=[];(null===(r=t.apiOptions)||void 0===r?void 0:r.utsClient)&&i.push(createAPIConfiguration("utsClient",t)),(null===(n=t.apiOptions)||void 0===n?void 0:n.mediaApi)&&i.push(createAPIConfiguration("mediaApi",t)),yield e.configure(i)}));return function(t){return e.apply(this,arguments)}}())}))).apply(this,arguments)}e.Events=Bn,e.MKError=MKError,e.MediaKitInstance=MediaKitInstance,e.PlayActivityEndReasonType=pi,e.VideoTypes={movie:!0,musicVideo:!0,musicMovie:!0,trailer:!0,tvEpisode:!0,uploadedVideo:!0,"uploaded-videos":!0,"music-videos":!0,"music-movies":!0,"tv-episodes":!0,Bonus:!0,Extra:!0,Episode:!0,Movie:!0,Preview:!0,Promotional:!0,Season:!0,Show:!0,Vod:!0,EditorialVideoClip:!0,RealityVideo:!0,SportingEvent:!0,LiveService:!0},e.__dev=I,e.__log=ei,e.configure=function(e){return _configure.apply(this,arguments)},e.createMediaItem=createMediaItem,e.createMediaItemFromPlayable=(e,t="Show")=>{if(Array.isArray(e.playables))return createMediaItem(e);const r=JSON.stringify(e),n=JSON.parse(r),i={id:n.id};addPlayableToItem(i,n,t);return new MediaItem(i)},e.enableMultipleInstances=function(){uo=!0},e.formatArtworkURL=formatArtworkURL,e.formatMediaTime=function(e,t=":"){const{hours:r,minutes:n}=formattedSeconds(e);e=Math.floor(e%3600%60);const i=[];return r?(i.push(""+r),i.push(n<10?"0"+n:""+n)):i.push(""+n),i.push(e<10?"0"+e:""+e),i.join(t)},e.formattedMediaURL=formattedMediaURL,e.formattedMilliseconds=function(e){return formattedSeconds(e/1e3)},e.formattedSeconds=formattedSeconds,e.generateEmbedCode=function(e,t={height:"450",width:"660"}){if(!m.test(e))throw new Error("Invalid content url");var r;let n=null!==(r=t.height)&&void 0!==r?r:"450";var i;let o=null!==(i=t.width)&&void 0!==i?i:"660";const{kind:a,isUTS:s}=formattedMediaURL(e),c="post"===a||"musicVideo"===a||s;"song"===a||"episode"===a?n="175":c&&(n=""+Math.round(.5625*parseInt(o,10))),n=(""+n).replace(/(\d+)px/i,"$1"),o=(""+o).replace(/^(\d+)(?!px)%?$/i,"$1px");const l=(c?"width:"+o:"width:100%;"+(o?"max-width:"+o:""))+";overflow:hidden;border-radius:10px;";let d="https://embed.music.apple.com";return["podcast","episode"].includes(null!=a?a:"")&&!s&&(d="https://embed.podcasts.apple.com"),["movie","episode","season","show"].includes(null!=a?a:"")&&s&&(d="https://embed.tv.apple.com"),`<iframe ${[`allow="${S.join("; ")}"`,'frameborder="0"',n?`height="${n}"`:"",`style="${l}"`,`sandbox="${b.join(" ")}"`,`src="${e.replace(m,d)}"`].join(" ")}></iframe>`},e.getHlsJsCdnConfig=getHlsJsCdnConfig,e.getInstance=function(e){if(0!==po.length)return void 0===e?po[po.length-1]:po.find(t=>t.id===e)},e.getInstances=function(){return po},e.getPlayerType=function(e){var t,r,n,i,o,a;return(null===(t=e)||void 0===t?void 0:t.isUTS)||rc.includes(null===(r=e)||void 0===r?void 0:r.type)?"video":"podcast-episodes"===(null===(n=e)||void 0===n?void 0:n.type)?"audio":null!==(a=null===(o=e)||void 0===o||null===(i=o.attributes)||void 0===i?void 0:i.mediaKind)&&void 0!==a?a:"audio"},Object.defineProperty(e,"__esModule",{value:!0})}));
